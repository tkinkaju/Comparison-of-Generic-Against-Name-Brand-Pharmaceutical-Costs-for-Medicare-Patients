{"version":3,"file":"normalize-3d-tile-colors.js","names":["normalize3DTileColorAttribute","tile","colors","batchTable","batchIds","isRGB565","pointCount","colorArray","Uint8ClampedArray","i","batchId","dimensions","getProperty","color","map","d","type","GL","UNSIGNED_BYTE","value","size","normalized","decodeRGB565","length"],"sources":["../../../../../src/lib/parsers/helpers/normalize-3d-tile-colors.ts"],"sourcesContent":["import {decodeRGB565, GL} from '@loaders.gl/math';\n\n/* eslint-disable complexity*/\nexport function normalize3DTileColorAttribute(tile, colors, batchTable?) {\n  // no colors defined\n  if (!colors && (!tile || !tile.batchIds || !batchTable)) {\n    return null;\n  }\n\n  const {batchIds, isRGB565, pointCount} = tile;\n  // Batch table, look up colors in table\n  if (batchIds && batchTable) {\n    const colorArray = new Uint8ClampedArray(pointCount * 3);\n    for (let i = 0; i < pointCount; i++) {\n      const batchId = batchIds[i];\n      // TODO figure out what is `dimensions` used for\n      const dimensions = batchTable.getProperty(batchId, 'dimensions');\n      const color = dimensions.map((d) => d * 255);\n      colorArray[i * 3] = color[0];\n      colorArray[i * 3 + 1] = color[1];\n      colorArray[i * 3 + 2] = color[2];\n    }\n    return {\n      type: GL.UNSIGNED_BYTE,\n      value: colorArray,\n      size: 3,\n      normalized: true\n    };\n  }\n\n  // RGB565 case, convert to RGB\n  if (isRGB565) {\n    const colorArray = new Uint8ClampedArray(pointCount * 3);\n    for (let i = 0; i < pointCount; i++) {\n      const color = decodeRGB565(colors[i]);\n      colorArray[i * 3] = color[0];\n      colorArray[i * 3 + 1] = color[1];\n      colorArray[i * 3 + 2] = color[2];\n    }\n    return {\n      type: GL.UNSIGNED_BYTE,\n      value: colorArray,\n      size: 3,\n      normalized: true\n    };\n  }\n\n  // RGB case (tile.isTranslucent)\n  if (colors && colors.length === pointCount * 3) {\n    return {\n      type: GL.UNSIGNED_BYTE,\n      value: colors,\n      size: 3,\n      normalized: true\n    };\n  }\n\n  // DEFAULT: RGBA case\n  return {\n    type: GL.UNSIGNED_BYTE,\n    value: colors,\n    size: 4,\n    normalized: true\n  };\n}\n/* eslint-enable complexity*/\n"],"mappings":";;;;;;AAAA;AAGO,SAASA,6BAA6B,CAACC,IAAI,EAAEC,MAAM,EAAEC,UAAW,EAAE;EAEvE,IAAI,CAACD,MAAM,KAAK,CAACD,IAAI,IAAI,CAACA,IAAI,CAACG,QAAQ,IAAI,CAACD,UAAU,CAAC,EAAE;IACvD,OAAO,IAAI;EACb;EAEA,IAAOC,QAAQ,GAA0BH,IAAI,CAAtCG,QAAQ;IAAEC,QAAQ,GAAgBJ,IAAI,CAA5BI,QAAQ;IAAEC,UAAU,GAAIL,IAAI,CAAlBK,UAAU;EAErC,IAAIF,QAAQ,IAAID,UAAU,EAAE;IAC1B,IAAMI,UAAU,GAAG,IAAIC,iBAAiB,CAACF,UAAU,GAAG,CAAC,CAAC;IACxD,KAAK,IAAIG,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,UAAU,EAAEG,CAAC,EAAE,EAAE;MACnC,IAAMC,OAAO,GAAGN,QAAQ,CAACK,CAAC,CAAC;MAE3B,IAAME,UAAU,GAAGR,UAAU,CAACS,WAAW,CAACF,OAAO,EAAE,YAAY,CAAC;MAChE,IAAMG,KAAK,GAAGF,UAAU,CAACG,GAAG,CAAC,UAACC,CAAC;QAAA,OAAKA,CAAC,GAAG,GAAG;MAAA,EAAC;MAC5CR,UAAU,CAACE,CAAC,GAAG,CAAC,CAAC,GAAGI,KAAK,CAAC,CAAC,CAAC;MAC5BN,UAAU,CAACE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAGI,KAAK,CAAC,CAAC,CAAC;MAChCN,UAAU,CAACE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAGI,KAAK,CAAC,CAAC,CAAC;IAClC;IACA,OAAO;MACLG,IAAI,EAAEC,QAAE,CAACC,aAAa;MACtBC,KAAK,EAAEZ,UAAU;MACjBa,IAAI,EAAE,CAAC;MACPC,UAAU,EAAE;IACd,CAAC;EACH;;EAGA,IAAIhB,QAAQ,EAAE;IACZ,IAAME,WAAU,GAAG,IAAIC,iBAAiB,CAACF,UAAU,GAAG,CAAC,CAAC;IACxD,KAAK,IAAIG,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGH,UAAU,EAAEG,EAAC,EAAE,EAAE;MACnC,IAAMI,MAAK,GAAG,IAAAS,kBAAY,EAACpB,MAAM,CAACO,EAAC,CAAC,CAAC;MACrCF,WAAU,CAACE,EAAC,GAAG,CAAC,CAAC,GAAGI,MAAK,CAAC,CAAC,CAAC;MAC5BN,WAAU,CAACE,EAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAGI,MAAK,CAAC,CAAC,CAAC;MAChCN,WAAU,CAACE,EAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAGI,MAAK,CAAC,CAAC,CAAC;IAClC;IACA,OAAO;MACLG,IAAI,EAAEC,QAAE,CAACC,aAAa;MACtBC,KAAK,EAAEZ,WAAU;MACjBa,IAAI,EAAE,CAAC;MACPC,UAAU,EAAE;IACd,CAAC;EACH;;EAGA,IAAInB,MAAM,IAAIA,MAAM,CAACqB,MAAM,KAAKjB,UAAU,GAAG,CAAC,EAAE;IAC9C,OAAO;MACLU,IAAI,EAAEC,QAAE,CAACC,aAAa;MACtBC,KAAK,EAAEjB,MAAM;MACbkB,IAAI,EAAE,CAAC;MACPC,UAAU,EAAE;IACd,CAAC;EACH;;EAGA,OAAO;IACLL,IAAI,EAAEC,QAAE,CAACC,aAAa;IACtBC,KAAK,EAAEjB,MAAM;IACbkB,IAAI,EAAE,CAAC;IACPC,UAAU,EAAE;EACd,CAAC;AACH"}