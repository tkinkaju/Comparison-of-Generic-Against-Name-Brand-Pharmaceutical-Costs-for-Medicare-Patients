{"version":3,"file":"draco-module-loader.js","names":["DRACO_DECODER_VERSION","DRACO_ENCODER_VERSION","STATIC_DECODER_URL","DRACO_JS_DECODER_URL","DRACO_WASM_WRAPPER_URL","DRACO_WASM_DECODER_URL","DRACO_ENCODER_URL","loadDecoderPromise","loadEncoderPromise","loadDracoDecoderModule","options","modules","draco3d","createDecoderModule","then","draco","loadDracoDecoder","loadDracoEncoderModule","createEncoderModule","loadDracoEncoder","decoderType","loadLibrary","DracoDecoderModule","Promise","all","wasmBinary","globalThis","initializeDracoDecoder","resolve","onModuleLoaded","DracoEncoderModule"],"sources":["../../../src/lib/draco-module-loader.ts"],"sourcesContent":["// Dynamic DRACO module loading inspired by THREE.DRACOLoader\n// https://github.com/mrdoob/three.js/blob/398c4f39ebdb8b23eefd4a7a5ec49ec0c96c7462/examples/jsm/loaders/DRACOLoader.js\n// by Don McCurdy / https://www.donmccurdy.com / MIT license\n\nimport {loadLibrary} from '@loaders.gl/worker-utils';\n\nconst DRACO_DECODER_VERSION = '1.5.5';\nconst DRACO_ENCODER_VERSION = '1.4.1';\n\nconst STATIC_DECODER_URL = `https://www.gstatic.com/draco/versioned/decoders/${DRACO_DECODER_VERSION}`;\n\nconst DRACO_JS_DECODER_URL = `${STATIC_DECODER_URL}/draco_decoder.js`;\nconst DRACO_WASM_WRAPPER_URL = `${STATIC_DECODER_URL}/draco_wasm_wrapper.js`;\nconst DRACO_WASM_DECODER_URL = `${STATIC_DECODER_URL}/draco_decoder.wasm`;\n\nconst DRACO_ENCODER_URL = `https://raw.githubusercontent.com/google/draco/${DRACO_ENCODER_VERSION}/javascript/draco_encoder.js`;\n\nlet loadDecoderPromise;\nlet loadEncoderPromise;\n\nexport async function loadDracoDecoderModule(options) {\n  const modules = options.modules || {};\n\n  // Check if a bundled draco3d library has been supplied by application\n  if (modules.draco3d) {\n    loadDecoderPromise =\n      loadDecoderPromise ||\n      modules.draco3d.createDecoderModule({}).then((draco) => {\n        return {draco};\n      });\n  } else {\n    // If not, dynamically load the WASM script from our CDN\n    loadDecoderPromise = loadDecoderPromise || loadDracoDecoder(options);\n  }\n  return await loadDecoderPromise;\n}\n\nexport async function loadDracoEncoderModule(options) {\n  const modules = options.modules || {};\n\n  // Check if a bundled draco3d library has been supplied by application\n  if (modules.draco3d) {\n    loadEncoderPromise =\n      loadEncoderPromise ||\n      modules.draco3d.createEncoderModule({}).then((draco) => {\n        return {draco};\n      });\n  } else {\n    // If not, dynamically load the WASM script from our CDN\n    loadEncoderPromise = loadEncoderPromise || loadDracoEncoder(options);\n  }\n  return await loadEncoderPromise;\n}\n\n// DRACO DECODER LOADING\n\nasync function loadDracoDecoder(options) {\n  let DracoDecoderModule;\n  let wasmBinary;\n  switch (options.draco && options.draco.decoderType) {\n    case 'js':\n      DracoDecoderModule = await loadLibrary(DRACO_JS_DECODER_URL, 'draco', options);\n      break;\n\n    case 'wasm':\n    default:\n      [DracoDecoderModule, wasmBinary] = await Promise.all([\n        await loadLibrary(DRACO_WASM_WRAPPER_URL, 'draco', options),\n        await loadLibrary(DRACO_WASM_DECODER_URL, 'draco', options)\n      ]);\n  }\n  // Depends on how import happened...\n  // @ts-ignore\n  DracoDecoderModule = DracoDecoderModule || globalThis.DracoDecoderModule;\n  return await initializeDracoDecoder(DracoDecoderModule, wasmBinary);\n}\n\nfunction initializeDracoDecoder(DracoDecoderModule, wasmBinary) {\n  const options: {wasmBinary?: any} = {};\n  if (wasmBinary) {\n    options.wasmBinary = wasmBinary;\n  }\n\n  return new Promise((resolve) => {\n    DracoDecoderModule({\n      ...options,\n      onModuleLoaded: (draco) => resolve({draco}) // Module is Promise-like. Wrap in object to avoid loop.\n    });\n  });\n}\n\n// ENCODER\n\nasync function loadDracoEncoder(options) {\n  let DracoEncoderModule = await loadLibrary(DRACO_ENCODER_URL, 'draco', options);\n  // @ts-ignore\n  DracoEncoderModule = DracoEncoderModule || globalThis.DracoEncoderModule;\n\n  return new Promise((resolve) => {\n    DracoEncoderModule({\n      onModuleLoaded: (draco) => resolve({draco}) // Module is Promise-like. Wrap in object to avoid loop.\n    });\n  });\n}\n"],"mappings":"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"}