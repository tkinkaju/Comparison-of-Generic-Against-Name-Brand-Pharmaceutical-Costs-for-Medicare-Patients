{"version":3,"file":"json-parser.js","names":["JSONParser","options","undefined","Object","freeze","container","key","JSONPath","reset","parser","ClarinetParser","onready","jsonpath","previousStates","length","currentState","onopenobject","name","_openObject","emit","onkey","set","oncloseobject","_closeObject","onopenarray","_openArray","onclosearray","_closeArray","onvalue","value","_pushOrSet","onerror","error","onend","result","pop","chunk","write","close","push","newContainer","isArray"],"sources":["../../../../src/lib/parser/json-parser.ts"],"sourcesContent":["// @ts-nocheck\n\nimport ClarinetParser, {ClarinetParserOptions} from '../clarinet/clarinet';\nimport JSONPath from '../jsonpath/jsonpath';\n\n// JSONParser builds a JSON object using the events emitted by the Clarinet parser\n\nexport default class JSONParser {\n  readonly parser: ClarinetParser;\n  result = undefined;\n  previousStates = [];\n  currentState = Object.freeze({container: [], key: null});\n  jsonpath: JSONPath = new JSONPath();\n\n  constructor(options: ClarinetParserOptions) {\n    this.reset();\n    this.parser = new ClarinetParser({\n      onready: () => {\n        this.jsonpath = new JSONPath();\n        this.previousStates.length = 0;\n        this.currentState.container.length = 0;\n      },\n\n      onopenobject: (name) => {\n        this._openObject({});\n        if (typeof name !== 'undefined') {\n          this.parser.emit('onkey', name);\n        }\n      },\n\n      onkey: (name) => {\n        this.jsonpath.set(name);\n        this.currentState.key = name;\n      },\n\n      oncloseobject: () => {\n        this._closeObject();\n      },\n\n      onopenarray: () => {\n        this._openArray();\n      },\n\n      onclosearray: () => {\n        this._closeArray();\n      },\n\n      onvalue: (value) => {\n        this._pushOrSet(value);\n      },\n\n      onerror: (error) => {\n        throw error;\n      },\n\n      onend: () => {\n        this.result = this.currentState.container.pop();\n      },\n\n      ...options\n    });\n  }\n\n  reset(): void {\n    this.result = undefined;\n    this.previousStates = [];\n    this.currentState = Object.freeze({container: [], key: null});\n    this.jsonpath = new JSONPath();\n  }\n\n  write(chunk): void {\n    this.parser.write(chunk);\n  }\n\n  close(): void {\n    this.parser.close();\n  }\n\n  // PRIVATE METHODS\n\n  _pushOrSet(value): void {\n    const {container, key} = this.currentState;\n    if (key !== null) {\n      container[key] = value;\n      this.currentState.key = null;\n    } else {\n      container.push(value);\n    }\n  }\n\n  _openArray(newContainer = []): void {\n    this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: true, key: null};\n  }\n\n  _closeArray(): void {\n    this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n\n  _openObject(newContainer = {}): void {\n    this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: false, key: null};\n  }\n\n  _closeObject(): void {\n    this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n}\n"],"mappings":";;;;;;;;;;AAEA;AACA;AAA4C;AAAA;AAAA,IAIvBA,UAAU;EAO7B,oBAAYC,OAA8B,EAAE;IAAA;IAAA;IAAA;IAAA,8CALnCC,SAAS;IAAA,sDACD,EAAE;IAAA,oDACJC,MAAM,CAACC,MAAM,CAAC;MAACC,SAAS,EAAE,EAAE;MAAEC,GAAG,EAAE;IAAI,CAAC,CAAC;IAAA,gDACnC,IAAIC,iBAAQ,EAAE;IAGjC,IAAI,CAACC,KAAK,EAAE;IACZ,IAAI,CAACC,MAAM,GAAG,IAAIC,iBAAc;MAC9BC,OAAO,EAAE,mBAAM;QACb,KAAI,CAACC,QAAQ,GAAG,IAAIL,iBAAQ,EAAE;QAC9B,KAAI,CAACM,cAAc,CAACC,MAAM,GAAG,CAAC;QAC9B,KAAI,CAACC,YAAY,CAACV,SAAS,CAACS,MAAM,GAAG,CAAC;MACxC,CAAC;MAEDE,YAAY,EAAE,sBAACC,IAAI,EAAK;QACtB,KAAI,CAACC,WAAW,CAAC,CAAC,CAAC,CAAC;QACpB,IAAI,OAAOD,IAAI,KAAK,WAAW,EAAE;UAC/B,KAAI,CAACR,MAAM,CAACU,IAAI,CAAC,OAAO,EAAEF,IAAI,CAAC;QACjC;MACF,CAAC;MAEDG,KAAK,EAAE,eAACH,IAAI,EAAK;QACf,KAAI,CAACL,QAAQ,CAACS,GAAG,CAACJ,IAAI,CAAC;QACvB,KAAI,CAACF,YAAY,CAACT,GAAG,GAAGW,IAAI;MAC9B,CAAC;MAEDK,aAAa,EAAE,yBAAM;QACnB,KAAI,CAACC,YAAY,EAAE;MACrB,CAAC;MAEDC,WAAW,EAAE,uBAAM;QACjB,KAAI,CAACC,UAAU,EAAE;MACnB,CAAC;MAEDC,YAAY,EAAE,wBAAM;QAClB,KAAI,CAACC,WAAW,EAAE;MACpB,CAAC;MAEDC,OAAO,EAAE,iBAACC,KAAK,EAAK;QAClB,KAAI,CAACC,UAAU,CAACD,KAAK,CAAC;MACxB,CAAC;MAEDE,OAAO,EAAE,iBAACC,KAAK,EAAK;QAClB,MAAMA,KAAK;MACb,CAAC;MAEDC,KAAK,EAAE,iBAAM;QACX,KAAI,CAACC,MAAM,GAAG,KAAI,CAACnB,YAAY,CAACV,SAAS,CAAC8B,GAAG,EAAE;MACjD;IAAC,GAEElC,OAAO,EACV;EACJ;EAAC;IAAA;IAAA,OAED,iBAAc;MACZ,IAAI,CAACiC,MAAM,GAAGhC,SAAS;MACvB,IAAI,CAACW,cAAc,GAAG,EAAE;MACxB,IAAI,CAACE,YAAY,GAAGZ,MAAM,CAACC,MAAM,CAAC;QAACC,SAAS,EAAE,EAAE;QAAEC,GAAG,EAAE;MAAI,CAAC,CAAC;MAC7D,IAAI,CAACM,QAAQ,GAAG,IAAIL,iBAAQ,EAAE;IAChC;EAAC;IAAA;IAAA,OAED,eAAM6B,KAAK,EAAQ;MACjB,IAAI,CAAC3B,MAAM,CAAC4B,KAAK,CAACD,KAAK,CAAC;IAC1B;EAAC;IAAA;IAAA,OAED,iBAAc;MACZ,IAAI,CAAC3B,MAAM,CAAC6B,KAAK,EAAE;IACrB;;EAAC;IAAA;IAAA;;IAID,oBAAWT,KAAK,EAAQ;MACtB,yBAAyB,IAAI,CAACd,YAAY;QAAnCV,SAAS,sBAATA,SAAS;QAAEC,GAAG,sBAAHA,GAAG;MACrB,IAAIA,GAAG,KAAK,IAAI,EAAE;QAChBD,SAAS,CAACC,GAAG,CAAC,GAAGuB,KAAK;QACtB,IAAI,CAACd,YAAY,CAACT,GAAG,GAAG,IAAI;MAC9B,CAAC,MAAM;QACLD,SAAS,CAACkC,IAAI,CAACV,KAAK,CAAC;MACvB;IACF;EAAC;IAAA;IAAA,OAED,sBAAoC;MAAA,IAAzBW,YAAY,uEAAG,EAAE;MAC1B,IAAI,CAAC5B,QAAQ,CAAC2B,IAAI,CAAC,IAAI,CAAC;MACxB,IAAI,CAACT,UAAU,CAACU,YAAY,CAAC;MAC7B,IAAI,CAAC3B,cAAc,CAAC0B,IAAI,CAAC,IAAI,CAACxB,YAAY,CAAC;MAC3C,IAAI,CAACA,YAAY,GAAG;QAACV,SAAS,EAAEmC,YAAY;QAAEC,OAAO,EAAE,IAAI;QAAEnC,GAAG,EAAE;MAAI,CAAC;IACzE;EAAC;IAAA;IAAA,OAED,uBAAoB;MAClB,IAAI,CAACM,QAAQ,CAACuB,GAAG,EAAE;MACnB,IAAI,CAACpB,YAAY,GAAG,IAAI,CAACF,cAAc,CAACsB,GAAG,EAAE;IAC/C;EAAC;IAAA;IAAA,OAED,uBAAqC;MAAA,IAAzBK,YAAY,uEAAG,CAAC,CAAC;MAC3B,IAAI,CAAC5B,QAAQ,CAAC2B,IAAI,CAAC,IAAI,CAAC;MACxB,IAAI,CAACT,UAAU,CAACU,YAAY,CAAC;MAC7B,IAAI,CAAC3B,cAAc,CAAC0B,IAAI,CAAC,IAAI,CAACxB,YAAY,CAAC;MAC3C,IAAI,CAACA,YAAY,GAAG;QAACV,SAAS,EAAEmC,YAAY;QAAEC,OAAO,EAAE,KAAK;QAAEnC,GAAG,EAAE;MAAI,CAAC;IAC1E;EAAC;IAAA;IAAA,OAED,wBAAqB;MACnB,IAAI,CAACM,QAAQ,CAACuB,GAAG,EAAE;MACnB,IAAI,CAACpB,YAAY,GAAG,IAAI,CAACF,cAAc,CAACsB,GAAG,EAAE;IAC/C;EAAC;EAAA;AAAA;AAAA"}