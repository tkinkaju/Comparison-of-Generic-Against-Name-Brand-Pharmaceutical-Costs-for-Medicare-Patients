{"version":3,"file":"geojson-tiler.js","names":["convert","clip","wrap","transformTile","createTile","DEFAULT_OPTIONS","maxZoom","indexMaxZoom","indexMaxPoints","tolerance","extent","buffer","lineMetrics","promoteId","undefined","generateId","debug","GeoJSONTiler","constructor","data","options","console","time","Error","features","timeEnd","log","length","splitTile","tiles","numFeatures","numPoints","total","JSON","stringify","stats","getTile","z","x","y","z2","id","toID","z0","x0","y0","parent","source","cz","cx","cy","stack","pop","tile","tileCoords","push","numSimplified","key","zoomSteps","k1","k2","k3","k4","tl","bl","tr","br","left","minX","maxX","right","minY","maxY"],"sources":["../../../../src/lib/geojson-tiler/geojson-tiler.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n\n/* eslint-disable no-console, no-continue */\n\nimport type {GeoJSONTile, GeoJSONTileFeature} from './tile';\n\nimport {convert} from './convert'; // GeoJSON conversion and preprocessing\nimport {clip} from './clip'; // stripe clipping algorithm\nimport {wrap} from './wrap'; // date line processing\nimport {transformTile} from './transform'; // coordinate transformation\nimport {createTile} from './tile'; // final simplified tile generation\n\n/** Options to configure tiling */\nexport type GeoJSONTilerOptions = {\n  maxZoom?: number /** max zoom to preserve detail on */;\n  indexMaxZoom?: number /** max zoom in the tile index */;\n  indexMaxPoints?: number /** max number of points per tile in the tile index */;\n  tolerance?: number /** simplification tolerance (higher means simpler) */;\n  extent?: number /** tile extent */;\n  buffer?: number /** tile buffer on each side */;\n  lineMetrics?: boolean /** whether to calculate line metrics */;\n  promoteId?: string /** name of a feature property to be promoted to feature.id */;\n  generateId?: boolean /** whether to generate feature ids. Cannot be used with promoteId */;\n  debug?: number /** logging level (0, 1 or 2) */;\n};\n\nconst DEFAULT_OPTIONS: Required<GeoJSONTilerOptions> = {\n  maxZoom: 14, // max zoom to preserve detail on\n  indexMaxZoom: 5, // max zoom in the tile index\n  indexMaxPoints: 100000, // max number of points per tile in the tile index\n  tolerance: 3, // simplification tolerance (higher means simpler)\n  extent: 4096, // tile extent\n  buffer: 64, // tile buffer on each side\n  lineMetrics: false, // whether to calculate line metrics\n  // @ts-expect-error Ensures all these required params have defaults\n  promoteId: undefined, // name of a feature property to be promoted to feature.id\n  generateId: false, // whether to generate feature ids. Cannot be used with promoteId\n  debug: 0 // logging level (0, 1 or 2)\n};\n\nexport class GeoJSONTiler {\n  options: Required<GeoJSONTilerOptions>;\n\n  // tiles and tileCoords are part of the public API\n  tiles: Record<string, GeoJSONTile> = {};\n  tileCoords: {x: number; y: number; z: number}[] = [];\n\n  stats: Record<string, number> = {};\n  total: number = 0;\n\n  constructor(data, options?: GeoJSONTilerOptions) {\n    this.options = {...DEFAULT_OPTIONS, ...options};\n    options = this.options;\n\n    const debug = options.debug;\n\n    if (debug) console.time('preprocess data');\n\n    if (this.options.maxZoom < 0 || this.options.maxZoom > 24) {\n      throw new Error('maxZoom should be in the 0-24 range');\n    }\n    if (options.promoteId && this.options.generateId) {\n      throw new Error('promoteId and generateId cannot be used together.');\n    }\n\n    // projects and adds simplification info\n    let features = convert(data, options);\n\n    if (debug) {\n      console.timeEnd('preprocess data');\n      console.log(\n        'index: maxZoom: %d, maxPoints: %d',\n        options.indexMaxZoom,\n        options.indexMaxPoints\n      );\n      console.time('generate tiles');\n    }\n\n    // wraps features (ie extreme west and extreme east)\n    features = wrap(features, this.options);\n\n    // start slicing from the top tile down\n    if (features.length) {\n      this.splitTile(features, 0, 0, 0);\n    }\n\n    if (debug) {\n      if (features.length) {\n        console.log('features: %d, points: %d', this.tiles[0].numFeatures, this.tiles[0].numPoints);\n      }\n      console.timeEnd('generate tiles');\n      console.log('tiles generated:', this.total, JSON.stringify(this.stats));\n    }\n  }\n\n  /**\n   * Get a tile at the specified index\n   * @param z\n   * @param x\n   * @param y\n   * @returns\n   */\n  // eslint-disable-next-line complexity, max-statements\n  getTile(z: number, x: number, y: number): GeoJSONTile | null {\n    // z = +z;\n    // x = +x;\n    // y = +y;\n\n    const {extent, debug} = this.options;\n\n    if (z < 0 || z > 24) {\n      return null;\n    }\n\n    const z2 = 1 << z;\n    x = (x + z2) & (z2 - 1); // wrap tile x coordinate\n\n    const id = toID(z, x, y);\n    if (this.tiles[id]) {\n      return transformTile(this.tiles[id], extent);\n    }\n\n    if (debug > 1) console.log('drilling down to z%d-%d-%d', z, x, y);\n\n    let z0 = z;\n    let x0 = x;\n    let y0 = y;\n    let parent;\n\n    while (!parent && z0 > 0) {\n      z0--;\n      x0 = x0 >> 1;\n      y0 = y0 >> 1;\n      parent = this.tiles[toID(z0, x0, y0)];\n    }\n\n    if (!parent || !parent.source) {\n      return null;\n    }\n\n    // if we found a parent tile containing the original geometry, we can drill down from it\n    if (debug > 1) {\n      console.log('found parent tile z%d-%d-%d', z0, x0, y0);\n      console.time('drilling down');\n    }\n    this.splitTile(parent.source, z0, x0, y0, z, x, y);\n    if (debug > 1) {\n      console.timeEnd('drilling down');\n    }\n\n    return this.tiles[id] ? transformTile(this.tiles[id], extent) : null;\n  }\n\n  /**\n   * splits features from a parent tile to sub-tiles.\n   * @param z, x, and y are the coordinates of the parent tile\n   * @param cz, cx, and cy are the coordinates of the target tile\n   *\n   * If no target tile is specified, splitting stops when we reach the maximum\n   * zoom or the number of points is low as specified in the options.\n   */\n  // eslint-disable-next-line max-params, max-statements, complexity\n  splitTile(\n    features: GeoJSONTileFeature[],\n    z: number,\n    x: number,\n    y: number,\n    cz?: number,\n    cx?: number,\n    cy?: number\n  ): void {\n    const stack: any[] = [features, z, x, y];\n    const options = this.options;\n    const debug = options.debug;\n\n    // avoid recursion by using a processing queue\n    while (stack.length) {\n      y = stack.pop();\n      x = stack.pop();\n      z = stack.pop();\n      features = stack.pop();\n\n      const z2 = 1 << z;\n      const id = toID(z, x, y);\n      let tile = this.tiles[id];\n\n      if (!tile) {\n        if (debug > 1) {\n          console.time('creation');\n        }\n\n        tile = this.tiles[id] = createTile(features, z, x, y, options);\n        this.tileCoords.push({z, x, y});\n\n        if (debug) {\n          if (debug > 1) {\n            console.log(\n              'tile z%d-%d-%d (features: %d, points: %d, simplified: %d)',\n              z,\n              x,\n              y,\n              tile.numFeatures,\n              tile.numPoints,\n              tile.numSimplified\n            );\n            console.timeEnd('creation');\n          }\n          const key = `z${z}`;\n          this.stats[key] = (this.stats[key] || 0) + 1;\n          this.total++;\n        }\n      }\n\n      // save reference to original geometry in tile so that we can drill down later if we stop now\n      tile.source = features;\n\n      // if it's the first-pass tiling\n      if (cz === undefined) {\n        // stop tiling if we reached max zoom, or if the tile is too simple\n        if (z === options.indexMaxZoom || tile.numPoints <= options.indexMaxPoints) continue;\n        // if a drilldown to a specific tile\n      } else if (z === options.maxZoom || z === cz) {\n        // stop tiling if we reached base zoom or our target tile zoom\n        continue;\n      } else if (cz !== undefined) {\n        // stop tiling if it's not an ancestor of the target tile\n        const zoomSteps = cz - z;\n        // @ts-expect-error TODO fix the types of cx cy\n        if (x !== cx >> zoomSteps || y !== cy >> zoomSteps) continue;\n      }\n\n      // if we slice further down, no need to keep source geometry\n      tile.source = null;\n\n      if (features.length === 0) continue;\n\n      if (debug > 1) console.time('clipping');\n\n      // values we'll use for clipping\n      const k1 = (0.5 * options.buffer) / options.extent;\n      const k2 = 0.5 - k1;\n      const k3 = 0.5 + k1;\n      const k4 = 1 + k1;\n\n      let tl: GeoJSONTileFeature[] | null = null;\n      let bl: GeoJSONTileFeature[] | null = null;\n      let tr: GeoJSONTileFeature[] | null = null;\n      let br: GeoJSONTileFeature[] | null = null;\n\n      let left = clip(features, z2, x - k1, x + k3, 0, tile.minX, tile.maxX, options);\n      let right = clip(features, z2, x + k2, x + k4, 0, tile.minX, tile.maxX, options);\n\n      // @ts-expect-error - unclear why this is needed?\n      features = null;\n\n      if (left) {\n        tl = clip(left, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n        bl = clip(left, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n        left = null;\n      }\n\n      if (right) {\n        tr = clip(right, z2, y - k1, y + k3, 1, tile.minY, tile.maxY, options);\n        br = clip(right, z2, y + k2, y + k4, 1, tile.minY, tile.maxY, options);\n        right = null;\n      }\n\n      if (debug > 1) console.timeEnd('clipping');\n\n      stack.push(tl || [], z + 1, x * 2, y * 2);\n      stack.push(bl || [], z + 1, x * 2, y * 2 + 1);\n      stack.push(tr || [], z + 1, x * 2 + 1, y * 2);\n      stack.push(br || [], z + 1, x * 2 + 1, y * 2 + 1);\n    }\n  }\n}\n\nfunction toID(z, x, y) {\n  return ((1 << z) * y + x) * 32 + z;\n}\n"],"mappings":"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"}