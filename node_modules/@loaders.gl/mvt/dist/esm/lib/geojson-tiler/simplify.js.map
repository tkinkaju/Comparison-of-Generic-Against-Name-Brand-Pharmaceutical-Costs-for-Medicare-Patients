{"version":3,"file":"simplify.js","names":["simplify","coords","first","last","sqTolerance","maxSqDist","mid","minPosToMid","index","ax","ay","bx","by","i","d","getSqSegDist","posToMid","Math","abs","px","py","x","y","dx","dy","t"],"sources":["../../../../src/lib/geojson-tiler/simplify.ts"],"sourcesContent":["// loaders.gl, MIT license\n// Forked from https://github.com/mapbox/geojson-vt under compatible ISC license\n\n/**\n * Calculate simplification data using optimized Douglas-Peucker algorithm\n *\n * @param coords contiguous list of coordinates\n * @param first first coord to simplify\n * @param last last coord to simplify\n * @param sqTolerance tolerance (square distance)\n */\nexport function simplify(coords: number[], first: number, last: number, sqTolerance: number): void {\n  let maxSqDist = sqTolerance;\n  const mid = (last - first) >> 1;\n  let minPosToMid = last - first;\n  let index;\n\n  const ax = coords[first];\n  const ay = coords[first + 1];\n  const bx = coords[last];\n  const by = coords[last + 1];\n\n  for (let i = first + 3; i < last; i += 3) {\n    const d = getSqSegDist(coords[i], coords[i + 1], ax, ay, bx, by);\n\n    if (d > maxSqDist) {\n      index = i;\n      maxSqDist = d;\n    } else if (d === maxSqDist) {\n      // a workaround to ensure we choose a pivot close to the middle of the list,\n      // reducing recursion depth, for certain degenerate inputs\n      // https://github.com/mapbox/geojson-vt/issues/104\n      const posToMid = Math.abs(i - mid);\n      if (posToMid < minPosToMid) {\n        index = i;\n        minPosToMid = posToMid;\n      }\n    }\n  }\n\n  if (maxSqDist > sqTolerance) {\n    if (index - first > 3) simplify(coords, first, index, sqTolerance);\n    coords[index + 2] = maxSqDist;\n    if (last - index > 3) simplify(coords, index, last, sqTolerance);\n  }\n}\n\n/** square distance from a point to a segment */\n// eslint-disable-next-line max-params\nfunction getSqSegDist(\n  px: number,\n  py: number,\n  x: number,\n  y: number,\n  bx: number,\n  by: number\n): number {\n  let dx = bx - x;\n  let dy = by - y;\n\n  if (dx !== 0 || dy !== 0) {\n    const t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n    if (t > 1) {\n      x = bx;\n      y = by;\n    } else if (t > 0) {\n      x += dx * t;\n      y += dy * t;\n    }\n  }\n\n  dx = px - x;\n  dy = py - y;\n\n  return dx * dx + dy * dy;\n}\n"],"mappings":";;AAWA,OAAO,SAASA,QAAQ,CAACC,MAAgB,EAAEC,KAAa,EAAEC,IAAY,EAAEC,WAAmB,EAAQ;EACjG,IAAIC,SAAS,GAAGD,WAAW;EAC3B,MAAME,GAAG,GAAIH,IAAI,GAAGD,KAAK,IAAK,CAAC;EAC/B,IAAIK,WAAW,GAAGJ,IAAI,GAAGD,KAAK;EAC9B,IAAIM,KAAK;EAET,MAAMC,EAAE,GAAGR,MAAM,CAACC,KAAK,CAAC;EACxB,MAAMQ,EAAE,GAAGT,MAAM,CAACC,KAAK,GAAG,CAAC,CAAC;EAC5B,MAAMS,EAAE,GAAGV,MAAM,CAACE,IAAI,CAAC;EACvB,MAAMS,EAAE,GAAGX,MAAM,CAACE,IAAI,GAAG,CAAC,CAAC;EAE3B,KAAK,IAAIU,CAAC,GAAGX,KAAK,GAAG,CAAC,EAAEW,CAAC,GAAGV,IAAI,EAAEU,CAAC,IAAI,CAAC,EAAE;IACxC,MAAMC,CAAC,GAAGC,YAAY,CAACd,MAAM,CAACY,CAAC,CAAC,EAAEZ,MAAM,CAACY,CAAC,GAAG,CAAC,CAAC,EAAEJ,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAEhE,IAAIE,CAAC,GAAGT,SAAS,EAAE;MACjBG,KAAK,GAAGK,CAAC;MACTR,SAAS,GAAGS,CAAC;IACf,CAAC,MAAM,IAAIA,CAAC,KAAKT,SAAS,EAAE;MAI1B,MAAMW,QAAQ,GAAGC,IAAI,CAACC,GAAG,CAACL,CAAC,GAAGP,GAAG,CAAC;MAClC,IAAIU,QAAQ,GAAGT,WAAW,EAAE;QAC1BC,KAAK,GAAGK,CAAC;QACTN,WAAW,GAAGS,QAAQ;MACxB;IACF;EACF;EAEA,IAAIX,SAAS,GAAGD,WAAW,EAAE;IAC3B,IAAII,KAAK,GAAGN,KAAK,GAAG,CAAC,EAAEF,QAAQ,CAACC,MAAM,EAAEC,KAAK,EAAEM,KAAK,EAAEJ,WAAW,CAAC;IAClEH,MAAM,CAACO,KAAK,GAAG,CAAC,CAAC,GAAGH,SAAS;IAC7B,IAAIF,IAAI,GAAGK,KAAK,GAAG,CAAC,EAAER,QAAQ,CAACC,MAAM,EAAEO,KAAK,EAAEL,IAAI,EAAEC,WAAW,CAAC;EAClE;AACF;;AAIA,SAASW,YAAY,CACnBI,EAAU,EACVC,EAAU,EACVC,CAAS,EACTC,CAAS,EACTX,EAAU,EACVC,EAAU,EACF;EACR,IAAIW,EAAE,GAAGZ,EAAE,GAAGU,CAAC;EACf,IAAIG,EAAE,GAAGZ,EAAE,GAAGU,CAAC;EAEf,IAAIC,EAAE,KAAK,CAAC,IAAIC,EAAE,KAAK,CAAC,EAAE;IACxB,MAAMC,CAAC,GAAG,CAAC,CAACN,EAAE,GAAGE,CAAC,IAAIE,EAAE,GAAG,CAACH,EAAE,GAAGE,CAAC,IAAIE,EAAE,KAAKD,EAAE,GAAGA,EAAE,GAAGC,EAAE,GAAGA,EAAE,CAAC;IAE/D,IAAIC,CAAC,GAAG,CAAC,EAAE;MACTJ,CAAC,GAAGV,EAAE;MACNW,CAAC,GAAGV,EAAE;IACR,CAAC,MAAM,IAAIa,CAAC,GAAG,CAAC,EAAE;MAChBJ,CAAC,IAAIE,EAAE,GAAGE,CAAC;MACXH,CAAC,IAAIE,EAAE,GAAGC,CAAC;IACb;EACF;EAEAF,EAAE,GAAGJ,EAAE,GAAGE,CAAC;EACXG,EAAE,GAAGJ,EAAE,GAAGE,CAAC;EAEX,OAAOC,EAAE,GAAGA,EAAE,GAAGC,EAAE,GAAGA,EAAE;AAC1B"}