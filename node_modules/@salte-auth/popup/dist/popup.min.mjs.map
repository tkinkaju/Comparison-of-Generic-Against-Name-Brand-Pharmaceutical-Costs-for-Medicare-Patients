{"version":3,"file":"popup.min.mjs","sources":["../node_modules/@babel/runtime/helpers/asyncToGenerator.js","../src/popup.ts"],"sourcesContent":["function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","import { Handler, SalteAuthError, Utils } from '@salte-auth/salte-auth';\n\nexport class Popup extends Handler {\n  public constructor(config?: Popup.Config) {\n    super(config);\n\n    this.config = Utils.Common.defaults(this.config, {\n      window: {\n        name: '@salte-auth/tab',\n        height: 600,\n        width: 600\n      }\n    });\n  }\n\n  public get name() {\n    return 'popup';\n  }\n\n  public get auto() {\n    return false;\n  }\n\n  public async open(options: Handler.OpenOptions) {\n    const top = ((window.innerHeight / 2) - (this.config.window.height / 2)) + window.screenTop;\n    const left = ((window.innerWidth / 2) - (this.config.window.width / 2)) + window.screenLeft;\n    const popupWindow = window.open(options.url, this.config.window.name, `height=${this.config.window.height}, width=${this.config.window.width}, status=yes, toolbar=no, menubar=no, location=no, top=${top}, left=${left}`);\n    if (!popupWindow) {\n      throw new SalteAuthError({\n        message: 'We were unable to open the popup window, its likely that the request was blocked.',\n        code: 'popup_blocked'\n      });\n    }\n\n    popupWindow.focus();\n    // TODO: Find a better way of tracking when a Window closes.\n    return new Promise((resolve) => {\n      const checker = setInterval(() => {\n        try {\n          if (!popupWindow.closed) {\n            // This could throw cross-domain errors, so we need to silence them.\n            if (popupWindow.location.href.indexOf(options.redirectUrl) !== 0) return;\n\n            const parsed = Utils.URL.parse(popupWindow.location);\n\n            popupWindow.close();\n            setTimeout(() => resolve(parsed));\n          }\n\n          clearInterval(checker);\n        } catch (e) {} // eslint-disable-line\n      }, 100);\n    });\n  }\n}\n\nexport interface Popup {\n  config: Popup.Config;\n}\n\nexport declare namespace Popup {\n  export interface Config extends Handler.Config {\n    /**\n     * The name to attach to the popup window.\n     *\n     * @default 'salte-auth'\n     */\n    name?: string;\n\n    /**\n     * The height of the popup window.\n     *\n     * @default 600\n     */\n    height?: number;\n\n    /**\n     * The width of the popup window.\n     *\n     * @default 600\n     */\n    width?: number;\n  }\n}\n"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","fn","self","this","args","arguments","apply","err","undefined","Popup","Handler","constructor","config","Utils","Common","defaults","window","name","height","width","open","options","top","innerHeight","_this","screenTop","left","innerWidth","screenLeft","popupWindow","url","SalteAuthError","message","code","focus","checker","setInterval","closed","location","href","indexOf","redirectUrl","parsed","URL","parse","close","setTimeout","clearInterval","e"],"mappings":";;;;;;;gFAAA,SAASA,EAAmBC,EAAKC,EAASC,EAAQC,EAAOC,EAAQC,EAAKC,GACpE,IACE,IAAIC,EAAOP,EAAIK,GAAKC,GAChBE,EAAQD,EAAKC,MACjB,MAAOC,GAEP,YADAP,EAAOO,GAILF,EAAKG,KACPT,EAAQO,GAERG,QAAQV,QAAQO,GAAOI,KAAKT,EAAOC,GAwBvC,MApBA,SAA2BS,GACzB,OAAO,WACL,IAAIC,EAAOC,KACPC,EAAOC,UACX,OAAO,IAAIN,QAAQ,SAAUV,EAASC,GACpC,IAAIF,EAAMa,EAAGK,MAAMJ,EAAME,GAEzB,SAASb,EAAMK,GACbT,EAAmBC,EAAKC,EAASC,EAAQC,EAAOC,EAAQ,OAAQI,GAGlE,SAASJ,EAAOe,GACdpB,EAAmBC,EAAKC,EAASC,EAAQC,EAAOC,EAAQ,QAASe,GAGnEhB,OAAMiB,OC7BL,MAAMC,UAAcC,EAClBC,YAAYC,SACXA,QAEDA,OAASC,EAAMC,OAAOC,SAASZ,KAAKS,OAAQ,CAC/CI,OAAQ,CACNC,KAAM,kBACNC,OAAQ,IACRC,MAAO,wBAMJ,0BAIA,EAGIC,KAAKC,yCACVC,EAAQN,OAAOO,YAAc,EAAMC,EAAKZ,OAAOI,OAAOE,OAAS,EAAMF,OAAOS,UAC5EC,EAASV,OAAOW,WAAa,EAAMH,EAAKZ,OAAOI,OAAOG,MAAQ,EAAMH,OAAOY,WAC3EC,EAAcb,OAAOI,KAAKC,EAAQS,IAAKN,EAAKZ,OAAOI,OAAOC,sBAAgBO,EAAKZ,OAAOI,OAAOE,0BAAiBM,EAAKZ,OAAOI,OAAOG,wEAA+DG,oBAAaI,QAC9MG,QACG,IAAIE,EAAe,CACvBC,QAAS,oFACTC,KAAM,yBAIVJ,EAAYK,QAEL,IAAInC,QAASV,UACZ8C,EAAUC,YAAY,aAEnBP,EAAYQ,OAAQ,IAEwC,IAA3DR,EAAYS,SAASC,KAAKC,QAAQnB,EAAQoB,aAAoB,aAE5DC,EAAS7B,EAAM8B,IAAIC,MAAMf,EAAYS,UAE3CT,EAAYgB,QACZC,WAAW,IAAMzD,EAAQqD,IAG3BK,cAAcZ,GACd,MAAOa,MACR"}