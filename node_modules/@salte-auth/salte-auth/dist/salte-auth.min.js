/**
 * @salte-auth/salte-auth JavaScript Library v3.0.0-rc.8
 *
 * @license MIT (https://github.com/salte-auth/salte-auth/blob/master/LICENSE)
 *
 * Made with â™¥ by Nick Woodward <nick@salte.io>, Dave Woodward <dave@salte.io>
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e=e||self).salte=e.salte||{},e.salte.auth={}))}(this,function(e){"use strict";function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=t(function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function s(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(e,t,n){var r=l;return function(o,i){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw i;return A()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=E(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var s=u(e,t,n);if("normal"===s.type){if(r=n.done?p:f,s.arg===d)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=p,n.method="throw",n.arg=s.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l="suspendedStart",f="suspendedYield",h="executing",p="completed",d={};function v(){}function y(){}function g(){}var m={};m[i]=function(){return this};var w=Object.getPrototypeOf,k=w&&w(w(L([])));k&&k!==n&&r.call(k,i)&&(m=k);var b=g.prototype=v.prototype=Object.create(m);function x(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function _(e){var t;this._invoke=function(n,o){function i(){return new Promise(function(t,i){!function t(n,o,i,a){var c=u(e[n],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(l).then(function(e){s.value=e,i(s)},function(e){return t("throw",e,i,a)})}a(c.arg)}(n,o,t,i)})}return t=t?t.then(i,i):i()}}function E(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,E(e,n),"throw"===n.method))return d;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var o=u(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,d;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,d):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,d)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function L(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:A}}function A(){return{value:t,done:!0}}return y.prototype=b.constructor=g,g.constructor=y,g[c]=y.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(_.prototype),_.prototype[a]=function(){return this},e.AsyncIterator=_,e.async=function(t,n,r,o){var i=new _(s(t,n,r,o));return e.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})},x(b),b[c]="Generator",b[i]=function(){return this},b.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=L,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:L(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}});function r(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,o)}var o=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function c(e){r(a,o,i,c,s,"next",e)}function s(e){r(a,o,i,c,s,"throw",e)}c(void 0)})}};var i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e},s=t(function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(r){return"function"==typeof Symbol&&"symbol"===t(Symbol.iterator)?e.exports=n=function(e){return t(e)}:e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":t(e)},n(r)}e.exports=n});var u=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var l=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?u(e):t},f=t(function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t}),h=t(function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,r)}e.exports=t});var p=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)};var d=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var v=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},y=t(function(e){function t(n,r,o){return!function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?e.exports=t=function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&h(o,n.prototype),o}:e.exports=t=Reflect.construct,t.apply(null,arguments)}e.exports=t}),g=function(e){function t(e){var n,r=e.message,o=e.code;return i(this,t),n=l(this,f(t).call(this,r)),d(u(n),"code",void 0),n.code=o,n}return p(t,e),t}(t(function(e){function t(n){var r="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!v(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return y(e,arguments,f(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),h(t,e)},t(n)}e.exports=t})(Error)),m=function(){function e(t){i(this,e),this.config=t||{}}return c(e,[{key:"required",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.filter(function(t){return void 0===e.config[t]});if(o.length>0)throw new g({code:"missing_required_properties",message:"Missing the following required fields. (".concat(o.join(", "),")")})}}]),e}(),w=function(){function e(){i(this,e)}return c(e,null,[{key:"setup",value:function(t){this.hasSetup&&!t||(this.hasSetup=!0,this.interceptors=[],this.real||(this.real=window.fetch),window.fetch&&(window.fetch=function(){var t=o(n.mark(function t(r,o){var i,a,c;return n.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=r instanceof Request?r:new Request(r,o),a=0;case 2:if(!(a<e.interceptors.length)){t.next=9;break}return c=e.interceptors[a],t.next=6,Promise.resolve(c(i));case 6:a++,t.next=2;break;case 9:return t.abrupt("return",e.real.call(this,i));case 10:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}()))}},{key:"add",value:function(e){this.setup(),this.interceptors.push(e)}}]),e}();d(w,"real",void 0),d(w,"hasSetup",!1),d(w,"interceptors",void 0);var k=!1,b=[];function x(){b.forEach(function(e){return e()})}var _=function(){function e(){i(this,e)}return c(e,null,[{key:"route",value:function(e){k||(window.addEventListener("popstate",x,{passive:!0}),window.addEventListener("click",x,{passive:!0}),setTimeout(x),k=!0),b.push(e)}},{key:"create",value:function(e,t){var n=document.createEvent("Event");return n.initEvent(e,t.bubbles||!1,t.cancelable||!0),n.detail=t.detail,n}},{key:"isCrossDomainError",value:function(e){return e instanceof DOMException||"Permission denied"===e.message}}]),e}(),E=function(){function e(){i(this,e)}return c(e,null,[{key:"setup",value:function(t){if(!this.hasSetup||t){this.hasSetup=!0,this.interceptors=[],this.realOpen||(this.realOpen=XMLHttpRequest.prototype.open),this.realSend||(this.realSend=XMLHttpRequest.prototype.send);var n=XMLHttpRequest.prototype;n.open=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n[1];return this.$url=o,e.realOpen.apply(this,n)},n.send=function(t){for(var n=this,r=[],o=0;o<e.interceptors.length;o++){var i=e.interceptors[o];r.push(i(this,t))}Promise.all(r).then(function(){e.realSend.call(n,t)}).catch(function(e){n.dispatchEvent(_.create("error",{detail:e}))})}}}},{key:"add",value:function(e){this.setup(),this.interceptors.push(e)}}]),e}();d(E,"realOpen",void 0),d(E,"realSend",void 0),d(E,"hasSetup",!1),d(E,"interceptors",void 0);var O=Object.freeze({Fetch:w,XHR:E});var S=function(e){if(Array.isArray(e))return e};var T=function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n};var L=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var A,j,$,U=function(e,t){return S(e)||T(e,t)||L()},R=function(){function e(){i(this,e)}return c(e,null,[{key:"resolve",value:function(e){return A||(A=document.implementation.createHTMLDocument("url"),j=A.createElement("base"),$=A.createElement("a"),A.head.appendChild(j)),j.href=window.location.protocol+"//"+window.location.host,$.href=e.replace(/ /g,"%20"),$.href.replace(/\/$/,"")}},{key:"match",value:function(e,t){var n=this;if(t instanceof Array){var r=this.resolve(e),o=q.find(t,function(e){return e instanceof RegExp?!!r.match(e):0===r.indexOf(n.resolve(e))});return!!o}return!0===t}},{key:"parse",value:function(e){var t=e.search,n=e.hash,r=[];t&&(r=r.concat(t.replace("?","").split("&"))),n&&(r=r.concat(n.replace("#","").split("&")));var o={};return q.forEach(r,function(e){var t=e.split("="),n=U(t,2),r=n[0],i=n[1];o[r]=i}),o}},{key:"origin",get:function(){return"".concat(location.protocol,"//").concat(location.host)}}]),e}(),P={},q=function(){function e(){i(this,e)}return c(e,null,[{key:"includes",value:function(e,t){return-1!==e.indexOf(t)}},{key:"forEach",value:function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n],n);else for(var r in e)t(e[r],r)}},{key:"find",value:function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n))return r}else for(var o in e){var i=e[o];if(t(i,o))return i}return null}},{key:"assign",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.forEach(n,function(t){for(var n in t)e[n]=t[n]}),e}},{key:"defaults",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this.forEach(r,function(n){for(var r in n)t.isObject(e[r])&&t.isObject(n[r])?e[r]=t.defaults(e[r],n[r]):void 0===e[r]&&(e[r]=n[r])}),e}},{key:"isObject",value:function(e){return"object"===s(e)&&!Array.isArray(e)}},{key:"iframe",value:function(){var e=o(n.mark(function e(t){var r,o,i,a;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.url,o=t.redirectUrl,i=t.visible,(a=document.createElement("iframe")).setAttribute("owner","@salte-auth/salte-auth"),i?(this.assign(a.style,{border:"none",bottom:0,height:"100%",left:0,position:"fixed",right:0,top:0,width:"100%",zIndex:9999,opacity:0,transition:"0.5s opacity"}),setTimeout(function(){return a.style.opacity="1"})):a.style.display="none",a.src=r,document.body.appendChild(a),e.abrupt("return",new Promise(function(e,t){var n=setInterval(function(){try{var r=a.contentWindow.location;if(0!==r.href.indexOf(o))return;var i=R.parse(r);a.parentElement&&a.parentElement.removeChild(a),clearInterval(n),e(i)}catch(e){if(_.isCrossDomainError(e))return;a.parentElement&&a.parentElement.removeChild(a),clearInterval(n),t(e)}})}));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"debounce",value:function(e,t,n){clearTimeout(P[e]),P[e]=window.setTimeout(function(){delete P[e],t()},n)}}]),e}(),I=function(){function e(t,n,r){i(this,e),d(this,"raw",void 0),d(this,"expiration",void 0),d(this,"type",void 0),this.raw=t,this.expiration=q.includes([void 0,null],n)?null:Number(n),this.type=r}return c(e,[{key:"expired",get:function(){return!this.raw||this.expiration<=Date.now()}}]),e}(),D=function(){function e(t){i(this,e),d(this,"raw",void 0),d(this,"user",void 0),this.raw=t,this.user=e.parse(this.raw)}return c(e,[{key:"expired",get:function(){return!this.user||1e3*this.user.exp<=Date.now()}}],[{key:"parse",value:function(e){try{var t=e.split(".");if(3!==t.length)throw new g({code:"invalid_id_token",message:"ID Token didn't match the desired format. ({header}.{payload}.{validation})"});return JSON.parse(atob(t[1].replace(/-/g,"+").replace(/_/g,"/")))}catch(e){return null}}}]),e}(),M=function(){function e(t,n){i(this,e),d(this,"name",void 0),d(this,"level",void 0),this.name=t,this.level="string"==typeof n?this.toLevel(n):n}return c(e,[{key:"trace",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,["trace",e].concat(n))}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,["info",e].concat(n))}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,["warn",e].concat(n))}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,["error",e].concat(n))}},{key:"log",value:function(e,t){if(this.enabled(e)){for(var n,r=arguments.length,o=new Array(r>2?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];(n=console).log.apply(n,["".concat(e,": ").concat(t)].concat(o))}}},{key:"enabled",value:function(e){return!1!==this.level&&(!0===this.level||this.level<=this.toLevel(e))}},{key:"toLevel",value:function(t){return q.find(e.levels,function(e,n){return n===t})}}]),e}();d(M,"levels",{trace:0,info:1,warn:2,error:3});var N=Object.freeze({Interceptors:O,AccessToken:I,IDToken:D,Common:q,Events:_,URL:R,Logger:M}),C=function(e){function t(e){var n;return i(this,t),(n=l(this,f(t).call(this,e))).config=q.defaults(n.config,{storage:"session"}),n}return p(t,m),c(t,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.storage.getItem(this.key(e))||t}},{key:"set",value:function(e,t){q.includes([void 0,null],t)?this.clear(e):this.storage.setItem(this.key(e),t)}},{key:"clear",value:function(e){this.storage.removeItem(this.key(e))}},{key:"reset",value:function(){var e=this.key("");for(var t in localStorage)0===t.indexOf(e)&&localStorage.removeItem(t);for(var n in sessionStorage)0===n.indexOf(e)&&sessionStorage.removeItem(n)}},{key:"key",value:function(e){return"salte.auth.".concat(e)}},{key:"storage",get:function(){var e=this.config&&this.config.storage;switch(e){case"local":return localStorage;case"session":return sessionStorage}throw new g({code:"invalid_storage",message:"Storage doesn't exist for the given value. (".concat(e,")")})}}]),t}(),F=function(e){function t(){var e,n;i(this,t);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=l(this,(e=f(t)).call.apply(e,[this].concat(o))),d(u(n),"listeners",new Map),n}return p(t,C),c(t,[{key:"on",value:function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"off",value:function(e,t){if(this.listeners.has(e)){var n=this.listeners.get(e);if(n.length){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this.listeners.has(e)){var o=this.listeners.get(e);q.forEach(o,function(e){return e.apply(void 0,n)})}}}]),t}(),H=function(e){function t(e){var n;return i(this,t),(n=l(this,f(t).call(this,e))).config=q.defaults(n.config,{redirectUrl:location.origin,level:"warn"}),n}return p(t,F),c(t,[{key:"redirectUrl",value:function(e){return"string"==typeof this.config.redirectUrl?this.config.redirectUrl:this.config.redirectUrl[e]}}]),t}(),G=self.crypto||self.msCrypto,z=function(e){e=e||21;for(var t="",n=G.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t},X=function(e){function t(e){var n;return i(this,t),n=l(this,f(t).call(this,e)),d(u(n),"logger",void 0),n.config=q.defaults(n.config,{validation:!0,level:"warn"}),n.logger=new M("@salte-auth/salte-auth:providers/".concat(n.$name),n.config.level),n}return p(t,H),c(t,[{key:"validation",value:function(e){return"object"===s(this.config.validation)?!0===this.config.validation[e]:!0===this.config.validation}},{key:"key",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return"salte.auth.provider.".concat(this.$name,".").concat(e)})},{key:"url",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;return q.forEach(t,function(e,t){q.includes([void 0,null,""],e)||(n+="".concat(-1===n.indexOf("?")?"?":"&").concat(t,"=").concat(encodeURIComponent(e)))}),n}},{key:"$name",get:function(){return this.config.name||this.name}},{key:"logout",get:function(){throw new g({code:"logout_not_supported",message:"This provider doesn't support logout."})}}]),t}(),B=function(e){function t(e){var n;return i(this,t),n=l(this,f(t).call(this,e)),d(u(n),"accessToken",void 0),n.sync(),n}return p(t,X),c(t,[{key:"connected",value:function(){this.required("clientID","responseType")}},{key:"secure",value:function(){var e=o(n.mark(function e(t){return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("token"!==this.config.responseType){e.next=13;break}if(!this.accessToken.expired){e.next=3;break}return e.abrupt("return",this.$login());case 3:if(!t){e.next=13;break}if(!(t instanceof Request)){e.next=8;break}t.headers.set("Authorization","Bearer ".concat(this.accessToken.raw)),e.next=13;break;case 8:if(!(t instanceof XMLHttpRequest)){e.next=12;break}t.setRequestHeader("Authorization","Bearer ".concat(this.accessToken.raw)),e.next=13;break;case 12:throw new g({code:"unknown_request",message:"Unknown request type. (".concat(t,")")});case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"$validate",value:function(e){try{if(!e)throw new g({code:"empty_response",message:"The response provided was empty, this is most likely due to the configured handler not providing it."});if(e.error)throw new g({code:e.error,message:"".concat(e.error_description?e.error_description:e.error).concat(e.error_uri?" (".concat(e.error_uri,")"):"")});var t=e.code,n=e.access_token,r=e.state,o=e.expires_in,i=e.token_type;if(this.validation("state")&&this.get("state")!==r)throw new g({code:"invalid_state",message:"State provided by identity provider did not match local state."});var a=this.get("response-type","").split(" ");if(q.includes(a,"code")){if(!t)throw new g({code:"invalid_code",message:"Expected a code to be returned by the Provider."})}else if(q.includes(a,"token")&&!n)throw new g({code:"invalid_access_token",message:"Expected an access token to be returned by the Provider."});t?(this.set("code.raw",t),this.clear("access-token.raw"),this.clear("access-token.expiration"),this.clear("access-token.type")):n&&(this.set("access-token.raw",n),this.set("access-token.expiration",Date.now()+1e3*Number(o)),this.set("access-token.type",i),this.clear("code.raw"))}finally{this.clear("state")}}},{key:"validate",value:function(e){try{this.$validate(e)}catch(e){throw this.emit("login",e),e}finally{this.sync()}this.emit("login",null,this.code||this.accessToken)}},{key:"$login",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="".concat(this.$name,"-state-").concat(z()),n=e.responseType||this.config.responseType;return this.set("state",t),this.set("response-type",n),this.url(this.login,{client_id:this.config.clientID,response_type:n,redirect_uri:this.config.redirectUrl,scope:this.config.scope,state:t})}},{key:"sync",value:function(){this.accessToken=new I(this.get("access-token.raw"),this.get("access-token.expiration"),this.get("access-token.type"))}},{key:"code",get:function(){return this.get("code.raw")}}]),t}();var Y=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e},J=t(function(e){function t(n,r,o){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=t=Reflect.get:e.exports=t=function(e,t,n){var r=Y(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},t(n,r,o||n)}e.exports=t}),V=function(e){function t(e){var n;return i(this,t),n=l(this,f(t).call(this,e)),d(u(n),"idToken",void 0),n.config.renewal="object"===s(n.config.renewal)?n.config.renewal:{type:n.config.renewal},n.config=q.defaults(n.config,{responseType:"id_token",scope:"openid",renewal:{type:"auto",buffer:6e4}}),n.sync(),n}return p(t,B),c(t,[{key:"secure",value:function(){var e=o(n.mark(function e(t){var r;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!q.includes(["id_token","id_token token","token"],this.config.responseType)){e.next=18;break}if(!this.idToken.expired){e.next=3;break}return e.abrupt("return",this.$login());case 3:if(!this.accessToken.expired){e.next=8;break}return e.next=6,q.iframe({redirectUrl:this.redirectUrl("login"),url:this.$login({prompt:"none",responseType:"token"})});case 6:r=e.sent,this.validate(r);case 8:if(!t){e.next=18;break}if(!(t instanceof Request)){e.next=13;break}t.headers.set("Authorization","Bearer ".concat(this.accessToken.raw)),e.next=18;break;case 13:if(!(t instanceof XMLHttpRequest)){e.next=17;break}t.setRequestHeader("Authorization","Bearer ".concat(this.accessToken.raw)),e.next=18;break;case 17:throw new g({code:"unknown_request",message:"Unknown request type. (".concat(t,")")});case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"$validate",value:function(e){try{J(f(t.prototype),"$validate",this).call(this,e);var n=this.get("response-type","").split(" ");if(q.includes(n,"id_token")){var r=e.id_token,o=D.parse(r);if(!o)throw new g({code:"invalid_id_token",message:"Failed to parse user information due to invalid id token."});if(this.validation("nonce")&&this.get("nonce")!==o.nonce)throw new g({code:"invalid_nonce",message:"Nonce provided by identity provider did not match the local nonce."});this.set("id-token.raw",r)}else q.includes(n,"code")&&this.clear("id-token.raw")}finally{this.clear("nonce")}}},{key:"validate",value:function(e){try{this.$validate(e)}catch(e){throw this.emit("login",e),e}finally{this.sync()}var t=this.get("response-type",""),n=t.split(" ");if(q.includes(n,"id_token"))this.emit("login",null,this.idToken);else if(q.includes(n,"token"))this.emit("login",null,this.accessToken);else{if(!q.includes(n,"code"))throw new g({code:"invalid_response_type",message:"Unknown Response Type (".concat(t,")")});this.emit("login",null,this.code)}}},{key:"$login",value:function(e){var n="".concat(this.$name,"-nonce-").concat(z());return this.set("nonce",n),this.url(J(f(t.prototype),"$login",this).call(this,e),{prompt:e&&e.prompt,nonce:n})}},{key:"sync",value:function(){J(f(t.prototype),"sync",this).call(this),this.idToken=new D(this.get("id-token.raw"))}}]),t}(),W=function(e){function t(e){var n;return i(this,t),(n=l(this,f(t).call(this,e))).required("login"),n}return p(t,B),c(t,[{key:"name",get:function(){return"generic.oauth2"}},{key:"login",get:function(){return this.config.login.apply(this)}}]),t}(),K=function(e){function t(e){var n;return i(this,t),(n=l(this,f(t).call(this,e))).required("login","logout"),n}return p(t,V),c(t,[{key:"name",get:function(){return"generic.openid"}},{key:"login",get:function(){return this.config.login.apply(this)}},{key:"logout",get:function(){return this.config.logout.apply(this)}}]),t}(),Q=Object.freeze({OAuth2:W,OpenID:K}),Z=function(e){function t(e){var n;return i(this,t),n=l(this,f(t).call(this,e)),d(u(n),"logger",void 0),n.config=q.defaults(n.config,{navigate:"reload",level:"warn"}),n.logger=new M("@salte-auth/salte-auth:handlers/".concat(n.$name),n.config.level),n}return p(t,C),c(t,[{key:"key",value:function(e){return"salte.auth.handler.".concat(this.$name,".").concat(e)}},{key:"navigate",value:function(e){"history"===this.config.navigate&&0===e.indexOf(R.origin)&&history.pushState("",document.title,e),location.href=e}},{key:"$name",get:function(){return this.config.name||this.name}}]),t}(),ee=function(e){function t(e){var r;i(this,t),r=l(this,f(t).call(this,e)),d(u(r),"logger",void 0),d(u(r),"mixin",void 0),r.required("providers","handlers"),r.config=q.defaults(r.config,{validation:!0,level:"warn"}),r.logger=new M("@salte-auth/salte-auth:core",r.config.level),q.forEach(r.config.providers,function(e){e.connected&&e.connected(),e.on("login",function(e,t){r.emit("login",e,t)}),e.on("logout",function(e){r.emit("logout",e)})});var a,c=r.get("action"),s=c?r.provider(r.get("provider")):null,h=c?r.get("handler"):null;if(!q.includes([void 0,null,"login","logout"],c))throw new g({code:"unknown_action",message:"Unable to finish redirect due to an unknown action! (".concat(c,")")});return q.forEach(r.config.handlers,function(e){if(e.connected){var t=e.$name===h;setTimeout(function(){var n=e.connected({action:t?c:null});t&&("login"===c?s.validate(n):(s.reset(),s.sync(),s.emit("logout")))})}}),r.clear("action"),r.clear("provider"),r.clear("handler"),w.add(function(){var e=o(n.mark(function e(t){var o,i;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<r.config.providers.length)){e.next=11;break}if(i=r.config.providers[o],!R.match(t.url,i.config.endpoints)){e.next=8;break}if(e.t0=i.secure,!e.t0){e.next=8;break}return e.next=8,i.secure(t);case 8:o++,e.next=1;break;case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),E.add(function(){var e=o(n.mark(function e(t){var o,i;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<r.config.providers.length)){e.next=11;break}if(i=r.config.providers[o],!R.match(t.$url,i.config.endpoints)){e.next=8;break}if(e.t0=i.secure,!e.t0){e.next=8;break}return e.next=8,i.secure(t);case 8:o++,e.next=1;break;case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),_.route(o(n.mark(function e(){var t,o,i,a,c;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=r.handler(),o=0;case 3:if(!(o<r.config.providers.length)){e.next=29;break}if(i=r.config.providers[o],!R.match(location.href,i.config.routes)){e.next=26;break}a=null;case 7:if(!0===a){e.next=26;break}return e.next=10,i.secure();case 10:if("string"!=typeof(a=e.sent)){e.next=24;break}if(t.auto){e.next=14;break}throw new g({code:"auto_unsupported",message:"The default handler doesn't support automatic authentication! (".concat(t.$name,")")});case 14:return r.set("action","login"),r.set("provider",i.$name),r.set("handler",t.$name),e.next=19,t.open({redirectUrl:i.redirectUrl("login"),url:a});case 19:c=e.sent,i.validate(c),r.clear("action"),r.clear("provider"),r.clear("handler");case 24:e.next=7;break;case 26:o++,e.next=3;break;case 29:e.next=37;break;case 31:throw e.prev=31,e.t0=e.catch(0),r.clear("action"),r.clear("provider"),r.clear("handler"),e.t0;case 37:case"end":return e.stop()}},e,null,[[0,31]])}))),r.mixin=(a=u(r),function(e){return function(t){function n(){var e,t;i(this,n);for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];return t=l(this,(e=f(n)).call.apply(e,[this].concat(o))),d(u(t),"auth",void 0),t.auth=a,t.auth.on("login",function(){t.requestUpdate&&t.requestUpdate("auth")}),t.auth.on("logout",function(){t.requestUpdate&&t.requestUpdate("auth")}),t}return p(n,e),n}()}),r}return p(t,H),c(t,[{key:"login",value:function(){var e=o(n.mark(function e(t){var r,o,i;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="string"==typeof t?{provider:t}:t,e.prev=1,r=this.provider(t.provider),o=this.handler(t.handler),this.set("action","login"),this.set("provider",r.$name),this.set("handler",o.$name),e.next=9,o.open({redirectUrl:r.redirectUrl("login"),url:r.$login()});case 9:i=e.sent,r.validate(i);case 11:return e.prev=11,this.clear("action"),this.clear("provider"),this.clear("handler"),e.finish(11);case 16:case"end":return e.stop()}},e,this,[[1,,11,16]])}));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=o(n.mark(function e(t){var r,o;return n.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="string"==typeof t?{provider:t}:t,r=this.provider(t.provider),e.prev=2,o=this.handler(t.handler),this.set("action","logout"),this.set("provider",r.$name),this.set("handler",o.$name),e.next=9,o.open({redirectUrl:r.redirectUrl("logout"),url:r.logout});case 9:r.reset(),r.emit("logout"),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(2),r.emit("logout",e.t0),e.t0;case 17:return e.prev=17,this.clear("action"),this.clear("provider"),this.clear("handler"),e.finish(17);case 22:case"end":return e.stop()}},e,this,[[2,13,17,22]])}));return function(t){return e.apply(this,arguments)}}()},{key:"provider",value:function(e){var t=q.find(this.config.providers,function(t){return t.$name===e});if(!t)throw new g({code:"invalid_provider",message:"Unable to locate provider with the given name. (".concat(e,")")});return t}},{key:"handler",value:function(e){var t=void 0===e?q.find(this.config.handlers,function(e){return!!e.config.default}):q.find(this.config.handlers,function(t){return t.$name===e});if(!t)throw new g({code:"invalid_handler",message:"Unable to locate handler with the given name. (".concat(e,")")});return t}}]),t}();e.Generic=Q,e.Handler=Z,e.OAuth2Provider=B,e.OpenIDProvider=V,e.SalteAuth=ee,e.SalteAuthError=g,e.Utils=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=salte-auth.min.js.map
