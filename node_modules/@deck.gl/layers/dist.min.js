(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var Lc=Object.create;var qt=Object.defineProperty;var Ac=Object.getOwnPropertyDescriptor;var Ic=Object.getOwnPropertyNames;var Tc=Object.getPrototypeOf,Ec=Object.prototype.hasOwnProperty;var G=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),Rc=(e,r)=>{for(var t in r)qt(e,t,{get:r[t],enumerable:!0})},Xt=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ic(r))!Ec.call(e,i)&&i!==t&&qt(e,i,{get:()=>r[i],enumerable:!(n=Ac(r,i))||n.enumerable});return e},ye=(e,r,t)=>(Xt(e,r,"default"),t&&Xt(t,r,"default")),g=(e,r,t)=>(t=e!=null?Lc(Tc(e)):{},Xt(r||!e||!e.__esModule?qt(t,"default",{value:e,enumerable:!0}):t,e)),zc=e=>Xt(qt({},"__esModule",{value:!0}),e);var D=G((Ep,ui)=>{ui.exports=globalThis.deck});var N=G((zp,vi)=>{function Fc(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}vi.exports=Fc});var B=G((Fp,gi)=>{function di(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kc(e,r,t){return r&&di(e.prototype,r),t&&di(e,t),e}gi.exports=kc});var se=G((kp,hi)=>{function Dc(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}hi.exports=Dc});var V=G((Dp,un)=>{function fn(e){return un.exports=fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fn(e)}un.exports=fn});var yi=G((jp,mi)=>{var jc=V();function Nc(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=jc(e),e!==null););return e}mi.exports=Nc});var X=G((Np,Qt)=>{var Wc=yi();function Jt(e,r,t){return typeof Reflect<"u"&&Reflect.get?Qt.exports=Jt=Reflect.get:Qt.exports=Jt=function(i,o,a){var s=Wc(i,o);if(s){var l=Object.getOwnPropertyDescriptor(s,o);return l.get?l.get.call(a):l.value}},Jt(e,r,t||e)}Qt.exports=Jt});var xi=G((Wp,vn)=>{function pn(e,r){return vn.exports=pn=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},pn(e,r)}vn.exports=pn});var $=G((Up,Pi)=>{var Uc=xi();function Bc(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Uc(e,r)}Pi.exports=Bc});var _i=G((Bp,tr)=>{function er(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tr.exports=er=function(t){return typeof t}:tr.exports=er=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},er(e)}tr.exports=er});var Y=G((Gp,Si)=>{var Gc=_i(),Zc=se();function Vc(e,r){return r&&(Gc(r)==="object"||typeof r=="function")?r:Zc(e)}Si.exports=Vc});var j=G((Zp,Mi)=>{function Hc(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Mi.exports=Hc});var q=G((Vp,Ci)=>{Ci.exports=globalThis.luma});var Fi=G((qp,zi)=>{function Xc(e){if(Array.isArray(e))return e}zi.exports=Xc});var Di=G((Jp,ki)=>{function qc(e,r){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]"){var t=[],n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),s;!(n=(s=a.next()).done)&&(t.push(s.value),!(r&&t.length===r));n=!0);}catch(l){i=!0,o=l}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}return t}}ki.exports=qc});var Ni=G((Qp,ji)=>{function Jc(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}ji.exports=Jc});var or=G((ev,Wi)=>{var Qc=Fi(),ef=Di(),tf=Ni();function rf(e,r){return Qc(e)||ef(e,r)||tf()}Wi.exports=rf});var _o=G((ig,Po)=>{Po.exports=globalThis.loaders});var Ms=G((Ph,Xn)=>{"use strict";Xn.exports=jr;Xn.exports.default=jr;function jr(e,r,t){t=t||2;var n=r&&r.length,i=n?r[0]*t:e.length,o=Ps(e,0,i,t,!0),a=[];if(!o||o.next===o.prev)return a;var s,l,c,f,u,p,v;if(n&&(o=xu(e,r,o,t)),e.length>80*t){s=c=e[0],l=f=e[1];for(var d=t;d<i;d+=t)u=e[d],p=e[d+1],u<s&&(s=u),p<l&&(l=p),u>c&&(c=u),p>f&&(f=p);v=Math.max(c-s,f-l),v=v!==0?32767/v:0}return Rt(o,a,t,s,l,v,0),a}function Ps(e,r,t,n,i){var o,a;if(i===Kn(e,r,t,n)>0)for(o=r;o<t;o+=n)a=xs(o,e[o],e[o+1],a);else for(o=t-n;o>=r;o-=n)a=xs(o,e[o],e[o+1],a);return a&&Nr(a,a.next)&&(Ft(a),a=a.next),a}function ze(e,r){if(!e)return e;r||(r=e);var t=e,n;do if(n=!1,!t.steiner&&(Nr(t,t.next)||U(t.prev,t,t.next)===0)){if(Ft(t),t=r=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==r);return r}function Rt(e,r,t,n,i,o,a){if(e){!a&&o&&Cu(e,n,i,o);for(var s=e,l,c;e.prev!==e.next;){if(l=e.prev,c=e.next,o?hu(e,n,i,o):gu(e)){r.push(l.i/t|0),r.push(e.i/t|0),r.push(c.i/t|0),Ft(e),e=c.next,s=c.next;continue}if(e=c,e===s){a?a===1?(e=mu(ze(e),r,t),Rt(e,r,t,n,i,o,2)):a===2&&yu(e,r,t,n,i,o):Rt(ze(e),r,t,n,i,o,1);break}}}}function gu(e){var r=e.prev,t=e,n=e.next;if(U(r,t,n)>=0)return!1;for(var i=r.x,o=t.x,a=n.x,s=r.y,l=t.y,c=n.y,f=i<o?i<a?i:a:o<a?o:a,u=s<l?s<c?s:c:l<c?l:c,p=i>o?i>a?i:a:o>a?o:a,v=s>l?s>c?s:c:l>c?l:c,d=n.next;d!==r;){if(d.x>=f&&d.x<=p&&d.y>=u&&d.y<=v&&qe(i,s,o,l,a,c,d.x,d.y)&&U(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function hu(e,r,t,n){var i=e.prev,o=e,a=e.next;if(U(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,c=a.x,f=i.y,u=o.y,p=a.y,v=s<l?s<c?s:c:l<c?l:c,d=f<u?f<p?f:p:u<p?u:p,m=s>l?s>c?s:c:l>c?l:c,y=f>u?f>p?f:p:u>p?u:p,x=$n(v,d,r,t,n),S=$n(m,y,r,t,n),h=e.prevZ,P=e.nextZ;h&&h.z>=x&&P&&P.z<=S;){if(h.x>=v&&h.x<=m&&h.y>=d&&h.y<=y&&h!==i&&h!==a&&qe(s,f,l,u,c,p,h.x,h.y)&&U(h.prev,h,h.next)>=0||(h=h.prevZ,P.x>=v&&P.x<=m&&P.y>=d&&P.y<=y&&P!==i&&P!==a&&qe(s,f,l,u,c,p,P.x,P.y)&&U(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;h&&h.z>=x;){if(h.x>=v&&h.x<=m&&h.y>=d&&h.y<=y&&h!==i&&h!==a&&qe(s,f,l,u,c,p,h.x,h.y)&&U(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;P&&P.z<=S;){if(P.x>=v&&P.x<=m&&P.y>=d&&P.y<=y&&P!==i&&P!==a&&qe(s,f,l,u,c,p,P.x,P.y)&&U(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function mu(e,r,t){var n=e;do{var i=n.prev,o=n.next.next;!Nr(i,o)&&_s(i,n,n.next,o)&&zt(i,o)&&zt(o,i)&&(r.push(i.i/t|0),r.push(n.i/t|0),r.push(o.i/t|0),Ft(n),Ft(n.next),n=e=o),n=n.next}while(n!==e);return ze(n)}function yu(e,r,t,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ou(a,s)){var l=Ss(a,s);a=ze(a,a.next),l=ze(l,l.next),Rt(a,r,t,n,i,o,0),Rt(l,r,t,n,i,o,0);return}s=s.next}a=a.next}while(a!==e)}function xu(e,r,t,n){var i=[],o,a,s,l,c;for(o=0,a=r.length;o<a;o++)s=r[o]*n,l=o<a-1?r[o+1]*n:e.length,c=Ps(e,s,l,n,!1),c===c.next&&(c.steiner=!0),i.push(wu(c));for(i.sort(Pu),o=0;o<i.length;o++)t=_u(i[o],t);return t}function Pu(e,r){return e.x-r.x}function _u(e,r){var t=Su(e,r);if(!t)return r;var n=Ss(t,e);return ze(n,n.next),ze(t,t.next)}function Su(e,r){var t=r,n=e.x,i=e.y,o=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var s=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=n&&s>o&&(o=s,a=t.x<t.next.x?t:t.next,s===n))return a}t=t.next}while(t!==r);if(!a)return null;var l=a,c=a.x,f=a.y,u=1/0,p;t=a;do n>=t.x&&t.x>=c&&n!==t.x&&qe(i<f?n:o,i,c,f,i<f?o:n,i,t.x,t.y)&&(p=Math.abs(i-t.y)/(n-t.x),zt(t,e)&&(p<u||p===u&&(t.x>a.x||t.x===a.x&&Mu(a,t)))&&(a=t,u=p)),t=t.next;while(t!==l);return a}function Mu(e,r){return U(e.prev,e,r.prev)<0&&U(r.next,e,e.next)<0}function Cu(e,r,t,n){var i=e;do i.z===0&&(i.z=$n(i.x,i.y,r,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,bu(i)}function bu(e){var r,t,n,i,o,a,s,l,c=1;do{for(t=e,e=null,o=null,a=0;t;){for(a++,n=t,s=0,r=0;r<c&&(s++,n=n.nextZ,!!n);r++);for(l=c;s>0||l>0&&n;)s!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;t=n}o.nextZ=null,c*=2}while(a>1);return e}function $n(e,r,t,n,i){return e=(e-t)*i|0,r=(r-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e|r<<1}function wu(e){var r=e,t=e;do(r.x<t.x||r.x===t.x&&r.y<t.y)&&(t=r),r=r.next;while(r!==e);return t}function qe(e,r,t,n,i,o,a,s){return(i-a)*(r-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(t-a)*(r-s)&&(t-a)*(o-s)>=(i-a)*(n-s)}function Ou(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!Lu(e,r)&&(zt(e,r)&&zt(r,e)&&Au(e,r)&&(U(e.prev,e,r.prev)||U(e,r.prev,r))||Nr(e,r)&&U(e.prev,e,e.next)>0&&U(r.prev,r,r.next)>0)}function U(e,r,t){return(r.y-e.y)*(t.x-r.x)-(r.x-e.x)*(t.y-r.y)}function Nr(e,r){return e.x===r.x&&e.y===r.y}function _s(e,r,t,n){var i=Dr(U(e,r,t)),o=Dr(U(e,r,n)),a=Dr(U(t,n,e)),s=Dr(U(t,n,r));return!!(i!==o&&a!==s||i===0&&kr(e,t,r)||o===0&&kr(e,n,r)||a===0&&kr(t,e,n)||s===0&&kr(t,r,n))}function kr(e,r,t){return r.x<=Math.max(e.x,t.x)&&r.x>=Math.min(e.x,t.x)&&r.y<=Math.max(e.y,t.y)&&r.y>=Math.min(e.y,t.y)}function Dr(e){return e>0?1:e<0?-1:0}function Lu(e,r){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==r.i&&t.next.i!==r.i&&_s(t,t.next,e,r))return!0;t=t.next}while(t!==e);return!1}function zt(e,r){return U(e.prev,e,e.next)<0?U(e,r,e.next)>=0&&U(e,e.prev,r)>=0:U(e,r,e.prev)<0||U(e,e.next,r)<0}function Au(e,r){var t=e,n=!1,i=(e.x+r.x)/2,o=(e.y+r.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==e);return n}function Ss(e,r){var t=new Yn(e.i,e.x,e.y),n=new Yn(r.i,r.x,r.y),i=e.next,o=r.prev;return e.next=r,r.prev=e,t.next=i,i.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function xs(e,r,t,n){var i=new Yn(e,r,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Ft(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Yn(e,r,t){this.i=e,this.x=r,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}jr.deviation=function(e,r,t,n){var i=r&&r.length,o=i?r[0]*t:e.length,a=Math.abs(Kn(e,0,o,t));if(i)for(var s=0,l=r.length;s<l;s++){var c=r[s]*t,f=s<l-1?r[s+1]*t:e.length;a-=Math.abs(Kn(e,c,f,t))}var u=0;for(s=0;s<n.length;s+=3){var p=n[s]*t,v=n[s+1]*t,d=n[s+2]*t;u+=Math.abs((e[p]-e[d])*(e[v+1]-e[p+1])-(e[p]-e[v])*(e[d+1]-e[p+1]))}return a===0&&u===0?0:Math.abs((u-a)/a)};function Kn(e,r,t,n){for(var i=0,o=r,a=t-n;o<t;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}jr.flatten=function(e){for(var r=e[0][0].length,t={vertices:[],holes:[],dimensions:r},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<r;a++)t.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,t.holes.push(n))}return t}});var sl=G((Wh,al)=>{function Ku(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}al.exports=Ku});var cl=G((Uh,ll)=>{var Xu=sl();function qu(e,r){if(e==null)return{};var t=Xu(e,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}ll.exports=qu});var Yt={};Rc(Yt,{ArcLayer:()=>ir,BitmapLayer:()=>mr,ColumnLayer:()=>Xe,GeoJsonLayer:()=>nn,GridCellLayer:()=>Rr,IconLayer:()=>_e,LineLayer:()=>Sr,PathLayer:()=>Oe,PointCloudLayer:()=>br,PolygonLayer:()=>Hr,ScatterplotLayer:()=>Ye,SolidPolygonLayer:()=>Ae,TextLayer:()=>it,_MultiIconLayer:()=>tt,_TextBackgroundLayer:()=>rt});var ae={},pi=g(D());ye(ae,g(D()));if(!pi.Layer)throw new Error("@deck.gl/core is not found");ye(Yt,ae);var Ai=g(N()),Ii=g(B()),Ti=g(se()),dn=g(X()),Ei=g($()),Ri=g(Y()),st=g(V()),lt=g(j()),xe=g(D()),nr=g(q());var bi=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var wi=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Oi(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Li(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Oi(Object(t),!0).forEach(function(n){(0,lt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Oi(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $c(e){var r=Yc();return function(){var n=(0,st.default)(e),i;if(r){var o=(0,st.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ri.default)(this,i)}}function Yc(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rr=[0,0,0,255],Kc={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getSourceColor:{type:"accessor",value:rr},getTargetColor:{type:"accessor",value:rr},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},ir=function(e){(0,Ei.default)(t,e);var r=$c(t);function t(){var n;(0,Ai.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,lt.default)((0,Ti.default)(n),"state",void 0),n}return(0,Ii.default)(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,dn.default)((0,st.default)(t.prototype),"getShaders",this).call(this,{vs:bi,fs:wi,modules:[xe.project32,xe.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:rr},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:rr},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(i){if((0,dn.default)((0,st.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,c=a.widthMinPixels,f=a.widthMaxPixels,u=a.greatCircle,p=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({greatCircle:u,widthUnits:xe.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f,useShortestPath:p}).draw()}},{key:"_getModel",value:function(i){for(var o=[],a=50,s=0;s<a;s++)o=o.concat([s,1,0,s,-1,0]);var l=new nr.Model(i,Li(Li({},this.getShaders()),{},{id:this.props.id,geometry:new nr.Geometry({drawMode:5,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}));return l.setUniforms({numSegments:a}),l}}]),t}(xe.Layer);(0,lt.default)(ir,"layerName","ArcLayer");(0,lt.default)(ir,"defaultProps",Kc);var uo=g(or()),po=g(N()),vo=g(B()),go=g(se()),Rn=g(X()),ho=g($()),mo=g(Y()),gt=g(V()),ht=g(j()),oe=g(D()),hr=g(q());function Ne(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function gn(e){if(Array.isArray(e))return Ne(e)}function hn(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ct(e,r){if(e){if(typeof e=="string")return Ne(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ne(e,r)}}function mn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function We(e){return gn(e)||hn(e)||ct(e)||mn()}function yn(e){if(Array.isArray(e))return e}function xn(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,o=!1,a,s;try{for(t=t.call(e);!(i=(a=t.next()).done)&&(n.push(a.value),!(r&&n.length===r));i=!0);}catch(l){o=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw s}}return n}}function Pn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K(e,r){return yn(e)||xn(e,r)||ct(e,r)||Pn()}function _n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function Ui(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Sn(e,r,t){return r&&Ui(e.prototype,r),t&&Ui(e,t),e}function F(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var H=1e-6,le=typeof Float32Array<"u"?Float32Array:Array;var Cv=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function nf(){var e=new le(4);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Gi(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Zi(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*a,e[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*a,e[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*a,e[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*a,e}var bv=function(){var e=nf();return function(r,t,n,i,o,a){var s,l;for(t||(t=4),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],e[3]=r[s+3],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3];return r}}();function Ue(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pe(e,r){var t=Zi([],r,e);return Gi(t,t,1/t[3]),t}function ft(e,r,t){return e<r?r:e>t?t:e}function of(e){return Math.log(e)*Math.LOG2E}var sr=Math.log2||of;function Vi(e,r){var t=r[0],n=r[1],i=r[2],o=r[3],a=r[4],s=r[5],l=r[6],c=r[7],f=r[8],u=r[9],p=r[10],v=r[11],d=r[12],m=r[13],y=r[14],x=r[15],S=t*s-n*a,h=t*l-i*a,P=t*c-o*a,_=n*l-i*s,M=n*c-o*s,C=i*c-o*l,b=f*m-u*d,O=f*y-p*d,I=f*x-v*d,A=u*y-p*m,L=u*x-v*m,T=p*x-v*y,w=S*T-h*L+P*A+_*I-M*O+C*b;return w?(w=1/w,e[0]=(s*T-l*L+c*A)*w,e[1]=(i*L-n*T-o*A)*w,e[2]=(m*C-y*M+x*_)*w,e[3]=(p*M-u*C-v*_)*w,e[4]=(l*I-a*T-c*O)*w,e[5]=(t*T-i*I+o*O)*w,e[6]=(y*P-d*C-x*h)*w,e[7]=(f*C-p*P+v*h)*w,e[8]=(a*L-s*I+c*b)*w,e[9]=(n*I-t*L-o*b)*w,e[10]=(d*M-m*P+x*S)*w,e[11]=(u*P-f*M-v*S)*w,e[12]=(s*O-a*A-l*b)*w,e[13]=(t*A-n*O+i*b)*w,e[14]=(m*h-d*_-y*S)*w,e[15]=(f*_-u*h+p*S)*w,e):null}function lr(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],f=r[7],u=r[8],p=r[9],v=r[10],d=r[11],m=r[12],y=r[13],x=r[14],S=r[15],h=t[0],P=t[1],_=t[2],M=t[3];return e[0]=h*n+P*s+_*u+M*m,e[1]=h*i+P*l+_*p+M*y,e[2]=h*o+P*c+_*v+M*x,e[3]=h*a+P*f+_*d+M*S,h=t[4],P=t[5],_=t[6],M=t[7],e[4]=h*n+P*s+_*u+M*m,e[5]=h*i+P*l+_*p+M*y,e[6]=h*o+P*c+_*v+M*x,e[7]=h*a+P*f+_*d+M*S,h=t[8],P=t[9],_=t[10],M=t[11],e[8]=h*n+P*s+_*u+M*m,e[9]=h*i+P*l+_*p+M*y,e[10]=h*o+P*c+_*v+M*x,e[11]=h*a+P*f+_*d+M*S,h=t[12],P=t[13],_=t[14],M=t[15],e[12]=h*n+P*s+_*u+M*m,e[13]=h*i+P*l+_*p+M*y,e[14]=h*o+P*c+_*v+M*x,e[15]=h*a+P*f+_*d+M*S,e}function ut(e,r,t){var n=t[0],i=t[1],o=t[2],a,s,l,c,f,u,p,v,d,m,y,x;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*o+r[12],e[13]=r[1]*n+r[5]*i+r[9]*o+r[13],e[14]=r[2]*n+r[6]*i+r[10]*o+r[14],e[15]=r[3]*n+r[7]*i+r[11]*o+r[15]):(a=r[0],s=r[1],l=r[2],c=r[3],f=r[4],u=r[5],p=r[6],v=r[7],d=r[8],m=r[9],y=r[10],x=r[11],e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=f,e[5]=u,e[6]=p,e[7]=v,e[8]=d,e[9]=m,e[10]=y,e[11]=x,e[12]=a*n+f*i+d*o+r[12],e[13]=s*n+u*i+m*o+r[13],e[14]=l*n+p*i+y*o+r[14],e[15]=c*n+v*i+x*o+r[15]),e}function cr(e,r,t){var n=t[0],i=t[1],o=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=r[11]*o,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Hi(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[4],a=r[5],s=r[6],l=r[7],c=r[8],f=r[9],u=r[10],p=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=o*i+c*n,e[5]=a*i+f*n,e[6]=s*i+u*n,e[7]=l*i+p*n,e[8]=c*i-o*n,e[9]=f*i-a*n,e[10]=u*i-s*n,e[11]=p*i-l*n,e}function $i(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[0],a=r[1],s=r[2],l=r[3],c=r[4],f=r[5],u=r[6],p=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=o*i+c*n,e[1]=a*i+f*n,e[2]=s*i+u*n,e[3]=l*i+p*n,e[4]=c*i-o*n,e[5]=f*i-a*n,e[6]=u*i-s*n,e[7]=p*i-l*n,e}function af(e,r,t,n,i){var o=1/Math.tan(r/2),a;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var Yi=af;function Mn(e,r){var t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],c=e[7],f=e[8],u=e[9],p=e[10],v=e[11],d=e[12],m=e[13],y=e[14],x=e[15],S=r[0],h=r[1],P=r[2],_=r[3],M=r[4],C=r[5],b=r[6],O=r[7],I=r[8],A=r[9],L=r[10],T=r[11],w=r[12],R=r[13],Z=r[14],k=r[15];return Math.abs(t-S)<=H*Math.max(1,Math.abs(t),Math.abs(S))&&Math.abs(n-h)<=H*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-P)<=H*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(o-_)<=H*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-M)<=H*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-C)<=H*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(l-b)<=H*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-O)<=H*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(f-I)<=H*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(u-A)<=H*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(p-L)<=H*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(v-T)<=H*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(d-w)<=H*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(m-R)<=H*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-Z)<=H*Math.max(1,Math.abs(y),Math.abs(Z))&&Math.abs(x-k)<=H*Math.max(1,Math.abs(x),Math.abs(k))}function sf(){var e=new le(2);return le!=Float32Array&&(e[0]=0,e[1]=0),e}function Cn(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function Xi(e,r){return e[0]=-r[0],e[1]=-r[1],e}function fr(e,r,t,n){var i=r[0],o=r[1];return e[0]=i+n*(t[0]-i),e[1]=o+n*(t[1]-o),e}var Av=function(){var e=sf();return function(r,t,n,i,o,a){var s,l;for(t||(t=2),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],o(e,e,a),r[s]=e[0],r[s+1]=e[1];return r}}();function lf(){var e=new le(3);return le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function qi(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function cf(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function Ji(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}var Qi=cf;var Iv=function(){var e=lf();return function(r,t,n,i,o,a){var s,l;for(t||(t=3),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}}();function re(e,r){if(!e)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var ne=Math.PI,ro=ne/4,ce=ne/180,wn=180/ne,pt=512,to=4003e4,Ge=85.051129,On=1.5;function ur(e){return Math.pow(2,e)}function Q(e){var r=K(e,2),t=r[0],n=r[1];re(Number.isFinite(t)),re(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=t*ce,o=n*ce,a=pt*(i+ne)/(2*ne),s=pt*(ne+Math.log(Math.tan(ro+o*.5)))/(2*ne);return[a,s]}function ie(e){var r=K(e,2),t=r[0],n=r[1],i=t/pt*(2*ne)-ne,o=2*(Math.atan(Math.exp(n/pt*(2*ne)-ne))-ro);return[i*wn,o*wn]}function Ln(e){var r=e.latitude,t=e.longitude,n=e.highPrecision,i=n===void 0?!1:n;re(Number.isFinite(r)&&Number.isFinite(t));var o=pt,a=Math.cos(r*ce),s=o/360,l=s/a,c=o/to/a,f={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[s,l,c],degreesPerUnit:[1/s,1/l,1/c]};if(i){var u=ce*Math.tan(r*ce)/a,p=s*u/2,v=o/to*u,d=v/l*c;f.unitsPerDegree2=[0,p,v],f.unitsPerMeter2=[d,0,d]}return f}function An(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,o=e.scale,a=e.center,s=Ue();ut(s,s,[0,0,-i]),Hi(s,s,-t*ce),$i(s,s,n*ce);var l=o/r;return cr(s,s,[l,l,l]),a&&ut(s,s,Ji([],a)),s}function no(e){var r=e.width,t=e.height,n=e.altitude,i=e.pitch,o=i===void 0?0:i,a=e.offset,s=e.center,l=e.scale,c=e.nearZMultiplier,f=c===void 0?1:c,u=e.farZMultiplier,p=u===void 0?1:u,v=e.fovy,d=v===void 0?Be(On):v;n!==void 0&&(d=Be(n));var m=d*ce,y=o*ce,x=pr(d),S=x;s&&(S+=s[2]*l/Math.cos(y)/t);var h=m*(.5+(a?a[1]:0)/t),P=Math.sin(h)*S/Math.sin(ft(Math.PI/2-y-h,.01,Math.PI-.01)),_=Math.sin(y)*P+S,M=S*10,C=Math.min(_*p,M);return{fov:m,aspect:r/t,focalDistance:x,near:f,far:C}}function In(e){var r=no(e),t=r.fov,n=r.aspect,i=r.near,o=r.far,a=Yi([],t,n,i,o);return a}function Be(e){return 2*Math.atan(.5/e)*wn}function pr(e){return .5/Math.tan(.5*e*ce)}function Tn(e,r){var t=K(e,3),n=t[0],i=t[1],o=t[2],a=o===void 0?0:o;return re(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),Pe(r,[n,i,a,1])}function vr(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=K(e,3),i=n[0],o=n[1],a=n[2];if(re(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=Pe(r,[i,o,a,1]);return s}var l=Pe(r,[i,o,0,1]),c=Pe(r,[i,o,1,1]),f=l[2],u=c[2],p=f===u?0:((t||0)-f)/(u-f);return fr([],l,c,p)}function dr(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,a=e.maxZoom,s=a===void 0?24:a,l=e.offset,c=l===void 0?[0,0]:l,f=K(n,2),u=K(f[0],2),p=u[0],v=u[1],d=K(f[1],2),m=d[0],y=d[1],x=ff(e.padding),S=Q([p,ft(y,-Ge,Ge)]),h=Q([m,ft(v,-Ge,Ge)]),P=[Math.max(Math.abs(h[0]-S[0]),o),Math.max(Math.abs(h[1]-S[1]),o)],_=[r-x.left-x.right-Math.abs(c[0])*2,t-x.top-x.bottom-Math.abs(c[1])*2];re(_[0]>0&&_[1]>0);var M=_[0]/P[0],C=_[1]/P[1],b=(x.right-x.left)/2/M,O=(x.bottom-x.top)/2/C,I=[(h[0]+S[0])/2+b,(h[1]+S[1])/2+O],A=ie(I),L=Math.min(s,sr(Math.abs(Math.min(M,C))));return re(Number.isFinite(L)),{longitude:A[0],latitude:A[1],zoom:L}}function ff(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(re(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var io=Math.PI/180;function gr(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=e.width,n=e.height,i=e.unproject,o={targetZ:r},a=i([0,n],o),s=i([t,n],o),l,c,f=e.fovy?.5*e.fovy*io:Math.atan(.5/e.altitude),u=(90-e.pitch)*io;return f>u-.01?(l=oo(e,0,r),c=oo(e,t,r)):(l=i([0,0],o),c=i([t,0],o)),[a,s,c,l]}function oo(e,r,t){var n=e.pixelUnprojectionMatrix,i=Pe(n,[r,0,1,1]),o=Pe(n,[r,e.height,1,1]),a=t*e.distanceScales.unitsPerMeter[2],s=(a-i[2])/(o[2]-i[2]),l=fr([],i,o,s),c=ie(l);return c.push(t),c}var ao=function(){function e(){var r=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};_n(this,e),F(this,"latitude",void 0),F(this,"longitude",void 0),F(this,"zoom",void 0),F(this,"pitch",void 0),F(this,"bearing",void 0),F(this,"altitude",void 0),F(this,"fovy",void 0),F(this,"meterOffset",void 0),F(this,"center",void 0),F(this,"width",void 0),F(this,"height",void 0),F(this,"scale",void 0),F(this,"distanceScales",void 0),F(this,"viewMatrix",void 0),F(this,"projectionMatrix",void 0),F(this,"viewProjectionMatrix",void 0),F(this,"pixelProjectionMatrix",void 0),F(this,"pixelUnprojectionMatrix",void 0),F(this,"equals",function(L){return L instanceof e?L.width===r.width&&L.height===r.height&&Mn(L.projectionMatrix,r.projectionMatrix)&&Mn(L.viewMatrix,r.viewMatrix):!1}),F(this,"project",function(L){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=T.topLeft,R=w===void 0?!0:w,Z=r.projectPosition(L),k=Tn(Z,r.pixelProjectionMatrix),E=K(k,2),z=E[0],ve=E[1],de=R?ve:r.height-ve;return L.length===2?[z,de]:[z,de,k[2]]}),F(this,"unproject",function(L){var T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=T.topLeft,R=w===void 0?!0:w,Z=T.targetZ,k=Z===void 0?void 0:Z,E=K(L,3),z=E[0],ve=E[1],de=E[2],Kt=R?ve:r.height-ve,on=k&&k*r.distanceScales.unitsPerMeter[2],fi=vr([z,Kt,de],r.pixelUnprojectionMatrix,on),an=r.unprojectPosition(fi),sn=K(an,3),ln=sn[0],cn=sn[1],Oc=sn[2];return Number.isFinite(de)?[ln,cn,Oc]:Number.isFinite(k)?[ln,cn,k]:[ln,cn]}),F(this,"projectPosition",function(L){var T=Q(L),w=K(T,2),R=w[0],Z=w[1],k=(L[2]||0)*r.distanceScales.unitsPerMeter[2];return[R,Z,k]}),F(this,"unprojectPosition",function(L){var T=ie(L),w=K(T,2),R=w[0],Z=w[1],k=(L[2]||0)*r.distanceScales.metersPerUnit[2];return[R,Z,k]});var n=t.width,i=t.height,o=t.altitude,a=o===void 0?null:o,s=t.fovy,l=s===void 0?null:s,c=t.latitude,f=c===void 0?0:c,u=t.longitude,p=u===void 0?0:u,v=t.zoom,d=v===void 0?0:v,m=t.pitch,y=m===void 0?0:m,x=t.bearing,S=x===void 0?0:x,h=t.position,P=h===void 0?null:h,_=t.nearZMultiplier,M=_===void 0?.02:_,C=t.farZMultiplier,b=C===void 0?1.01:C;n=n||1,i=i||1,l===null&&a===null?(a=On,l=Be(a)):l===null?l=Be(a):a===null&&(a=pr(l));var O=ur(d);a=Math.max(.75,a);var I=Ln({longitude:p,latitude:f}),A=Q([p,f]);A.push(0),P&&qi(A,A,Qi([],P,I.unitsPerMeter)),this.projectionMatrix=In({width:n,height:i,scale:O,center:A,pitch:y,fovy:l,nearZMultiplier:M,farZMultiplier:b}),this.viewMatrix=An({height:i,scale:O,center:A,pitch:y,bearing:S,altitude:a}),this.width=n,this.height=i,this.scale=O,this.latitude=f,this.longitude=p,this.zoom=d,this.pitch=y,this.bearing=S,this.altitude=a,this.fovy=l,this.center=A,this.meterOffset=P||[0,0,0],this.distanceScales=I,this._initMatrices(),Object.freeze(this)}return Sn(e,[{key:"_initMatrices",value:function(){var t=this.width,n=this.height,i=this.projectionMatrix,o=this.viewMatrix,a=Ue();lr(a,a,i),lr(a,a,o),this.viewProjectionMatrix=a;var s=Ue();cr(s,s,[t/2,-n/2,1]),ut(s,s,[1,-1,0]),lr(s,s,a);var l=Vi(Ue(),s);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=l}},{key:"projectFlat",value:function(t){return Q(t)}},{key:"unprojectFlat",value:function(t){return ie(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var n=t.lngLat,i=t.pos,o=vr(i,this.pixelUnprojectionMatrix),a=Q(n),s=Cn([],a,Xi([],o)),l=Cn([],this.center,s);return ie(l)}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,o=this.height,a=dr(Object.assign({width:i,height:o,bounds:t},n)),s=a.longitude,l=a.latitude,c=a.zoom;return new e({width:i,height:o,longitude:s,latitude:l,zoom:c})}},{key:"getBounds",value:function(t){var n=this.getBoundingRegion(t),i=Math.min.apply(Math,We(n.map(function(l){return l[0]}))),o=Math.max.apply(Math,We(n.map(function(l){return l[0]}))),a=Math.min.apply(Math,We(n.map(function(l){return l[1]}))),s=Math.max.apply(Math,We(n.map(function(l){return l[1]})));return[[i,a],[o,s]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return gr(this,t.z||0)}},{key:"getLocationAtPoint",value:function(t){var n=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),e}();var wd=1/Math.PI*180,Od=1/180*Math.PI,vt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Ze(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Ve(e,r,t){return Ze(e)?e.map(function(n,i){return Ve(n,r[i],t)}):t*r+(1-t)*e}function He(e,r,t){var n=vt.EPSILON;t&&(vt.EPSILON=t);try{if(e===r)return!0;if(Ze(e)&&Ze(r)){if(e.length!==r.length)return!1;for(var i=0;i<e.length;++i)if(!He(e[i],r[i]))return!1;return!0}return e&&e.equals?e.equals(r):r&&r.equals?r.equals(e):typeof e=="number"&&typeof r=="number"?Math.abs(e-r)<=vt.EPSILON*Math.max(1,Math.abs(e),Math.abs(r)):!1}finally{vt.EPSILON=n}}var pf=new Uint16Array([0,2,1,0,3,2]),vf=new Float32Array([0,1,0,0,1,0,1,1]);function En(e,r){if(!r)return df(e);for(var t=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(t/r)+1,o=Math.ceil(n/r)+1,a=(i-1)*(o-1)*6,s=new Uint32Array(a),l=new Float32Array(i*o*2),c=new Float64Array(i*o*3),f=0,u=0,p=0;p<i;p++)for(var v=p/(i-1),d=0;d<o;d++){var m=d/(o-1),y=gf(e,v,m);c[f*3+0]=y[0],c[f*3+1]=y[1],c[f*3+2]=y[2]||0,l[f*2+0]=v,l[f*2+1]=1-m,p>0&&d>0&&(s[u++]=f-o,s[u++]=f-o-1,s[u++]=f-1,s[u++]=f-o,s[u++]=f-1,s[u++]=f),f++}return{vertexCount:a,positions:c,indices:s,texCoords:l}}function df(e){for(var r=new Float64Array(12),t=0;t<e.length;t++)r[t*3+0]=e[t][0],r[t*3+1]=e[t][1],r[t*3+2]=e[t][2]||0;return{vertexCount:6,positions:r,indices:pf,texCoords:vf}}function gf(e,r,t){return Ve(Ve(e[0],e[1],t),Ve(e[3],e[2],t),r)}var so=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var hf=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,lo=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(hf,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);function co(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function dt(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?co(Object(t),!0).forEach(function(n){(0,ht.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):co(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mf(e){var r=yf();return function(){var n=(0,gt.default)(e),i;if(r){var o=(0,gt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,mo.default)(this,i)}}function yf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xf={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:oe.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},mr=function(e){(0,ho.default)(t,e);var r=mf(t);function t(){var n;(0,po.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,ht.default)((0,go.default)(n),"state",void 0),n}return(0,vo.default)(t,[{key:"getShaders",value:function(){return(0,Rn.default)((0,gt.default)(t.prototype),"getShaders",this).call(this,{vs:so,fs:lo,modules:[oe.project32,oe.picking]})}},{key:"initializeState",value:function(){var i=this,o=this.getAttributeManager();o.remove(["instancePickingColors"]);var a=!0;o.add({indices:{size:1,isIndexed:!0,update:function(l){return l.value=i.state.mesh.indices},noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(l){return l.value=i.state.mesh.positions},noAlloc:a},texCoords:{size:2,update:function(l){return l.value=i.state.mesh.texCoords},noAlloc:a}})}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager();if(s.extensionsChanged){var c,f=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(f),l.invalidateAll()}if(o.bounds!==a.bounds){var u=this.state.mesh,p=this._createMesh();this.state.model.setVertexCount(p.vertexCount);for(var v in p)u&&u[v]!==p[v]&&l.invalidate(v);this.setState(dt({mesh:p},this._getCoordinateUniforms()))}else o._imageCoordinateSystem!==a._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(i){var o=this.props.image,a=i.info;if(!a.color||!o)return a.bitmap=null,a;var s=o,l=s.width,c=s.height;a.index=0;var f=Pf(a.color),u=[Math.floor(f[0]*l),Math.floor(f[1]*c)];return a.bitmap={size:{width:l,height:c},uv:f,pixel:u},a}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(i){(0,Rn.default)((0,gt.default)(t.prototype),"_updateAutoHighlight",this).call(this,dt(dt({},i),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var i=this.props.bounds,o=i;return fo(i)&&(o=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]),En(o,this.context.viewport.resolution)}},{key:"_getModel",value:function(i){return i?new hr.Model(i,dt(dt({},this.getShaders()),{},{id:this.props.id,geometry:new hr.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(i){var o=i.uniforms,a=i.moduleParameters,s=this.state,l=s.model,c=s.coordinateConversion,f=s.bounds,u=s.disablePicking,p=this.props,v=p.image,d=p.desaturate,m=p.transparentColor,y=p.tintColor;a.pickingActive&&u||v&&l&&l.setUniforms(o).setUniforms({bitmapTexture:v,desaturate:d,transparentColor:m.map(function(x){return x/255}),tintColor:y.slice(0,3).map(function(x){return x/255}),coordinateConversion:c,bounds:f}).draw()}},{key:"_getCoordinateUniforms",value:function(){var i=oe.COORDINATE_SYSTEM.LNGLAT,o=oe.COORDINATE_SYSTEM.CARTESIAN,a=oe.COORDINATE_SYSTEM.DEFAULT,s=this.props._imageCoordinateSystem;if(s!==a){var l=this.props.bounds;if(!fo(l))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var c=this.context.viewport.resolution?i:o;if(s=s===i?i:o,s===i&&c===o)return{coordinateConversion:-1,bounds:l};if(s===o&&c===i){var f=Q([l[0],l[1]]),u=Q([l[2],l[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],u[0],u[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),t}(oe.Layer);(0,ht.default)(mr,"layerName","BitmapLayer");(0,ht.default)(mr,"defaultProps",xf);function Pf(e){var r=(0,uo.default)(e,3),t=r[0],n=r[1],i=r[2],o=(i&240)/256,a=(i&15)/16;return[(t+a)/256,(n+o)/256]}function fo(e){return Number.isFinite(e[0])}var Fo=g(N()),ko=g(B()),Do=g(se()),xt=g(X()),jo=g($()),No=g(Y()),Ee=g(V()),Pt=g(j()),fe=g(D()),xr=g(q());var yo=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var xo=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var Oo=g(N()),Lo=g(B()),W=g(j()),yt=g(q()),Io=g(_o()),To=g(D()),$e;function Ao(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_f(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function _f(e,r){if(e){if(typeof e=="string")return So(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return So(e,r)}}function So(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Mo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yr(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Mo(Object(t),!0).forEach(function(n){(0,W.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Mo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Sf=1024,Mf=4,Co=function(){},bo=($e={},(0,W.default)($e,10241,9987),(0,W.default)($e,10240,9729),(0,W.default)($e,10242,33071),(0,W.default)($e,10243,33071),$e);function Cf(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function bf(e,r,t,n){var i=Math.min(t/r.width,n/r.height),o=Math.floor(r.width*i),a=Math.floor(r.height*i);return i===1?{data:r,width:o,height:a}:(e.canvas.height=a,e.canvas.width=o,e.clearRect(0,0,o,a),e.drawImage(r,0,0,r.width,r.height,0,0,o,a),{data:e.canvas,width:o,height:a})}function mt(e){return e&&(e.id||e.url)}function wf(e,r,t,n){var i=e.width,o=e.height,a=new yt.Texture2D(e.gl,{width:r,height:t,parameters:n});return(0,yt.copyToTexture)(e,a,{targetY:0,width:i,height:o}),e.delete(),a}function wo(e,r,t){for(var n=0;n<r.length;n++){var i=r[n],o=i.icon,a=i.xOffset,s=mt(o);e[s]=yr(yr({},o),{},{x:a,y:t})}}function Of(e){for(var r=e.icons,t=e.buffer,n=e.mapping,i=n===void 0?{}:n,o=e.xOffset,a=o===void 0?0:o,s=e.yOffset,l=s===void 0?0:s,c=e.rowHeight,f=c===void 0?0:c,u=e.canvasWidth,p=[],v=0;v<r.length;v++){var d=r[v],m=mt(d);if(!i[m]){var y=d.height,x=d.width;a+x+t>u&&(wo(i,p,l),a=0,l=f+l+t,f=0,p=[]),p.push({icon:d,xOffset:a}),a=a+x+t,f=Math.max(f,y)}}return p.length>0&&wo(i,p,l),{mapping:i,rowHeight:f,xOffset:a,yOffset:l,canvasWidth:u,canvasHeight:Cf(f+l+t)}}function Lf(e,r,t){if(!e||!r)return null;t=t||{};var n={},i=(0,To.createIterable)(e),o=i.iterable,a=i.objectInfo,s=Ao(o),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;a.index++;var f=r(c,a),u=mt(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[u]&&(!t[u]||f.url!==t[u].url)&&(n[u]=yr(yr({},f),{},{source:c,sourceIndex:a.index}))}}catch(p){s.e(p)}finally{s.f()}return n}var Eo=function(){function e(r,t){var n=t.onUpdate,i=n===void 0?Co:n,o=t.onError,a=o===void 0?Co:o;(0,Oo.default)(this,e),(0,W.default)(this,"gl",void 0),(0,W.default)(this,"onUpdate",void 0),(0,W.default)(this,"onError",void 0),(0,W.default)(this,"_loadOptions",null),(0,W.default)(this,"_texture",null),(0,W.default)(this,"_externalTexture",null),(0,W.default)(this,"_mapping",{}),(0,W.default)(this,"_textureParameters",null),(0,W.default)(this,"_pendingCount",0),(0,W.default)(this,"_autoPacking",!1),(0,W.default)(this,"_xOffset",0),(0,W.default)(this,"_yOffset",0),(0,W.default)(this,"_rowHeight",0),(0,W.default)(this,"_buffer",Mf),(0,W.default)(this,"_canvasWidth",Sf),(0,W.default)(this,"_canvasHeight",0),(0,W.default)(this,"_canvas",null),this.gl=r,this.onUpdate=i,this.onError=a}return(0,Lo.default)(e,[{key:"finalize",value:function(){var t;(t=this._texture)===null||t===void 0||t.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(t){var n=this._autoPacking?mt(t):t;return this._mapping[n]||{}}},{key:"setProps",value:function(t){var n=t.loadOptions,i=t.autoPacking,o=t.iconAtlas,a=t.iconMapping,s=t.textureParameters;if(n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),a&&(this._mapping=a),o){var l;(l=this._texture)===null||l===void 0||l.delete(),this._texture=null,this._externalTexture=o}s&&(this._textureParameters=s)}},{key:"isLoaded",get:function(){return this._pendingCount===0}},{key:"packIcons",value:function(t,n){if(!(!this._autoPacking||typeof document>"u")){var i=Object.values(Lf(t,n,this._mapping)||{});if(i.length>0){var o=Of({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=o.mapping,s=o.xOffset,l=o.yOffset,c=o.rowHeight,f=o.canvasHeight;this._rowHeight=c,this._mapping=a,this._xOffset=s,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=new yt.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||bo})),this._texture.height!==this._canvasHeight&&(this._texture=wf(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||bo)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}}},{key:"_loadIcons",value:function(t){var n=this,i=this._canvas.getContext("2d",{willReadFrequently:!0}),o=Ao(t),a;try{var s=function(){var c=a.value;n._pendingCount++,(0,Io.load)(c.url,n._loadOptions).then(function(f){var u=mt(c),p=n._mapping[u],v=p.x,d=p.y,m=p.width,y=p.height,x=bf(i,f,m,y),S=x.data,h=x.width,P=x.height;n._texture.setSubImageData({data:S,x:v+(m-h)/2,y:d+(y-P)/2,width:h,height:P}),p.width=h,p.height=P,n._texture.generateMipmap(),n.onUpdate()}).catch(function(f){n.onError({url:c.url,source:c.source,sourceIndex:c.sourceIndex,loadOptions:n._loadOptions,error:f})}).finally(function(){n._pendingCount--})};for(o.s();!(a=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}}}]),e}();function Ro(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function zo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ro(Object(t),!0).forEach(function(n){(0,Pt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ro(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Af(e){var r=If();return function(){var n=(0,Ee.default)(e),i;if(r){var o=(0,Ee.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,No.default)(this,i)}}function If(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Wo=[0,0,0,255],Tf={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(r){return r.position}},getIcon:{type:"accessor",value:function(r){return r.icon}},getColor:{type:"accessor",value:Wo},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},_e=function(e){(0,jo.default)(t,e);var r=Af(t);function t(){var n;(0,Fo.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Pt.default)((0,Do.default)(n),"state",void 0),n}return(0,ko.default)(t,[{key:"getShaders",value:function(){return(0,xt.default)((0,Ee.default)(t.prototype),"getShaders",this).call(this,{vs:yo,fs:xo,modules:[fe.project32,fe.picking]})}},{key:"initializeState",value:function(){this.state={iconManager:new Eo(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:Wo},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(i){(0,xt.default)((0,Ee.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),c=o.iconAtlas,f=o.iconMapping,u=o.data,p=o.getIcon,v=o.textureParameters,d=this.state.iconManager,m=c||this.internalState.isAsyncPropLoading("iconAtlas");if(d.setProps({loadOptions:o.loadOptions,autoPacking:!m,iconAtlas:c,iconMapping:m?f:null,textureParameters:v}),m?a.iconMapping!==o.iconMapping&&l.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&d.packIcons(u,p),s.extensionsChanged){var y,x=this.context.gl;(y=this.state.model)===null||y===void 0||y.delete(),this.state.model=this._getModel(x),l.invalidateAll()}}},{key:"isLoaded",get:function(){return(0,xt.default)((0,Ee.default)(t.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(i){(0,xt.default)((0,Ee.default)(t.prototype),"finalizeState",this).call(this,i),this.state.iconManager.finalize()}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.sizeScale,l=a.sizeMinPixels,c=a.sizeMaxPixels,f=a.sizeUnits,u=a.billboard,p=a.alphaCutoff,v=this.state.iconManager,d=v.getTexture();d&&this.state.model.setUniforms(o).setUniforms({iconsTexture:d,iconsTextureDim:[d.width,d.height],sizeUnits:fe.UNIT[f],sizeScale:s,sizeMinPixels:l,sizeMaxPixels:c,billboard:u,alphaCutoff:p}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,-1,1,1,1,1,-1];return new xr.Model(i,zo(zo({},this.getShaders()),{},{id:this.props.id,geometry:new xr.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(i){var o,a=(o=this.getCurrentLayer())===null||o===void 0?void 0:o.props.onIconError;a?a(i):fe.log.error(i.error.message)()}},{key:"getInstanceOffset",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.width,s=o.height,l=o.anchorX,c=l===void 0?a/2:l,f=o.anchorY,u=f===void 0?s/2:f;return[a/2-c,s/2-u]}},{key:"getInstanceColorMode",value:function(i){var o=this.state.iconManager.getIconMapping(i);return o.mask?1:0}},{key:"getInstanceIconFrame",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.x,s=o.y,l=o.width,c=o.height;return[a,s,l,c]}}]),t}(fe.Layer);(0,Pt.default)(_e,"defaultProps",Tf);(0,Pt.default)(_e,"layerName","IconLayer");var Vo=g(N()),Ho=g(B()),zn=g(X()),$o=g($()),Yo=g(Y()),_t=g(V()),Pr=g(j()),Se=g(D()),_r=g(q());var Uo=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Bo=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Go(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Zo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Go(Object(t),!0).forEach(function(n){(0,Pr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Go(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ef(e){var r=Rf();return function(){var n=(0,_t.default)(e),i;if(r){var o=(0,_t.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Yo.default)(this,i)}}function Rf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zf=[0,0,0,255],Ff={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getColor:{type:"accessor",value:zf},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Sr=function(e){(0,$o.default)(t,e);var r=Ef(t);function t(){return(0,Vo.default)(this,t),r.apply(this,arguments)}return(0,Ho.default)(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,zn.default)((0,_t.default)(t.prototype),"getShaders",this).call(this,{vs:Uo,fs:Bo,modules:[Se.project32,Se.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,zn.default)((0,_t.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,c=a.widthMinPixels,f=a.widthMaxPixels,u=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({widthUnits:Se.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f,useShortestPath:u?1:0}).draw(),u&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(i){var o=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new _r.Model(i,Zo(Zo({},this.getShaders()),{},{id:this.props.id,geometry:new _r.Geometry({drawMode:5,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(Se.Layer);(0,Pr.default)(Sr,"layerName","LineLayer");(0,Pr.default)(Sr,"defaultProps",Ff);var Qo=g(N()),ea=g(B()),Fn=g(X()),ta=g($()),ra=g(Y()),St=g(V()),Mr=g(j()),ue=g(D()),Cr=g(q());var Ko=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Xo=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function qo(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Jo(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?qo(Object(t),!0).forEach(function(n){(0,Mr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qo(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function kf(e){var r=Df();return function(){var n=(0,St.default)(e),i;if(r){var o=(0,St.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,ra.default)(this,i)}}function Df(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var na=[0,0,0,255],ia=[0,0,1],jf={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(r){return r.position}},getNormal:{type:"accessor",value:ia},getColor:{type:"accessor",value:na},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Nf(e){var r=e.header,t=e.attributes;!r||!t||(e.length=r.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}var br=function(e){(0,ta.default)(t,e);var r=kf(t);function t(){return(0,Qo.default)(this,t),r.apply(this,arguments)}return(0,ea.default)(t,[{key:"getShaders",value:function(){return(0,Fn.default)((0,St.default)(t.prototype),"getShaders",this).call(this,{vs:Ko,fs:Xo,modules:[ue.project32,ue.gouraudLighting,ue.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ia},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:na}})}},{key:"updateState",value:function(i){var o=i.changeFlags,a=i.props;if((0,Fn.default)((0,St.default)(t.prototype),"updateState",this).call(this,i),o.extensionsChanged){var s,l=this.context.gl;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(l),this.getAttributeManager().invalidateAll()}o.dataChanged&&Nf(a.data)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.pointSize,l=a.sizeUnits;this.state.model.setUniforms(o).setUniforms({sizeUnits:ue.UNIT[l],radiusPixels:s}).draw()}},{key:"_getModel",value:function(i){for(var o=[],a=0;a<3;a++){var s=a/3*Math.PI*2;o.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Cr.Model(i,Jo(Jo({},this.getShaders()),{},{id:this.props.id,geometry:new Cr.Geometry({drawMode:4,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(ue.Layer);(0,Mr.default)(br,"layerName","PointCloudLayer");(0,Mr.default)(br,"defaultProps",jf);var fa=g(N()),ua=g(B()),kn=g(X()),pa=g($()),va=g(Y()),Mt=g(V()),wr=g(j()),ge=g(D()),Or=g(q());var oa=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var aa=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function sa(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function la(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?sa(Object(t),!0).forEach(function(n){(0,wr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sa(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wf(e){var r=Uf();return function(){var n=(0,Mt.default)(e),i;if(r){var o=(0,Mt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,va.default)(this,i)}}function Uf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ca=[0,0,0,255],Bf={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:ca},getLineColor:{type:"accessor",value:ca},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Ye=function(e){(0,pa.default)(t,e);var r=Wf(t);function t(){return(0,fa.default)(this,t),r.apply(this,arguments)}return(0,ua.default)(t,[{key:"getShaders",value:function(){return(0,kn.default)((0,Mt.default)(t.prototype),"getShaders",this).call(this,{vs:oa,fs:aa,modules:[ge.project32,ge.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,kn.default)((0,Mt.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.radiusUnits,l=a.radiusScale,c=a.radiusMinPixels,f=a.radiusMaxPixels,u=a.stroked,p=a.filled,v=a.billboard,d=a.antialiasing,m=a.lineWidthUnits,y=a.lineWidthScale,x=a.lineWidthMinPixels,S=a.lineWidthMaxPixels;this.state.model.setUniforms(o).setUniforms({stroked:u?1:0,filled:p,billboard:v,antialiasing:d,radiusUnits:ge.UNIT[s],radiusScale:l,radiusMinPixels:c,radiusMaxPixels:f,lineWidthUnits:ge.UNIT[m],lineWidthScale:y,lineWidthMinPixels:x,lineWidthMaxPixels:S}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Or.Model(i,la(la({},this.getShaders()),{},{id:this.props.id,geometry:new Or.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(ge.Layer);(0,wr.default)(Ye,"defaultProps",Bf);(0,wr.default)(Ye,"layerName","ScatterplotLayer");var Na=g(N()),Wa=g(B()),Bn=g(X()),Ua=g($()),Ba=g(Y()),It=g(V()),Er=g(j()),ee=g(D()),be=g(q());var Aa=g(j()),Ia=g(N()),Ta=g($()),Ea=g(Y()),Un=g(V()),Ra=g(D()),Ir=g(q());var ma=g(N()),ya=g(B());function Ct(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Ke={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Me(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=da(e,t);return n!==r?(Gf(e,t),!0):!1}function da(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(bt(e,r))}function bt(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size||2,s=0,l=n,c=o-a;l<o;l+=a)s+=(e[l]-e[c])*(e[l+1]+e[c+1]),c=l;return s/2}function Dn(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.size,l=s===void 0?2:s,c=t.isClosed,f=(a-i)/l,u=0;u<f-1;++u)r(e[i+u*l],e[i+u*l+1],e[i+(u+1)*l],e[i+(u+1)*l+1],u,u+1);var p=i+(f-1)*l,v=c||He(e[i],e[p])&&He(e[i+1],e[p+1]);v||r(e[p],e[p+1],e[i],e[i+1],f-1,0)}function Gf(e,r){for(var t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size,s=a===void 0?2:a,l=(o-n)/s,c=Math.floor(l/2),f=0;f<c;++f)for(var u=n+f*s,p=n+(l-1-f)*s,v=0;v<s;++v){var d=e[u+v];e[u+v]=e[p+v],e[p+v]=d}}function ga(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Zf(e,t);return n!==r?(e.reverse(),!0):!1}function Zf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(jn(e,r))}function jn(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=0,s=n,l=o-1;s<o;++s)a+=(e[s][0]-e[l][0])*(e[s][1]+e[l][1]),l=s;return a/2}function ha(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.isClosed,l=i;l<a-1;++l)r(e[l],e[l+1],l,l+1);var c=s||He(e[a-1],e[0]);c||r(e[a-1],e[0],a-1,0)}var xa=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,ma.default)(this,e),Ct(this,"points",void 0),Ct(this,"isFlatArray",void 0),Ct(this,"options",void 0),this.points=r,this.isFlatArray=!Ze(r[0]),this.options={start:t.start||0,end:t.end||r.length,size:t.size||2,isClosed:t.isClosed},Object.freeze(this)}return(0,ya.default)(e,[{key:"getSignedArea",value:function(){return this.isFlatArray?bt(this.points,this.options):jn(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(t){this.isFlatArray?Dn(this.points,function(n,i,o,a,s,l){t([n,i],[o,a],s,l)},this.options):ha(this.points,t,this.options)}},{key:"modifyWindingDirection",value:function(t){return this.isFlatArray?Me(this.points,t,this.options):ga(this.points,t,this.options)}}]),e}();function J(e,r){var t=r.length,n=e.length;if(n>0){for(var i=!0,o=0;o<t;o++)if(e[n-t+o]!==r[o]){i=!1;break}if(i)return!1}for(var a=0;a<t;a++)e[n+a]=r[a];return!0}function wt(e,r){for(var t=r.length,n=0;n<t;n++)e[n]=r[n]}function Ce(e,r,t,n){for(var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o=n+r*t,a=0;a<t;a++)i[a]=e[o+a];return i}function Lr(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o,a;if(t&8)o=(n[3]-e[1])/(r[1]-e[1]),a=3;else if(t&4)o=(n[1]-e[1])/(r[1]-e[1]),a=1;else if(t&2)o=(n[2]-e[0])/(r[0]-e[0]),a=2;else if(t&1)o=(n[0]-e[0])/(r[0]-e[0]),a=0;else return null;for(var s=0;s<e.length;s++)i[s]=(a&1)===s?n[a]:o*(r[s]-e[s])+e[s];return i}function Ot(e,r){var t=0;return e[0]<r[0]?t|=1:e[0]>r[2]&&(t|=2),e[1]<r[1]?t|=4:e[1]>r[3]&&(t|=8),t}function Lt(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.broken,a=o===void 0?!1:o,s=t.gridResolution,l=s===void 0?10:s,c=t.gridOffset,f=c===void 0?[0,0]:c,u=t.startIndex,p=u===void 0?0:u,v=t.endIndex,d=v===void 0?e.length:v,m=(d-p)/i,y=[],x=[y],S=Ce(e,0,i,p),h,P,_=Sa(S,l,f,[]),M=[];J(y,S);for(var C=1;C<m;C++){for(h=Ce(e,C,i,p,h),P=Ot(h,_);P;){Lr(S,h,P,_,M);var b=Ot(M,_);b&&(Lr(S,M,b,_,M),P=b),J(y,M),wt(S,M),Hf(_,l,P),a&&y.length>i&&(y=[],x.push(y),J(y,S)),P=Ot(h,_)}J(y,h),wt(S,h)}return a?x:x[0]}var Pa=0,Vf=1;function Ar(e,r){for(var t=0;t<r.length;t++)e.push(r[t]);return e}function At(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(!e.length)return[];for(var n=t||{},i=n.size,o=i===void 0?2:i,a=n.gridResolution,s=a===void 0?10:a,l=n.gridOffset,c=l===void 0?[0,0]:l,f=n.edgeTypes,u=f===void 0?!1:f,p=[],v=[{pos:e,types:u?new Array(e.length/o).fill(Vf):null,holes:r||[]}],d=[[],[]],m=[];v.length;){var y=v.shift(),x=y.pos,S=y.types,h=y.holes;$f(x,o,h[0]||x.length,d),m=Sa(d[0],s,c,m);var P=Ot(d[1],m);if(P){var _=_a(x,S,o,0,h[0]||x.length,m,P),M={pos:_[0].pos,types:_[0].types,holes:[]},C={pos:_[1].pos,types:_[1].types,holes:[]};v.push(M,C);for(var b=0;b<h.length;b++)_=_a(x,S,o,h[b],h[b+1]||x.length,m,P),_[0]&&(M.holes.push(M.pos.length),M.pos=Ar(M.pos,_[0].pos),u&&(M.types=Ar(M.types,_[0].types))),_[1]&&(C.holes.push(C.pos.length),C.pos=Ar(C.pos,_[1].pos),u&&(C.types=Ar(C.types,_[1].types)))}else{var O={positions:x};u&&(O.edgeTypes=S),h.length&&(O.holeIndices=h),p.push(O)}}return p}function _a(e,r,t,n,i,o,a){for(var s=(i-n)/t,l=[],c=[],f=[],u=[],p=[],v,d,m,y=Ce(e,s-1,t,n),x=Math.sign(a&8?y[1]-o[3]:y[0]-o[2]),S=r&&r[s-1],h=0,P=0,_=0;_<s;_++)v=Ce(e,_,t,n,v),d=Math.sign(a&8?v[1]-o[3]:v[0]-o[2]),m=r&&r[n/t+_],d&&x&&x!==d&&(Lr(y,v,a,o,p),J(l,p)&&f.push(S),J(c,p)&&u.push(S)),d<=0?(J(l,v)&&f.push(m),h-=d):f.length&&(f[f.length-1]=Pa),d>=0?(J(c,v)&&u.push(m),P+=d):u.length&&(u[u.length-1]=Pa),wt(y,v),x=d,S=m;return[h?{pos:l,types:r&&f}:null,P?{pos:c,types:r&&u}:null]}function Sa(e,r,t,n){var i=Math.floor((e[0]-t[0])/r)*r+t[0],o=Math.floor((e[1]-t[1])/r)*r+t[1];return n[0]=i,n[1]=o,n[2]=i+r,n[3]=o+r,n}function Hf(e,r,t){t&8?(e[1]+=r,e[3]+=r):t&4?(e[1]-=r,e[3]-=r):t&2?(e[0]+=r,e[2]+=r):t&1&&(e[0]-=r,e[2]-=r)}function $f(e,r,t,n){for(var i=1/0,o=-1/0,a=1/0,s=-1/0,l=0;l<t;l+=r){var c=e[l],f=e[l+1];i=c<i?c:i,o=c>o?c:o,a=f<a?f:a,s=f>s?f:s}return n[0][0]=i,n[0][1]=a,n[1][0]=o,n[1][1]=s,n}function Ca(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yf(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Yf(e,r){if(e){if(typeof e=="string")return Ma(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ma(e,r)}}function Ma(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Kf=85.051129;function Nn(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.startIndex,a=o===void 0?0:o,s=t.endIndex,l=s===void 0?e.length:s,c=t.normalize,f=c===void 0?!0:c,u=e.slice(a,l);ba(u,i,0,l-a);var p=Lt(u,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(f){var v=Ca(p),d;try{for(v.s();!(d=v.n()).done;){var m=d.value;wa(m,i)}}catch(y){v.e(y)}finally{v.f()}}return p}function Wn(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0,n=t||{},i=n.size,o=i===void 0?2:i,a=n.normalize,s=a===void 0?!0:a,l=n.edgeTypes,c=l===void 0?!1:l;r=r||[];for(var f=[],u=[],p=0,v=0,d=0;d<=r.length;d++){for(var m=r[d]||e.length,y=v,x=Xf(e,o,p,m),S=x;S<m;S++)f[v++]=e[S];for(var h=p;h<x;h++)f[v++]=e[h];ba(f,o,y,v),qf(f,o,y,v,t?.maxLatitude),p=m,u[d]=v}u.pop();var P=At(f,u,{size:o,gridResolution:360,gridOffset:[-180,-180],edgeTypes:c});if(s){var _=Ca(P),M;try{for(_.s();!(M=_.n()).done;){var C=M.value;wa(C.positions,o)}}catch(b){_.e(b)}finally{_.f()}}return P}function Xf(e,r,t,n){for(var i=-1,o=-1,a=t+1;a<n;a+=r){var s=Math.abs(e[a]);s>i&&(i=s,o=a-1)}return o}function qf(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Kf,o=e[t],a=e[n-r];if(Math.abs(o-a)>180){var s=Ce(e,0,r,t);s[0]+=Math.round((a-o)/360)*360,J(e,s),s[1]=Math.sign(s[1])*i,J(e,s),s[0]=o,J(e,s)}}function ba(e,r,t,n){for(var i=e[0],o,a=t;a<n;a+=r){o=e[a];var s=o-i;(s>180||s<-180)&&(o-=Math.round(s/360)*360),e[a]=i=o}}function wa(e,r){for(var t,n=e.length/r,i=0;i<n&&(t=e[i*r],(t+180)%360===0);i++);var o=-Math.round(t/360)*360;if(o!==0)for(var a=0;a<n;a++)e[a*r]+=o}function Oa(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function La(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Oa(Object(t),!0).forEach(function(n){(0,Aa.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Oa(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Jf(e){var r=Qf();return function(){var n=(0,Un.default)(e),i;if(r){var o=(0,Un.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ea.default)(this,i)}}function Qf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var za=function(e){(0,Ta.default)(t,e);var r=Jf(t);function t(n){(0,Ia.default)(this,t);var i=n.id,o=i===void 0?(0,Ir.uid)("column-geometry"):i,a=eu(n),s=a.indices,l=a.attributes;return r.call(this,La(La({},n),{},{id:o,indices:s,attributes:l}))}return t}(Ir.Geometry);function eu(e){var r=e.radius,t=e.height,n=t===void 0?1:t,i=e.nradial,o=i===void 0?10:i,a=e.vertices;a&&(Ra.log.assert(a.length>=o),a=a.flatMap(function(T){return[T[0],T[1]]}),Me(a,Ke.COUNTER_CLOCKWISE));var s=n>0,l=o+1,c=s?l*3+1:o,f=Math.PI*2/o,u=new Uint16Array(s?o*3*2:0),p=new Float32Array(c*3),v=new Float32Array(c*3),d=0;if(s){for(var m=0;m<l;m++)for(var y=m*f,x=m%o,S=Math.sin(y),h=Math.cos(y),P=0;P<2;P++)p[d+0]=a?a[x*2]:h*r,p[d+1]=a?a[x*2+1]:S*r,p[d+2]=(1/2-P)*n,v[d+0]=a?a[x*2]:h,v[d+1]=a?a[x*2+1]:S,d+=3;p[d+0]=p[d-3],p[d+1]=p[d-2],p[d+2]=p[d-1],d+=3}for(var _=s?0:1;_<l;_++){var M=Math.floor(_/2)*Math.sign(.5-_%2),C=M*f,b=(M+o)%o,O=Math.sin(C),I=Math.cos(C);p[d+0]=a?a[b*2]:I*r,p[d+1]=a?a[b*2+1]:O*r,p[d+2]=n/2,v[d+2]=1,d+=3}if(s)for(var A=0,L=0;L<o;L++)u[A++]=L*2+0,u[A++]=L*2+2,u[A++]=L*2+0,u[A++]=L*2+1,u[A++]=L*2+1,u[A++]=L*2+3;return{indices:u,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:v}}}}var Fa=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var ka=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Da(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ja(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Da(Object(t),!0).forEach(function(n){(0,Er.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Da(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tu(e){var r=ru();return function(){var n=(0,It.default)(e),i;if(r){var o=(0,It.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ba.default)(this,i)}}function ru(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tr=[0,0,0,255],nu={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(r){return r.position}},getFillColor:{type:"accessor",value:Tr},getLineColor:{type:"accessor",value:Tr},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Xe=function(e){(0,Ua.default)(t,e);var r=tu(t);function t(){return(0,Na.default)(this,t),r.apply(this,arguments)}return(0,Wa.default)(t,[{key:"getShaders",value:function(){var i=this.context.gl,o=!(0,be.isWebGL2)(i),a={},s=this.props.flatShading&&(0,be.hasFeature)(i,be.FEATURES.GLSL_DERIVATIVES);return s&&(a.FLAT_SHADING=1),(0,Bn.default)((0,It.default)(t.prototype),"getShaders",this).call(this,{vs:Fa,fs:ka,defines:a,transpileToGLSL100:o,modules:[ee.project32,s?ee.phongLighting:ee.gouraudLighting,ee.picking]})}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:Tr},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:Tr},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(i){(0,Bn.default)((0,It.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.extensionsChanged||o.flatShading!==a.flatShading;if(l){var c,f=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(f),this.getAttributeManager().invalidateAll()}(l||o.diskResolution!==a.diskResolution||o.vertices!==a.vertices||(o.extruded||o.stroked)!==(a.extruded||a.stroked))&&this._updateGeometry(o)}},{key:"getGeometry",value:function(i,o,a){var s=new za({radius:1,height:a?2:0,vertices:o,nradial:i}),l=0;if(o)for(var c=0;c<i;c++){var f=o[c],u=Math.sqrt(f[0]*f[0]+f[1]*f[1]);l+=u/i}else l=1;return this.setState({edgeDistance:Math.cos(Math.PI/i)*l}),s}},{key:"_getModel",value:function(i){return new be.Model(i,ja(ja({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(i){var o=i.diskResolution,a=i.vertices,s=i.extruded,l=i.stroked,c=this.getGeometry(o,a,s||l);this.setState({fillVertexCount:c.attributes.POSITION.value.length/3,wireframeVertexCount:c.indices.value.length}),this.state.model.setProps({geometry:c})}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.lineWidthUnits,l=a.lineWidthScale,c=a.lineWidthMinPixels,f=a.lineWidthMaxPixels,u=a.radiusUnits,p=a.elevationScale,v=a.extruded,d=a.filled,m=a.stroked,y=a.wireframe,x=a.offset,S=a.coverage,h=a.radius,P=a.angle,_=this.state,M=_.model,C=_.fillVertexCount,b=_.wireframeVertexCount,O=_.edgeDistance;M.setUniforms(o).setUniforms({radius:h,angle:P/180*Math.PI,offset:x,extruded:v,stroked:m,coverage:S,elevationScale:p,edgeDistance:O,radiusUnits:ee.UNIT[u],widthUnits:ee.UNIT[s],widthScale:l,widthMinPixels:c,widthMaxPixels:f}),v&&y&&(M.setProps({isIndexed:!0}),M.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),d&&(M.setProps({isIndexed:!1}),M.setVertexCount(C).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!v&&m&&(M.setProps({isIndexed:!1}),M.setVertexCount(C*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(ee.Layer);(0,Er.default)(Xe,"layerName","ColumnLayer");(0,Er.default)(Xe,"defaultProps",nu);var Ga=g(N()),Za=g(B()),Va=g($()),Ha=g(Y()),Gn=g(V()),Zn=g(j()),$a=g(q()),Ya=g(D());function iu(e){var r=ou();return function(){var n=(0,Gn.default)(e),i;if(r){var o=(0,Gn.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ha.default)(this,i)}}function ou(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var au={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},Rr=function(e){(0,Va.default)(t,e);var r=iu(t);function t(){return(0,Ga.default)(this,t),r.apply(this,arguments)}return(0,Za.default)(t,[{key:"getGeometry",value:function(i){return new $a.CubeGeometry}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.elevationScale,l=a.extruded,c=a.offset,f=a.coverage,u=a.cellSize,p=a.angle,v=a.radiusUnits;this.state.model.setUniforms(o).setUniforms({radius:u/2,radiusUnits:Ya.UNIT[v],angle:p,offset:c,extruded:l,coverage:f,elevationScale:s,edgeDistance:1,isWireframe:!1}).draw()}}]),t}(Xe);(0,Zn.default)(Rr,"layerName","GridCellLayer");(0,Zn.default)(Rr,"defaultProps",au);var vs=g(N()),ds=g(B()),gs=g(se()),Tt=g(X()),hs=g($()),ms=g(Y()),Re=g(V()),Et=g(j()),we=g(D()),Fr=g(q());var ts=g(j()),rs=g(N()),ns=g(B()),is=g(X()),os=g($()),as=g(Y()),zr=g(V()),ss=g(D());function Ka(e,r,t,n){var i;if(Array.isArray(e[0])){var o=e.length*r;i=new Array(o);for(var a=0;a<e.length;a++)for(var s=0;s<r;s++)i[a*r+s]=e[a][s]||0}else i=e;return t?Lt(i,{size:r,gridResolution:t}):n?Nn(i,{size:r}):i}function Xa(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=su(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function su(e,r){if(e){if(typeof e=="string")return qa(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qa(e,r)}}function qa(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ja(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Qa(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ja(Object(t),!0).forEach(function(n){(0,ts.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ja(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function lu(e){var r=cu();return function(){var n=(0,zr.default)(e),i;if(r){var o=(0,zr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,as.default)(this,i)}}function cu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fu=1,uu=2,Vn=4,ls=function(e){(0,os.default)(t,e);var r=lu(t);function t(n){return(0,rs.default)(this,t),r.call(this,Qa(Qa({},n),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:n.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return(0,ns.default)(t,[{key:"get",value:function(i){return this.attributes[i]}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize?(0,is.default)((0,zr.default)(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"normalizeGeometry",value:function(i){return this.normalize?Ka(i,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):i}},{key:"getGeometrySize",value:function(i){if(es(i)){var o=0,a=Xa(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(f){a.e(f)}finally{a.f()}return o}var c=this.getPathLength(i);return c<2?0:this.isClosed(i)?c<3?0:c+2:c}},{key:"updateGeometryAttributes",value:function(i,o){if(o.geometrySize!==0)if(i&&es(i)){var a=Xa(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,c=this.getGeometrySize(l);o.geometrySize=c,this.updateGeometryAttributes(l,o),o.vertexStart+=c}}catch(f){a.e(f)}finally{a.f()}}else this._updateSegmentTypes(i,o),this._updatePositions(i,o)}},{key:"_updateSegmentTypes",value:function(i,o){var a=this.attributes.segmentTypes,s=i?this.isClosed(i):!1,l=o.vertexStart,c=o.geometrySize;a.fill(0,l,l+c),s?(a[l]=Vn,a[l+c-2]=Vn):(a[l]+=fu,a[l+c-2]+=uu),a[l+c-1]=Vn}},{key:"_updatePositions",value:function(i,o){var a=this.attributes.positions;if(!(!a||!i))for(var s=o.vertexStart,l=o.geometrySize,c=new Array(3),f=s,u=0;u<l;f++,u++)this.getPointOnPath(i,u,c),a[f*3]=c[0],a[f*3+1]=c[1],a[f*3+2]=c[2]}},{key:"getPathLength",value:function(i){return i.length/this.positionSize}},{key:"getPointOnPath",value:function(i,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=this.positionSize;o*s>=i.length&&(o+=1-i.length/s);var l=o*s;return a[0]=i[l],a[1]=i[l+1],a[2]=s===3&&i[l+2]||0,a}},{key:"isClosed",value:function(i){if(!this.normalize)return Boolean(this.opts.loop);var o=this.positionSize,a=i.length-o;return i[0]===i[a]&&i[1]===i[a+1]&&(o===2||i[2]===i[a+2])}}]),t}(ss.Tesselator);function es(e){return Array.isArray(e[0])}var cs=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var fs=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function us(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ps(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?us(Object(t),!0).forEach(function(n){(0,Et.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):us(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pu(e){var r=vu();return function(){var n=(0,Re.default)(e),i;if(r){var o=(0,Re.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,ms.default)(this,i)}}function vu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ys=[0,0,0,255],du={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(r){return r.path}},getColor:{type:"accessor",value:ys},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Hn={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},Oe=function(e){(0,hs.default)(t,e);var r=pu(t);function t(){var n;(0,vs.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Et.default)((0,gs.default)(n),"state",void 0),n}return(0,ds.default)(t,[{key:"getShaders",value:function(){return(0,Tt.default)((0,Re.default)(t.prototype),"getShaders",this).call(this,{vs:cs,fs,modules:[we.project32,we.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=!0,a=this.getAttributeManager();a.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Hn,accessor:"getPath",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:o},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Hn,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Hn,defaultValue:ys},instancePickingColors:{size:3,type:5121,accessor:function(l,c){var f=c.index,u=c.target;return i.encodePickingColor(l&&l.__source?l.__source.index:f,u)}}}),this.setState({pathTesselator:new ls({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(i){(0,Tt.default)((0,Re.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.changeFlags,s=this.getAttributeManager(),l=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPath);if(l){var c=this.state.pathTesselator,f=o.data.attributes||{};c.updateGeometry({data:o.data,geometryBuffer:f.getPath,buffers:f,normalize:!o._pathType,loop:o._pathType==="loop",getGeometry:o.getPath,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:a.dataChanged}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),a.dataChanged||s.invalidateAll()}if(a.extensionsChanged){var u,p=this.context.gl;(u=this.state.model)===null||u===void 0||u.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}},{key:"getPickingInfo",value:function(i){var o=(0,Tt.default)((0,Re.default)(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else(0,Tt.default)((0,Re.default)(t.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.jointRounded,l=a.capRounded,c=a.billboard,f=a.miterLimit,u=a.widthUnits,p=a.widthScale,v=a.widthMinPixels,d=a.widthMaxPixels;this.state.model.setUniforms(o).setUniforms({jointType:Number(s),capType:Number(l),billboard:c,widthUnits:we.UNIT[u],widthScale:p,miterLimit:f,widthMinPixels:v,widthMaxPixels:d}).draw()}},{key:"_getModel",value:function(i){var o=[0,1,2,1,4,2,1,3,4,3,5,4],a=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Fr.Model(i,ps(ps({},this.getShaders()),{},{id:this.props.id,geometry:new Fr.Geometry({drawMode:4,attributes:{indices:new Uint16Array(o),positions:{value:new Float32Array(a),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateSegmentTypes",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("segmentTypes")}}]),t}(we.Layer);(0,Et.default)(Oe,"defaultProps",du);(0,Et.default)(Oe,"layerName","PathLayer");var tl=g(N()),rl=g(B()),nl=g($()),il=g(Y()),Qn=g(V()),ei=g(j()),et=g(D());var Ks=g(N()),Xs=g(B()),qs=g(se()),jt=g(X()),Js=g($()),Qs=g(Y()),Fe=g(V()),Nt=g(j()),te=g(D()),he=g(q());var js=g(j()),Ns=g(N()),Ws=g(B()),Jn=g(X()),Us=g($()),Bs=g(Y()),Dt=g(V());var As=g(or()),Is=g(Ms());function Iu(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Tu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Tu(e,r){if(e){if(typeof e=="string")return Cs(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Cs(e,r)}}function Cs(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Wr=Ke.CLOCKWISE,bs=Ke.COUNTER_CLOCKWISE,Le={isClosed:!0};function Eu(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Je(e){return"positions"in e?e.positions:e}function kt(e){return"holeIndices"in e?e.holeIndices:null}function Ru(e){return Array.isArray(e[0])}function zu(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function Fu(e){var r=e[0],t=e[e.length-1];return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function ku(e,r,t,n){for(var i=0;i<r;i++)if(e[t+i]!==e[n-r+i])return!1;return!0}function ws(e,r,t,n,i){for(var o=r,a=t.length,s=0;s<a;s++)for(var l=0;l<n;l++)e[o++]=t[s][l]||0;if(!Fu(t))for(var c=0;c<n;c++)e[o++]=t[0][c]||0;return Le.start=r,Le.end=o,Le.size=n,Me(e,i,Le),o}function Os(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;o=o||t.length;var s=o-i;if(s<=0)return r;for(var l=r,c=0;c<s;c++)e[l++]=t[i+c];if(!ku(t,n,i,o))for(var f=0;f<n;f++)e[l++]=t[i+f];return Le.start=r,Le.end=l,Le.size=n,Me(e,a,Le),l}function Ur(e,r){Eu(e);var t=[],n=[];if("positions"in e){var i=e,o=i.positions,a=i.holeIndices;if(a){for(var s=0,l=0;l<=a.length;l++)s=Os(t,s,o,r,a[l-1],a[l],l===0?Wr:bs),n.push(s);return n.pop(),{positions:t,holeIndices:n}}e=o}if(!Ru(e))return Os(t,0,e,r,0,t.length,Wr),t;if(!zu(e)){var c=0,f=Iu(e.entries()),u;try{for(f.s();!(u=f.n()).done;){var p=(0,As.default)(u.value,2),v=p[0],d=p[1];c=ws(t,c,d,r,v===0?Wr:bs),n.push(c)}}catch(m){f.e(m)}finally{f.f()}return n.pop(),{positions:t,holeIndices:n}}return ws(t,0,e,r,Wr),t}function qn(e,r,t){for(var n=e.length/3,i=0,o=0;o<n;o++){var a=(o+1)%n;i+=e[o*3+r]*e[a*3+t],i-=e[a*3+r]*e[o*3+t]}return Math.abs(i/2)}function Ls(e,r,t,n){for(var i=e.length/3,o=0;o<i;o++){var a=o*3,s=e[a+0],l=e[a+1],c=e[a+2];e[a+r]=s,e[a+t]=l,e[a+n]=c}}function Ts(e,r,t,n){var i=kt(e);i&&(i=i.map(function(d){return d/r}));var o=Je(e),a=n&&r===3;if(t){var s=o.length;o=o.slice();for(var l=[],c=0;c<s;c+=r){l[0]=o[c],l[1]=o[c+1],a&&(l[2]=o[c+2]);var f=t(l);o[c]=f[0],o[c+1]=f[1],a&&(o[c+2]=f[2])}}if(a){var u=qn(o,0,1),p=qn(o,0,2),v=qn(o,1,2);if(!u&&!p&&!v)return[];u>p&&u>v||(p>v?(t||(o=o.slice()),Ls(o,0,2,1)):(t||(o=o.slice()),Ls(o,1,2,0)))}return(0,Is.default)(o,i,r)}var Gs=g(D());function Rs(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Du(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Du(e,r){if(e){if(typeof e=="string")return zs(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return zs(e,r)}}function zs(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Fs(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ks(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Fs(Object(t),!0).forEach(function(n){(0,js.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Fs(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ju(e){var r=Nu();return function(){var n=(0,Dt.default)(e),i;if(r){var o=(0,Dt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Bs.default)(this,i)}}function Nu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Zs=function(e){(0,Us.default)(t,e);var r=ju(t);function t(n){(0,Ns.default)(this,t);var i=n.fp64,o=n.IndexType,a=o===void 0?Uint32Array:o;return r.call(this,ks(ks({},n),{},{attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:a,size:1}}}))}return(0,Ws.default)(t,[{key:"get",value:function(i){var o=this.attributes;return i==="indices"?o.indices&&o.indices.subarray(0,this.vertexCount):o[i]}},{key:"updateGeometry",value:function(i){(0,Jn.default)((0,Dt.default)(t.prototype),"updateGeometry",this).call(this,i);var o=this.buffers.indices;if(o)this.vertexCount=(o.value||o).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(i){if(this.normalize){var o=Ur(i,this.positionSize);return this.opts.resolution?At(Je(o),kt(o),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?Wn(Je(o),kt(o),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):o}return i}},{key:"getGeometrySize",value:function(i){if(Ds(i)){var o=0,a=Rs(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(c){a.e(c)}finally{a.f()}return o}return Je(i).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize||!this.buffers.indices?(0,Jn.default)((0,Dt.default)(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"updateGeometryAttributes",value:function(i,o){if(i&&Ds(i)){var a=Rs(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,c=this.getGeometrySize(l);o.geometrySize=c,this.updateGeometryAttributes(l,o),o.vertexStart+=c,o.indexStart=this.indexStarts[o.geometryIndex+1]}}catch(f){a.e(f)}finally{a.f()}}else this._updateIndices(i,o),this._updatePositions(i,o),this._updateVertexValid(i,o)}},{key:"_updateIndices",value:function(i,o){var a=o.geometryIndex,s=o.vertexStart,l=o.indexStart,c=this.attributes,f=this.indexStarts,u=this.typedArrayManager,p=c.indices;if(!(!p||!i)){var v=l,d=Ts(i,this.positionSize,this.opts.preproject,this.opts.full3d);p=u.allocate(p,l+d.length,{copy:!0});for(var m=0;m<d.length;m++)p[v++]=d[m]+s;f[a+1]=l+d.length,c.indices=p}}},{key:"_updatePositions",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.attributes.positions,c=this.positionSize;if(!(!l||!i))for(var f=Je(i),u=a,p=0;p<s;u++,p++){var v=f[p*c],d=f[p*c+1],m=c>2?f[p*c+2]:0;l[u*3]=v,l[u*3+1]=d,l[u*3+2]=m}}},{key:"_updateVertexValid",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.positionSize,c=this.attributes.vertexValid,f=i&&kt(i);if(i&&i.edgeTypes?c.set(i.edgeTypes,a):c.fill(1,a,a+s),f)for(var u=0;u<f.length;u++)c[a+f[u]/l-1]=0;c[a+s-1]=0}}]),t}(Gs.Tesselator);function Ds(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var Br=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Vs=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Br,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var Hs=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Br,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var $s=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Ys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Qe(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ys(Object(t),!0).forEach(function(n){(0,Nt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ys(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wu(e){var r=Uu();return function(){var n=(0,Fe.default)(e),i;if(r){var o=(0,Fe.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Qs.default)(this,i)}}function Uu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Zr=[0,0,0,255],Bu={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(r){return r.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Zr},getLineColor:{type:"accessor",value:Zr},material:!0},Gr={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},Ae=function(e){(0,Js.default)(t,e);var r=Wu(t);function t(){var n;(0,Ks.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Nt.default)((0,qs.default)(n),"state",void 0),n}return(0,Xs.default)(t,[{key:"getShaders",value:function(i){return(0,jt.default)((0,Fe.default)(t.prototype),"getShaders",this).call(this,{vs:i==="top"?Vs:Hs,fs:$s,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[te.project32,te.gouraudLighting,te.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=this.context,a=o.gl,s=o.viewport,l=this.props.coordinateSystem,c=this.props._full3d;s.isGeospatial&&l===te.COORDINATE_SYSTEM.DEFAULT&&(l=te.COORDINATE_SYSTEM.LNGLAT);var f;l===te.COORDINATE_SYSTEM.LNGLAT&&(c?f=s.projectPosition.bind(s):f=s.projectFlat.bind(s)),this.setState({numInstances:0,polygonTesselator:new Zs({preproject:f,fp64:this.use64bitPositions(),IndexType:!a||(0,he.hasFeatures)(a,he.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var u=this.getAttributeManager(),p=!0;u.remove(["instancePickingColors"]),u.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:p},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Gr,accessor:"getPolygon",update:this.calculatePositions,noAlloc:p,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:p},elevations:{size:1,transition:Gr,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Gr,accessor:"getFillColor",defaultValue:Zr,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Gr,accessor:"getLineColor",defaultValue:Zr,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(d,m){var y=m.index,x=m.target;return i.encodePickingColor(d&&d.__source?d.__source.index:y,x)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(i){var o=(0,jt.default)((0,Fe.default)(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else(0,jt.default)((0,Fe.default)(t.prototype),"disablePickingIndex",this).call(this,i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.extruded,l=a.filled,c=a.wireframe,f=a.elevationScale,u=this.state,p=u.topModel,v=u.sideModel,d=u.polygonTesselator,m=Qe(Qe({},o),{},{extruded:Boolean(s),elevationScale:f});v&&(v.setInstanceCount(d.instanceCount-1),v.setUniforms(m),c&&(v.setDrawMode(3),v.setUniforms({isWireframe:!0}).draw()),l&&(v.setDrawMode(6),v.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(d.vertexCount),p.setUniforms(m).draw())}},{key:"updateState",value:function(i){(0,jt.default)((0,Fe.default)(t.prototype),"updateState",this).call(this,i),this.updateGeometry(i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),c=s.extensionsChanged||o.filled!==a.filled||o.extruded!==a.extruded;if(c){var f;(f=this.state.models)===null||f===void 0||f.forEach(function(u){return u.delete()}),this.setState(this._getModels(this.context.gl)),l.invalidateAll()}}},{key:"updateGeometry",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(l){var c=this.state.polygonTesselator,f=o.data.attributes||{};c.updateGeometry({data:o.data,normalize:o._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:o.getPolygon,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:o._full3d}),this.setState({numInstances:c.instanceCount,startIndices:c.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(i){var o=this.props,a=o.id,s=o.filled,l=o.extruded,c,f;if(s){var u=this.getShaders("top");u.defines.NON_INSTANCED_MODEL=1,c=new he.Model(i,Qe(Qe({},u),{},{id:"".concat(a,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return l&&(f=new he.Model(i,Qe(Qe({},this.getShaders("side")),{},{id:"".concat(a,"-side"),geometry:new he.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),f.userData.excludeAttributes={indices:!0}),{models:[f,c].filter(Boolean),topModel:c,sideModel:f}}},{key:"calculateIndices",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.indexStarts,i.value=o.get("indices")}},{key:"calculatePositions",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateVertexValid",value:function(i){i.value=this.state.polygonTesselator.get("vertexValid")}}]),t}(te.Layer);(0,Nt.default)(Ae,"defaultProps",Bu);(0,Nt.default)(Ae,"layerName","SolidPolygonLayer");function Vr(e){for(var r=e.data,t=e.getIndex,n=e.dataRange,i=e.replace,o=n.startRow,a=o===void 0?0:o,s=n.endRow,l=s===void 0?1/0:s,c=r.length,f=c,u=c,p=0;p<c;p++){var v=t(r[p]);if(f>p&&v>=a&&(f=p),v>=l){u=p;break}}for(var d=f,m=u-f!==i.length,y=m?r.slice(u):void 0,x=0;x<i.length;x++)r[d++]=i[x];if(y){for(var S=0;S<y.length;S++)r[d++]=y[S];r.length=d}return{startRow:f,endRow:f+i.length}}function Gu(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zu(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Zu(e,r){if(e){if(typeof e=="string")return el(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return el(e,r)}}function el(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Vu(e){var r=Hu();return function(){var n=(0,Qn.default)(e),i;if(r){var o=(0,Qn.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,il.default)(this,i)}}function Hu(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ol=[0,0,0,255],$u=[0,0,0,255],Yu={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(r){return r.polygon}},getFillColor:{type:"accessor",value:$u},getLineColor:{type:"accessor",value:ol},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Hr=function(e){(0,nl.default)(t,e);var r=Vu(t);function t(){return(0,tl.default)(this,t),r.apply(this,arguments)}return(0,rl.default)(t,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&et.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(i){var o=this,a=i.changeFlags,s=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPolygon);if(s&&Array.isArray(a.dataChanged)){var l=this.state.paths.slice(),c=a.dataChanged.map(function(f){return Vr({data:l,getIndex:function(p){return p.__source.index},dataRange:f,replace:o._getPaths(f)})});this.setState({paths:l,pathsDiff:c})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,a=o.data,s=o.getPolygon,l=o.positionFormat,c=o._normalize,f=[],u=l==="XY"?2:3,p=i.startRow,v=i.endRow,d=(0,et.createIterable)(a,p,v),m=d.iterable,y=d.objectInfo,x=Gu(m),S;try{for(x.s();!(S=x.n()).done;){var h=S.value;y.index++;var P=s(h,y);c&&(P=Ur(P,u));var _=P,M=_.holeIndices,C=P.positions||P;if(M)for(var b=0;b<=M.length;b++){var O=C.slice(M[b-1]||0,M[b]||C.length);f.push(this.getSubLayerRow({path:O},h,y.index))}else f.push(this.getSubLayerRow({path:C},h,y.index))}}catch(I){x.e(I)}finally{x.f()}return f}},{key:"renderLayers",value:function(){var i=this.props,o=i.data,a=i._dataDiff,s=i.stroked,l=i.filled,c=i.extruded,f=i.wireframe,u=i._normalize,p=i._windingOrder,v=i.elevationScale,d=i.transitions,m=i.positionFormat,y=this.props,x=y.lineWidthUnits,S=y.lineWidthScale,h=y.lineWidthMinPixels,P=y.lineWidthMaxPixels,_=y.lineJointRounded,M=y.lineMiterLimit,C=y.lineDashJustified,b=this.props,O=b.getFillColor,I=b.getLineColor,A=b.getLineWidth,L=b.getLineDashArray,T=b.getElevation,w=b.getPolygon,R=b.updateTriggers,Z=b.material,k=this.state,E=k.paths,z=k.pathsDiff,ve=this.getSubLayerClass("fill",Ae),de=this.getSubLayerClass("stroke",Oe),Kt=this.shouldRenderSubLayer("fill",E)&&new ve({_dataDiff:a,extruded:c,elevationScale:v,filled:l,wireframe:f,_normalize:u,_windingOrder:p,getElevation:T,getFillColor:O,getLineColor:c&&f?I:ol,material:Z,transitions:d},this.getSubLayerProps({id:"fill",updateTriggers:R&&{getPolygon:R.getPolygon,getElevation:R.getElevation,getFillColor:R.getFillColor,lineColors:c&&f,getLineColor:R.getLineColor}}),{data:o,positionFormat:m,getPolygon:w}),on=!c&&s&&this.shouldRenderSubLayer("stroke",E)&&new de({_dataDiff:z&&function(){return z},widthUnits:x,widthScale:S,widthMinPixels:h,widthMaxPixels:P,jointRounded:_,miterLimit:M,dashJustified:C,_pathType:"loop",transitions:d&&{getWidth:d.getLineWidth,getColor:d.getLineColor,getPath:d.getPolygon},getColor:this.getSubLayerAccessor(I),getWidth:this.getSubLayerAccessor(A),getDashArray:this.getSubLayerAccessor(L)},this.getSubLayerProps({id:"stroke",updateTriggers:R&&{getWidth:R.getLineWidth,getColor:R.getLineColor,getDashArray:R.getLineDashArray}}),{data:E,positionFormat:m,getPath:function(an){return an.path}});return[!c&&Kt,on,c&&Kt]}}]),t}(et.CompositeLayer);(0,ei.default)(Hr,"layerName","PolygonLayer");(0,ei.default)(Hr,"defaultProps",Yu);var _c=g(cl()),Sc=g(N()),Mc=g(B()),ci=g(X()),Cc=g($()),bc=g(Y()),$t=g(V()),rn=g(j()),wc=g(D());var ul=g(j());function fl(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ju(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?fl(Object(t),!0).forEach(function(n){(0,ul.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fl(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pl(e,r){if(!e)return null;var t="startIndices"in e?e.startIndices[r]:r,n=e.featureIds.value[t];return t!==-1?Qu(e,n,t):null}function Qu(e,r,t){var n={properties:Ju({},e.properties[r])};for(var i in e.numericProps)n.properties[i]=e.numericProps[i].value[t];return n}function vl(e,r){var t={points:null,lines:null,polygons:null};for(var n in t){var i=e[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*3);for(var o=[],a=0;a<i.length;a++)r(i[a],o),t[n][a*3+0]=o[0],t[n][a*3+1]=o[1],t[n][a*3+2]=o[2]}return t}var oi=g(or()),lc=g(N()),cc=g(B()),Jr=g(se()),fc=g($()),uc=g(Y()),ai=g(V()),je=g(j()),nt=g(D());var ml=g(N()),yl=g(B()),xl=g(se()),ke=g(X()),Pl=g($()),_l=g(Y()),me=g(V()),Wt=g(j()),Sl=g(D());var dl=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function gl(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function $r(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?gl(Object(t),!0).forEach(function(n){(0,Wt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gl(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ep(e){var r=tp();return function(){var n=(0,me.default)(e),i;if(r){var o=(0,me.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,_l.default)(this,i)}}function tp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ti=192/256,hl=[],rp={getIconOffsets:{type:"accessor",value:function(r){return r.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},tt=function(e){(0,Pl.default)(t,e);var r=ep(t);function t(){var n;(0,ml.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Wt.default)((0,xl.default)(n),"state",void 0),n}return(0,yl.default)(t,[{key:"getShaders",value:function(){return $r($r({},(0,ke.default)((0,me.default)(t.prototype),"getShaders",this).call(this)),{},{fs:dl})}},{key:"initializeState",value:function(){var i=this;(0,ke.default)((0,me.default)(t.prototype),"initializeState",this).call(this);var o=this.getAttributeManager();o.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(s,l){var c=l.index,f=l.target;return i.encodePickingColor(c,f)}}})}},{key:"updateState",value:function(i){(0,ke.default)((0,me.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=o.outlineColor;s!==a.outlineColor&&(s=s.map(function(l){return l/255}),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!o.sdf&&o.outlineWidth&&Sl.log.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(i){var o=this.props,a=o.sdf,s=o.smoothing,l=o.outlineWidth,c=this.state.outlineColor,f=l?Math.max(s,ti*(1-l)):-1;if(i.uniforms=$r($r({},i.uniforms),{},{sdfBuffer:ti,outlineBuffer:f,gamma:s,sdf:Boolean(a),outlineColor:c}),(0,ke.default)((0,me.default)(t.prototype),"draw",this).call(this,i),a&&l){var u=this.state.iconManager,p=u.getTexture();p&&this.state.model.draw({uniforms:{outlineBuffer:ti}})}}},{key:"getInstanceOffset",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return(0,ke.default)((0,me.default)(t.prototype),"getInstanceOffset",o).call(o,a)}):hl}},{key:"getInstanceColorMode",value:function(i){return 1}},{key:"getInstanceIconFrame",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return(0,ke.default)((0,me.default)(t.prototype),"getInstanceIconFrame",o).call(o,a)}):hl}}]),t}(_e);(0,Wt.default)(tt,"defaultProps",rp);(0,Wt.default)(tt,"layerName","MultiIconLayer");var Gl=g(N()),Zl=g(B()),Bt=g(j());var Ut=class{constructor({fontSize:r=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;let l=this.size=r+t*4,c=this._createCanvas(l),f=this.ctx=c.getContext("2d",{willReadFrequently:!0});f.font=`${s} ${a} ${r}px ${o}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(r){let t=document.createElement("canvas");return t.width=t.height=r,t}draw(r){let{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(r),s=Math.ceil(n),l=0,c=Math.min(this.size-this.buffer,Math.ceil(a-o)),f=Math.min(this.size-this.buffer,s+Math.ceil(i)),u=c+2*this.buffer,p=f+2*this.buffer,v=Math.max(u*p,0),d=new Uint8ClampedArray(v),m={data:d,width:u,height:p,glyphWidth:c,glyphHeight:f,glyphTop:s,glyphLeft:l,glyphAdvance:t};if(c===0||f===0)return m;let{ctx:y,buffer:x,gridInner:S,gridOuter:h}=this;y.clearRect(x,x,c,f),y.fillText(r,x,x+s);let P=y.getImageData(x,x,c,f);h.fill(1e20,0,v),S.fill(0,0,v);for(let _=0;_<f;_++)for(let M=0;M<c;M++){let C=P.data[4*(_*c+M)+3]/255;if(C===0)continue;let b=(_+x)*u+M+x;if(C===1)h[b]=0,S[b]=1e20;else{let O=.5-C;h[b]=O>0?O*O:0,S[b]=O<0?O*O:0}}Ml(h,0,0,u,p,u,this.f,this.v,this.z),Ml(S,x,x,c,f,u,this.f,this.v,this.z);for(let _=0;_<v;_++){let M=Math.sqrt(h[_])-Math.sqrt(S[_]);d[_]=Math.round(255-255*(M/this.radius+this.cutoff))}return m}};function Ml(e,r,t,n,i,o,a,s,l){for(let c=r;c<r+n;c++)Cl(e,t*o+c,o,i,a,s,l);for(let c=t;c<t+i;c++)Cl(e,c*o+r,1,n,a,s,l)}function Cl(e,r,t,n,i,o,a){o[0]=0,a[0]=-1e20,a[1]=1e20,i[0]=e[r];for(let s=1,l=0,c=0;s<n;s++){i[s]=e[r+s*t];let f=s*s;do{let u=o[l];c=(i[s]-i[u]+f-u*u)/(s-u)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=1e20}for(let s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;let c=o[l],f=s-c;e[r+s*t]=i[c]+f*f}}var Vl=g(D());var Ol=g(D());function wl(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=np(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function np(e,r){if(e){if(typeof e=="string")return bl(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bl(e,r)}}function bl(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var ip=32,op=[];function ap(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Ll(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=a===void 0?{}:a,l=e.xOffset,c=l===void 0?0:l,f=e.yOffset,u=f===void 0?0:f,p=0,v=c,d=n+i*2,m=wl(r),y;try{for(m.s();!(y=m.n()).done;){var x=y.value;if(!s[x]){var S=t(x);v+S+i*2>o&&(v=0,p++),s[x]={x:v+i,y:u+p*d+i,width:S,height:d,layoutWidth:S,layoutHeight:n},v+=S+i*2}}}catch(h){m.e(h)}finally{m.f()}return{mapping:s,xOffset:v,yOffset:u+p*d,canvasHeight:ap(u+(p+1)*d)}}function Al(e,r,t,n){for(var i=0,o=r;o<t;o++){var a,s=e[o];i+=((a=n[s])===null||a===void 0?void 0:a.layoutWidth)||0}return i}function Il(e,r,t,n,i,o){for(var a=r,s=0,l=r;l<t;l++){var c=Al(e,l,l+1,i);s+c>n&&(a<l&&o.push(l),a=l,s=0),s+=c}return s}function sp(e,r,t,n,i,o){for(var a=r,s=r,l=r,c=0,f=r;f<t;f++)if((e[f]===" "||e[f+1]===" "||f+1===t)&&(l=f+1),l>s){var u=Al(e,s,l,i);c+u>n&&(a<s&&(o.push(s),a=s,c=0),u>n&&(u=Il(e,s,l,n,i,o),a=o[o.length-1])),s=l,c+=u}return c}function lp(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;o===void 0&&(o=e.length);var a=[];return r==="break-all"?Il(e,i,o,t,n,a):sp(e,i,o,t,n,a),a}function cp(e,r,t,n,i,o){for(var a=0,s=0,l=r;l<t;l++){var c=e[l],f=n[c];f?(s||(s=f.layoutHeight),i[l]=a+f.layoutWidth/2,a+=f.layoutWidth):(Ol.log.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),i[l]=a,a+=ip)}o[0]=a,o[1]=s}function Tl(e,r,t,n,i){for(var o=Array.from(e),a=o.length,s=new Array(a),l=new Array(a),c=new Array(a),f=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,u=[0,0],p=[0,0],v=0,d=0,m=0,y=0;y<=a;y++){var x=o[y];if((x===`
`||y===a)&&(m=y),m>d){for(var S=f?lp(o,t,n,i,d,m):op,h=0;h<=S.length;h++){var P=h===0?d:S[h-1],_=h<S.length?S[h]:m;cp(o,P,_,i,s,p);for(var M=P;M<_;M++){var C,b=o[M],O=((C=i[b])===null||C===void 0?void 0:C.layoutOffsetY)||0;l[M]=v+p[1]/2+O,c[M]=p[0]}v=v+p[1]*r,u[0]=Math.max(u[0],p[0])}d=m}x===`
`&&(s[d]=0,l[d]=0,c[d]=0,d++)}return u[1]=v,{x:s,y:l,rowWidth:c,size:u}}function El(e){var r=e.value,t=e.length,n=e.stride,i=e.offset,o=e.startIndices,a=e.characterSet,s=r.BYTES_PER_ELEMENT,l=n?n/s:1,c=i?i/s:0,f=o[t]||Math.ceil((r.length-c)/l),u=a&&new Set,p=new Array(t),v=r;if(l>1||c>0){var d=r.constructor;v=new d(f);for(var m=0;m<f;m++)v[m]=r[m*l+c]}for(var y=0;y<t;y++){var x=o[y],S=o[y+1]||f,h=v.subarray(x,S);p[y]=String.fromCodePoint.apply(null,h),u&&h.forEach(u.add,u)}if(u){var P=wl(u),_;try{for(P.s();!(_=P.n()).done;){var M=_.value;a.add(String.fromCodePoint(M))}}catch(C){P.e(C)}finally{P.f()}}return{texts:p,characterCount:f}}var Rl=g(N()),zl=g(B()),Yr=g(j()),ri=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;(0,Rl.default)(this,e),(0,Yr.default)(this,"limit",void 0),(0,Yr.default)(this,"_cache",{}),(0,Yr.default)(this,"_order",[]),this.limit=r}return(0,zl.default)(e,[{key:"get",value:function(t){var n=this._cache[t];return n&&(this._deleteOrder(t),this._appendOrder(t)),n}},{key:"set",value:function(t,n){this._cache[t]?(this.delete(t),this._cache[t]=n,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=n,this._appendOrder(t))}},{key:"delete",value:function(t){var n=this._cache[t];n&&(delete this._cache[t],this._deleteOrder(t))}},{key:"_deleteOrder",value:function(t){var n=this._order.indexOf(t);n>=0&&this._order.splice(n,1)}},{key:"_appendOrder",value:function(t){this._order.push(t)}}]),e}();function Fl(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=fp(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function fp(e,r){if(e){if(typeof e=="string")return kl(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kl(e,r)}}function kl(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Dl(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function jl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Dl(Object(t),!0).forEach(function(n){(0,Bt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dl(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function up(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}var De={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:up(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Nl=1024,Wl=.9,Ul=1.2,Hl=3,Kr=new ri(Hl);function pp(e,r){var t;typeof r=="string"?t=new Set(Array.from(r)):t=new Set(r);var n=Kr.get(e);if(!n)return t;for(var i in n.mapping)t.has(i)&&t.delete(i);return t}function vp(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}function Bl(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function $l(e){Vl.log.assert(Number.isFinite(e)&&e>=Hl,"Invalid cache limit"),Kr=new ri(e)}var Yl=function(){function e(){(0,Gl.default)(this,e),(0,Bt.default)(this,"props",jl({},De)),(0,Bt.default)(this,"_key",void 0),(0,Bt.default)(this,"_atlas",void 0)}return(0,Zl.default)(e,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var t=this.props,n=t.fontSize,i=t.buffer;return(n*Ul+i*2)/n}},{key:"setProps",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this.props,t),this._key=this._getKey();var n=pp(this._key,this.props.characterSet),i=Kr.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}var o=this._generateFontAtlas(n,i);this._atlas=o,Kr.set(this._key,o)}},{key:"_generateFontAtlas",value:function(t,n){var i=this.props,o=i.fontFamily,a=i.fontWeight,s=i.fontSize,l=i.buffer,c=i.sdf,f=i.radius,u=i.cutoff,p=n&&n.data;p||(p=document.createElement("canvas"),p.width=Nl);var v=p.getContext("2d",{willReadFrequently:!0});Bl(v,o,s,a);var d=Ll(jl({getFontWidth:function(E){return v.measureText(E).width},fontHeight:s*Ul,buffer:l,characterSet:t,maxCanvasWidth:Nl},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=d.mapping,y=d.canvasHeight,x=d.xOffset,S=d.yOffset;if(p.height!==y){var h=v.getImageData(0,0,p.width,p.height);p.height=y,v.putImageData(h,0,0)}if(Bl(v,o,s,a),c){var P=new Ut({fontSize:s,buffer:l,radius:f,cutoff:u,fontFamily:o,fontWeight:"".concat(a)}),_=Fl(t),M;try{for(_.s();!(M=_.n()).done;){var C=M.value,b=P.draw(C),O=b.data,I=b.width,A=b.height,L=b.glyphTop;m[C].width=I,m[C].layoutOffsetY=s*Wl-L;var T=v.createImageData(I,A);vp(O,T),v.putImageData(T,m[C].x,m[C].y)}}catch(k){_.e(k)}finally{_.f()}}else{var w=Fl(t),R;try{for(w.s();!(R=w.n()).done;){var Z=R.value;v.fillText(Z,m[Z].x,m[Z].y+l+s*Wl)}}catch(k){w.e(k)}finally{w.f()}}return{xOffset:x,yOffset:S,mapping:m,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var t=this.props,n=t.fontFamily,i=t.fontWeight,o=t.fontSize,a=t.buffer,s=t.sdf,l=t.radius,c=t.cutoff;return s?"".concat(n," ").concat(i," ").concat(o," ").concat(a," ").concat(l," ").concat(c):"".concat(n," ").concat(i," ").concat(o," ").concat(a)}}]),e}();var Ql=g(N()),ec=g(B()),tc=g(se()),ni=g(X()),rc=g($()),nc=g(Y()),Gt=g(V()),Zt=g(j()),Ie=g(D()),Xr=g(q());var Kl=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var Xl=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function ql(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Jl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ql(Object(t),!0).forEach(function(n){(0,Zt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ql(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function dp(e){var r=gp();return function(){var n=(0,Gt.default)(e),i;if(r){var o=(0,Gt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,nc.default)(this,i)}}function gp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hp={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(r){return r.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},rt=function(e){(0,rc.default)(t,e);var r=dp(t);function t(){var n;(0,Ql.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Zt.default)((0,tc.default)(n),"state",void 0),n}return(0,ec.default)(t,[{key:"getShaders",value:function(){return(0,ni.default)((0,Gt.default)(t.prototype),"getShaders",this).call(this,{vs:Kl,fs:Xl,modules:[Ie.project32,Ie.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){(0,ni.default)((0,Gt.default)(t.prototype),"updateState",this).call(this,i);var o=i.changeFlags;if(o.extensionsChanged){var a,s=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.billboard,l=a.sizeScale,c=a.sizeUnits,f=a.sizeMinPixels,u=a.sizeMaxPixels,p=a.getLineWidth,v=this.props.padding;v.length<4&&(v=[v[0],v[1],v[0],v[1]]),this.state.model.setUniforms(o).setUniforms({billboard:s,stroked:Boolean(p),padding:v,sizeUnits:Ie.UNIT[c],sizeScale:l,sizeMinPixels:f,sizeMaxPixels:u}).draw()}},{key:"_getModel",value:function(i){var o=[0,0,1,0,1,1,0,1];return new Xr.Model(i,Jl(Jl({},this.getShaders()),{},{id:this.props.id,geometry:new Xr.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(Ie.Layer);(0,Zt.default)(rt,"defaultProps",hp);(0,Zt.default)(rt,"layerName","TextBackgroundLayer");function mp(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=yp(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function yp(e,r){if(e){if(typeof e=="string")return ic(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ic(e,r)}}function ic(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function oc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function qr(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?oc(Object(t),!0).forEach(function(n){(0,je.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):oc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function xp(e){var r=Pp();return function(){var n=(0,ai.default)(e),i;if(r){var o=(0,ai.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,uc.default)(this,i)}}function Pp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ac={start:1,middle:0,end:-1},sc={top:1,center:0,bottom:-1},ii=[0,0,0,255],_p=1,Sp={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ii},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:De.characterSet},fontFamily:De.fontFamily,fontWeight:De.fontWeight,lineHeight:_p,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ii},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(r){return r.text}},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:ii},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},it=function(e){(0,fc.default)(t,e);var r=xp(t);function t(){var n;(0,lc.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,je.default)((0,Jr.default)(n),"state",void 0),(0,je.default)((0,Jr.default)(n),"getBoundingRect",function(s,l){var c=n.transformParagraph(s,l),f=(0,oi.default)(c.size,2),u=f[0],p=f[1],v=n.state.fontAtlasManager.props.fontSize;u/=v,p/=v;var d=n.props,m=d.getTextAnchor,y=d.getAlignmentBaseline,x=ac[typeof m=="function"?m(s,l):m],S=sc[typeof y=="function"?y(s,l):y];return[(x-1)*u/2,(S-1)*p/2,u,p]}),(0,je.default)((0,Jr.default)(n),"getIconOffsets",function(s,l){for(var c=n.props,f=c.getTextAnchor,u=c.getAlignmentBaseline,p=n.transformParagraph(s,l),v=p.x,d=p.y,m=p.rowWidth,y=(0,oi.default)(p.size,2),x=y[0],S=y[1],h=ac[typeof f=="function"?f(s,l):f],P=sc[typeof u=="function"?u(s,l):u],_=v.length,M=new Array(_*2),C=0,b=0;b<_;b++){var O=(1-h)*(x-m[b])/2;M[C++]=(h-1)*x/2+O+v[b],M[C++]=(P-1)*S/2+d[b]}return M}),n}return(0,cc.default)(t,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new Yl},this.props.maxWidth>0&&nt.log.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText);l&&this._updateText();var c=this._updateFontAtlas(),f=c||o.lineHeight!==a.lineHeight||o.wordBreak!==a.wordBreak||o.maxWidth!==a.maxWidth;f&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(i){var o=i.info;return o.object=o.index>=0?this.props.data[o.index]:null,o}},{key:"_updateFontAtlas",value:function(){var i=this.props,o=i.fontSettings,a=i.fontFamily,s=i.fontWeight,l=this.state,c=l.fontAtlasManager,f=l.characterSet,u=qr(qr({},o),{},{characterSet:f,fontFamily:a,fontWeight:s});if(!c.mapping)return c.setProps(u),!0;for(var p in u)if(u[p]!==c.props[p])return c.setProps(u),!0;return!1}},{key:"_updateText",value:function(){var i,o=this.props,a=o.data,s=o.characterSet,l=(i=a.attributes)===null||i===void 0?void 0:i.getText,c=this.props.getText,f=a.startIndices,u,p=s==="auto"&&new Set;if(l&&f){var v=El(qr(qr({},ArrayBuffer.isView(l)?{value:l}:l),{},{length:a.length,startIndices:f,characterSet:p})),d=v.texts,m=v.characterCount;u=m,c=function(b,O){var I=O.index;return d[I]}}else{var y=(0,nt.createIterable)(a),x=y.iterable,S=y.objectInfo;f=[0],u=0;var h=mp(x),P;try{for(h.s();!(P=h.n()).done;){var _=P.value;S.index++;var M=Array.from(c(_,S)||"");p&&M.forEach(p.add,p),u+=M.length,f.push(u)}}catch(C){h.e(C)}finally{h.f()}}this.setState({getText:c,startIndices:f,numInstances:u,characterSet:p||s})}},{key:"transformParagraph",value:function(i,o){var a=this.state.fontAtlasManager,s=a.mapping,l=this.state.getText,c=this.props,f=c.wordBreak,u=c.lineHeight,p=c.maxWidth,v=l(i,o)||"";return Tl(v,u,f,p*a.props.fontSize,s)}},{key:"renderLayers",value:function(){var i=this.state,o=i.startIndices,a=i.numInstances,s=i.getText,l=i.fontAtlasManager,c=l.scale,f=l.texture,u=l.mapping,p=i.styleVersion,v=this.props,d=v.data,m=v._dataDiff,y=v.getPosition,x=v.getColor,S=v.getSize,h=v.getAngle,P=v.getPixelOffset,_=v.getBackgroundColor,M=v.getBorderColor,C=v.getBorderWidth,b=v.backgroundPadding,O=v.background,I=v.billboard,A=v.fontSettings,L=v.outlineWidth,T=v.outlineColor,w=v.sizeScale,R=v.sizeUnits,Z=v.sizeMinPixels,k=v.sizeMaxPixels,E=v.transitions,z=v.updateTriggers,ve=this.getSubLayerClass("characters",tt),de=this.getSubLayerClass("background",rt);return[O&&new de({getFillColor:_,getLineColor:M,getLineWidth:C,padding:b,getPosition:y,getSize:S,getAngle:h,getPixelOffset:P,billboard:I,sizeScale:w,sizeUnits:R,sizeMinPixels:Z,sizeMaxPixels:k,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getSize:E.getSize,getFillColor:E.getBackgroundColor,getLineColor:E.getBorderColor,getLineWidth:E.getBorderWidth,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:z.getPosition,getAngle:z.getAngle,getSize:z.getSize,getFillColor:z.getBackgroundColor,getLineColor:z.getBorderColor,getLineWidth:z.getBorderWidth,getPixelOffset:z.getPixelOffset,getBoundingRect:{getText:z.getText,getTextAnchor:z.getTextAnchor,getAlignmentBaseline:z.getAlignmentBaseline,styleVersion:p}}}),{data:d.attributes&&d.attributes.background?{length:d.length,attributes:d.attributes.background}:d,_dataDiff:m,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new ve({sdf:A.sdf,smoothing:Number.isFinite(A.smoothing)?A.smoothing:De.smoothing,outlineWidth:L/(A.radius||De.radius),outlineColor:T,iconAtlas:f,iconMapping:u,getPosition:y,getColor:x,getSize:S,getAngle:h,getPixelOffset:P,billboard:I,sizeScale:w*c,sizeUnits:R,sizeMinPixels:Z*c,sizeMaxPixels:k*c,transitions:E&&{getPosition:E.getPosition,getAngle:E.getAngle,getColor:E.getColor,getSize:E.getSize,getPixelOffset:E.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:z.getText,getPosition:z.getPosition,getAngle:z.getAngle,getColor:z.getColor,getSize:z.getSize,getPixelOffset:z.getPixelOffset,getIconOffsets:{getTextAnchor:z.getTextAnchor,getAlignmentBaseline:z.getAlignmentBaseline,styleVersion:p}}}),{data:d,_dataDiff:m,startIndices:o,numInstances:a,getIconOffsets:this.getIconOffsets,getIcon:s})]}}],[{key:"fontAtlasCacheLimit",set:function(i){$l(i)}}]),t}(nt.CompositeLayer);(0,je.default)(it,"defaultProps",Sp);(0,je.default)(it,"layerName","TextLayer");var Vt={circle:{type:Ye,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:_e,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:it,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ht={type:Oe,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Qr={type:Ae,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ot(e){var r=e.type,t=e.props,n={};for(var i in t)n[i]=r.defaultProps[t[i]];return n}function en(e,r){var t=e.props,n=t.transitions,i=t.updateTriggers,o={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var a in r){var s=r[a],l=e.props[a];a.startsWith("get")&&(l=e.getSubLayerAccessor(l),o.updateTriggers[s]=i[a],n&&(o.transitions[s]=n[a])),o[s]=l}return o}var at=g(D());function vc(e){if(Array.isArray(e))return e;switch(at.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return at.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function si(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=t.startRow,o=i===void 0?0:i,a=t.endRow,s=a===void 0?e.length:a,l=o;l<s;l++){var c=e[l],f=c.geometry;if(f)if(f.type==="GeometryCollection"){at.log.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");for(var u=f.geometries,p=0;p<u.length;p++){var v=u[p];pc(v,n,r,c,l)}}else pc(f,n,r,c,l)}return n}function pc(e,r,t,n,i){var o=e.type,a=e.coordinates,s=r.pointFeatures,l=r.lineFeatures,c=r.polygonFeatures,f=r.polygonOutlineFeatures;if(!Cp(o,a)){at.log.warn("".concat(o," coordinates are malformed"))();return}switch(o){case"Point":s.push(t({geometry:e},n,i));break;case"MultiPoint":a.forEach(function(u){s.push(t({geometry:{type:"Point",coordinates:u}},n,i))});break;case"LineString":l.push(t({geometry:e},n,i));break;case"MultiLineString":a.forEach(function(u){l.push(t({geometry:{type:"LineString",coordinates:u}},n,i))});break;case"Polygon":c.push(t({geometry:e},n,i)),a.forEach(function(u){f.push(t({geometry:{type:"LineString",coordinates:u}},n,i))});break;case"MultiPolygon":a.forEach(function(u){c.push(t({geometry:{type:"Polygon",coordinates:u}},n,i)),u.forEach(function(p){f.push(t({geometry:{type:"LineString",coordinates:p}},n,i))})});break;default:}}var Mp={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Cp(e,r){var t=Mp[e];for(at.log.assert(t,"Unknown GeoJSON type ".concat(e));r&&--t>0;)r=r[0];return r&&Number.isFinite(r[0])}var gc=g(j());function dc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Te(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?dc(Object(t),!0).forEach(function(n){(0,gc.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hc(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function tn(e){return e.geometry.coordinates}function mc(e,r){var t=hc(),n=e.pointFeatures,i=e.lineFeatures,o=e.polygonFeatures,a=e.polygonOutlineFeatures;return t.points.data=n,t.points._dataDiff=r.pointFeatures&&function(){return r.pointFeatures},t.points.getPosition=tn,t.lines.data=i,t.lines._dataDiff=r.lineFeatures&&function(){return r.lineFeatures},t.lines.getPath=tn,t.polygons.data=o,t.polygons._dataDiff=r.polygonFeatures&&function(){return r.polygonFeatures},t.polygons.getPolygon=tn,t.polygonsOutline.data=a,t.polygonsOutline._dataDiff=r.polygonOutlineFeatures&&function(){return r.polygonOutlineFeatures},t.polygonsOutline.getPath=tn,t}function yc(e,r){var t=hc(),n=e.points,i=e.lines,o=e.polygons,a=vl(e,r);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:Te(Te({},n.attributes),{},{getPosition:n.positions,instancePickingColors:{size:3,value:a.points}}),properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:Te(Te({},i.attributes),{},{getPath:i.positions,instancePickingColors:{size:3,value:a.lines}}),properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:Te(Te({},o.attributes),{},{getPolygon:o.positions,pickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:Te(Te({},o.attributes),{},{getPath:o.positions,instancePickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}var bp=["instancePickingColors"];function li(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=wp(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var c=t.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function wp(e,r){if(e){if(typeof e=="string")return xc(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xc(e,r)}}function xc(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Op(e){var r=Lp();return function(){var n=(0,$t.default)(e),i;if(r){var o=(0,$t.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,bc.default)(this,i)}}function Lp(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Pc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function pe(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Pc(Object(t),!0).forEach(function(n){(0,rn.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Ap=["points","linestrings","polygons"],Ip=pe(pe(pe(pe(pe(pe({},ot(Vt.circle)),ot(Vt.icon)),ot(Vt.text)),ot(Ht)),ot(Qr)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(r){return r.properties.icon}},getText:{type:"accessor",value:function(r){return r.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),nn=function(e){(0,Cc.default)(t,e);var r=Op(t);function t(){return(0,Sc.default)(this,t),r.apply(this,arguments)}return(0,Mc.default)(t,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(i){var o=i.props,a=i.changeFlags;if(a.dataChanged){var s=this.props.data,l=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:l}),l?this._updateStateBinary({props:o,changeFlags:a}):this._updateStateJSON({props:o,changeFlags:a})}}},{key:"_updateStateBinary",value:function(i){var o=i.props,a=i.changeFlags,s=yc(o.data,this.encodePickingColor);this.setState({layerProps:s})}},{key:"_updateStateJSON",value:function(i){var o=i.props,a=i.changeFlags,s=vc(o.data),l=this.getSubLayerRow.bind(this),c={},f={};if(Array.isArray(a.dataChanged)){var u=this.state.features;for(var p in u)c[p]=u[p].slice(),f[p]=[];var v=li(a.dataChanged),d;try{for(v.s();!(d=v.n()).done;){var m=d.value,y=si(s,l,m);for(var x in u)f[x].push(Vr({data:c[x],getIndex:function(P){return P.__source.index},dataRange:m,replace:y[x]}))}}catch(h){v.e(h)}finally{v.f()}}else c=si(s,l);var S=mc(c,f);this.setState({features:c,featuresDiff:f,layerProps:S})}},{key:"getPickingInfo",value:function(i){var o=this,a=(0,ci.default)((0,$t.default)(t.prototype),"getPickingInfo",this).call(this,i),s=a.index,l=a.sourceLayer;return a.featureType=Ap.find(function(c){return l.id.startsWith("".concat(o.id,"-").concat(c,"-"))}),s>=0&&l.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(a.index=this.props.data.points.globalFeatureIds.value[s]),a}},{key:"_updateAutoHighlight",value:function(i){var o="".concat(this.id,"-points-"),a=i.featureType==="points",s=li(this.getSubLayers()),l;try{for(s.s();!(l=s.n()).done;){var c=l.value;c.id.startsWith(o)===a&&c.updateAutoHighlight(i)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,o=i.extruded,a=i.wireframe,s=this.state.layerProps,l="polygons-fill",c=this.shouldRenderSubLayer(l,s.polygons.data)&&this.getSubLayerClass(l,Qr.type);if(c){var f=en(this,Qr.props),u=o&&a;return u||delete f.getLineColor,f.updateTriggers.lineColors=u,new c(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers}),s.polygons)}return null}},{key:"_renderLineLayers",value:function(){var i=this.props,o=i.extruded,a=i.stroked,s=this.state.layerProps,l="polygons-stroke",c="linestrings",f=!o&&a&&this.shouldRenderSubLayer(l,s.polygonsOutline.data)&&this.getSubLayerClass(l,Ht.type),u=this.shouldRenderSubLayer(c,s.lines.data)&&this.getSubLayerClass(c,Ht.type);if(f||u){var p=en(this,Ht.props);return[f&&new f(p,this.getSubLayerProps({id:l,updateTriggers:p.updateTriggers}),s.polygonsOutline),u&&new u(p,this.getSubLayerProps({id:c,updateTriggers:p.updateTriggers}),s.lines)]}return null}},{key:"_renderPointLayers",value:function(){var i=this.props.pointType,o=this.state,a=o.layerProps,s=o.binary,l=this.props.highlightedObjectIndex;!s&&Number.isFinite(l)&&(l=a.points.data.findIndex(function(M){return M.__source.index===l}));var c=new Set(i.split("+")),f=[],u=li(c),p;try{for(u.s();!(p=u.n()).done;){var v=p.value,d="points-".concat(v),m=Vt[v],y=m&&this.shouldRenderSubLayer(d,a.points.data)&&this.getSubLayerClass(d,m.type);if(y){var x=en(this,m.props),S=a.points;if(v==="text"&&s){var h=S.data.attributes,P=h.instancePickingColors,_=(0,_c.default)(h,bp);S=pe(pe({},S),{},{data:pe(pe({},S.data),{},{attributes:_})})}f.push(new y(x,this.getSubLayerProps({id:d,updateTriggers:x.updateTriggers,highlightedObjectIndex:l}),S))}}}catch(M){u.e(M)}finally{u.f()}return f}},{key:"renderLayers",value:function(){var i=this.props.extruded,o=this._renderPolygonLayer(),a=this._renderLineLayers(),s=this._renderPointLayers();return[!i&&o,a,s,i&&o]}},{key:"getSubLayerAccessor",value:function(i){var o=this.state.binary;return!o||typeof i!="function"?(0,ci.default)((0,$t.default)(t.prototype),"getSubLayerAccessor",this).call(this,i):function(a,s){var l=s.data,c=s.index,f=pl(l,c);return i(f,s)}}}]),t}(wc.CompositeLayer);(0,rn.default)(nn,"layerName","GeoJsonLayer");(0,rn.default)(nn,"defaultProps",Ip);return zc(Yt);})();
      return __exports__;
      });
