(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var $k=Object.create;var Es=Object.defineProperty;var Hk=Object.getOwnPropertyDescriptor;var Wk=Object.getOwnPropertyNames;var Yk=Object.getPrototypeOf,Xk=Object.prototype.hasOwnProperty;var _e=(t,r)=>()=>(r||t((r={exports:{}}).exports,r),r.exports),Ps=(t,r)=>{for(var e in r)Es(t,e,{get:r[e],enumerable:!0})},Lm=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Wk(r))!Xk.call(t,i)&&i!==e&&Es(t,i,{get:()=>r[i],enumerable:!(n=Hk(r,i))||n.enumerable});return t};var h=(t,r,e)=>(e=t!=null?$k(Yk(t)):{},Lm(r||!t||!t.__esModule?Es(e,"default",{value:t,enumerable:!0}):e,t)),qk=t=>Lm(Es({},"__esModule",{value:!0}),t);var qe=_e((jz,Os)=>{function Ss(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Os.exports=Ss=function(e){return typeof e}:Os.exports=Ss=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ss(t)}Os.exports=Ss});var jm=_e((Fz,Dm)=>{function Zk(t){if(Array.isArray(t)){for(var r=0,e=new Array(t.length);r<t.length;r++)e[r]=t[r];return e}}Dm.exports=Zk});var Nm=_e((Nz,Fm)=>{function Kk(t){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]")return Array.from(t)}Fm.exports=Kk});var Vm=_e((Bz,Bm)=>{function Qk(){throw new TypeError("Invalid attempt to spread non-iterable instance")}Bm.exports=Qk});var Ri=_e((Vz,zm)=>{var Jk=jm(),eR=Nm(),tR=Vm();function rR(t){return Jk(t)||eR(t)||tR()}zm.exports=rR});var G=_e((zz,Um)=>{function nR(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}Um.exports=nR});var B=_e((Uz,Gm)=>{function iR(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}Gm.exports=iR});var U=_e((Gz,Hm)=>{function $m(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function aR(t,r,e){return r&&$m(t.prototype,r),e&&$m(t,e),t}Hm.exports=aR});var bg=_e((XU,_g)=>{function GR(t){if(Array.isArray(t))return t}_g.exports=GR});var xg=_e((qU,wg)=>{function $R(t,r){if(Symbol.iterator in Object(t)||Object.prototype.toString.call(t)==="[object Arguments]"){var e=[],n=!0,i=!1,a=void 0;try{for(var o=t[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(e.push(s.value),!(r&&e.length===r));n=!0);}catch(u){i=!0,a=u}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw a}}return e}}wg.exports=$R});var Eg=_e((ZU,Tg)=>{function HR(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}Tg.exports=HR});var Ue=_e((KU,Pg)=>{var WR=bg(),YR=xg(),XR=Eg();function qR(t,r){return WR(t)||YR(t,r)||XR()}Pg.exports=qR});var we=_e((H6,Hg)=>{function cC(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}Hg.exports=cC});var cc=_e((W6,lc)=>{function fc(t,r){return lc.exports=fc=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},fc(t,r)}lc.exports=fc});var ie=_e((Y6,Wg)=>{var hC=cc();function pC(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&hC(t,r)}Wg.exports=pC});var ae=_e((X6,Yg)=>{var dC=qe(),vC=we();function mC(t,r){return r&&(dC(r)==="object"||typeof r=="function")?r:vC(t)}Yg.exports=mC});var ne=_e((q6,pc)=>{function hc(t){return pc.exports=hc=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},hc(t)}pc.exports=hc});var Kg=_e((l5,Us)=>{var _C=cc();function bC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function zs(t,r,e){return bC()?Us.exports=zs=Reflect.construct:Us.exports=zs=function(i,a,o){var s=[null];s.push.apply(s,a);var u=Function.bind.apply(i,s),f=new u;return o&&_C(f,o.prototype),f},zs.apply(null,arguments)}Us.exports=zs});var dt=_e((V5,Sy)=>{function Py(t,r,e,n,i,a,o){try{var s=t[a](o),u=s.value}catch(f){e(f);return}s.done?r(u):Promise.resolve(u).then(n,i)}function jC(t){return function(){var r=this,e=arguments;return new Promise(function(n,i){var a=t.apply(r,e);function o(u){Py(a,n,i,o,s,"next",u)}function s(u){Py(a,n,i,o,s,"throw",u)}o(void 0)})}}Sy.exports=jC});var Ay=_e((z5,_c)=>{var Oy=function(t){"use strict";var r=Object.prototype,e=r.hasOwnProperty,n,i=typeof Symbol=="function"?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(M,k,R,Y){var V=k&&k.prototype instanceof m?k:m,Q=Object.create(V.prototype),J=new j(Y||[]);return Q._invoke=D(M,R,J),Q}t.wrap=u;function f(M,k,R){try{return{type:"normal",arg:M.call(k,R)}}catch(Y){return{type:"throw",arg:Y}}}var l="suspendedStart",c="suspendedYield",p="executing",d="completed",v={};function m(){}function g(){}function _(){}var x={};x[a]=function(){return this};var w=Object.getPrototypeOf,E=w&&w(w(z([])));E&&E!==r&&e.call(E,a)&&(x=E);var T=_.prototype=m.prototype=Object.create(x);g.prototype=T.constructor=_,_.constructor=g,_[s]=g.displayName="GeneratorFunction";function P(M){["next","throw","return"].forEach(function(k){M[k]=function(R){return this._invoke(k,R)}})}t.isGeneratorFunction=function(M){var k=typeof M=="function"&&M.constructor;return k?k===g||(k.displayName||k.name)==="GeneratorFunction":!1},t.mark=function(M){return Object.setPrototypeOf?Object.setPrototypeOf(M,_):(M.__proto__=_,s in M||(M[s]="GeneratorFunction")),M.prototype=Object.create(T),M},t.awrap=function(M){return{__await:M}};function A(M){function k(V,Q,J,re){var oe=f(M[V],M,Q);if(oe.type==="throw")re(oe.arg);else{var ue=oe.arg,Oe=ue.value;return Oe&&typeof Oe=="object"&&e.call(Oe,"__await")?Promise.resolve(Oe.__await).then(function(ee){k("next",ee,J,re)},function(ee){k("throw",ee,J,re)}):Promise.resolve(Oe).then(function(ee){ue.value=ee,J(ue)},function(ee){return k("throw",ee,J,re)})}}var R;function Y(V,Q){function J(){return new Promise(function(re,oe){k(V,Q,re,oe)})}return R=R?R.then(J,J):J()}this._invoke=Y}P(A.prototype),A.prototype[o]=function(){return this},t.AsyncIterator=A,t.async=function(M,k,R,Y){var V=new A(u(M,k,R,Y));return t.isGeneratorFunction(k)?V:V.next().then(function(Q){return Q.done?Q.value:V.next()})};function D(M,k,R){var Y=l;return function(Q,J){if(Y===p)throw new Error("Generator is already running");if(Y===d){if(Q==="throw")throw J;return N()}for(R.method=Q,R.arg=J;;){var re=R.delegate;if(re){var oe=L(re,R);if(oe){if(oe===v)continue;return oe}}if(R.method==="next")R.sent=R._sent=R.arg;else if(R.method==="throw"){if(Y===l)throw Y=d,R.arg;R.dispatchException(R.arg)}else R.method==="return"&&R.abrupt("return",R.arg);Y=p;var ue=f(M,k,R);if(ue.type==="normal"){if(Y=R.done?d:c,ue.arg===v)continue;return{value:ue.arg,done:R.done}}else ue.type==="throw"&&(Y=d,R.method="throw",R.arg=ue.arg)}}}function L(M,k){var R=M.iterator[k.method];if(R===n){if(k.delegate=null,k.method==="throw"){if(M.iterator.return&&(k.method="return",k.arg=n,L(M,k),k.method==="throw"))return v;k.method="throw",k.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var Y=f(R,M.iterator,k.arg);if(Y.type==="throw")return k.method="throw",k.arg=Y.arg,k.delegate=null,v;var V=Y.arg;if(!V)return k.method="throw",k.arg=new TypeError("iterator result is not an object"),k.delegate=null,v;if(V.done)k[M.resultName]=V.value,k.next=M.nextLoc,k.method!=="return"&&(k.method="next",k.arg=n);else return V;return k.delegate=null,v}P(T),T[s]="Generator",T[a]=function(){return this},T.toString=function(){return"[object Generator]"};function C(M){var k={tryLoc:M[0]};1 in M&&(k.catchLoc=M[1]),2 in M&&(k.finallyLoc=M[2],k.afterLoc=M[3]),this.tryEntries.push(k)}function F(M){var k=M.completion||{};k.type="normal",delete k.arg,M.completion=k}function j(M){this.tryEntries=[{tryLoc:"root"}],M.forEach(C,this),this.reset(!0)}t.keys=function(M){var k=[];for(var R in M)k.push(R);return k.reverse(),function Y(){for(;k.length;){var V=k.pop();if(V in M)return Y.value=V,Y.done=!1,Y}return Y.done=!0,Y}};function z(M){if(M){var k=M[a];if(k)return k.call(M);if(typeof M.next=="function")return M;if(!isNaN(M.length)){var R=-1,Y=function V(){for(;++R<M.length;)if(e.call(M,R))return V.value=M[R],V.done=!1,V;return V.value=n,V.done=!0,V};return Y.next=Y}}return{next:N}}t.values=z;function N(){return{value:n,done:!0}}return j.prototype={constructor:j,reset:function(M){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(F),!M)for(var k in this)k.charAt(0)==="t"&&e.call(this,k)&&!isNaN(+k.slice(1))&&(this[k]=n)},stop:function(){this.done=!0;var M=this.tryEntries[0],k=M.completion;if(k.type==="throw")throw k.arg;return this.rval},dispatchException:function(M){if(this.done)throw M;var k=this;function R(oe,ue){return Q.type="throw",Q.arg=M,k.next=oe,ue&&(k.method="next",k.arg=n),!!ue}for(var Y=this.tryEntries.length-1;Y>=0;--Y){var V=this.tryEntries[Y],Q=V.completion;if(V.tryLoc==="root")return R("end");if(V.tryLoc<=this.prev){var J=e.call(V,"catchLoc"),re=e.call(V,"finallyLoc");if(J&&re){if(this.prev<V.catchLoc)return R(V.catchLoc,!0);if(this.prev<V.finallyLoc)return R(V.finallyLoc)}else if(J){if(this.prev<V.catchLoc)return R(V.catchLoc,!0)}else if(re){if(this.prev<V.finallyLoc)return R(V.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(M,k){for(var R=this.tryEntries.length-1;R>=0;--R){var Y=this.tryEntries[R];if(Y.tryLoc<=this.prev&&e.call(Y,"finallyLoc")&&this.prev<Y.finallyLoc){var V=Y;break}}V&&(M==="break"||M==="continue")&&V.tryLoc<=k&&k<=V.finallyLoc&&(V=null);var Q=V?V.completion:{};return Q.type=M,Q.arg=k,V?(this.method="next",this.next=V.finallyLoc,v):this.complete(Q)},complete:function(M,k){if(M.type==="throw")throw M.arg;return M.type==="break"||M.type==="continue"?this.next=M.arg:M.type==="return"?(this.rval=this.arg=M.arg,this.method="return",this.next="end"):M.type==="normal"&&k&&(this.next=k),v},finish:function(M){for(var k=this.tryEntries.length-1;k>=0;--k){var R=this.tryEntries[k];if(R.finallyLoc===M)return this.complete(R.completion,R.afterLoc),F(R),v}},catch:function(M){for(var k=this.tryEntries.length-1;k>=0;--k){var R=this.tryEntries[k];if(R.tryLoc===M){var Y=R.completion;if(Y.type==="throw"){var V=Y.arg;F(R)}return V}}throw new Error("illegal catch attempt")},delegateYield:function(M,k,R){return this.delegate={iterator:z(M),resultName:k,nextLoc:R},this.method==="next"&&(this.arg=n),v}},t}(typeof _c=="object"?_c.exports:{});try{regeneratorRuntime=Oy}catch{Function("r","regeneratorRuntime = r")(Oy)}});var et=_e((U5,My)=>{My.exports=Ay()});var Uy=_e((K5,zy)=>{var zC=ne();function UC(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&(t=zC(t),t!==null););return t}zy.exports=UC});var kt=_e((Q5,Ys)=>{var GC=Uy();function Ws(t,r,e){return typeof Reflect<"u"&&Reflect.get?Ys.exports=Ws=Reflect.get:Ys.exports=Ws=function(i,a,o){var s=GC(i,a);if(s){var u=Object.getOwnPropertyDescriptor(s,a);return u.get?u.get.call(o):u.value}},Ws(t,r,e||t)}Ys.exports=Ws});var Ju=_e((ZY,_w)=>{function uj(t){var r;if(typeof Symbol<"u"&&(Symbol.asyncIterator&&(r=t[Symbol.asyncIterator],r!=null)||Symbol.iterator&&(r=t[Symbol.iterator],r!=null)))return r.call(t);throw new TypeError("Object is not async iterable")}_w.exports=uj});var Kh=_e((cX,ww)=>{function hj(t){this.wrapped=t}ww.exports=hj});var Qh=_e((hX,xw)=>{var pj=Kh();function dj(t){return new pj(t)}xw.exports=dj});var Ew=_e((pX,Tw)=>{var vj=Kh();function _o(t){var r,e;function n(o,s){return new Promise(function(u,f){var l={key:o,arg:s,resolve:u,reject:f,next:null};e?e=e.next=l:(r=e=l,i(o,s))})}function i(o,s){try{var u=t[o](s),f=u.value,l=f instanceof vj;Promise.resolve(l?f.wrapped:f).then(function(c){if(l){i(o==="return"?"return":"next",c);return}a(u.done?"return":"normal",c)},function(c){i("throw",c)})}catch(c){a("throw",c)}}function a(o,s){switch(o){case"return":r.resolve({value:s,done:!0});break;case"throw":r.reject(s);break;default:r.resolve({value:s,done:!1});break}r=r.next,r?i(r.key,r.arg):e=null}this._invoke=n,typeof t.return!="function"&&(this.return=void 0)}typeof Symbol=="function"&&Symbol.asyncIterator&&(_o.prototype[Symbol.asyncIterator]=function(){return this});_o.prototype.next=function(t){return this._invoke("next",t)};_o.prototype.throw=function(t){return this._invoke("throw",t)};_o.prototype.return=function(t){return this._invoke("return",t)};Tw.exports=_o});var Jh=_e((dX,Pw)=>{var mj=Ew();function gj(t){return function(){return new mj(t.apply(this,arguments))}}Pw.exports=gj});var Mw=_e(()=>{});var xS=_e((Jee,Yf)=>{(function(t,r,e,n){"use strict";var i=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),o="function",s=Math.round,u=Math.abs,f=Date.now;function l(y,b,S){return setTimeout(x(y,S),b)}function c(y,b,S){return Array.isArray(y)?(p(y,S[b],S),!0):!1}function p(y,b,S){var I;if(y)if(y.forEach)y.forEach(b,S);else if(y.length!==n)for(I=0;I<y.length;)b.call(S,y[I],I,y),I++;else for(I in y)y.hasOwnProperty(I)&&b.call(S,y[I],I,y)}function d(y,b,S){var I="DEPRECATED METHOD: "+b+`
`+S+` AT 
`;return function(){var H=new Error("get-stack-trace"),Z=H&&H.stack?H.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ye=t.console&&(t.console.warn||t.console.log);return ye&&ye.call(t.console,I,Z),y.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(b){if(b===n||b===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(b),I=1;I<arguments.length;I++){var H=arguments[I];if(H!==n&&H!==null)for(var Z in H)H.hasOwnProperty(Z)&&(S[Z]=H[Z])}return S}:v=Object.assign;var m=d(function(b,S,I){for(var H=Object.keys(S),Z=0;Z<H.length;)(!I||I&&b[H[Z]]===n)&&(b[H[Z]]=S[H[Z]]),Z++;return b},"extend","Use `assign`."),g=d(function(b,S){return m(b,S,!0)},"merge","Use `assign`.");function _(y,b,S){var I=b.prototype,H;H=y.prototype=Object.create(I),H.constructor=y,H._super=I,S&&v(H,S)}function x(y,b){return function(){return y.apply(b,arguments)}}function w(y,b){return typeof y==o?y.apply(b&&b[0]||n,b):y}function E(y,b){return y===n?b:y}function T(y,b,S){p(L(b),function(I){y.addEventListener(I,S,!1)})}function P(y,b,S){p(L(b),function(I){y.removeEventListener(I,S,!1)})}function A(y,b){for(;y;){if(y==b)return!0;y=y.parentNode}return!1}function D(y,b){return y.indexOf(b)>-1}function L(y){return y.trim().split(/\s+/g)}function C(y,b,S){if(y.indexOf&&!S)return y.indexOf(b);for(var I=0;I<y.length;){if(S&&y[I][S]==b||!S&&y[I]===b)return I;I++}return-1}function F(y){return Array.prototype.slice.call(y,0)}function j(y,b,S){for(var I=[],H=[],Z=0;Z<y.length;){var ye=b?y[Z][b]:y[Z];C(H,ye)<0&&I.push(y[Z]),H[Z]=ye,Z++}return S&&(b?I=I.sort(function(pt,Tt){return pt[b]>Tt[b]}):I=I.sort()),I}function z(y,b){for(var S,I,H=b[0].toUpperCase()+b.slice(1),Z=0;Z<i.length;){if(S=i[Z],I=S?S+H:b,I in y)return I;Z++}return n}var N=1;function M(){return N++}function k(y){var b=y.ownerDocument||y;return b.defaultView||b.parentWindow||t}var R=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in t,V=z(t,"PointerEvent")!==n,Q=Y&&R.test(navigator.userAgent),J="touch",re="pen",oe="mouse",ue="kinect",Oe=25,ee=1,Ee=2,de=4,Qe=8,mn=1,Sr=2,Un=4,Gn=8,ut=16,be=Sr|Un,ar=Gn|ut,or=be|ar,sr=["x","y"],Mi=["clientX","clientY"];function Mt(y,b){var S=this;this.manager=y,this.callback=b,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(I){w(y.options.enable,[y])&&S.handler(I)},this.init()}Mt.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(k(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(k(this.element),this.evWin,this.domHandler)}};function La(y){var b,S=y.options.inputClass;return S?b=S:V?b=Ul:Q?b=ys:Y?b=Gl:b=gs,new b(y,Nl)}function Nl(y,b,S){var I=S.pointers.length,H=S.changedPointers.length,Z=b&ee&&I-H===0,ye=b&(de|Qe)&&I-H===0;S.isFirst=!!Z,S.isFinal=!!ye,Z&&(y.session={}),S.eventType=b,Bl(y,S),y.emit("hammer.input",S),y.recognize(S),y.session.prevInput=S}function Bl(y,b){var S=y.session,I=b.pointers,H=I.length;S.firstInput||(S.firstInput=vs(b)),H>1&&!S.firstMultiple?S.firstMultiple=vs(b):H===1&&(S.firstMultiple=!1);var Z=S.firstInput,ye=S.firstMultiple,ft=ye?ye.center:Z.center,pt=b.center=ms(I);b.timeStamp=f(),b.deltaTime=b.timeStamp-Z.timeStamp,b.angle=Wn(ft,pt),b.distance=Yr(ft,pt),Vl(S,b),b.offsetDirection=Hn(b.deltaX,b.deltaY);var Tt=$n(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=Tt.x,b.overallVelocityY=Tt.y,b.overallVelocity=u(Tt.x)>u(Tt.y)?Tt.x:Tt.y,b.scale=ye?Tk(ye.pointers,I):1,b.rotation=ye?xk(ye.pointers,I):0,b.maxPointers=S.prevInput?b.pointers.length>S.prevInput.maxPointers?b.pointers.length:S.prevInput.maxPointers:b.pointers.length,zl(S,b);var Ar=y.element;A(b.srcEvent.target,Ar)&&(Ar=b.srcEvent.target),b.target=Ar}function Vl(y,b){var S=b.center,I=y.offsetDelta||{},H=y.prevDelta||{},Z=y.prevInput||{};(b.eventType===ee||Z.eventType===de)&&(H=y.prevDelta={x:Z.deltaX||0,y:Z.deltaY||0},I=y.offsetDelta={x:S.x,y:S.y}),b.deltaX=H.x+(S.x-I.x),b.deltaY=H.y+(S.y-I.y)}function zl(y,b){var S=y.lastInterval||b,I=b.timeStamp-S.timeStamp,H,Z,ye,ft;if(b.eventType!=Qe&&(I>Oe||S.velocity===n)){var pt=b.deltaX-S.deltaX,Tt=b.deltaY-S.deltaY,Ar=$n(I,pt,Tt);Z=Ar.x,ye=Ar.y,H=u(Ar.x)>u(Ar.y)?Ar.x:Ar.y,ft=Hn(pt,Tt),y.lastInterval=b}else H=S.velocity,Z=S.velocityX,ye=S.velocityY,ft=S.direction;b.velocity=H,b.velocityX=Z,b.velocityY=ye,b.direction=ft}function vs(y){for(var b=[],S=0;S<y.pointers.length;)b[S]={clientX:s(y.pointers[S].clientX),clientY:s(y.pointers[S].clientY)},S++;return{timeStamp:f(),pointers:b,center:ms(b),deltaX:y.deltaX,deltaY:y.deltaY}}function ms(y){var b=y.length;if(b===1)return{x:s(y[0].clientX),y:s(y[0].clientY)};for(var S=0,I=0,H=0;H<b;)S+=y[H].clientX,I+=y[H].clientY,H++;return{x:s(S/b),y:s(I/b)}}function $n(y,b,S){return{x:b/y||0,y:S/y||0}}function Hn(y,b){return y===b?mn:u(y)>=u(b)?y<0?Sr:Un:b<0?Gn:ut}function Yr(y,b,S){S||(S=sr);var I=b[S[0]]-y[S[0]],H=b[S[1]]-y[S[1]];return Math.sqrt(I*I+H*H)}function Wn(y,b,S){S||(S=sr);var I=b[S[0]]-y[S[0]],H=b[S[1]]-y[S[1]];return Math.atan2(H,I)*180/Math.PI}function xk(y,b){return Wn(b[1],b[0],Mi)+Wn(y[1],y[0],Mi)}function Tk(y,b){return Yr(b[0],b[1],Mi)/Yr(y[0],y[1],Mi)}var Ek={mousedown:ee,mousemove:Ee,mouseup:de},Pk="mousedown",Sk="mousemove mouseup";function gs(){this.evEl=Pk,this.evWin=Sk,this.pressed=!1,Mt.apply(this,arguments)}_(gs,Mt,{handler:function(b){var S=Ek[b.type];S&ee&&b.button===0&&(this.pressed=!0),S&Ee&&b.which!==1&&(S=de),this.pressed&&(S&de&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[b],changedPointers:[b],pointerType:oe,srcEvent:b}))}});var Ok={pointerdown:ee,pointermove:Ee,pointerup:de,pointercancel:Qe,pointerout:Qe},Ak={2:J,3:re,4:oe,5:ue},wm="pointerdown",xm="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(wm="MSPointerDown",xm="MSPointerMove MSPointerUp MSPointerCancel");function Ul(){this.evEl=wm,this.evWin=xm,Mt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_(Ul,Mt,{handler:function(b){var S=this.store,I=!1,H=b.type.toLowerCase().replace("ms",""),Z=Ok[H],ye=Ak[b.pointerType]||b.pointerType,ft=ye==J,pt=C(S,b.pointerId,"pointerId");Z&ee&&(b.button===0||ft)?pt<0&&(S.push(b),pt=S.length-1):Z&(de|Qe)&&(I=!0),!(pt<0)&&(S[pt]=b,this.callback(this.manager,Z,{pointers:S,changedPointers:[b],pointerType:ye,srcEvent:b}),I&&S.splice(pt,1))}});var Mk={touchstart:ee,touchmove:Ee,touchend:de,touchcancel:Qe},kk="touchstart",Rk="touchstart touchmove touchend touchcancel";function Tm(){this.evTarget=kk,this.evWin=Rk,this.started=!1,Mt.apply(this,arguments)}_(Tm,Mt,{handler:function(b){var S=Mk[b.type];if(S===ee&&(this.started=!0),!!this.started){var I=Ck.call(this,b,S);S&(de|Qe)&&I[0].length-I[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:I[0],changedPointers:I[1],pointerType:J,srcEvent:b})}}});function Ck(y,b){var S=F(y.touches),I=F(y.changedTouches);return b&(de|Qe)&&(S=j(S.concat(I),"identifier",!0)),[S,I]}var Ik={touchstart:ee,touchmove:Ee,touchend:de,touchcancel:Qe},Lk="touchstart touchmove touchend touchcancel";function ys(){this.evTarget=Lk,this.targetIds={},Mt.apply(this,arguments)}_(ys,Mt,{handler:function(b){var S=Ik[b.type],I=Dk.call(this,b,S);I&&this.callback(this.manager,S,{pointers:I[0],changedPointers:I[1],pointerType:J,srcEvent:b})}});function Dk(y,b){var S=F(y.touches),I=this.targetIds;if(b&(ee|Ee)&&S.length===1)return I[S[0].identifier]=!0,[S,S];var H,Z,ye=F(y.changedTouches),ft=[],pt=this.target;if(Z=S.filter(function(Tt){return A(Tt.target,pt)}),b===ee)for(H=0;H<Z.length;)I[Z[H].identifier]=!0,H++;for(H=0;H<ye.length;)I[ye[H].identifier]&&ft.push(ye[H]),b&(de|Qe)&&delete I[ye[H].identifier],H++;if(ft.length)return[j(Z.concat(ft),"identifier",!0),ft]}var jk=2500,Em=25;function Gl(){Mt.apply(this,arguments);var y=x(this.handler,this);this.touch=new ys(this.manager,y),this.mouse=new gs(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}_(Gl,Mt,{handler:function(b,S,I){var H=I.pointerType==J,Z=I.pointerType==oe;if(!(Z&&I.sourceCapabilities&&I.sourceCapabilities.firesTouchEvents)){if(H)Fk.call(this,S,I);else if(Z&&Nk.call(this,I))return;this.callback(b,S,I)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Fk(y,b){y&ee?(this.primaryTouch=b.changedPointers[0].identifier,Pm.call(this,b)):y&(de|Qe)&&Pm.call(this,b)}function Pm(y){var b=y.changedPointers[0];if(b.identifier===this.primaryTouch){var S={x:b.clientX,y:b.clientY};this.lastTouches.push(S);var I=this.lastTouches,H=function(){var Z=I.indexOf(S);Z>-1&&I.splice(Z,1)};setTimeout(H,jk)}}function Nk(y){for(var b=y.srcEvent.clientX,S=y.srcEvent.clientY,I=0;I<this.lastTouches.length;I++){var H=this.lastTouches[I],Z=Math.abs(b-H.x),ye=Math.abs(S-H.y);if(Z<=Em&&ye<=Em)return!0}return!1}var Sm=z(a.style,"touchAction"),Om=Sm!==n,Am="compute",Mm="auto",$l="manipulation",Yn="none",Da="pan-x",ja="pan-y",_s=Vk();function Hl(y,b){this.manager=y,this.set(b)}Hl.prototype={set:function(y){y==Am&&(y=this.compute()),Om&&this.manager.element.style&&_s[y]&&(this.manager.element.style[Sm]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return p(this.manager.recognizers,function(b){w(b.options.enable,[b])&&(y=y.concat(b.getTouchAction()))}),Bk(y.join(" "))},preventDefaults:function(y){var b=y.srcEvent,S=y.offsetDirection;if(this.manager.session.prevented){b.preventDefault();return}var I=this.actions,H=D(I,Yn)&&!_s[Yn],Z=D(I,ja)&&!_s[ja],ye=D(I,Da)&&!_s[Da];if(H){var ft=y.pointers.length===1,pt=y.distance<2,Tt=y.deltaTime<250;if(ft&&pt&&Tt)return}if(!(ye&&Z)&&(H||Z&&S&be||ye&&S&ar))return this.preventSrc(b)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function Bk(y){if(D(y,Yn))return Yn;var b=D(y,Da),S=D(y,ja);return b&&S?Yn:b||S?b?Da:ja:D(y,$l)?$l:Mm}function Vk(){if(!Om)return!1;var y={},b=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){y[S]=b?t.CSS.supports("touch-action",S):!0}),y}var bs=1,Ut=2,ki=4,gn=8,Xr=gn,Fa=16,Or=32;function qr(y){this.options=v({},this.defaults,y||{}),this.id=M(),this.manager=null,this.options.enable=E(this.options.enable,!0),this.state=bs,this.simultaneous={},this.requireFail=[]}qr.prototype={defaults:{},set:function(y){return v(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(c(y,"recognizeWith",this))return this;var b=this.simultaneous;return y=ws(y,this),b[y.id]||(b[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return c(y,"dropRecognizeWith",this)?this:(y=ws(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(c(y,"requireFailure",this))return this;var b=this.requireFail;return y=ws(y,this),C(b,y)===-1&&(b.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(c(y,"dropRequireFailure",this))return this;y=ws(y,this);var b=C(this.requireFail,y);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var b=this,S=this.state;function I(H){b.manager.emit(H,y)}S<gn&&I(b.options.event+km(S)),I(b.options.event),y.additionalEvent&&I(y.additionalEvent),S>=gn&&I(b.options.event+km(S))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=Or},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(Or|bs)))return!1;y++}return!0},recognize:function(y){var b=v({},y);if(!w(this.options.enable,[this,b])){this.reset(),this.state=Or;return}this.state&(Xr|Fa|Or)&&(this.state=bs),this.state=this.process(b),this.state&(Ut|ki|gn|Fa)&&this.tryEmit(b)},process:function(y){},getTouchAction:function(){},reset:function(){}};function km(y){return y&Fa?"cancel":y&gn?"end":y&ki?"move":y&Ut?"start":""}function Rm(y){return y==ut?"down":y==Gn?"up":y==Sr?"left":y==Un?"right":""}function ws(y,b){var S=b.manager;return S?S.get(y):y}function ur(){qr.apply(this,arguments)}_(ur,qr,{defaults:{pointers:1},attrTest:function(y){var b=this.options.pointers;return b===0||y.pointers.length===b},process:function(y){var b=this.state,S=y.eventType,I=b&(Ut|ki),H=this.attrTest(y);return I&&(S&Qe||!H)?b|Fa:I||H?S&de?b|gn:b&Ut?b|ki:Ut:Or}});function xs(){ur.apply(this,arguments),this.pX=null,this.pY=null}_(xs,ur,{defaults:{event:"pan",threshold:10,pointers:1,direction:or},getTouchAction:function(){var y=this.options.direction,b=[];return y&be&&b.push(ja),y&ar&&b.push(Da),b},directionTest:function(y){var b=this.options,S=!0,I=y.distance,H=y.direction,Z=y.deltaX,ye=y.deltaY;return H&b.direction||(b.direction&be?(H=Z===0?mn:Z<0?Sr:Un,S=Z!=this.pX,I=Math.abs(y.deltaX)):(H=ye===0?mn:ye<0?Gn:ut,S=ye!=this.pY,I=Math.abs(y.deltaY))),y.direction=H,S&&I>b.threshold&&H&b.direction},attrTest:function(y){return ur.prototype.attrTest.call(this,y)&&(this.state&Ut||!(this.state&Ut)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var b=Rm(y.direction);b&&(y.additionalEvent=this.options.event+b),this._super.emit.call(this,y)}});function Wl(){ur.apply(this,arguments)}_(Wl,ur,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Yn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&Ut)},emit:function(y){if(y.scale!==1){var b=y.scale<1?"in":"out";y.additionalEvent=this.options.event+b}this._super.emit.call(this,y)}});function Yl(){qr.apply(this,arguments),this._timer=null,this._input=null}_(Yl,qr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Mm]},process:function(y){var b=this.options,S=y.pointers.length===b.pointers,I=y.distance<b.threshold,H=y.deltaTime>b.time;if(this._input=y,!I||!S||y.eventType&(de|Qe)&&!H)this.reset();else if(y.eventType&ee)this.reset(),this._timer=l(function(){this.state=Xr,this.tryEmit()},b.time,this);else if(y.eventType&de)return Xr;return Or},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===Xr&&(y&&y.eventType&de?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}});function Xl(){ur.apply(this,arguments)}_(Xl,ur,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Yn]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&Ut)}});function ql(){ur.apply(this,arguments)}_(ql,ur,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:be|ar,pointers:1},getTouchAction:function(){return xs.prototype.getTouchAction.call(this)},attrTest:function(y){var b=this.options.direction,S;return b&(be|ar)?S=y.overallVelocity:b&be?S=y.overallVelocityX:b&ar&&(S=y.overallVelocityY),this._super.attrTest.call(this,y)&&b&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&u(S)>this.options.velocity&&y.eventType&de},emit:function(y){var b=Rm(y.offsetDirection);b&&this.manager.emit(this.options.event+b,y),this.manager.emit(this.options.event,y)}});function Ts(){qr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_(Ts,qr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$l]},process:function(y){var b=this.options,S=y.pointers.length===b.pointers,I=y.distance<b.threshold,H=y.deltaTime<b.time;if(this.reset(),y.eventType&ee&&this.count===0)return this.failTimeout();if(I&&H&&S){if(y.eventType!=de)return this.failTimeout();var Z=this.pTime?y.timeStamp-this.pTime<b.interval:!0,ye=!this.pCenter||Yr(this.pCenter,y.center)<b.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!ye||!Z?this.count=1:this.count+=1,this._input=y;var ft=this.count%b.taps;if(ft===0)return this.hasRequireFailures()?(this._timer=l(function(){this.state=Xr,this.tryEmit()},b.interval,this),Ut):Xr}return Or},failTimeout:function(){return this._timer=l(function(){this.state=Or},this.options.interval,this),Or},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Xr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Zr(y,b){return b=b||{},b.recognizers=E(b.recognizers,Zr.defaults.preset),new Zl(y,b)}Zr.VERSION="2.0.7",Zr.defaults={domEvents:!1,touchAction:Am,enable:!0,inputTarget:null,inputClass:null,preset:[[Xl,{enable:!1}],[Wl,{enable:!1},["rotate"]],[ql,{direction:be}],[xs,{direction:be},["swipe"]],[Ts],[Ts,{event:"doubletap",taps:2},["tap"]],[Yl]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var zk=1,Cm=2;function Zl(y,b){this.options=v({},Zr.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=La(this),this.touchAction=new Hl(this,this.options.touchAction),Im(this,!0),p(this.options.recognizers,function(S){var I=this.add(new S[0](S[1]));S[2]&&I.recognizeWith(S[2]),S[3]&&I.requireFailure(S[3])},this)}Zl.prototype={set:function(y){return v(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?Cm:zk},recognize:function(y){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(y);var S,I=this.recognizers,H=b.curRecognizer;(!H||H&&H.state&Xr)&&(H=b.curRecognizer=null);for(var Z=0;Z<I.length;)S=I[Z],b.stopped!==Cm&&(!H||S==H||S.canRecognizeWith(H))?S.recognize(y):S.reset(),!H&&S.state&(Ut|ki|gn)&&(H=b.curRecognizer=S),Z++}},get:function(y){if(y instanceof qr)return y;for(var b=this.recognizers,S=0;S<b.length;S++)if(b[S].options.event==y)return b[S];return null},add:function(y){if(c(y,"add",this))return this;var b=this.get(y.options.event);return b&&this.remove(b),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(c(y,"remove",this))return this;if(y=this.get(y),y){var b=this.recognizers,S=C(b,y);S!==-1&&(b.splice(S,1),this.touchAction.update())}return this},on:function(y,b){if(y!==n&&b!==n){var S=this.handlers;return p(L(y),function(I){S[I]=S[I]||[],S[I].push(b)}),this}},off:function(y,b){if(y!==n){var S=this.handlers;return p(L(y),function(I){b?S[I]&&S[I].splice(C(S[I],b),1):delete S[I]}),this}},emit:function(y,b){this.options.domEvents&&Uk(y,b);var S=this.handlers[y]&&this.handlers[y].slice();if(!(!S||!S.length)){b.type=y,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var I=0;I<S.length;)S[I](b),I++}},destroy:function(){this.element&&Im(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Im(y,b){var S=y.element;if(S.style){var I;p(y.options.cssProps,function(H,Z){I=z(S.style,Z),b?(y.oldCssProps[I]=S.style[I],S.style[I]=H):S.style[I]=y.oldCssProps[I]||""}),b||(y.oldCssProps={})}}function Uk(y,b){var S=r.createEvent("Event");S.initEvent(y,!0,!0),S.gesture=b,b.target.dispatchEvent(S)}v(Zr,{INPUT_START:ee,INPUT_MOVE:Ee,INPUT_END:de,INPUT_CANCEL:Qe,STATE_POSSIBLE:bs,STATE_BEGAN:Ut,STATE_CHANGED:ki,STATE_ENDED:gn,STATE_RECOGNIZED:Xr,STATE_CANCELLED:Fa,STATE_FAILED:Or,DIRECTION_NONE:mn,DIRECTION_LEFT:Sr,DIRECTION_RIGHT:Un,DIRECTION_UP:Gn,DIRECTION_DOWN:ut,DIRECTION_HORIZONTAL:be,DIRECTION_VERTICAL:ar,DIRECTION_ALL:or,Manager:Zl,Input:Mt,TouchAction:Hl,TouchInput:ys,MouseInput:gs,PointerEventInput:Ul,TouchMouseInput:Gl,SingleTouchInput:Tm,Recognizer:qr,AttrRecognizer:ur,Tap:Ts,Pan:xs,Swipe:ql,Pinch:Wl,Rotate:Xl,Press:Yl,on:T,off:P,each:p,merge:g,extend:m,assign:v,inherit:_,bindFn:x,prefixed:z});var Gk=typeof t<"u"?t:typeof self<"u"?self:{};Gk.Hammer=Zr,n==="function"&&define.amd?define(function(){return Zr}):typeof Yf<"u"&&Yf.exports?Yf.exports=Zr:t[e]=Zr})(window,document,"Hammer")});var ak=_e((eoe,ik)=>{"use strict";var Sz="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";ik.exports=Sz});var fk=_e((toe,uk)=>{"use strict";var Oz=ak();function ok(){}function sk(){}sk.resetWarningCache=ok;uk.exports=function(){function t(n,i,a,o,s,u){if(u!==Oz){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}t.isRequired=t;function r(){return t}var e={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:r,element:t,elementType:t,instanceOf:r,node:t,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:sk,resetWarningCache:ok};return e.PropTypes=e,e}});var ck=_e((ioe,lk)=>{lk.exports=fk()();var roe,noe});var Lz={};Ps(Lz,{AmbientLight:()=>pf,AttributeManager:()=>fl,COORDINATE_SYSTEM:()=>me,CompositeLayer:()=>Dv,Controller:()=>rr,Deck:()=>Ta,DeckGL:()=>wk,DeckRenderer:()=>$f,DirectionalLight:()=>ci,FirstPersonController:()=>Sl,FirstPersonView:()=>Kv,FirstPersonViewport:()=>Tl,FlyToInterpolator:()=>KM,Layer:()=>ka,LayerExtension:()=>Dl,LayerManager:()=>jf,LightingEffect:()=>Uo,LinearInterpolator:()=>Ct,MapController:()=>Uf,MapView:()=>Ko,OPERATION:()=>zx,OrbitController:()=>Al,OrbitView:()=>nm,OrbitViewport:()=>bl,OrthographicController:()=>Ml,OrthographicView:()=>fm,OrthographicViewport:()=>wl,PointLight:()=>kf,PostProcessEffect:()=>DE,TRANSITION_EVENTS:()=>qo,Tesselator:()=>rk,TransitionInterpolator:()=>ga,UNIT:()=>Io,VERSION:()=>hf,View:()=>tr,Viewport:()=>gt,WebMercatorViewport:()=>_i,_CameraLight:()=>vE,_GlobeController:()=>Il,_GlobeView:()=>dm,_GlobeViewport:()=>_l,_LayersPass:()=>In,_PickLayersPass:()=>pa,_SunLight:()=>EE,_compareProps:()=>ll,_count:()=>cl,_deepEqual:()=>st,_fillArray:()=>Df,_flatten:()=>Nn,_memoize:()=>Zt,_mergeShaders:()=>hl,_registerLoggers:()=>cf,assert:()=>ke,createIterable:()=>Ea,fp64LowPart:()=>kd,gouraudLighting:()=>co,log:()=>le,phongLighting:()=>ho,picking:()=>Ud,project:()=>Ln,project32:()=>zd,shadow:()=>gi});var jh={};Ps(jh,{Buffer:()=>se,ConeGeometry:()=>zu,CubeGeometry:()=>Gu,CylinderGeometry:()=>$u,FEATURES:()=>Se,Framebuffer:()=>xe,Geometry:()=>bt,IcoSphereGeometry:()=>Wu,Model:()=>An,PlaneGeometry:()=>Xu,Program:()=>En,ProgramManager:()=>Lr,Renderbuffer:()=>jt,SphereGeometry:()=>Zu,Texture2D:()=>Ge,Texture3D:()=>zi,TextureCube:()=>Qn,Timeline:()=>kn,Transform:()=>Dr,TransformFeedback:()=>Pn,TruncatedConeGeometry:()=>Mn,cloneTextureFrom:()=>Ui,copyToTexture:()=>Zs,cssToDeviceRatio:()=>Lt,getParameters:()=>Fi,hasFeatures:()=>wn,instrumentGLContext:()=>Jr,isWebGL2:()=>te,readPixelsToBuffer:()=>Xs,setParameters:()=>at,withParameters:()=>Re});var Cs=h(qe()),Ba=h(Ri()),og=h(G()),sg=h(B()),ug=h(U());function X(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var Wm=h(qe());var As=h(qe());function Na(t){if(typeof window<"u"&&(0,As.default)(window.process)==="object"&&window.process.type==="renderer"||typeof process<"u"&&(0,As.default)(process.versions)==="object"&&Boolean(process.versions.electron))return!0;var r=(typeof navigator>"u"?"undefined":(0,As.default)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,e=t||r;return!!(e&&e.indexOf("Electron")>=0)}function it(){var t=(typeof process>"u"?"undefined":(0,Wm.default)(process))==="object"&&String(process)==="[object process]"&&!process.browser;return!t||Na()}var Ym=h(qe()),yn={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:(typeof process>"u"?"undefined":(0,Ym.default)(process))==="object"&&process};var oR=yn.self||yn.window||yn.global,Ci=yn.window||yn.self||yn.global,sR=yn.document||{},Xn=yn.process||{};var Ms="8.9.11",Zz=it();var Kl=globalThis;function Ii(t){if(!t&&!it())return"Node";if(Na(t))return"Electron";var r=typeof navigator<"u"?navigator:{},e=t||r.userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i?"IE":Kl.chrome?"Chrome":Kl.safari?"Safari":Kl.mozInnerScreenX?"Firefox":"Unknown"}var Xm=h(B()),qm=h(U());function uR(t){try{var r=window[t],e="__storage_test__";return r.setItem(e,e),r.removeItem(e),r}catch{return null}}var Zm=function(){function t(r){(0,Xm.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";X(this,"storage",void 0),X(this,"id",void 0),X(this,"config",{}),this.storage=uR(n),this.id=r,this.config={},Object.assign(this.config,e),this._loadConfiguration()}return(0,qm.default)(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}]),t}();function Km(t){var r;return t<10?r="".concat(t.toFixed(2),"ms"):t<100?r="".concat(t.toFixed(1),"ms"):t<1e3?r="".concat(t.toFixed(0),"ms"):r="".concat((t/1e3).toFixed(2),"s"),r}function Qm(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,e=Math.max(r-t.length,0);return"".concat(" ".repeat(e)).concat(t)}function ks(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(e=Math.min(e,n/t.width));var a=t.width*e,o=t.height*e,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var Rs;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Rs||(Rs={}));function Jm(t){return typeof t=="string"?Rs[t.toUpperCase()]||Rs.WHITE:t}function eg(t,r,e){return!it&&typeof t=="string"&&(r&&(r=Jm(r),t="\x1B[".concat(r,"m").concat(t,"\x1B[39m")),e&&(r=Jm(e),t="\x1B[".concat(e+10,"m").concat(t,"\x1B[49m"))),t}function fR(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=lR(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function lR(t,r){if(t){if(typeof t=="string")return tg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tg(t,r)}}function tg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function rg(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],e=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(e),i=fR(n),a;try{var o=function(){var u=a.value;typeof t[u]=="function"&&(r.find(function(f){return u===f})||(t[u]=t[u].bind(t)))};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}function Li(t,r){if(!t)throw new Error(r||"Assertion failed")}function qn(){var t;if(it&&"performance"in Ci){var r,e;t=Ci===null||Ci===void 0||(r=Ci.performance)===null||r===void 0||(e=r.now)===null||e===void 0?void 0:e.call(r)}else if("hrtime"in Xn){var n,i=Xn===null||Xn===void 0||(n=Xn.hrtime)===null||n===void 0?void 0:n.call(Xn);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}var Di={debug:it&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},cR={enabled:!0,level:0};function Gt(){}var ng={},ig={once:!0},$t=function(){function t(){(0,sg.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""},e=r.id;X(this,"id",void 0),X(this,"VERSION",Ms),X(this,"_startTs",qn()),X(this,"_deltaTs",qn()),X(this,"_storage",void 0),X(this,"userData",{}),X(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new Zm("__probe-".concat(this.id,"__"),cR),this.userData={},this.timeStamp("".concat(this.id," started")),rg(this),Object.seal(this)}return(0,ug.default)(t,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((qn()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((qn()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,n){this._storage.updateConfiguration((0,og.default)({},e,n))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,n){Li(e,n)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,Di.warn,arguments,ig)}},{key:"error",value:function(e){return this._getLogFunction(0,e,Di.error,arguments)}},{key:"deprecated",value:function(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}},{key:"removed",value:function(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}},{key:"probe",value:function(e,n){return this._getLogFunction(e,n,Di.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,n){return this._getLogFunction(e,n,Di.debug,arguments)}},{key:"info",value:function(e,n){return this._getLogFunction(e,n,console.info,arguments)}},{key:"once",value:function(e,n){for(var i=arguments.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];return this._getLogFunction(e,n,Di.debug||Di.info,arguments,ig)}},{key:"table",value:function(e,n,i){return n?this._getLogFunction(e,n,console.table||Gt,i&&[i],{tag:vR(n)}):Gt}},{key:"image",value:function(e){var n=e.logLevel,i=e.priority,a=e.image,o=e.message,s=o===void 0?"":o,u=e.scale,f=u===void 0?1:u;return this._shouldLog(n||i)?it?dR({image:a,message:s,scale:f}):pR({image:a,message:s,scale:f}):Gt}},{key:"time",value:function(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,n){return this._getLogFunction(e,n,console.timeStamp||Gt)}},{key:"group",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},a=ag({logLevel:e,message:n,opts:i}),o=i.collapsed;return a.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}},{key:"groupCollapsed",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||Gt)}},{key:"withGroup",value:function(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=fg(e)}},{key:"_getLogFunction",value:function(e,n,i,a,o){if(this._shouldLog(e)){var s;o=ag({logLevel:e,message:n,args:a,opts:o}),i=i||o.method,Li(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=qn();var u=o.tag||o.message;if(o.once)if(!ng[u])ng[u]=qn();else return Gt;return n=hR(this.id,o.message,o),(s=i).bind.apply(s,[console,n].concat((0,Ba.default)(o.args)))}return Gt}}]),t}();X($t,"VERSION",Ms);function fg(t){if(!t)return 0;var r;switch((0,Cs.default)(t)){case"number":r=t;break;case"object":r=t.logLevel||t.priority||0;break;default:return 0}return Li(Number.isFinite(r)&&r>=0),r}function ag(t){var r=t.logLevel,e=t.message;t.logLevel=fg(r);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==e;);switch((0,Cs.default)(r)){case"string":case"function":e!==void 0&&n.unshift(e),t.message=r;break;case"object":Object.assign(t,r);break;default:}typeof t.message=="function"&&(t.message=t.message());var i=(0,Cs.default)(t.message);return Li(i==="string"||i==="object"),Object.assign(t,{args:n},t.opts)}function hR(t,r,e){if(typeof r=="string"){var n=e.time?Qm(Km(e.total)):"";r=e.time?"".concat(t,": ").concat(n,"  ").concat(r):"".concat(t,": ").concat(r),r=eg(r,e.color,e.background)}return r}function pR(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i,o=null;try{o=module.require("asciify-image")}catch{}return o?function(){return o(r,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(s){return console.log(s)})}:Gt}function dR(t){var r=t.image,e=t.message,n=e===void 0?"":e,i=t.scale,a=i===void 0?1:i;if(typeof r=="string"){var o=new Image;return o.onload=function(){var l,c=ks(o,n,a);(l=console).log.apply(l,(0,Ba.default)(c))},o.src=r,Gt}var s=r.nodeName||"";if(s.toLowerCase()==="img"){var u;return(u=console).log.apply(u,(0,Ba.default)(ks(r,n,a))),Gt}if(s.toLowerCase()==="canvas"){var f=new Image;return f.onload=function(){var l;return(l=console).log.apply(l,(0,Ba.default)(ks(f,n,a)))},f.src=r.toDataURL(),Gt}return Gt}function vR(t){for(var r in t)for(var e in t[r])return e||"untitled";return"empty"}var MU=new $t({id:"@probe.gl/log"});var q=new $t({id:"luma.gl"});function Je(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}var mR="Invalid WebGLRenderingContext";var gR="Requires WebGL2";function Kr(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function te(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function Ql(t){return te(t)?t:null}function Qr(t){return Je(Kr(t),mR),t}function De(t){return Je(te(t),gR),t}var Va={};function yR(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function _R(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function bR(t,r){Va[t]=!0,r!==void 0&&yR(r)}function wR(t){var r=t.getError;t.getError=function(){var n;do n=r.apply(t),n!==0&&(Va[n]=!0);while(n!==0);for(n in Va)if(Va[n])return delete Va[n],parseInt(n,10);return 0}}var za=function t(r){var e=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new t.VertexAttrib(e);this.attribs[n]=i}this.maxAttrib=0};za.VertexAttrib=function(r){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};za.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var Zn=function(r){var e=this;this.gl=r,wR(r);var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(a){return a===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(a){var o=e.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,a);var s=o.attribs[a];return s.enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(a,o){switch(a){case 34962:e.currentArrayBuffer=o;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=o;break;default:}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(a,o){var s=e.currentVertexArrayObject,u=s.attribs[a];switch(o){case 34975:return u.buffer;case 34338:return u.enabled;case 34339:return u.size;case 34340:return u.stride;case 34341:return u.type;case 34922:return u.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(a,o,s,u,f,l){var c=e.currentVertexArrayObject;c.maxAttrib=Math.max(c.maxAttrib,a);var p=c.attribs[a];return p.buffer=e.currentArrayBuffer,p.size=o,p.type=s,p.normalized=u,p.stride=f,p.offset=l,p.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas&&r.canvas.addEventListener("webglcontextrestored",function(){_R("OESVertexArrayObject emulation library context restored"),e.reset_()},!0),this.reset_()};Zn.prototype.VERTEX_ARRAY_BINDING_OES=34229;Zn.prototype.reset_=function(){var r=this.vertexArrayObjects!==void 0;if(r)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new za(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Zn.prototype.createVertexArrayOES=function(){var r=new za(this);return this.vertexArrayObjects.push(r),r};Zn.prototype.deleteVertexArrayOES=function(r){r.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(r),1),this.currentVertexArrayObject===r&&this.bindVertexArrayOES(null)};Zn.prototype.isVertexArrayOES=function(r){return!!(r&&r instanceof za&&r.hasBeenBound&&r.ext===this)};Zn.prototype.bindVertexArrayOES=function(r){var e=this.gl;if(r&&!r.isAlive){bR(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var n=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=r||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var a=this.currentVertexArrayObject;if(i!==a){(!i||a.elementArrayBuffer!==i.elementArrayBuffer)&&n.bindBuffer.call(e,34963,a.elementArrayBuffer);for(var o=this.currentArrayBuffer,s=Math.max(i?i.maxAttrib:0,a.maxAttrib),u=0;u<=s;u++){var f=a.attribs[u],l=i?i.attribs[u]:null;if((!i||f.enabled!==l.enabled)&&(f.enabled?n.enableVertexAttribArray.call(e,u):n.disableVertexAttribArray.call(e,u)),f.enabled){var c=!1;(!i||f.buffer!==l.buffer)&&(o!==f.buffer&&(n.bindBuffer.call(e,34962,f.buffer),o=f.buffer),c=!0),(c||f.cached!==l.cached)&&n.vertexAttribPointer.call(e,u,f.size,f.type,f.normalized,f.stride,f.offset)}}this.currentArrayBuffer!==o&&n.bindBuffer.call(e,34962,this.currentArrayBuffer)}};function lg(t){if(typeof t.createVertexArray!="function"){var r=t.getSupportedExtensions;t.getSupportedExtensions=function(){var i=r.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};var e=t.getExtension;t.getExtension=function(i){var a=e.call(this,i);return a||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Zn(this)),this.__OESVertexArrayObject))}}}var Ua=h(G());var ge=h(G());var ve,cg="OES_element_index",hg="WEBGL_draw_buffers",xR="EXT_disjoint_timer_query",TR="EXT_disjoint_timer_query_webgl2",ER="EXT_texture_filter_anisotropic",pg="WEBGL_debug_renderer_info",PR=35723,SR=4352,OR=36795,AR=34047,MR=37445,kR=37446,je=function(r){return te(r)?void 0:0},RR=(ve={},(0,ge.default)(ve,3074,function(r){return te(r)?void 0:36064}),(0,ge.default)(ve,PR,function(t){return te(t)?void 0:SR}),(0,ge.default)(ve,35977,je),(0,ge.default)(ve,32937,je),(0,ge.default)(ve,OR,function(t,r){var e=te(t)?t.getExtension(TR):t.getExtension(xR);return e&&e.GPU_DISJOINT_EXT?r(e.GPU_DISJOINT_EXT):0}),(0,ge.default)(ve,MR,function(t,r){var e=t.getExtension(pg);return r(e&&e.UNMASKED_VENDOR_WEBGL||7936)}),(0,ge.default)(ve,kR,function(t,r){var e=t.getExtension(pg);return r(e&&e.UNMASKED_RENDERER_WEBGL||7937)}),(0,ge.default)(ve,AR,function(t,r){var e=t.luma.extensions[ER];return e?r(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1}),(0,ge.default)(ve,32883,je),(0,ge.default)(ve,35071,je),(0,ge.default)(ve,37447,je),(0,ge.default)(ve,36063,function(r,e){if(!te(r)){var n=r.getExtension(hg);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}}),(0,ge.default)(ve,35379,je),(0,ge.default)(ve,35374,je),(0,ge.default)(ve,35377,je),(0,ge.default)(ve,34852,function(r){if(!te(r)){var e=r.getExtension(hg);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}}),(0,ge.default)(ve,36203,function(r){return r.getExtension(cg)?2147483647:65535}),(0,ge.default)(ve,33001,function(r){return r.getExtension(cg)?16777216:65535}),(0,ge.default)(ve,33e3,function(r){return 16777216}),(0,ge.default)(ve,37157,je),(0,ge.default)(ve,35373,je),(0,ge.default)(ve,35657,je),(0,ge.default)(ve,36183,je),(0,ge.default)(ve,37137,je),(0,ge.default)(ve,34045,je),(0,ge.default)(ve,35978,je),(0,ge.default)(ve,35979,je),(0,ge.default)(ve,35968,je),(0,ge.default)(ve,35376,je),(0,ge.default)(ve,35375,je),(0,ge.default)(ve,35659,je),(0,ge.default)(ve,37154,je),(0,ge.default)(ve,35371,je),(0,ge.default)(ve,35658,je),(0,ge.default)(ve,35076,je),(0,ge.default)(ve,35077,je),(0,ge.default)(ve,35380,je),ve);function dg(t,r,e){var n=RR[e],i=typeof n=="function"?n(t,r,e):n,a=i!==void 0?i:r(e);return a}var ji,CR="OES_vertex_array_object",vg="ANGLE_instanced_arrays",IR="WEBGL_draw_buffers",LR="EXT_disjoint_timer_query",DR="EXT_texture_filter_anisotropic",jR="VertexArray requires WebGL2 or OES_vertex_array_object extension";function FR(t,r){return{webgl2:te(t),ext:t.getExtension(r)}}var Jl=(ji={},(0,Ua.default)(ji,CR,{meta:{suffix:"OES"},createVertexArray:function(){Je(!1,jR)},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),(0,Ua.default)(ji,vg,{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(r,e){Je(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),(0,Ua.default)(ji,IR,{meta:{suffix:"WEBGL"},drawBuffers:function(){Je(!1)}}),(0,Ua.default)(ji,LR,{meta:{suffix:"EXT"},createQuery:function(){Je(!1)},deleteQuery:function(){Je(!1)},beginQuery:function(){Je(!1)},endQuery:function(){},getQuery:function(r,e){return this.getQueryObject(r,e)},getQueryParameter:function(r,e){return this.getQueryObject(r,e)},getQueryObject:function(){}}),ji),Is={readBuffer:function(r,e,n){te(r)&&e(n)},getVertexAttrib:function(r,e,n,i){var a=FR(r,vg),o=a.webgl2,s=a.ext,u;switch(i){case 35069:u=o?void 0:!1;break;case 35070:u=!o&&!s?0:void 0;break;default:}return u!==void 0?u:e(n,i)},getProgramParameter:function(r,e,n,i){if(!te(r))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0;default:}return e(n,i)},getInternalformatParameter:function(r,e,n,i,a){if(!te(r))switch(a){case 32937:return new Int32Array([0]);default:}return r.getInternalformatParameter(n,i,a)},getTexParameter:function(r,e,n,i){switch(i){case 34046:var a=r.luma.extensions,o=a[DR];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break;default:}return e(n,i)},getParameter:dg,hint:function(r,e,n,i){return e(n,i)}};function gg(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=NR(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function NR(t,r){if(t){if(typeof t=="string")return mg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return mg(t,r)}}function mg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function yg(t){t.luma=t.luma||{};var r=t.luma;return r.polyfilled||(lg(t),BR(t),zR(t,Jl),VR(t,{target:r,target2:t}),r.polyfilled=!0),t}globalThis.polyfillContext=yg;function BR(t){t.luma.extensions={};var r=t.getSupportedExtensions()||[],e=gg(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;t.luma[i]=t.getExtension(i)}}catch(a){e.e(a)}finally{e.f()}}function VR(t,r){var e=r.target,n=r.target2;Object.keys(Is).forEach(function(i){if(typeof Is[i]=="function"){var a=t[i]?t[i].bind(t):function(){},o=Is[i].bind(null,t,a);e[i]=o,n[i]=o}})}function zR(t,r){var e=gg(Object.getOwnPropertyNames(r)),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i!=="overrides"&&UR(t,{extension:i,target:t.luma,target2:t})}}catch(a){e.e(a)}finally{e.f()}}function UR(t,r){var e=r.extension,n=r.target,i=r.target2,a=Jl[e];Je(a);for(var o=a.meta,s=o===void 0?{}:o,u=s.suffix,f=u===void 0?"":u,l=t.getExtension(e),c=function(){var m=d[p],g="".concat(m).concat(f),_=null;m==="meta"||typeof t[m]=="function"||(l&&typeof l[g]=="function"?_=function(){return l[g].apply(l,arguments)}:typeof a[m]=="function"&&(_=a[m].bind(n))),_&&(n[m]=_,i[m]=_)},p=0,d=Object.keys(a);p<d.length;p++)c()}var Ls=h(Ue()),Ye=h(Ri()),O=h(G());var K,W,Ht,$a=(K={},(0,O.default)(K,3042,!1),(0,O.default)(K,32773,new Float32Array([0,0,0,0])),(0,O.default)(K,32777,32774),(0,O.default)(K,34877,32774),(0,O.default)(K,32969,1),(0,O.default)(K,32968,0),(0,O.default)(K,32971,1),(0,O.default)(K,32970,0),(0,O.default)(K,3106,new Float32Array([0,0,0,0])),(0,O.default)(K,3107,[!0,!0,!0,!0]),(0,O.default)(K,2884,!1),(0,O.default)(K,2885,1029),(0,O.default)(K,2929,!1),(0,O.default)(K,2931,1),(0,O.default)(K,2932,513),(0,O.default)(K,2928,new Float32Array([0,1])),(0,O.default)(K,2930,!0),(0,O.default)(K,3024,!0),(0,O.default)(K,36006,null),(0,O.default)(K,2886,2305),(0,O.default)(K,33170,4352),(0,O.default)(K,2849,1),(0,O.default)(K,32823,!1),(0,O.default)(K,32824,0),(0,O.default)(K,10752,0),(0,O.default)(K,32938,1),(0,O.default)(K,32939,!1),(0,O.default)(K,3089,!1),(0,O.default)(K,3088,new Int32Array([0,0,1024,1024])),(0,O.default)(K,2960,!1),(0,O.default)(K,2961,0),(0,O.default)(K,2968,4294967295),(0,O.default)(K,36005,4294967295),(0,O.default)(K,2962,519),(0,O.default)(K,2967,0),(0,O.default)(K,2963,4294967295),(0,O.default)(K,34816,519),(0,O.default)(K,36003,0),(0,O.default)(K,36004,4294967295),(0,O.default)(K,2964,7680),(0,O.default)(K,2965,7680),(0,O.default)(K,2966,7680),(0,O.default)(K,34817,7680),(0,O.default)(K,34818,7680),(0,O.default)(K,34819,7680),(0,O.default)(K,2978,[0,0,1024,1024]),(0,O.default)(K,3333,4),(0,O.default)(K,3317,4),(0,O.default)(K,37440,!1),(0,O.default)(K,37441,!1),(0,O.default)(K,37443,37444),(0,O.default)(K,35723,4352),(0,O.default)(K,36010,null),(0,O.default)(K,35977,!1),(0,O.default)(K,3330,0),(0,O.default)(K,3332,0),(0,O.default)(K,3331,0),(0,O.default)(K,3314,0),(0,O.default)(K,32878,0),(0,O.default)(K,3316,0),(0,O.default)(K,3315,0),(0,O.default)(K,32877,0),K),_n=function(r,e,n){return e?r.enable(n):r.disable(n)},Sg=function(r,e,n){return r.hint(n,e)},It=function(r,e,n){return r.pixelStorei(n,e)},ZR=function(r,e){var n=te(r)?36009:36160;return r.bindFramebuffer(n,e)},KR=function(r,e){return r.bindFramebuffer(36008,e)};function Ga(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var Og=(W={},(0,O.default)(W,3042,_n),(0,O.default)(W,32773,function(r,e){return r.blendColor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,32777,"blendEquation"),(0,O.default)(W,34877,"blendEquation"),(0,O.default)(W,32969,"blendFunc"),(0,O.default)(W,32968,"blendFunc"),(0,O.default)(W,32971,"blendFunc"),(0,O.default)(W,32970,"blendFunc"),(0,O.default)(W,3106,function(r,e){return r.clearColor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,3107,function(r,e){return r.colorMask.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,2884,_n),(0,O.default)(W,2885,function(r,e){return r.cullFace(e)}),(0,O.default)(W,2929,_n),(0,O.default)(W,2931,function(r,e){return r.clearDepth(e)}),(0,O.default)(W,2932,function(r,e){return r.depthFunc(e)}),(0,O.default)(W,2928,function(r,e){return r.depthRange.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,2930,function(r,e){return r.depthMask(e)}),(0,O.default)(W,3024,_n),(0,O.default)(W,35723,Sg),(0,O.default)(W,36006,ZR),(0,O.default)(W,2886,function(r,e){return r.frontFace(e)}),(0,O.default)(W,33170,Sg),(0,O.default)(W,2849,function(r,e){return r.lineWidth(e)}),(0,O.default)(W,32823,_n),(0,O.default)(W,32824,"polygonOffset"),(0,O.default)(W,10752,"polygonOffset"),(0,O.default)(W,35977,_n),(0,O.default)(W,32938,"sampleCoverage"),(0,O.default)(W,32939,"sampleCoverage"),(0,O.default)(W,3089,_n),(0,O.default)(W,3088,function(r,e){return r.scissor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,2960,_n),(0,O.default)(W,2961,function(r,e){return r.clearStencil(e)}),(0,O.default)(W,2968,function(r,e){return r.stencilMaskSeparate(1028,e)}),(0,O.default)(W,36005,function(r,e){return r.stencilMaskSeparate(1029,e)}),(0,O.default)(W,2962,"stencilFuncFront"),(0,O.default)(W,2967,"stencilFuncFront"),(0,O.default)(W,2963,"stencilFuncFront"),(0,O.default)(W,34816,"stencilFuncBack"),(0,O.default)(W,36003,"stencilFuncBack"),(0,O.default)(W,36004,"stencilFuncBack"),(0,O.default)(W,2964,"stencilOpFront"),(0,O.default)(W,2965,"stencilOpFront"),(0,O.default)(W,2966,"stencilOpFront"),(0,O.default)(W,34817,"stencilOpBack"),(0,O.default)(W,34818,"stencilOpBack"),(0,O.default)(W,34819,"stencilOpBack"),(0,O.default)(W,2978,function(r,e){return r.viewport.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,3333,It),(0,O.default)(W,3317,It),(0,O.default)(W,37440,It),(0,O.default)(W,37441,It),(0,O.default)(W,37443,It),(0,O.default)(W,3330,It),(0,O.default)(W,3332,It),(0,O.default)(W,3331,It),(0,O.default)(W,36010,KR),(0,O.default)(W,3314,It),(0,O.default)(W,32878,It),(0,O.default)(W,3316,It),(0,O.default)(W,3315,It),(0,O.default)(W,32877,It),(0,O.default)(W,"framebuffer",function(r,e){var n=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,n)}),(0,O.default)(W,"blend",function(r,e){return e?r.enable(3042):r.disable(3042)}),(0,O.default)(W,"blendColor",function(r,e){return r.blendColor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"blendEquation",function(r,e){e=Ga(e)?e:[e,e],r.blendEquationSeparate.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"blendFunc",function(r,e){e=Ga(e)&&e.length===2?[].concat((0,Ye.default)(e),(0,Ye.default)(e)):e,r.blendFuncSeparate.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"clearColor",function(r,e){return r.clearColor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"clearDepth",function(r,e){return r.clearDepth(e)}),(0,O.default)(W,"clearStencil",function(r,e){return r.clearStencil(e)}),(0,O.default)(W,"colorMask",function(r,e){return r.colorMask.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"cull",function(r,e){return e?r.enable(2884):r.disable(2884)}),(0,O.default)(W,"cullFace",function(r,e){return r.cullFace(e)}),(0,O.default)(W,"depthTest",function(r,e){return e?r.enable(2929):r.disable(2929)}),(0,O.default)(W,"depthFunc",function(r,e){return r.depthFunc(e)}),(0,O.default)(W,"depthMask",function(r,e){return r.depthMask(e)}),(0,O.default)(W,"depthRange",function(r,e){return r.depthRange.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"dither",function(r,e){return e?r.enable(3024):r.disable(3024)}),(0,O.default)(W,"derivativeHint",function(r,e){r.hint(35723,e)}),(0,O.default)(W,"frontFace",function(r,e){return r.frontFace(e)}),(0,O.default)(W,"mipmapHint",function(r,e){return r.hint(33170,e)}),(0,O.default)(W,"lineWidth",function(r,e){return r.lineWidth(e)}),(0,O.default)(W,"polygonOffsetFill",function(r,e){return e?r.enable(32823):r.disable(32823)}),(0,O.default)(W,"polygonOffset",function(r,e){return r.polygonOffset.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"sampleCoverage",function(r,e){return r.sampleCoverage.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"scissorTest",function(r,e){return e?r.enable(3089):r.disable(3089)}),(0,O.default)(W,"scissor",function(r,e){return r.scissor.apply(r,(0,Ye.default)(e))}),(0,O.default)(W,"stencilTest",function(r,e){return e?r.enable(2960):r.disable(2960)}),(0,O.default)(W,"stencilMask",function(r,e){e=Ga(e)?e:[e,e];var n=e,i=(0,Ls.default)(n,2),a=i[0],o=i[1];r.stencilMaskSeparate(1028,a),r.stencilMaskSeparate(1029,o)}),(0,O.default)(W,"stencilFunc",function(r,e){e=Ga(e)&&e.length===3?[].concat((0,Ye.default)(e),(0,Ye.default)(e)):e;var n=e,i=(0,Ls.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],f=i[4],l=i[5];r.stencilFuncSeparate(1028,a,o,s),r.stencilFuncSeparate(1029,u,f,l)}),(0,O.default)(W,"stencilOp",function(r,e){e=Ga(e)&&e.length===3?[].concat((0,Ye.default)(e),(0,Ye.default)(e)):e;var n=e,i=(0,Ls.default)(n,6),a=i[0],o=i[1],s=i[2],u=i[3],f=i[4],l=i[5];r.stencilOpSeparate(1028,a,o,s),r.stencilOpSeparate(1029,u,f,l)}),(0,O.default)(W,"viewport",function(r,e){return r.viewport.apply(r,(0,Ye.default)(e))}),W);function Ze(t,r,e){return r[t]!==void 0?r[t]:e[t]}var Ag={blendEquation:function(r,e,n){return r.blendEquationSeparate(Ze(32777,e,n),Ze(34877,e,n))},blendFunc:function(r,e,n){return r.blendFuncSeparate(Ze(32969,e,n),Ze(32968,e,n),Ze(32971,e,n),Ze(32970,e,n))},polygonOffset:function(r,e,n){return r.polygonOffset(Ze(32824,e,n),Ze(10752,e,n))},sampleCoverage:function(r,e,n){return r.sampleCoverage(Ze(32938,e,n),Ze(32939,e,n))},stencilFuncFront:function(r,e,n){return r.stencilFuncSeparate(1028,Ze(2962,e,n),Ze(2967,e,n),Ze(2963,e,n))},stencilFuncBack:function(r,e,n){return r.stencilFuncSeparate(1029,Ze(34816,e,n),Ze(36003,e,n),Ze(36004,e,n))},stencilOpFront:function(r,e,n){return r.stencilOpSeparate(1028,Ze(2964,e,n),Ze(2965,e,n),Ze(2966,e,n))},stencilOpBack:function(r,e,n){return r.stencilOpSeparate(1029,Ze(34817,e,n),Ze(34818,e,n),Ze(34819,e,n))}},ec={enable:function(r,e){return r((0,O.default)({},e,!0))},disable:function(r,e){return r((0,O.default)({},e,!1))},pixelStorei:function(r,e,n){return r((0,O.default)({},e,n))},hint:function(r,e,n){return r((0,O.default)({},e,n))},bindFramebuffer:function(r,e,n){var i;switch(e){case 36160:return r((i={},(0,O.default)(i,36006,n),(0,O.default)(i,36010,n),i));case 36009:return r((0,O.default)({},36006,n));case 36008:return r((0,O.default)({},36010,n));default:return null}},blendColor:function(r,e,n,i,a){return r((0,O.default)({},32773,new Float32Array([e,n,i,a])))},blendEquation:function(r,e){var n;return r((n={},(0,O.default)(n,32777,e),(0,O.default)(n,34877,e),n))},blendEquationSeparate:function(r,e,n){var i;return r((i={},(0,O.default)(i,32777,e),(0,O.default)(i,34877,n),i))},blendFunc:function(r,e,n){var i;return r((i={},(0,O.default)(i,32969,e),(0,O.default)(i,32968,n),(0,O.default)(i,32971,e),(0,O.default)(i,32970,n),i))},blendFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,O.default)(o,32969,e),(0,O.default)(o,32968,n),(0,O.default)(o,32971,i),(0,O.default)(o,32970,a),o))},clearColor:function(r,e,n,i,a){return r((0,O.default)({},3106,new Float32Array([e,n,i,a])))},clearDepth:function(r,e){return r((0,O.default)({},2931,e))},clearStencil:function(r,e){return r((0,O.default)({},2961,e))},colorMask:function(r,e,n,i,a){return r((0,O.default)({},3107,[e,n,i,a]))},cullFace:function(r,e){return r((0,O.default)({},2885,e))},depthFunc:function(r,e){return r((0,O.default)({},2932,e))},depthRange:function(r,e,n){return r((0,O.default)({},2928,new Float32Array([e,n])))},depthMask:function(r,e){return r((0,O.default)({},2930,e))},frontFace:function(r,e){return r((0,O.default)({},2886,e))},lineWidth:function(r,e){return r((0,O.default)({},2849,e))},polygonOffset:function(r,e,n){var i;return r((i={},(0,O.default)(i,32824,e),(0,O.default)(i,10752,n),i))},sampleCoverage:function(r,e,n){var i;return r((i={},(0,O.default)(i,32938,e),(0,O.default)(i,32939,n),i))},scissor:function(r,e,n,i,a){return r((0,O.default)({},3088,new Int32Array([e,n,i,a])))},stencilMask:function(r,e){var n;return r((n={},(0,O.default)(n,2968,e),(0,O.default)(n,36005,e),n))},stencilMaskSeparate:function(r,e,n){return r((0,O.default)({},e===1028?2968:36005,n))},stencilFunc:function(r,e,n,i){var a;return r((a={},(0,O.default)(a,2962,e),(0,O.default)(a,2967,n),(0,O.default)(a,2963,i),(0,O.default)(a,34816,e),(0,O.default)(a,36003,n),(0,O.default)(a,36004,i),a))},stencilFuncSeparate:function(r,e,n,i,a){var o;return r((o={},(0,O.default)(o,e===1028?2962:34816,n),(0,O.default)(o,e===1028?2967:36003,i),(0,O.default)(o,e===1028?2963:36004,a),o))},stencilOp:function(r,e,n,i){var a;return r((a={},(0,O.default)(a,2964,e),(0,O.default)(a,2965,n),(0,O.default)(a,2966,i),(0,O.default)(a,34817,e),(0,O.default)(a,34818,n),(0,O.default)(a,34819,i),a))},stencilOpSeparate:function(r,e,n,i,a){var o;return r((o={},(0,O.default)(o,e===1028?2964:34817,n),(0,O.default)(o,e===1028?2965:34818,i),(0,O.default)(o,e===1028?2966:34819,a),o))},viewport:function(r,e,n,i,a){return r((0,O.default)({},2978,[e,n,i,a]))}},Mr=function(r,e){return r.isEnabled(e)},tc=(Ht={},(0,O.default)(Ht,3042,Mr),(0,O.default)(Ht,2884,Mr),(0,O.default)(Ht,2929,Mr),(0,O.default)(Ht,3024,Mr),(0,O.default)(Ht,32823,Mr),(0,O.default)(Ht,32926,Mr),(0,O.default)(Ht,32928,Mr),(0,O.default)(Ht,3089,Mr),(0,O.default)(Ht,2960,Mr),(0,O.default)(Ht,35977,Mr),Ht);var Rg=h(B()),Cg=h(U());function rc(t){for(var r in t)return!1;return!0}function Mg(t,r){if(t===r)return!0;var e=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(r)||ArrayBuffer.isView(r);if(e&&n&&t.length===r.length){for(var i=0;i<t.length;++i)if(t[i]!==r[i])return!1;return!0}return!1}function kg(t,r){var e=t[r].bind(t);t[r]=function(){var i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache&&t.state.enable?t.state.cache[i]:e.apply(void 0,arguments)},Object.defineProperty(t[r],"name",{value:"".concat(r,"-from-cache"),configurable:!1})}function QR(t,r,e){var n=t[r].bind(t);t[r]=function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=e.apply(void 0,[t.state._updateCache].concat(o)),f=u.valueChanged,l=u.oldValue;return f&&n.apply(void 0,o),l},Object.defineProperty(t[r],"name",{value:"".concat(r,"-to-cache"),configurable:!1})}function JR(t){var r=t.useProgram.bind(t);t.useProgram=function(n){t.state.program!==n&&(r(n),t.state.program=n)}}var eC=function(){function t(r){(0,Rg.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.copyState,i=n===void 0?!1:n,a=e.log,o=a===void 0?function(){}:a;this.gl=r,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?Fi(r):Object.assign({},$a),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return(0,Cg.default)(t,[{key:"push",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.stateStack.push({})}},{key:"pop",value:function(){Je(this.stateStack.length>0);var e=this.stateStack[this.stateStack.length-1];at(this.gl,e),this.stateStack.pop()}},{key:"_updateCache",value:function(e){var n=!1,i,a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var o in e){Je(o!==void 0);var s=e[o],u=this.cache[o];Mg(s,u)||(n=!0,i=u,a&&!(o in a)&&(a[o]=u),this.cache[o]=s)}return{valueChanged:n,oldValue:i}}}]),t}();function Ds(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.enable,n=e===void 0?!0:e,i=r.copyState;if(Je(i!==void 0),!t.state){var a=globalThis.polyfillContext;a&&a(t),t.state=new eC(t,{copyState:i}),JR(t);for(var o in ec){var s=ec[o];QR(t,o,s)}kg(t,"getParameter"),kg(t,"isEnabled")}return t.state.enable=n,t}function nc(t){t.state||Ds(t,{copyState:!1}),t.state.push()}function js(t){Je(t.state),t.state.pop()}function tC(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rC(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rC(t,r){if(t){if(typeof t=="string")return Ig(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ig(t,r)}}function Ig(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function at(t,r){if(Je(Kr(t),"setParameters requires a WebGL context"),!rc(r)){var e={};for(var n in r){var i=Number(n),a=Og[n];a&&(typeof a=="string"?e[a]=!0:a(t,r[n],i))}var o=t.state&&t.state.cache;if(o)for(var s in e){var u=Ag[s];u(t,r,o)}}}function Fi(t,r){if(r=r||$a,typeof r=="number"){var e=r,n=tc[e];return n?n(t,e):t.getParameter(e)}var i=Array.isArray(r)?r:Object.keys(r),a={},o=tC(i),s;try{for(o.s();!(s=o.n()).done;){var u=s.value,f=tc[u];a[u]=f?f(t,Number(u)):t.getParameter(Number(u))}}catch(l){o.e(l)}finally{o.f()}return a}function Fs(t){at(t,$a)}function Re(t,r,e){if(rc(r))return e(t);var n=r.nocatch,i=n===void 0?!0:n;nc(t),at(t,r);var a;if(i)a=e(t),js(t);else try{a=e(t)}finally{js(t)}return a}function Lt(t){var r=t.luma;if(t.canvas&&r){var e=r.canvasSizeInfo.clientWidth;return e?t.drawingBufferWidth/e:1}return 1}function Ni(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=Lt(t),i=t.drawingBufferWidth,a=t.drawingBufferHeight;return nC(r,n,i,a,e)}function jg(t){var r=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?r:1}function nC(t,r,e,n,i){var a=Lg(t[0],r,e),o=Dg(t[1],r,n,i),s=Lg(t[0]+1,r,e),u=s===e-1?s:s-1;s=Dg(t[1]+1,r,n,i);var f;return i?(s=s===0?s:s+1,f=o,o=s):f=s===n-1?s:s-1,{x:a,y:o,width:Math.max(u-a+1,1),height:Math.max(f-o+1,1)}}function Lg(t,r,e){var n=Math.min(Math.round(t*r),e-1);return n}function Dg(t,r,e,n){return n?Math.max(0,e-1-Math.round(t*r)):Math.min(Math.round(t*r),e-1)}var ic=it(),iC=ic&&typeof document<"u",Fg={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function Bi(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Je(ic,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},Fg,t);var r=t,e=r.width,n=r.height;function i(f){if(t.throwOnError)throw new Error(f);return console.error(f),null}t.onError=i;var a,o=t,s=o.canvas,u=oC({canvas:s,width:e,height:n,onError:i});return a=aC(u,t),a?(a=Jr(a,t),sC(a),a):null}function Jr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||uC(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},r=Object.assign({},Fg,r);var e=r,n=e.manageState,i=e.debug;return n&&Ds(t,{copyState:!1,log:function(){for(var o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];return q.log.apply(q,[1].concat(s))()}}),ic&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,r),q.level=Math.max(q.level,1)):q.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function Ng(t){var r=t.getParameter(7936),e=t.getParameter(7937),n=t.getExtension("WEBGL_debug_renderer_info"),i=n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||7936),a=n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||r,renderer:a||e,vendorMasked:r,rendererMasked:e,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function ac(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){var e=jg(r.useDevicePixels);fC(t,e,r);return}var n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in r&&"height"in r&&n.resize(r.width,r.height)}function aC(t,r){var e=r.onError,n=null,i=function(c){return n=c.statusMessage||n};t.addEventListener("webglcontextcreationerror",i,!1);var a=r.webgl1,o=a===void 0?!0:a,s=r.webgl2,u=s===void 0?!0:s,f=null;return u&&(f=f||t.getContext("webgl2",r),f=f||t.getContext("experimental-webgl2",r)),o&&(f=f||t.getContext("webgl",r),f=f||t.getContext("experimental-webgl",r)),t.removeEventListener("webglcontextcreationerror",i,!1),f?(r.onContextLost&&t.addEventListener("webglcontextlost",r.onContextLost,!1),r.onContextRestored&&t.addEventListener("webglcontextrestored",r.onContextRestored,!1),f):e("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function oC(t){var r=t.canvas,e=t.width,n=e===void 0?800:e,i=t.height,a=i===void 0?600:i,o=t.onError,s;if(typeof r=="string"){var u=iC&&document.readyState==="complete";u||o("createGLContext called on canvas '".concat(r,"' before page was loaded")),s=document.getElementById(r)}else r?s=r:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(a)?"".concat(a,"px"):"100%",document.body.insertBefore(s,document.body.firstChild));return s}function sC(t){var r=te(t)?"WebGL2":"WebGL1",e=Ng(t),n=e?"(".concat(e.vendor,",").concat(e.renderer,")"):"",i=t.debug?" debug":"";q.info(1,"".concat(r).concat(i," context ").concat(n))()}function uC(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function fC(t,r,e){var n="width"in e?e.width:t.canvas.clientWidth,i="height"in e?e.height:t.canvas.clientHeight;(!n||!i)&&(q.log(1,"Canvas clientWidth/clientHeight is 0")(),r=1,n=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var a=t.luma.canvasSizeInfo;if(a.clientWidth!==n||a.clientHeight!==i||a.devicePixelRatio!==r){var o=r,s=Math.floor(n*o),u=Math.floor(i*o);t.canvas.width=s,t.canvas.height=u,(t.drawingBufferWidth!==s||t.drawingBufferHeight!==u)&&(q.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/n,t.drawingBufferHeight/i),t.canvas.width=Math.floor(n*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:n,clientHeight:i,devicePixelRatio:r})}}var Gg=h(B()),$g=h(U());var zg=h(B()),Ug=h(U());var Bg=h(B()),Vg=h(U());function Ha(){var t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){var r=process.hrtime();t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}var Ns=function(){function t(r,e){(0,Bg.default)(this,t),X(this,"name",void 0),X(this,"type",void 0),X(this,"sampleSize",1),X(this,"time",void 0),X(this,"count",void 0),X(this,"samples",void 0),X(this,"lastTiming",void 0),X(this,"lastSampleTime",void 0),X(this,"lastSampleCount",void 0),X(this,"_count",0),X(this,"_time",0),X(this,"_samples",0),X(this,"_startTime",0),X(this,"_timerPending",!1),this.name=r,this.type=e,this.reset()}return(0,Vg.default)(t,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Ha(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Ha()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}();var Kn=function(){function t(r){(0,zg.default)(this,t),X(this,"id",void 0),X(this,"stats",{}),this.id=r.id,this.stats={},this._initializeStats(r.stats),Object.seal(this)}return(0,Ug.default)(t,[{key:"get",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var n in this.stats)e(this.stats[n])}},{key:"getTable",value:function(){var e={};return this.forEach(function(n){e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(function(i){return e._getOrCreate(i)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var n=e.name,i=e.type;return this.stats[n]||(e instanceof Ns?this.stats[n]=e:this.stats[n]=new Ns(n,i)),this.stats[n]}}]),t}();var Wa="8.5.16",lC="set luma.log.level=1 (or higher) to trace rendering",oc=function(){function t(){(0,Gg.default)(this,t),this.stats=new Map}return(0,$g.default)(t,[{key:"get",value:function(e){return this.stats.has(e)||this.stats.set(e,new Kn({id:e})),this.stats.get(e)}}]),t}(),Wt=new oc;if(globalThis.luma&&globalThis.luma.VERSION!==Wa)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Wa));globalThis.luma||(it()&&q.log(1,"luma.gl ".concat(Wa," - ").concat(lC))(),globalThis.luma=globalThis.luma||{VERSION:Wa,version:Wa,log:q,stats:Wt,globals:{modules:{},nodeIO:{}}});var U6=globalThis.luma;function sc(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function uc(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var d0=h(G());var by=h(B()),wy=h(U()),xy=h(we()),Ty=h(ie()),Ey=h(ae()),yc=h(ne());var dy=h(Ue()),vy=h(B()),my=h(U()),gy=h(ie()),yy=h(ae()),gc=h(ne());var qg=h(B()),Zg=h(U());function $(t,r){if(!t)throw new Error(r||"luma.gl: assertion failed.")}function Bs(t,r){if(typeof r!="string")return r;var e=Number(r);if(!isNaN(e))return e;r=r.replace(/^.*\./,"");var n=t[r];return $(n!==void 0,"Accessing undefined constant GL.".concat(r)),n}function Yt(t,r){r=Number(r);for(var e in t)if(t[e]===r)return"GL.".concat(e);return String(r)}var dc={};function Ae(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";dc[t]=dc[t]||1;var r=dc[t]++;return"".concat(t,"-").concat(r)}function vc(t){return $(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function kr(t){var r=!0;for(var e in t){r=!1;break}return r}function Vs(t,r,e,n){var i="See luma.gl ".concat(e," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),a=Object.getPrototypeOf(t);n.forEach(function(o){a.methodName||(a[o]=function(){throw q.removed("Calling removed method ".concat(r,".").concat(o,": "),i)(),new Error(o)})})}function gC(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=yC(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function yC(t,r){if(t){if(typeof t=="string")return Xg(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Xg(t,r)}}function Xg(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Vi="Resource subclass must define virtual methods",lt=function(t){function r(e){(0,qg.default)(this,r);var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Qr(e);var i=n.id,a=n.userData,o=a===void 0?{}:a;this.gl=e,this.gl2=e,this.id=i||Ae(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}return(0,Zg.default)(r,[{key:t,get:function(){return"Resource"}},{key:"toString",value:function(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.deleteChildren,a=i===void 0?!1:i,o=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,o&&a&&o.filter(Boolean).forEach(function(s){return s.delete()}),this}},{key:"bind",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof n!="function")return this._bindHandle(n),this;var i;return this._bound?i=n():(this._bindHandle(this.handle),this._bound=!0,i=n(),this._bound=!1,this._bindHandle(null)),i}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};n=Bs(this.gl,n),$(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=te(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u){var f=o.webgl1,l="webgl2"in o?o.webgl2:o.webgl1,c=s?l:f;return c}}return this._getParameter(n,i)}},{key:"getParameters",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.parameters,a=n.keys,o=this.constructor.PARAMETERS||{},s=te(this.gl),u={},f=i||Object.keys(o),l=gC(f),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,d=o[p],v=d&&(!("webgl2"in d)||s)&&(!("extension"in d)||this.gl.getExtension(d.extension));if(v){var m=a?Yt(this.gl,p):p;u[m]=this.getParameter(p,n),a&&d.type==="GLenum"&&(u[m]=Yt(this.gl,u[m]))}}}catch(g){l.e(g)}finally{l.f()}return u}},{key:"setParameter",value:function(n,i){n=Bs(this.gl,n),$(n);var a=this.constructor.PARAMETERS||{},o=a[n];if(o){var s=te(this.gl),u=(!("webgl2"in o)||s)&&(!("extension"in o)||this.gl.getExtension(o.extension));if(!u)throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(i=Bs(i))}return this._setParameter(n,i),this}},{key:"setParameters",value:function(n){for(var i in n)this.setParameter(i,n[i]);return this}},{key:"stubRemovedMethods",value:function(n,i,a){return Vs(this,n,i,a)}},{key:"initialize",value:function(n){}},{key:"_createHandle",value:function(){throw new Error(Vi)}},{key:"_deleteHandle",value:function(){throw new Error(Vi)}},{key:"_bindHandle",value:function(n){throw new Error(Vi)}},{key:"_getOptsFromHandle",value:function(){throw new Error(Vi)}},{key:"_getParameter",value:function(n,i){throw new Error(Vi)}},{key:"_setParameter",value:function(n,i){throw new Error(Vi)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_initStats",value:function(){this.gl.stats=this.gl.stats||new oc}},{key:"_addStats",value:function(){var n=this[Symbol.toStringTag],i=Wt.get("Resource Counts");i.get("Resources Created").incrementCount(),i.get("".concat(n,"s Created")).incrementCount(),i.get("".concat(n,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var n=this[Symbol.toStringTag],i=Wt.get("Resource Counts");i.get("".concat(n,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(n,i),this._doTrackAllocatedMemory(n,i,this.gl.stats.get("Memory Usage"))}},{key:"_doTrackAllocatedMemory",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Wt.get("Memory Usage");a.get("GPU Memory").addCount(n),a.get("".concat(i," Memory")).addCount(n),this.byteLength=n}},{key:"_trackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(n),this._doTrackDeallocatedMemory(n,this.gl.stats.get("Memory Usage"))}},{key:"_doTrackDeallocatedMemory",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wt.get("Memory Usage");i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(n," Memory")).subtractCount(this.byteLength),this.byteLength=0}}]),r}(Symbol.toStringTag);var iy=h(B()),ay=h(U()),oy=h(we()),sy=h(ie()),uy=h(ae()),mc=h(ne());var ey=h(Kg()),ty=h(B()),ry=h(U());var wC="Failed to deduce GL constant from typed array";function Ya(t){var r=ArrayBuffer.isView(t)?t.constructor:t;switch(r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(wC)}}function bn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.clamped,n=e===void 0?!0:e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Qg(t){var r=t.data,e=t.width,n=t.height,i=t.bytesPerPixel,a=i===void 0?4:i,o=t.temp,s=e*a;o=o||new Uint8Array(s);for(var u=0;u<n/2;++u){var f=u*s,l=(n-u-1)*s;o.set(r.subarray(f,f+s)),r.copyWithin(f,l,l+s),r.set(o,l)}}function Jg(t){for(var r=t.data,e=t.width,n=t.height,i=Math.round(e/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var u=0;u<i;u++)for(var f=0;f<4;f++)o[(s*i+u)*4+f]=r[(s*2*e+u*2)*4+f];return{data:o,width:i,height:a}}function Xa(t,r,e){var n=e.removedProps,i=n===void 0?{}:n,a=e.deprecatedProps,o=a===void 0?{}:a,s=e.replacedProps,u=s===void 0?{}:s;for(var f in i)if(f in r){var l=i[f],c=l?"".concat(t,".").concat(i[f]):"N/A";q.removed("".concat(t,".").concat(f),c)()}for(var p in o)if(p in r){var d=o[p];q.deprecated("".concat(t,".").concat(p),"".concat(t,".").concat(d))()}var v=null;for(var m in u)if(m in r){var g=u[m];q.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(g))(),v=v||Object.assign({},r),v[g]=r[m],delete v[m]}return v||r}var xC={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},TC={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},Xt=function(){function t(){var r=this;(0,ty.default)(this,t);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(a){return r._assign(a)}),Object.freeze(this)}return(0,ry.default)(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}},{key:"_assign",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Xa("Accessor",e,TC),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(e){var n=bn(e.type||5126);return n.BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(e){$(e.size);var n=bn(e.type||5126);return n.BYTES_PER_ELEMENT*e.size}},{key:"resolve",value:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0,ey.default)(t,[xC].concat(n))}}]),t}();function EC(t){var r=PC();return function(){var n=(0,mc.default)(t),i;if(r){var a=(0,mc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,uy.default)(this,i)}}function PC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ny=10,fy={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},SC={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:fy},OC={removedProps:fy},se=function(t,r){(0,sy.default)(n,t);var e=EC(n);function n(i){var a;(0,iy.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),a.target=o.target||(a.gl.webgl2?36662:34962),a.initialize(o),Object.seal((0,oy.default)(a)),a}return(0,ay.default)(n,[{key:r,get:function(){return"Buffer"}},{key:"getElementCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Xt.getBytesPerElement(a))}},{key:"getVertexCount",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Xt.getBytesPerVertex(a))}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(a)&&(a={data:a}),Number.isFinite(a)&&(a={byteLength:a}),a=Xa("Buffer",a,SC),this.usage=a.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},a,a.accessor)),a.data?this._setData(a.data,a.offset,a.byteLength):this._setByteLength(a.byteLength||0),this}},{key:"setProps",value:function(a){return a=Xa("Buffer",a,OC),"accessor"in a&&this.setAccessor(a.accessor),this}},{key:"setAccessor",value:function(a){return a=Object.assign({},a),delete a.buffer,this.accessor=new Xt(a),this}},{key:"reallocate",value:function(a){return a>this.byteLength?(this._setByteLength(a),!0):(this.bytesUsed=a,!1)}},{key:"setData",value:function(a){return this.initialize(a)}},{key:"subData",value:function(a){ArrayBuffer.isView(a)&&(a={data:a});var o=a,s=o.data,u=o.offset,f=u===void 0?0:u,l=o.srcOffset,c=l===void 0?0:l,p=a.byteLength||a.length;$(s);var d=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(d,this.handle),c!==0||p!==void 0?(De(this.gl),this.gl.bufferSubData(this.target,f,s,c,p)):this.gl.bufferSubData(d,f,s),this.gl.bindBuffer(d,null),this.debugData=null,this._inferType(s),this}},{key:"copyData",value:function(a){var o=a.sourceBuffer,s=a.readOffset,u=s===void 0?0:s,f=a.writeOffset,l=f===void 0?0:f,c=a.size,p=this.gl;return De(p),p.bindBuffer(36662,o.handle),p.bindBuffer(36663,this.handle),p.copyBufferSubData(36662,36663,u,l,c),p.bindBuffer(36662,null),p.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.dstData,s=o===void 0?null:o,u=a.srcByteOffset,f=u===void 0?0:u,l=a.dstOffset,c=l===void 0?0:l,p=a.length,d=p===void 0?0:p;De(this.gl);var v=bn(this.accessor.type||5126,{clamped:!1}),m=this._getAvailableElementCount(f),g=c,_,x;s?(x=s.length,_=x-g):(_=Math.min(m,d||m),x=g+_);var w=Math.min(m,_);return d=d||w,$(d<=w),s=s||new v(x),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,f,s,c,d),this.gl.bindBuffer(36662,null),s}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,f=u===void 0?this.accessor&&this.accessor.index:u,l=a.offset,c=l===void 0?0:l,p=a.size;return s===35345||s===35982?p!==void 0?this.gl.bindBufferRange(s,f,this.handle,c,p):($(c===0),this.gl.bindBufferBase(s,f,this.handle)):this.gl.bindBuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?this.target:o,u=a.index,f=u===void 0?this.accessor&&this.accessor.index:u,l=s===35345||s===35982;return l?this.gl.bindBufferBase(s,f,null):this.gl.bindBuffer(s,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(ny,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:a.byteLength+o;$(ArrayBuffer.isView(a)),this._trackDeallocatedMemory();var u=this._getTarget();this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,this.usage),this.gl.bufferSubData(u,o,a),this.gl.bindBuffer(u,null),this.debugData=a.slice(0,ny),this.bytesUsed=s,this._trackAllocatedMemory(s);var f=Ya(a);return $(f),this.setAccessor(new Xt(this.accessor,{type:f})),this}},{key:"_setByteLength",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;$(a>=0),this._trackDeallocatedMemory();var s=a;a===0&&(s=new Float32Array(0));var u=this._getTarget();return this.gl.bindBuffer(u,this.handle),this.gl.bufferData(u,s,o),this.gl.bindBuffer(u,null),this.usage=o,this.debugData=null,this.bytesUsed=a,this._trackAllocatedMemory(a),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(a){var o=bn(this.accessor.type||5126,{clamped:!1}),s=a/o.BYTES_PER_ELEMENT;return this.getElementCount()-s}},{key:"_inferType",value:function(a){this.accessor.type||this.setAccessor(new Xt(this.accessor,{type:Ya(a)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(a){this.gl.bindBuffer(this.target,this.handle);var o=this.gl.getBufferParameter(this.target,a);return this.gl.bindBuffer(this.target,null),o}},{key:"type",get:function(){return q.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return q.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(a){return q.deprecated("setByteLength","reallocate")(),this.reallocate(a)}},{key:"updateAccessor",value:function(a){return q.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Xt(this.accessor,a),this}}]),n}(lt,Symbol.toStringTag);var Pe=h(G());var fr,Et,Rr,Gs=(fr={},(0,Pe.default)(fr,6407,{dataFormat:6407,types:[5121,33635]}),(0,Pe.default)(fr,6408,{dataFormat:6408,types:[5121,32819,32820]}),(0,Pe.default)(fr,6406,{dataFormat:6406,types:[5121]}),(0,Pe.default)(fr,6409,{dataFormat:6409,types:[5121]}),(0,Pe.default)(fr,6410,{dataFormat:6410,types:[5121]}),(0,Pe.default)(fr,33326,{dataFormat:6403,types:[5126],gl2:!0}),(0,Pe.default)(fr,33328,{dataFormat:33319,types:[5126],gl2:!0}),(0,Pe.default)(fr,34837,{dataFormat:6407,types:[5126],gl2:!0}),(0,Pe.default)(fr,34836,{dataFormat:6408,types:[5126],gl2:!0}),fr),$s=(Et={},(0,Pe.default)(Et,6403,1),(0,Pe.default)(Et,36244,1),(0,Pe.default)(Et,33319,2),(0,Pe.default)(Et,33320,2),(0,Pe.default)(Et,6407,3),(0,Pe.default)(Et,36248,3),(0,Pe.default)(Et,6408,4),(0,Pe.default)(Et,36249,4),(0,Pe.default)(Et,6402,1),(0,Pe.default)(Et,34041,1),(0,Pe.default)(Et,6406,1),(0,Pe.default)(Et,6409,1),(0,Pe.default)(Et,6410,2),Et),Hs=(Rr={},(0,Pe.default)(Rr,5126,4),(0,Pe.default)(Rr,5125,4),(0,Pe.default)(Rr,5124,4),(0,Pe.default)(Rr,5123,2),(0,Pe.default)(Rr,5122,2),(0,Pe.default)(Rr,5131,2),(0,Pe.default)(Rr,5120,1),(0,Pe.default)(Rr,5121,1),Rr);function ly(t,r){var e=Gs[r];if(!e)return!1;if(e.gl1===void 0&&e.gl2===void 0)return!0;var n=te(t)&&e.gl2||e.gl1;return typeof n=="string"?t.getExtension(n):n}function cy(t,r){var e=Gs[r];switch(e&&e.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}function AC(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=MC(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function MC(t,r){if(t){if(typeof t=="string")return hy(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return hy(t,r)}}function hy(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function kC(t){var r=RC();return function(){var n=(0,gc.default)(t),i;if(r){var a=(0,gc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,yy.default)(this,i)}}function RC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var CC=[9729,9728],py=globalThis.WebGLBuffer||function(){},Dt=function(t,r){(0,gy.default)(n,t);var e=kC(n);function n(i,a){var o;(0,vy.default)(this,n);var s=a.id,u=s===void 0?Ae("texture"):s,f=a.handle,l=a.target;return o=e.call(this,i,{id:u,handle:f}),o.target=l,o.textureUnit=void 0,o.loaded=!1,o.width=void 0,o.height=void 0,o.depth=void 0,o.format=void 0,o.type=void 0,o.dataFormat=void 0,o.border=void 0,o.textureUnit=void 0,o.mipmaps=void 0,o}return(0,my.default)(n,[{key:r,get:function(){return"Texture"}},{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.data;if(s instanceof Promise)return s.then(function(Y){return a.initialize(Object.assign({},o,{pixels:Y,data:Y}))}),this;var u=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(u&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",function(){return a.initialize(o)}),this;var f=o.pixels,l=f===void 0?null:f,c=o.format,p=c===void 0?6408:c,d=o.border,v=d===void 0?0:d,m=o.recreate,g=m===void 0?!1:m,_=o.parameters,x=_===void 0?{}:_,w=o.pixelStore,E=w===void 0?{}:w,T=o.textureUnit,P=T===void 0?void 0:T;s||(s=l);var A=o.width,D=o.height,L=o.dataFormat,C=o.type,F=o.compressed,j=F===void 0?!1:F,z=o.mipmaps,N=z===void 0?!0:z,M=o.depth,k=M===void 0?0:M,R=this._deduceParameters({format:p,type:C,dataFormat:L,compressed:j,data:s,width:A,height:D});return A=R.width,D=R.height,j=R.compressed,L=R.dataFormat,C=R.type,this.width=A,this.height=D,this.depth=k,this.format=p,this.type=C,this.dataFormat=L,this.border=v,this.textureUnit=P,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),N&&this._isNPOT()&&(q.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),N=!1,this._updateForNPOT(x)),this.mipmaps=N,this.setImageData({data:s,width:A,height:D,depth:k,format:p,type:C,dataFormat:L,border:v,mipmaps:N,parameters:E,compressed:j}),N&&this.generateMipmap(),this.setParameters(x),g&&(this.data=s),u&&(this._video={video:s,parameters:x,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var a=this._video,o=a.video,s=a.parameters,u=a.lastTime;if(u===o.currentTime||o.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:o,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=o.currentTime}}},{key:"resize",value:function(a){var o=a.height,s=a.width,u=a.mipmaps,f=u===void 0?!1:u;return s!==this.width||o!==this.height?this.initialize({width:s,height:o,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:f}):this}},{key:"generateMipmap",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(q.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Re(this.gl,o,function(){a.gl.generateMipmap(a.target)}),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(a){this._trackDeallocatedMemory("Texture");var o=a.target,s=o===void 0?this.target:o,u=a.pixels,f=u===void 0?null:u,l=a.level,c=l===void 0?0:l,p=a.format,d=p===void 0?this.format:p,v=a.border,m=v===void 0?this.border:v,g=a.offset,_=g===void 0?0:g,x=a.parameters,w=x===void 0?{}:x,E=a.data,T=E===void 0?null:E,P=a.type,A=P===void 0?this.type:P,D=a.width,L=D===void 0?this.width:D,C=a.height,F=C===void 0?this.height:C,j=a.dataFormat,z=j===void 0?this.dataFormat:j,N=a.compressed,M=N===void 0?!1:N;T||(T=f);var k=this._deduceParameters({format:d,type:A,dataFormat:z,compressed:M,data:T,width:L,height:F});A=k.type,z=k.dataFormat,M=k.compressed,L=k.width,F=k.height;var R=this.gl;R.bindTexture(this.target,this.handle);var Y=null,V=this._getDataType({data:T,compressed:M});T=V.data,Y=V.dataType;var Q,J=0;if(Re(this.gl,w,function(){switch(Y){case"null":R.texImage2D(s,c,d,L,F,m,z,A,T);break;case"typed-array":R.texImage2D(s,c,d,L,F,m,z,A,T,_);break;case"buffer":Q=De(R),Q.bindBuffer(35052,T.handle||T),Q.texImage2D(s,c,d,L,F,m,z,A,_),Q.bindBuffer(35052,null);break;case"browser-object":te(R)?R.texImage2D(s,c,d,L,F,m,z,A,T):R.texImage2D(s,c,d,z,A,T);break;case"compressed":var ue=AC(T.entries()),Oe;try{for(ue.s();!(Oe=ue.n()).done;){var ee=(0,dy.default)(Oe.value,2),Ee=ee[0],de=ee[1];R.compressedTexImage2D(s,Ee,de.format,de.width,de.height,m,de.data),J+=de.levelSize}}catch(Qe){ue.e(Qe)}finally{ue.f()}break;default:$(!1,"Unknown image data type")}}),Y==="compressed")this._trackAllocatedMemory(J,"Texture");else if(T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{var re=$s[this.dataFormat]||4,oe=Hs[this.type]||1;this._trackAllocatedMemory(this.width*this.height*re*oe,"Texture")}return this.loaded=!0,this}},{key:"setSubImageData",value:function(a){var o=this,s=a.target,u=s===void 0?this.target:s,f=a.pixels,l=f===void 0?null:f,c=a.data,p=c===void 0?null:c,d=a.x,v=d===void 0?0:d,m=a.y,g=m===void 0?0:m,_=a.width,x=_===void 0?this.width:_,w=a.height,E=w===void 0?this.height:w,T=a.level,P=T===void 0?0:T,A=a.format,D=A===void 0?this.format:A,L=a.type,C=L===void 0?this.type:L,F=a.dataFormat,j=F===void 0?this.dataFormat:F,z=a.compressed,N=z===void 0?!1:z,M=a.offset,k=M===void 0?0:M,R=a.border,Y=R===void 0?this.border:R,V=a.parameters,Q=V===void 0?{}:V,J=this._deduceParameters({format:D,type:C,dataFormat:j,compressed:N,data:p,width:x,height:E});if(C=J.type,j=J.dataFormat,N=J.compressed,x=J.width,E=J.height,$(this.depth===0,"texSubImage not supported for 3D textures"),p||(p=l),p&&p.data){var re=p;p=re.data,x=re.shape[0],E=re.shape[1]}p instanceof se&&(p=p.handle),this.gl.bindTexture(this.target,this.handle),Re(this.gl,Q,function(){if(N)o.gl.compressedTexSubImage2D(u,P,v,g,x,E,D,p);else if(p===null)o.gl.texSubImage2D(u,P,v,g,x,E,j,C,null);else if(ArrayBuffer.isView(p))o.gl.texSubImage2D(u,P,v,g,x,E,j,C,p,k);else if(p instanceof py){var oe=De(o.gl);oe.bindBuffer(35052,p),oe.texSubImage2D(u,P,v,g,x,E,j,C,k),oe.bindBuffer(35052,null)}else if(te(o.gl)){var ue=De(o.gl);ue.texSubImage2D(u,P,v,g,x,E,j,C,p)}else o.gl.texSubImage2D(u,P,v,g,j,C,p)}),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,this.handle),a}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit,o=this.gl;return a!==void 0&&(this.textureUnit=a,o.activeTexture(33984+a)),o.bindTexture(this.target,null),a}},{key:"_getDataType",value:function(a){var o=a.data,s=a.compressed,u=s===void 0?!1:s;return u?{data:o,dataType:"compressed"}:o===null?{data:o,dataType:"null"}:ArrayBuffer.isView(o)?{data:o,dataType:"typed-array"}:o instanceof se?{data:o.handle,dataType:"buffer"}:o instanceof py?{data:o,dataType:"buffer"}:{data:o,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(a){var o=a.format,s=a.data,u=a.width,f=a.height,l=a.dataFormat,c=a.type,p=a.compressed,d=Gs[o];l=l||d&&d.dataFormat,c=c||d&&d.types[0],p=p||d&&d.compressed;var v=this._deduceImageSize(s,u,f);return u=v.width,f=v.height,{dataFormat:l,type:c,compressed:p,width:u,height:f,format:o,data:s}}},{key:"_deduceImageSize",value:function(a,o,s){var u;return typeof ImageData<"u"&&a instanceof ImageData?u={width:a.width,height:a.height}:typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement?u={width:a.naturalWidth,height:a.naturalHeight}:typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement?u={width:a.width,height:a.height}:typeof ImageBitmap<"u"&&a instanceof ImageBitmap?u={width:a.width,height:a.height}:typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement?u={width:a.videoWidth,height:a.videoHeight}:a?u={width:o,height:s}:u={width:o>=0?o:1,height:s>=0?s:1},$(u,"Could not deduced texture size"),$(o===void 0||u.width===o,"Deduced texture width does not match supplied width"),$(s===void 0||u.height===s,"Deduced texture height does not match supplied height"),u}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(a){switch(a){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var o=this.gl.getTexParameter(this.target,a);return this.gl.bindTexture(this.target,null),o}}},{key:"_setParameter",value:function(a,o){switch(this.gl.bindTexture(this.target,this.handle),o=this._getNPOTParam(a,o),a){case 33082:case 33083:this.gl.texParameterf(this.handle,a,o);break;case 4096:case 4097:$(!1);break;default:this.gl.texParameteri(this.target,a,o);break}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return te(this.gl)||!this.width||!this.height?!1:!vc(this.width)||!vc(this.height)}},{key:"_updateForNPOT",value:function(a){a[this.gl.TEXTURE_MIN_FILTER]===void 0&&(a[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),a[this.gl.TEXTURE_WRAP_S]===void 0&&(a[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),a[this.gl.TEXTURE_WRAP_T]===void 0&&(a[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(a,o){if(this._isNPOT())switch(a){case 10241:CC.indexOf(o)===-1&&(o=9729);break;case 10242:case 10243:o!==33071&&(o=33071);break;default:break}return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.format,u=o.linearFiltering,f=!0;return s&&(f=f&&ly(a,s),f=f&&(!u||cy(a,s))),f}}]),n}(lt,Symbol.toStringTag);var IC="";function _y(t,r){return $(typeof t=="string"),t=IC+t,new Promise(function(e,n){try{var i=new Image;i.onload=function(){return e(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=r&&r.crossOrigin||"anonymous",i.src=t}catch(a){n(a)}})}function LC(t){var r=DC();return function(){var n=(0,yc.default)(t),i;if(r){var a=(0,yc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Ey.default)(this,i)}}function DC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ge=function(t,r){(0,Ty.default)(n,t);var e=LC(n);function n(i){var a;(0,by.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qr(i),(o instanceof Promise||typeof o=="string")&&(o={data:o}),typeof o.data=="string"&&(o=Object.assign({},o,{data:_y(o.data)})),a=e.call(this,i,Object.assign({},o,{target:3553})),a.initialize(o),Object.seal((0,xy.default)(a)),a}return(0,wy.default)(n,[{key:r,get:function(){return"Texture2D"}}],[{key:"isSupported",value:function(a,o){return Dt.isSupported(a,o)}}]),n}(Dt,Symbol.toStringTag);var ky=h(dt()),Ry=h(B()),Cy=h(U()),Iy=h(we()),Ly=h(ie()),Dy=h(ae()),bc=h(ne()),wc=h(et());function FC(t){var r=NC();return function(){var n=(0,bc.default)(t),i;if(r){var a=(0,bc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Dy.default)(this,i)}}function NC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xc=[34069,34070,34071,34072,34073,34074],Qn=function(t,r){(0,Ly.default)(n,t);var e=FC(n);function n(i){var a;(0,Ry.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qr(i),a=e.call(this,i,Object.assign({},o,{target:34067})),a.initialize(o),Object.seal((0,Iy.default)(a)),a}return(0,Cy.default)(n,[{key:r,get:function(){return"TextureCube"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.mipmaps,u=s===void 0?!0:s,f=o.parameters,l=f===void 0?{}:f;return this.opts=o,this.setCubeMapImageData(o).then(function(){a.loaded=!0,u&&a.generateMipmap(o),a.setParameters(l)}),this}},{key:"subImage",value:function(a){var o=a.face,s=a.data,u=a.x,f=u===void 0?0:u,l=a.y,c=l===void 0?0:l,p=a.mipmapLevel,d=p===void 0?0:p;return this._subImage({target:o,data:s,x:f,y:c,mipmapLevel:d})}},{key:"setCubeMapImageData",value:function(){var i=(0,ky.default)(wc.default.mark(function o(s){var u=this,f,l,c,p,d,v,m,g,_,x,w,E,T;return wc.default.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return f=s.width,l=s.height,c=s.pixels,p=s.data,d=s.border,v=d===void 0?0:d,m=s.format,g=m===void 0?6408:m,_=s.type,x=_===void 0?5121:_,w=this.gl,E=c||p,A.next=5,Promise.all(xc.map(function(D){var L=E[D];return Promise.all(Array.isArray(L)?L:[L])}));case 5:T=A.sent,this.bind(),xc.forEach(function(D,L){T[L].length>1&&u.opts.mipmaps!==!1&&q.warn("".concat(u.id," has mipmap and multiple LODs."))(),T[L].forEach(function(C,F){f&&l?w.texImage2D(D,F,g,f,l,v,g,x,C):w.texImage2D(D,F,g,g,x,C)})}),this.unbind();case 9:case"end":return A.stop()}},o,this)}));function a(o){return i.apply(this,arguments)}return a}()},{key:"setImageDataForFace",value:function(a){var o=this,s=a.face,u=a.width,f=a.height,l=a.pixels,c=a.data,p=a.border,d=p===void 0?0:p,v=a.format,m=v===void 0?6408:v,g=a.type,_=g===void 0?5121:g,x=this.gl,w=l||c;return this.bind(),w instanceof Promise?w.then(function(E){return o.setImageDataForFace(Object.assign({},a,{face:s,data:E,pixels:E}))}):this.width||this.height?x.texImage2D(s,0,m,u,f,d,m,_,w):x.texImage2D(s,0,m,m,_,w),this}}]),n}(Dt,Symbol.toStringTag);Qn.FACES=xc;var jy=h(B()),Fy=h(U()),Ny=h(we()),By=h(ie()),Vy=h(ae()),Tc=h(ne());function BC(t){var r=VC();return function(){var n=(0,Tc.default)(t),i;if(r){var a=(0,Tc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Vy.default)(this,i)}}function VC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zi=function(t,r){(0,By.default)(n,t);var e=BC(n);function n(i){var a;(0,jy.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return De(i),o=Object.assign({depth:1},o,{target:32879,unpackFlipY:!1}),a=e.call(this,i,o),a.initialize(o),Object.seal((0,Ny.default)(a)),a}return(0,Fy.default)(n,[{key:r,get:function(){return"Texture3D"}},{key:"setImageData",value:function(a){var o=this,s=a.level,u=s===void 0?0:s,f=a.dataFormat,l=f===void 0?6408:f,c=a.width,p=a.height,d=a.depth,v=d===void 0?1:d,m=a.border,g=m===void 0?0:m,_=a.format,x=a.type,w=x===void 0?5121:x,E=a.offset,T=E===void 0?0:E,P=a.data,A=a.parameters,D=A===void 0?{}:A;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Re(this.gl,D,function(){ArrayBuffer.isView(P)&&o.gl.texImage3D(o.target,u,l,c,p,v,g,_,w,P),P instanceof se&&(o.gl.bindBuffer(35052,P.handle),o.gl.texImage3D(o.target,u,l,c,p,v,g,_,w,T))}),P&&P.byteLength)this._trackAllocatedMemory(P.byteLength,"Texture");else{var L=$s[this.dataFormat]||4,C=Hs[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*L*C,"Texture")}return this.loaded=!0,this}}],[{key:"isSupported",value:function(a){return te(a)}}]),n}(Dt,Symbol.toStringTag);var Za=h(G()),s0=h(Ue()),u0=h(B()),f0=h(U()),l0=h(we()),c0=h(kt()),h0=h(ie()),p0=h(ae()),Qs=h(ne());var Gy=h(B()),$y=h(U()),Hy=h(we()),Wy=h(ie()),Yy=h(ae()),Pc=h(ne());var pe=h(G()),ce,Jn="EXT_color_buffer_float",Ec=(ce={},(0,pe.default)(ce,33189,{bpp:2}),(0,pe.default)(ce,33190,{gl2:!0,bpp:3}),(0,pe.default)(ce,36012,{gl2:!0,bpp:4}),(0,pe.default)(ce,36168,{bpp:1}),(0,pe.default)(ce,34041,{bpp:4}),(0,pe.default)(ce,35056,{gl2:!0,bpp:4}),(0,pe.default)(ce,36013,{gl2:!0,bpp:5}),(0,pe.default)(ce,32854,{bpp:2}),(0,pe.default)(ce,36194,{bpp:2}),(0,pe.default)(ce,32855,{bpp:2}),(0,pe.default)(ce,33321,{gl2:!0,bpp:1}),(0,pe.default)(ce,33330,{gl2:!0,bpp:1}),(0,pe.default)(ce,33329,{gl2:!0,bpp:1}),(0,pe.default)(ce,33332,{gl2:!0,bpp:2}),(0,pe.default)(ce,33331,{gl2:!0,bpp:2}),(0,pe.default)(ce,33334,{gl2:!0,bpp:4}),(0,pe.default)(ce,33333,{gl2:!0,bpp:4}),(0,pe.default)(ce,33323,{gl2:!0,bpp:2}),(0,pe.default)(ce,33336,{gl2:!0,bpp:2}),(0,pe.default)(ce,33335,{gl2:!0,bpp:2}),(0,pe.default)(ce,33338,{gl2:!0,bpp:4}),(0,pe.default)(ce,33337,{gl2:!0,bpp:4}),(0,pe.default)(ce,33340,{gl2:!0,bpp:8}),(0,pe.default)(ce,33339,{gl2:!0,bpp:8}),(0,pe.default)(ce,32849,{gl2:!0,bpp:3}),(0,pe.default)(ce,32856,{gl2:!0,bpp:4}),(0,pe.default)(ce,32857,{gl2:!0,bpp:4}),(0,pe.default)(ce,36220,{gl2:!0,bpp:4}),(0,pe.default)(ce,36238,{gl2:!0,bpp:4}),(0,pe.default)(ce,36975,{gl2:!0,bpp:4}),(0,pe.default)(ce,36214,{gl2:!0,bpp:8}),(0,pe.default)(ce,36232,{gl2:!0,bpp:8}),(0,pe.default)(ce,36226,{gl2:!0,bpp:16}),(0,pe.default)(ce,36208,{gl2:!0,bpp:16}),(0,pe.default)(ce,33325,{gl2:Jn,bpp:2}),(0,pe.default)(ce,33327,{gl2:Jn,bpp:4}),(0,pe.default)(ce,34842,{gl2:Jn,bpp:8}),(0,pe.default)(ce,33326,{gl2:Jn,bpp:4}),(0,pe.default)(ce,33328,{gl2:Jn,bpp:8}),(0,pe.default)(ce,34836,{gl2:Jn,bpp:16}),(0,pe.default)(ce,35898,{gl2:Jn,bpp:4}),ce);function $C(t){var r=HC();return function(){var n=(0,Pc.default)(t),i;if(r){var a=(0,Pc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Yy.default)(this,i)}}function HC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function WC(t,r,e){var n=e[r];if(!n)return!1;var i=te(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}var jt=function(t,r){(0,Wy.default)(n,t);var e=$C(n);function n(i){var a;(0,Gy.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.initialize(o),Object.seal((0,Hy.default)(a)),a}return(0,$y.default)(n,[{key:r,get:function(){return"Renderbuffer"}},{key:"initialize",value:function(a){var o=a.format,s=a.width,u=s===void 0?1:s,f=a.height,l=f===void 0?1:f,c=a.samples,p=c===void 0?0:c;return $(o,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),p!==0&&te(this.gl)?this.gl.renderbufferStorageMultisample(36161,p,o,u,l):this.gl.renderbufferStorage(36161,o,u,l),this.format=o,this.width=u,this.height=l,this.samples=p,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ec[this.format].bpp),this}},{key:"resize",value:function(a){var o=a.width,s=a.height;return o!==this.width||s!==this.height?this.initialize({width:o,height:s,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(a){this.gl.bindRenderbuffer(36161,a)}},{key:"_syncHandle",value:function(a){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(a){this.gl.bindRenderbuffer(36161,this.handle);var o=this.gl.getRenderbufferParameter(36161,a);return o}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null},s=o.format;return!s||WC(a,s,Ec)}},{key:"getSamplesForFormat",value:function(a,o){var s=o.format;return a.getInternalformatParameter(36161,s,32937)}}]),n}(lt,Symbol.toStringTag);var Qy=h(Ue());var YC=256,XC=1024,qC=16384,Xy=6144,qy=6145,Zy=6146,Ky=34041,Jy="clear: bad arguments";function Cr(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.color,a=i===void 0?null:i,o=r.depth,s=o===void 0?null:o,u=r.stencil,f=u===void 0?null:u,l={};n&&(l.framebuffer=n);var c=0;a&&(c|=qC,a!==!0&&(l.clearColor=a)),s&&(c|=YC,s!==!0&&(l.clearDepth=s)),f&&(c|=XC,s!==!0&&(l.clearStencil=s)),$(c!==0,Jy),Re(t,l,function(){t.clear(c)})}function Sc(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.framebuffer,n=e===void 0?null:e,i=r.buffer,a=i===void 0?Xy:i,o=r.drawBuffer,s=o===void 0?0:o,u=r.value,f=u===void 0?[0,0,0,0]:u;De(t),Re(t,{framebuffer:n},function(){switch(a){case Xy:switch(f.constructor){case Int32Array:t.clearBufferiv(a,s,f);break;case Uint32Array:t.clearBufferuiv(a,s,f);break;case Float32Array:default:t.clearBufferfv(a,s,f)}break;case qy:t.clearBufferfv(qy,0,[f]);break;case Zy:t.clearBufferiv(Zy,0,[f]);break;case Ky:var l=(0,Qy.default)(f,2),c=l[0],p=l[1];t.clearBufferfi(Ky,0,c,p);break;default:$(!1,Jy)}})}function Oc(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return $(!1),0}}function e0(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return $(!1),0}}function en(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.sourceAttachment,f=u===void 0?36064:u,l=r.target,c=l===void 0?null:l,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Ac(t),g=m.framebuffer,_=m.deleteFramebuffer;$(g);var x=g.gl,w=g.handle,E=g.attachments;p=p||g.width,d=d||g.height,f===36064&&w===null&&(f=1028),$(E[f]),v=v||E[f].type,c=ZC(c,v,s,p,d),v=v||Ya(c);var T=x.bindFramebuffer(36160,w);return x.readPixels(n,a,p,d,s,v,c),x.bindFramebuffer(36160,T||null),_&&g.delete(),c}function Xs(t,r){var e=r.sourceX,n=e===void 0?0:e,i=r.sourceY,a=i===void 0?0:i,o=r.sourceFormat,s=o===void 0?6408:o,u=r.target,f=u===void 0?null:u,l=r.targetByteOffset,c=l===void 0?0:l,p=r.sourceWidth,d=r.sourceHeight,v=r.sourceType,m=Ac(t),g=m.framebuffer,_=m.deleteFramebuffer;$(g),p=p||g.width,d=d||g.height;var x=De(g.gl);if(v=v||(f?f.type:5121),!f){var w=Oc(s),E=e0(v),T=c+p*d*w*E;f=new se(x,{byteLength:T,accessor:{type:v,size:w}})}return f.bind({target:35051}),Re(x,{framebuffer:g},function(){x.readPixels(n,a,p,d,s,v,c)}),f.unbind({target:35051}),_&&g.delete(),f}function qs(t){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.sourceAttachment,n=e===void 0?36064:e,i=r.targetMaxHeight,a=i===void 0?Number.MAX_SAFE_INTEGER:i,o=en(t,{sourceAttachment:n}),s=t.width,u=t.height;u>a;){var f=Jg({data:o,width:s,height:u});o=f.data,s=f.width,u=f.height}Qg({data:o,width:s,height:u});var l=document.createElement("canvas");l.width=s,l.height=u;var c=l.getContext("2d"),p=c.createImageData(s,u);return p.data.set(o),c.putImageData(p,0,0),l.toDataURL()}function Zs(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=e.sourceX,i=n===void 0?0:n,a=e.sourceY,o=a===void 0?0:a,s=e.targetMipmaplevel,u=s===void 0?0:s,f=e.targetInternalFormat,l=f===void 0?6408:f,c=e.targetX,p=e.targetY,d=e.targetZ,v=e.width,m=e.height,g=Ac(t),_=g.framebuffer,x=g.deleteFramebuffer;$(_);var w=_.gl,E=_.handle,T=typeof c<"u"||typeof p<"u"||typeof d<"u";c=c||0,p=p||0,d=d||0;var P=w.bindFramebuffer(36160,E);$(r);var A=null;if(r instanceof Dt&&(A=r,v=Number.isFinite(v)?v:A.width,m=Number.isFinite(m)?m:A.height,A.bind(0),r=A.target),!T)w.copyTexImage2D(r,u,l,i,o,v,m,0);else switch(r){case 3553:case 34067:w.copyTexSubImage2D(r,u,c,p,i,o,v,m);break;case 35866:case 32879:var D=De(w);D.copyTexSubImage3D(r,u,c,p,d,i,o,v,m);break;default:}return A&&A.unbind(),w.bindFramebuffer(36160,P||null),x&&_.delete(),A}function Ac(t){return t instanceof xe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:t0(t),deleteFramebuffer:!0}}function ZC(t,r,e,n,i){if(t)return t;r=r||5121;var a=bn(r,{clamped:!1}),o=Oc(e);return new a(n*i*o)}var He=h(G());var $e,Se={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function KC(t){var r=new Ge(t,{format:6408,type:5126,dataFormat:6408}),e=new xe(t,{id:"test-framebuffer",check:!1,attachments:(0,He.default)({},36064,r)}),n=e.getStatus();return r.delete(),e.delete(),n===36053}var Mc=($e={},(0,He.default)($e,Se.WEBGL2,[!1,!0]),(0,He.default)($e,Se.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),(0,He.default)($e,Se.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),(0,He.default)($e,Se.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),(0,He.default)($e,Se.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),(0,He.default)($e,Se.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),(0,He.default)($e,Se.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),(0,He.default)($e,Se.FLOAT_BLEND,["EXT_float_blend"]),(0,He.default)($e,Se.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),(0,He.default)($e,Se.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),(0,He.default)($e,Se.TEXTURE_FLOAT,["OES_texture_float",!0]),(0,He.default)($e,Se.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),(0,He.default)($e,Se.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),(0,He.default)($e,Se.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),(0,He.default)($e,Se.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),(0,He.default)($e,Se.COLOR_ATTACHMENT_RGBA32F,[KC,"EXT_color_buffer_float"]),(0,He.default)($e,Se.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),(0,He.default)($e,Se.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),(0,He.default)($e,Se.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),(0,He.default)($e,Se.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),(0,He.default)($e,Se.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),(0,He.default)($e,Se.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),$e);function QC(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=JC(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function JC(t,r){if(t){if(typeof t=="string")return r0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return r0(t,r)}}function r0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var eI=2;function qa(t,r){return wn(t,r)}function wn(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return n0(t,e)})}function Ks(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(var r in Mc)t.luma.caps[r]===void 0&&(t.luma.caps[r]=n0(t,r));return t.luma.caps}function n0(t,r){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[r]===void 0&&(t.luma.caps[r]=tI(t,r)),t.luma.caps[r]||q.log(eI,"Feature: ".concat(r," not supported"))(),t.luma.caps[r]}function tI(t,r){var e=Mc[r];$(e,r);var n,i=te(t)&&e[1]||e[0];if(typeof i=="function")n=i(t);else if(Array.isArray(i)){n=!0;var a=QC(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=n&&Boolean(t.getExtension(s))}}catch(u){a.e(u)}finally{a.f()}}else typeof i=="string"?n=Boolean(t.getExtension(i)):typeof i=="boolean"?n=i:$(!1);return n}function i0(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rI(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rI(t,r){if(t){if(typeof t=="string")return a0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return a0(t,r)}}function a0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function nI(t){var r=iI();return function(){var n=(0,Qs.default)(t),i;if(r){var a=(0,Qs.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p0.default)(this,i)}}function iI(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var o0="Multiple render targets not supported",xe=function(t,r){(0,h0.default)(n,t);var e=nI(n);function n(i){var a;(0,u0.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.width=null,a.height=null,a.attachments={},a.readBuffer=36064,a.drawBuffers=[36064],a.ownResources=[],a.initialize(o),Object.seal((0,l0.default)(a)),a}return(0,f0.default)(n,[{key:r,get:function(){return"Framebuffer"}},{key:"MAX_COLOR_ATTACHMENTS",get:function(){var a=De(this.gl);return a.getParameter(a.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var a=De(this.gl);return a.getParameter(a.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(a){var o=a.width,s=o===void 0?1:o,u=a.height,f=u===void 0?1:u,l=a.attachments,c=l===void 0?null:l,p=a.color,d=p===void 0?!0:p,v=a.depth,m=v===void 0?!0:v,g=a.stencil,_=g===void 0?!1:g,x=a.check,w=x===void 0?!0:x,E=a.readBuffer,T=E===void 0?void 0:E,P=a.drawBuffers,A=P===void 0?void 0:P;if($(s>=0&&f>=0,"Width and height need to be integers"),this.width=s,this.height=f,c)for(var D in c){var L=c[D],C=Array.isArray(L)?L[0]:L;C.resize({width:s,height:f})}else c=this._createDefaultAttachments(d,m,_,s,f);this.update({clearAttachments:!0,attachments:c,readBuffer:T,drawBuffers:A}),c&&w&&this.checkStatus()}},{key:"delete",value:function(){var a=i0(this.ownResources),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(u){a.e(u)}finally{a.f()}return(0,c0.default)((0,Qs.default)(n.prototype),"delete",this).call(this),this}},{key:"update",value:function(a){var o=a.attachments,s=o===void 0?{}:o,u=a.readBuffer,f=a.drawBuffers,l=a.clearAttachments,c=l===void 0?!1:l,p=a.resizeAttachments,d=p===void 0?!0:p;this.attach(s,{clearAttachments:c,resizeAttachments:d});var v=this.gl,m=v.bindFramebuffer(36160,this.handle);return u&&this._setReadBuffer(u),f&&this._setDrawBuffers(f),v.bindFramebuffer(36160,m||null),this}},{key:"resize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.width,s=a.height;if(this.handle===null)return $(o===void 0&&s===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;o===void 0&&(o=this.gl.drawingBufferWidth),s===void 0&&(s=this.gl.drawingBufferHeight),o!==this.width&&s!==this.height&&q.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(o,"x").concat(s))();for(var u in this.attachments)this.attachments[u].resize({width:o,height:s});return this.width=o,this.height=s,this}},{key:"attach",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=s.clearAttachments,f=u===void 0?!1:u,l=s.resizeAttachments,c=l===void 0?!0:l,p={};f&&Object.keys(this.attachments).forEach(function(D){p[D]=null}),Object.assign(p,a);var d=this.gl.bindFramebuffer(36160,this.handle);for(var v in p){$(v!==void 0,"Misspelled framebuffer binding point?");var m=Number(v),g=p[m],_=g;if(!_)this._unattach(m);else if(_ instanceof jt)this._attachRenderbuffer({attachment:m,renderbuffer:_});else if(Array.isArray(g)){var x=(0,s0.default)(g,3),w=x[0],E=x[1],T=E===void 0?0:E,P=x[2],A=P===void 0?0:P;_=w,this._attachTexture({attachment:m,texture:w,layer:T,level:A})}else this._attachTexture({attachment:m,texture:_,layer:0,level:0});c&&_&&_.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,d||null),Object.assign(this.attachments,a),Object.keys(this.attachments).filter(function(D){return!o.attachments[D]}).forEach(function(D){delete o.attachments[D]})}},{key:"checkStatus",value:function(){var a=this.gl,o=this.getStatus();if(o!==36053)throw new Error(oI(o));return this}},{key:"getStatus",value:function(){var a=this.gl,o=a.bindFramebuffer(36160,this.handle),s=a.checkFramebufferStatus(36160);return a.bindFramebuffer(36160,o||null),s}},{key:"clear",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=o.color,u=o.depth,f=o.stencil,l=o.drawBuffers,c=l===void 0?[]:l,p=this.gl.bindFramebuffer(36160,this.handle);return(s||u||f)&&Cr(this.gl,{color:s,depth:u,stencil:f}),c.forEach(function(d,v){Sc(a.gl,{drawBuffer:v,value:d})}),this.gl.bindFramebuffer(36160,p||null),this}},{key:"readPixels",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(a){var o=a.attachments,s=o===void 0?[]:o,u=a.x,f=u===void 0?0:u,l=a.y,c=l===void 0?0:l,p=a.width,d=a.height,v=De(this.gl),m=v.bindFramebuffer(36008,this.handle),g=f===0&&c===0&&p===void 0&&d===void 0;return g?v.invalidateFramebuffer(36008,s):v.invalidateFramebuffer(36008,s,f,c,p,d),v.bindFramebuffer(36008,m),this}},{key:"getAttachmentParameter",value:function(a,o,s){var u=this._getAttachmentParameterFallback(o);return u===null&&(this.gl.bindFramebuffer(36160,this.handle),u=this.gl.getFramebufferAttachmentParameter(36160,a,o),this.gl.bindFramebuffer(36160,null)),s&&u>1e3&&(u=Yt(this.gl,u)),u}},{key:"getAttachmentParameters",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,o=arguments.length>1?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[],u={},f=i0(s),l;try{for(f.s();!(l=f.n()).done;){var c=l.value,p=o?Yt(this.gl,c):c;u[p]=this.getAttachmentParameter(a,c,o)}}catch(d){f.e(d)}finally{f.f()}return u}},{key:"getParameters",value:function(){for(var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,o=Object.keys(this.attachments),s={},u=0,f=o;u<f.length;u++){var l=f[u],c=Number(l),p=a?Yt(this.gl,c):c;s[p]=this.getAttachmentParameters(c,a)}return s}},{key:"show",value:function(){return typeof window<"u"&&window.open(qs(this),"luma-debug-texture"),this}},{key:"log",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(a>q.level||typeof window>"u")return this;o=o||"Framebuffer ".concat(this.id);var s=qs(this,{targetMaxHeight:100});return q.image({logLevel:a,message:o,image:s},o)(),this}},{key:"bind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,this.handle),this}},{key:"unbind",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.target,s=o===void 0?36160:o;return this.gl.bindFramebuffer(s,null),this}},{key:"_createDefaultAttachments",value:function(a,o,s,u,f){var l=null;if(a){var c;l=l||{},l[36064]=new Ge(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:u,height:f,mipmaps:!1,parameters:(c={},(0,Za.default)(c,10241,9729),(0,Za.default)(c,10240,9729),(0,Za.default)(c,10242,33071),(0,Za.default)(c,10243,33071),c)}),this.ownResources.push(l[36064])}return o&&s?(l=l||{},l[33306]=new jt(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:u,height:111}),this.ownResources.push(l[33306])):o?(l=l||{},l[36096]=new jt(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:u,height:f}),this.ownResources.push(l[36096])):s&&$(!1),l}},{key:"_unattach",value:function(a){var o=this.attachments[a];o&&(o instanceof jt?this.gl.framebufferRenderbuffer(36160,a,36161,null):this.gl.framebufferTexture2D(36160,a,3553,null,0),delete this.attachments[a])}},{key:"_attachRenderbuffer",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.renderbuffer,f=this.gl;f.framebufferRenderbuffer(36160,s,36161,u.handle),this.attachments[s]=u}},{key:"_attachTexture",value:function(a){var o=a.attachment,s=o===void 0?36064:o,u=a.texture,f=a.layer,l=a.level,c=this.gl;switch(c.bindTexture(u.target,u.handle),u.target){case 35866:case 32879:var p=De(c);p.framebufferTextureLayer(36160,s,u.target,l,f);break;case 34067:var d=aI(f);c.framebufferTexture2D(36160,s,d,u.handle,l);break;case 3553:c.framebufferTexture2D(36160,s,3553,u.handle,l);break;default:$(!1,"Illegal texture type")}c.bindTexture(u.target,null),this.attachments[s]=u}},{key:"_setReadBuffer",value:function(a){var o=Ql(this.gl);o?o.readBuffer(a):$(a===36064||a===1029,o0),this.readBuffer=a}},{key:"_setDrawBuffers",value:function(a){var o=this.gl,s=De(o);if(s)s.drawBuffers(a);else{var u=o.getExtension("WEBGL_draw_buffers");u?u.drawBuffersWEBGL(a):$(a.length===1&&(a[0]===36064||a[0]===1029),o0)}this.drawBuffers=a}},{key:"_getAttachmentParameterFallback",value:function(a){var o=Ks(this.gl);switch(a){case 36052:return o.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return o.WEBGL2?null:8;case 33297:return o.WEBGL2?null:5125;case 33296:return!o.WEBGL2&&!o.EXT_sRGB?9729:null;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(a){return this.gl.bindFramebuffer(36160,a)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.colorBufferFloat,u=o.colorBufferHalfFloat,f=!0;return s&&(f=Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("WEBGL_color_buffer_float")||a.getExtension("OES_texture_float"))),u&&(f=f&&Boolean(a.getExtension("EXT_color_buffer_float")||a.getExtension("EXT_color_buffer_half_float"))),f}},{key:"getDefaultFramebuffer",value:function(a){return a.luma=a.luma||{},a.luma.defaultFramebuffer=a.luma.defaultFramebuffer||new n(a,{id:"default-framebuffer",handle:null,attachments:{}}),a.luma.defaultFramebuffer}}]),n}(lt,Symbol.toStringTag);function aI(t){return t<34069?t+34069:t}function oI(t){var r=xe.STATUS||{};return r[t]||"Framebuffer error ".concat(t)}var sI=[36049,36048,33296,33298,33299,33300,33301,33302,33303];xe.ATTACHMENT_PARAMETERS=sI;function Ui(t,r){$(t instanceof Ge||t instanceof Qn||t instanceof zi);var e=t.constructor,n=t.gl,i=t.width,a=t.height,o=t.format,s=t.type,u=t.dataFormat,f=t.border,l=t.mipmaps,c=Object.assign({width:i,height:a,format:o,type:s,dataFormat:u,border:f,mipmaps:l},r);return new e(n,c)}function t0(t,r){var e=t.gl,n=t.width,i=t.height,a=t.id,o=new xe(e,Object.assign({},r,{id:"framebuffer-for-".concat(a),width:n,height:i,attachments:(0,d0.default)({},36064,t)}));return o}var Js=h(B()),eu=h(U()),tu=h(ie()),g0=h(ae()),Cc=h(ne());function xn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed",e=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,n=t.match(e);return n?n[1]:r}var uI=35632,fI=35633;function kc(t){switch(t){case uI:return"fragment";case fI:return"vertex";default:return"unknown type"}}function Rc(t,r,e,n){for(var i=t.split(/\r?\n/),a={},o={},s=n||xn(r)||"(unnamed)",u="".concat(kc(e)," shader ").concat(s),f=0;f<i.length;f++){var l=i[f];if(!(l.length<=1)){var c=l.split(":"),p=c[0],d=parseInt(c[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));p!=="WARNING"?a[d]=l:o[d]=l}}var v=lI(r);return{shaderName:u,errors:v0(a,v),warnings:v0(o,v)}}function v0(t,r){for(var e="",n=0;n<r.length;n++){var i=r[n];if(!(!t[n+3]&&!t[n+2]&&!t[n+1])&&(e+="".concat(i,`
`),t[n+1])){var a=t[n+1],o=a.split(":",3),s=o[0],u=parseInt(o[1],10)||0,f=a.substring(o.join(":").length+1).trim();e+=m0("^^^ ".concat(s,": ").concat(f,`

`),u)}}return e}function lI(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ",n=t.split(/\r?\n/),i=String(n.length+r-1).length;return n.map(function(a,o){var s=String(o+r),u=s.length,f=m0(s,i-u);return f+e+a})}function m0(t,r){for(var e="",n=0;n<r;++n)e+=" ";return"".concat(e).concat(t)}function Gi(t){var r=100,e=t.match(/[^\s]+/g);if(e.length>=2&&e[0]==="#version"){var n=parseInt(e[1],10);Number.isFinite(n)&&(r=n)}return r}function Ic(t){var r=cI();return function(){var n=(0,Cc.default)(t),i;if(r){var a=(0,Cc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,g0.default)(this,i)}}function cI(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hI="Shader: GLSL source code must be a JavaScript string",y0=function(t,r){(0,tu.default)(n,t);var e=Ic(n);function n(i,a){var o;(0,Js.default)(this,n),Qr(i),$(typeof a.source=="string",hI);var s=xn(a.source,null)||a.id||Ae("unnamed ".concat(n.getTypeName(a.shaderType)));return o=e.call(this,i,{id:s}),o.shaderType=a.shaderType,o.source=a.source,o.initialize(a),o}return(0,eu.default)(n,[{key:r,get:function(){return"Shader"}},{key:"initialize",value:function(a){var o=a.source,s=xn(o,null);s&&(this.id=Ae(s)),this._compile(o)}},{key:"getParameter",value:function(a){return this.gl.getShaderParameter(this.handle,a)}},{key:"toString",value:function(){return"".concat(n.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return xn(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var a=this.gl.getExtension("WEBGL_debug_shaders");return a?a.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;a.startsWith("#version ")||(a=`#version 100
`.concat(a)),this.source=a,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle);var o=this.getParameter(35713);if(!o){var s=this.gl.getShaderInfoLog(this.handle),u=Rc(s,this.source,this.shaderType,this.id),f=u.shaderName,l=u.errors,c=u.warnings;throw q.error("GLSL compilation errors in ".concat(f,`
`).concat(l))(),q.warn("GLSL compilation warnings in ".concat(f,`
`).concat(c))(),new Error("GLSL compilation errors in ".concat(f))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(a){switch(a){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return $(!1),"unknown"}}}]),n}(lt,Symbol.toStringTag),Ka=function(t,r){(0,tu.default)(n,t);var e=Ic(n);function n(i,a){return(0,Js.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35633}))}return(0,eu.default)(n,[{key:r,get:function(){return"VertexShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),n}(y0,Symbol.toStringTag),Qa=function(t,r){(0,tu.default)(n,t);var e=Ic(n);function n(i,a){return(0,Js.default)(this,n),typeof a=="string"&&(a={source:a}),e.call(this,i,Object.assign({},a,{shaderType:35632}))}return(0,eu.default)(n,[{key:r,get:function(){return"FragmentShader"}},{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),n}(y0,Symbol.toStringTag);var k0=h(B()),R0=h(U()),C0=h(we()),I0=h(kt()),L0=h(ie()),D0=h(ae()),ou=h(ne());var he=h(G());var fe,pI=(fe={},(0,he.default)(fe,5126,Be.bind(null,"uniform1fv",Ft,1,yt)),(0,he.default)(fe,35664,Be.bind(null,"uniform2fv",Ft,2,yt)),(0,he.default)(fe,35665,Be.bind(null,"uniform3fv",Ft,3,yt)),(0,he.default)(fe,35666,Be.bind(null,"uniform4fv",Ft,4,yt)),(0,he.default)(fe,5124,Be.bind(null,"uniform1iv",Tn,1,yt)),(0,he.default)(fe,35667,Be.bind(null,"uniform2iv",Tn,2,yt)),(0,he.default)(fe,35668,Be.bind(null,"uniform3iv",Tn,3,yt)),(0,he.default)(fe,35669,Be.bind(null,"uniform4iv",Tn,4,yt)),(0,he.default)(fe,35670,Be.bind(null,"uniform1iv",Tn,1,yt)),(0,he.default)(fe,35671,Be.bind(null,"uniform2iv",Tn,2,yt)),(0,he.default)(fe,35672,Be.bind(null,"uniform3iv",Tn,3,yt)),(0,he.default)(fe,35673,Be.bind(null,"uniform4iv",Tn,4,yt)),(0,he.default)(fe,35674,Be.bind(null,"uniformMatrix2fv",Ft,4,tn)),(0,he.default)(fe,35675,Be.bind(null,"uniformMatrix3fv",Ft,9,tn)),(0,he.default)(fe,35676,Be.bind(null,"uniformMatrix4fv",Ft,16,tn)),(0,he.default)(fe,35678,vt),(0,he.default)(fe,35680,vt),(0,he.default)(fe,5125,Be.bind(null,"uniform1uiv",ru,1,yt)),(0,he.default)(fe,36294,Be.bind(null,"uniform2uiv",ru,2,yt)),(0,he.default)(fe,36295,Be.bind(null,"uniform3uiv",ru,3,yt)),(0,he.default)(fe,36296,Be.bind(null,"uniform4uiv",ru,4,yt)),(0,he.default)(fe,35685,Be.bind(null,"uniformMatrix2x3fv",Ft,6,tn)),(0,he.default)(fe,35686,Be.bind(null,"uniformMatrix2x4fv",Ft,8,tn)),(0,he.default)(fe,35687,Be.bind(null,"uniformMatrix3x2fv",Ft,6,tn)),(0,he.default)(fe,35688,Be.bind(null,"uniformMatrix3x4fv",Ft,12,tn)),(0,he.default)(fe,35689,Be.bind(null,"uniformMatrix4x2fv",Ft,8,tn)),(0,he.default)(fe,35690,Be.bind(null,"uniformMatrix4x3fv",Ft,12,tn)),(0,he.default)(fe,35678,vt),(0,he.default)(fe,35680,vt),(0,he.default)(fe,35679,vt),(0,he.default)(fe,35682,vt),(0,he.default)(fe,36289,vt),(0,he.default)(fe,36292,vt),(0,he.default)(fe,36293,vt),(0,he.default)(fe,36298,vt),(0,he.default)(fe,36299,vt),(0,he.default)(fe,36300,vt),(0,he.default)(fe,36303,vt),(0,he.default)(fe,36306,vt),(0,he.default)(fe,36307,vt),(0,he.default)(fe,36308,vt),(0,he.default)(fe,36311,vt),fe),dI={},vI={},mI={},_0=[0];function Lc(t,r,e,n){r===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(_0[0]=t,t=_0);var i=t.length;if(i%r&&q.warn("Uniform size should be multiples of ".concat(r),t)(),t instanceof e)return t;var a=n[i];a||(a=new e(i),n[i]=a);for(var o=0;o<i;o++)a[o]=t[o];return a}function Ft(t,r){return Lc(t,r,Float32Array,dI)}function Tn(t,r){return Lc(t,r,Int32Array,vI)}function ru(t,r){return Lc(t,r,Uint32Array,mI)}function Dc(t,r,e){var n=pI[e.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(e.type));return n().bind(null,t,r)}function b0(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};var r=/([^[]*)(\[[0-9]+\])?/,e=t.match(r);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function w0(t,r,e){for(var n in t){var i=t[n],a=!e||Boolean(e[n]);if(a&&!gI(i))throw r=r?"".concat(r," "):"",console.error("".concat(r," Bad uniform ").concat(n),i),new Error("".concat(r," Bad uniform ").concat(n))}return!0}function gI(t){return Array.isArray(t)||ArrayBuffer.isView(t)?yI(t):isFinite(t)||t===!0||t===!1||t instanceof Dt||t instanceof jt?!0:t instanceof xe?Boolean(t.texture):!1}function x0(t,r,e){if(Array.isArray(e)||ArrayBuffer.isView(e))if(t[r])for(var n=t[r],i=0,a=e.length;i<a;++i)n[i]=e[i];else t[r]=e.slice();else t[r]=e}function yI(t){if(t.length===0)return!1;for(var r=Math.min(t.length,16),e=0;e<r;++e)if(!Number.isFinite(t[e]))return!1;return!0}function vt(){var t=null;return function(r,e,n){var i=t!==n;return i&&(r.uniform1i(e,n),t=n),i}}function Be(t,r,e,n){var i=null,a=null;return function(o,s,u){var f=r(u,e),l=f.length,c=!1;if(i===null)i=new Float32Array(l),a=l,c=!0;else{$(a===l,"Uniform length cannot change.");for(var p=0;p<l;++p)if(f[p]!==i[p]){c=!0;break}}return c&&(n(o,t,s,f),i.set(f)),c}}function yt(t,r,e,n){t[r](e,n)}function tn(t,r,e,n){t[r](e,!1,n)}var P0=h(B()),S0=h(U());var Fc=h(Ue()),Fe=h(G());var Ce,_I=5120,bI=5121,wI=5122,xI=5123,T0=0,nu=1,TI=2,EI=3,iu=4,PI=5,SI=6,ot=5126,OI=35664,AI=35665,MI=35666,Ja=5124,kI=35667,RI=35668,CI=35669,eo=5125,II=36294,LI=36295,DI=36296,jI=35670,FI=35671,NI=35672,BI=35673,VI=35674,zI=35675,UI=35676,GI=35685,$I=35686,HI=35687,WI=35688,YI=35689,XI=35690,jc=(Ce={},(0,Fe.default)(Ce,ot,[ot,1,"float"]),(0,Fe.default)(Ce,OI,[ot,2,"vec2"]),(0,Fe.default)(Ce,AI,[ot,3,"vec3"]),(0,Fe.default)(Ce,MI,[ot,4,"vec4"]),(0,Fe.default)(Ce,Ja,[Ja,1,"int"]),(0,Fe.default)(Ce,kI,[Ja,2,"ivec2"]),(0,Fe.default)(Ce,RI,[Ja,3,"ivec3"]),(0,Fe.default)(Ce,CI,[Ja,4,"ivec4"]),(0,Fe.default)(Ce,eo,[eo,1,"uint"]),(0,Fe.default)(Ce,II,[eo,2,"uvec2"]),(0,Fe.default)(Ce,LI,[eo,3,"uvec3"]),(0,Fe.default)(Ce,DI,[eo,4,"uvec4"]),(0,Fe.default)(Ce,jI,[ot,1,"bool"]),(0,Fe.default)(Ce,FI,[ot,2,"bvec2"]),(0,Fe.default)(Ce,NI,[ot,3,"bvec3"]),(0,Fe.default)(Ce,BI,[ot,4,"bvec4"]),(0,Fe.default)(Ce,VI,[ot,8,"mat2"]),(0,Fe.default)(Ce,GI,[ot,8,"mat2x3"]),(0,Fe.default)(Ce,$I,[ot,8,"mat2x4"]),(0,Fe.default)(Ce,zI,[ot,12,"mat3"]),(0,Fe.default)(Ce,HI,[ot,12,"mat3x2"]),(0,Fe.default)(Ce,WI,[ot,12,"mat3x4"]),(0,Fe.default)(Ce,UI,[ot,16,"mat4"]),(0,Fe.default)(Ce,YI,[ot,16,"mat4x2"]),(0,Fe.default)(Ce,XI,[ot,16,"mat4x3"]),Ce);function E0(t){switch(t){case T0:return T0;case nu:return nu;case EI:return nu;case TI:return nu;case iu:return iu;case PI:return iu;case SI:return iu;default:return $(!1),0}}function Nc(t){var r=jc[t];if(!r)return null;var e=(0,Fc.default)(r,2),n=e[0],i=e[1];return{type:n,components:i}}function au(t,r){switch(t){case _I:case bI:case wI:case xI:t=ot;break;default:}for(var e in jc){var n=(0,Fc.default)(jc[e],3),i=n[0],a=n[1],o=n[2];if(i===t&&a===r)return{glType:e,name:o}}return null}var O0=function(){function t(r){(0,P0.default)(this,t),this.id=r.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(r),this._readVaryingsFromProgram(r)}return(0,S0.default)(t,[{key:"getAttributeInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}},{key:"getAttributeLocation",value:function(e){var n=this.getAttributeInfo(e);return n?n.location:-1}},{key:"getAttributeAccessor",value:function(e){var n=this.getAttributeInfo(e);return n?n.accessor:null}},{key:"getVaryingInfo",value:function(e){var n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}},{key:"getVaryingIndex",value:function(e){var n=this.getVaryingInfo();return n?n.location:-1}},{key:"getVaryingAccessor",value:function(e){var n=this.getVaryingInfo();return n?n.accessor:null}},{key:"_readAttributesFromProgram",value:function(e){for(var n=e.gl,i=n.getProgramParameter(e.handle,35721),a=0;a<i;a++){var o=n.getActiveAttrib(e.handle,a),s=o.name,u=o.type,f=o.size,l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,u,f)}this.attributeInfos.sort(function(c,p){return c.location-p.location})}},{key:"_readVaryingsFromProgram",value:function(e){var n=e.gl;if(te(n)){for(var i=n.getProgramParameter(e.handle,35971),a=0;a<i;a++){var o=n.getTransformFeedbackVarying(e.handle,a),s=o.name,u=o.type,f=o.size;this._addVarying(a,s,u,f)}this.varyingInfos.sort(function(l,c){return l.location-c.location})}}},{key:"_addAttribute",value:function(e,n,i,a){var o=Nc(i),s=o.type,u=o.components,f={type:s,size:a*u};this._inferProperties(e,n,f);var l={location:e,name:n,accessor:new Xt(f)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}},{key:"_inferProperties",value:function(e,n,i){/instance/i.test(n)&&(i.divisor=1)}},{key:"_addVarying",value:function(e,n,i,a){var o=Nc(i),s=o.type,u=o.components,f=new Xt({type:s,size:a*u}),l={location:e,name:n,accessor:f};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}]),t}();function qI(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=ZI(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function ZI(t,r){if(t){if(typeof t=="string")return A0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return A0(t,r)}}function A0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function KI(t){var r=QI();return function(){var n=(0,ou.default)(t),i;if(r){var a=(0,ou.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,D0.default)(this,i)}}function QI(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var M0=4,JI=35981,e3=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],En=function(t,r){(0,L0.default)(n,t);var e=KI(n);function n(i){var a;(0,k0.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.stubRemovedMethods("Program","v6.0",e3),a._isCached=!1,a.initialize(o),Object.seal((0,C0.default)(a)),a._setId(o.id),a}return(0,R0.default)(n,[{key:r,get:function(){return"Program"}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.hash,s=a.vs,u=a.fs,f=a.varyings,l=a.bufferMode,c=l===void 0?JI:l;return this.hash=o||"",this.vs=typeof s=="string"?new Ka(this.gl,{id:"".concat(a.id,"-vs"),source:s}):s,this.fs=typeof u=="string"?new Qa(this.gl,{id:"".concat(a.id,"-fs"),source:u}):u,$(this.vs instanceof Ka),$(this.fs instanceof Qa),this.uniforms={},this._textureUniforms={},f&&f.length>0&&(De(this.gl),this.varyings=f,this.gl2.transformFeedbackVaryings(this.handle,f,c)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new O0(this),this.setProps(a)}},{key:"delete",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:(0,I0.default)((0,ou.default)(n.prototype),"delete",this).call(this,a)}},{key:"setProps",value:function(a){return"uniforms"in a&&this.setUniforms(a.uniforms),this}},{key:"draw",value:function(a){var o=this,s=a.logPriority,u=a.drawMode,f=u===void 0?4:u,l=a.vertexCount,c=a.offset,p=c===void 0?0:c,d=a.start,v=a.end,m=a.isIndexed,g=m===void 0?!1:m,_=a.indexType,x=_===void 0?5123:_,w=a.instanceCount,E=w===void 0?0:w,T=a.isInstanced,P=T===void 0?E>0:T,A=a.vertexArray,D=A===void 0?null:A,L=a.transformFeedback,C=a.framebuffer,F=a.parameters,j=F===void 0?{}:F,z=a.uniforms,N=a.samplers;if((z||N)&&(q.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(z||{})),q.priority>=s){var M=C?C.id:"default",k="mode=".concat(Yt(this.gl,f)," verts=").concat(l," ")+"instances=".concat(E," indexType=").concat(Yt(this.gl,x)," ")+"isInstanced=".concat(P," isIndexed=").concat(g," ")+"Framebuffer=".concat(M);q.log(s,k)()}return $(D),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||l===0||P&&E===0?!1:(D.bindForDraw(l,E,function(){if(C!==void 0&&(j=Object.assign({},j,{framebuffer:C})),L){var R=E0(f);L.begin(R)}o._bindTextures(),Re(o.gl,j,function(){g&&P?o.gl2.drawElementsInstanced(f,l,x,p,E):g&&te(o.gl)&&!isNaN(d)&&!isNaN(v)?o.gl2.drawRangeElements(f,d,v,l,x,p):g?o.gl.drawElements(f,l,x,p):P?o.gl2.drawArraysInstanced(f,p,l,E):o.gl.drawArrays(f,p,l)}),L&&L.end()}),!0)}},{key:"setUniforms",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};q.priority>=2&&w0(a,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(var o in a){var s=a[o],u=this._uniformSetters[o];if(u){var f=s,l=!1;if(f instanceof xe&&(f=f.texture),f instanceof Dt)if(l=this.uniforms[o]!==s,l){u.textureIndex===void 0&&(u.textureIndex=this._textureIndexCounter++);var c=f,p=u.textureIndex;c.bind(p),f=p,this._textureUniforms[o]=c}else f=u.textureIndex;else this._textureUniforms[o]&&delete this._textureUniforms[o];(u(f)||l)&&x0(this.uniforms,o,s)}}return this}},{key:"_areTexturesRenderable",value:function(){var a=!0;for(var o in this._textureUniforms){var s=this._textureUniforms[o];s.update(),a=a&&s.loaded}return a}},{key:"_bindTextures",value:function(){for(var a in this._textureUniforms){var o=this._uniformSetters[a].textureIndex;this._textureUniforms[a].bind(o)}}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(a){var o=this.gl.getAttachedShaders(a),s={},u=qI(o),f;try{for(u.s();!(f=u.n()).done;){var l=f.value,c=this.gl.getShaderParameter(this.handle,35663);switch(c){case 35633:s.vs=new Ka({handle:l});break;case 35632:s.fs=new Qa({handle:l});break;default:}}}catch(p){u.e(p)}finally{u.f()}return s}},{key:"_getParameter",value:function(a){return this.gl.getProgramParameter(this.handle,a)}},{key:"_setId",value:function(a){if(!a){var o=this._getName();this.id=Ae(o)}}},{key:"_getName",value:function(){var a=this.vs.getName()||this.fs.getName();return a=a.replace(/shader/i,""),a=a?"".concat(a,"-program"):"program",a}},{key:"_compileAndLink",value:function(){var a=this.gl;if(a.attachShader(this.handle,this.vs.handle),a.attachShader(this.handle,this.fs.handle),q.time(M0,"linkProgram for ".concat(this._getName()))(),a.linkProgram(this.handle),q.timeEnd(M0,"linkProgram for ".concat(this._getName()))(),a.debug||q.level>0){var o=a.getProgramParameter(this.handle,35714);if(!o)throw new Error("Error linking: ".concat(a.getProgramInfoLog(this.handle)));a.validateProgram(this.handle);var s=a.getProgramParameter(this.handle,35715);if(!s)throw new Error("Error validating: ".concat(a.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var a=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var o=0;o<this._uniformCount;o++){var s=this.gl.getActiveUniform(this.handle,o),u=b0(s.name),f=u.name,l=a.getUniformLocation(this.handle,f);if(this._uniformSetters[f]=Dc(a,l,s),s.size>1)for(var c=0;c<s.size;c++)l=a.getUniformLocation(this.handle,"".concat(f,"[").concat(c,"]")),this._uniformSetters["".concat(f,"[").concat(c,"]")]=Dc(a,l,s)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(a,o){return this.gl2.getActiveUniforms(this.handle,a,o)}},{key:"getUniformBlockIndex",value:function(a){return this.gl2.getUniformBlockIndex(this.handle,a)}},{key:"getActiveUniformBlockParameter",value:function(a,o){return this.gl2.getActiveUniformBlockParameter(this.handle,a,o)}},{key:"uniformBlockBinding",value:function(a,o){this.gl2.uniformBlockBinding(this.handle,a,o)}}]),n}(lt,Symbol.toStringTag);var F0=h(B()),N0=h(U()),B0=h(we()),V0=h(ie()),z0=h(ae()),Bc=h(ne());function t3(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=r3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function r3(t,r){if(t){if(typeof t=="string")return j0(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return j0(t,r)}}function j0(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function n3(t){var r=i3();return function(){var n=(0,Bc.default)(t),i;if(r){var a=(0,Bc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,z0.default)(this,i)}}function i3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var a3=34918,o3=34919,s3=35007,u3=36795,f3=35976,l3=35887,c3=36202,su=function(t,r){(0,V0.default)(n,t);var e=n3(n);function n(i){var a;(0,F0.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return a=e.call(this,i,o),a.target=null,a._queryPending=!1,a._pollingPromise=null,Object.seal((0,B0.default)(a)),a}return(0,N0.default)(n,[{key:r,get:function(){return"Query"}},{key:"beginTimeElapsedQuery",value:function(){return this.begin(s3)}},{key:"beginOcclusionQuery",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a.conservative,s=o===void 0?!1:o;return this.begin(s?c3:l3)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(f3)}},{key:"begin",value:function(a){return this._queryPending?this:(this.target=a,this.gl2.beginQuery(this.target,this.handle),this)}},{key:"end",value:function(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var a=this.gl2.getQueryParameter(this.handle,o3);return a&&(this._queryPending=!1),a}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(u3)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,a3)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var s=0;return this._pollingPromise=new Promise(function(u,f){var l=function c(){a.isResultAvailable()?(u(a.getResult()),a._pollingPromise=null):s++>o?(f("Timed out"),a._pollingPromise=null):requestAnimationFrame(c)};requestAnimationFrame(l)}),this._pollingPromise}},{key:"_createHandle",value:function(){return n.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],s=te(a),u=wn(a,Se.TIMER_QUERY),f=s||u,l=t3(o),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;switch(p){case"queries":f=f&&s;break;case"timers":f=f&&u;break;default:$(!1)}}}catch(d){l.e(d)}finally{l.f()}return f}}]),n}(lt,Symbol.toStringTag);var U0=h(B()),G0=h(U()),$0=h(we()),H0=h(ie()),W0=h(ae()),Vc=h(ne());function h3(t){var r=p3();return function(){var n=(0,Vc.default)(t),i;if(r){var a=(0,Vc.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,W0.default)(this,i)}}function p3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Pn=function(t,r){(0,H0.default)(n,t);var e=h3(n);function n(i){var a;(0,U0.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return De(i),a=e.call(this,i,o),a.initialize(o),a.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal((0,$0.default)(a)),a}return(0,G0.default)(n,[{key:r,get:function(){return"TransformFeedback"}},{key:"initialize",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,kr(this.buffers)||this.bind(function(){return a._unbindBuffers()}),this.setProps(o),this}},{key:"setProps",value:function(a){"program"in a&&(this.configuration=a.program&&a.program.configuration),"configuration"in a&&(this.configuration=a.configuration),"bindOnUse"in a&&(a=a.bindOnUse),"buffers"in a&&this.setBuffers(a.buffers)}},{key:"setBuffers",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(function(){for(var s in o)a.setBuffer(s,o[s])}),this}},{key:"setBuffer",value:function(a,o){var s=this._getVaryingIndex(a),u=this._getBufferParams(o),f=u.buffer,l=u.byteSize,c=u.byteOffset;return s<0?(this.unused[a]=f,q.warn("".concat(this.id," unused varying buffer ").concat(a))(),this):(this.buffers[s]=o,this.bindOnUse||this._bindBuffer(s,f,c,l),this)}},{key:"begin",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(a),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(a){var o,s,u;return a instanceof se?u=a:(u=a.buffer,s=a.byteSize,o=a.byteOffset),(o!==void 0||s!==void 0)&&(o=o||0,s=s||u.byteLength-o),{buffer:u,byteOffset:o,byteSize:s}}},{key:"_getVaryingInfo",value:function(a){return this.configuration&&this.configuration.getVaryingInfo(a)}},{key:"_getVaryingIndex",value:function(a){if(this.configuration)return this.configuration.getVaryingInfo(a).location;var o=Number(a);return Number.isFinite(o)?o:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers){var o=this._getBufferParams(this.buffers[a]),s=o.buffer,u=o.byteSize,f=o.byteOffset;this._bindBuffer(a,s,f,u)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var a in this.buffers)this._bindBuffer(a,null)}},{key:"_bindBuffer",value:function(a,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,f=o&&o.handle;return!f||u===void 0?this.gl.bindBufferBase(35982,a,f):this.gl.bindBufferRange(35982,a,f,s,u),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(a){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(a){return te(a)}}]),n}(lt,Symbol.toStringTag);var q0=h(B()),Z0=h(U()),K0=h(we()),Q0=h(kt()),J0=h(ie()),e_=h(ae()),fu=h(ne());var uu=null;function d3(t){return(!uu||uu.byteLength<t)&&(uu=new ArrayBuffer(t)),uu}function Y0(t,r){var e=d3(t.BYTES_PER_ELEMENT*r);return new t(e,0,r)}function X0(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,f=0,l=i;f<s;f++)r[l++]=e[f];for(;f<u;)f<u-f?(r.copyWithin(i+f,i,i+f),f*=2):(r.copyWithin(i+f,i,i+u-f),f=u);return r}function v3(t){var r=m3();return function(){var n=(0,fu.default)(t),i;if(r){var a=(0,fu.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,e_.default)(this,i)}}function m3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var g3="elements must be GL.ELEMENT_ARRAY_BUFFER",lu=function(t,r){(0,J0.default)(n,t);var e=v3(n);function n(i){var a;(0,q0.default)(this,n);var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=o.id||o.program&&o.program.id;return a=e.call(this,i,Object.assign({},o,{id:s})),a.buffer=null,a.bufferValue=null,a.isDefaultArray=o.isDefaultArray||!1,a.gl2=i,a.initialize(o),Object.seal((0,K0.default)(a)),a}return(0,Z0.default)(n,[{key:r,get:function(){return"VertexArrayObject"}},{key:"delete",value:function(){return(0,Q0.default)((0,fu.default)(n.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return n.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(a)}},{key:"setProps",value:function(a){return this}},{key:"setElementBuffer",value:function(){var a=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return $(!o||o.target===34963,g3),this.bind(function(){a.gl.bindBuffer(34963,o?o.handle:null)}),this}},{key:"setBuffer",value:function(a,o,s){if(o.target===34963)return this.setElementBuffer(o,s);var u=s.size,f=s.type,l=s.stride,c=s.offset,p=s.normalized,d=s.integer,v=s.divisor,m=this.gl,g=this.gl2;return a=Number(a),this.bind(function(){m.bindBuffer(34962,o.handle),d?($(te(m)),g.vertexAttribIPointer(a,u,f,l,c)):m.vertexAttribPointer(a,u,f,p,l,c),m.enableVertexAttribArray(a),g.vertexAttribDivisor(a,v||0)}),this}},{key:"enable",value:function(a){var o=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,u=!s&&a===0&&!n.isSupported(this.gl,{constantAttributeZero:!0});return u||(a=Number(a),this.bind(function(){return s?o.gl.enableVertexAttribArray(a):o.gl.disableVertexAttribArray(a)})),this}},{key:"getConstantBuffer",value:function(a,o){var s=this._normalizeConstantArrayValue(o),u=s.byteLength*a,f=s.length*a,l=!this.buffer;if(this.buffer=this.buffer||new se(this.gl,u),l=l||this.buffer.reallocate(u),l=l||!this._compareConstantArrayValues(s,this.bufferValue),l){var c=Y0(o.constructor,f);X0({target:c,source:s,start:0,count:f}),this.buffer.subData(c),this.bufferValue=o}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(a){return Array.isArray(a)?new Float32Array(a):a}},{key:"_compareConstantArrayValues",value:function(a,o){if(!a||!o||a.length!==o.length||a.constructor!==o.constructor)return!1;for(var s=0;s<a.length;++s)if(a[s]!==o[s])return!1;return!0}},{key:"_createHandle",value:function(){var a=this.gl;return a.createVertexArray()}},{key:"_deleteHandle",value:function(a){return this.gl2.deleteVertexArray(a),[this.elements]}},{key:"_bindHandle",value:function(a){this.gl2.bindVertexArray(a)}},{key:"_getParameter",value:function(a,o){var s=this,u=o.location;return $(Number.isFinite(u)),this.bind(function(){switch(a){case 34373:return s.gl.getVertexAttribOffset(u,a);default:return s.gl.getVertexAttrib(u,a)}})}}],[{key:"isSupported",value:function(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o.constantAttributeZero?te(a)||Ii()==="Chrome":!0}},{key:"getDefaultArray",value:function(a){return a.luma=a.luma||{},a.luma.defaultVertexArray||(a.luma.defaultVertexArray=new n(a,{handle:null,isDefaultArray:!0})),a.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(a){return n.MAX_ATTRIBUTES=n.MAX_ATTRIBUTES||a.getParameter(34921),n.MAX_ATTRIBUTES}},{key:"setConstant",value:function(a,o,s){switch(s.constructor){case Float32Array:n._setConstantFloatArray(a,o,s);break;case Int32Array:n._setConstantIntArray(a,o,s);break;case Uint32Array:n._setConstantUintArray(a,o,s);break;default:$(!1)}}},{key:"_setConstantFloatArray",value:function(a,o,s){switch(s.length){case 1:a.vertexAttrib1fv(o,s);break;case 2:a.vertexAttrib2fv(o,s);break;case 3:a.vertexAttrib3fv(o,s);break;case 4:a.vertexAttrib4fv(o,s);break;default:$(!1)}}},{key:"_setConstantIntArray",value:function(a,o,s){switch($(te(a)),s.length){case 1:a.vertexAttribI1iv(o,s);break;case 2:a.vertexAttribI2iv(o,s);break;case 3:a.vertexAttribI3iv(o,s);break;case 4:a.vertexAttribI4iv(o,s);break;default:$(!1)}}},{key:"_setConstantUintArray",value:function(a,o,s){switch($(te(a)),s.length){case 1:a.vertexAttribI1uiv(o,s);break;case 2:a.vertexAttribI2uiv(o,s);break;case 3:a.vertexAttribI3uiv(o,s);break;case 4:a.vertexAttribI4uiv(o,s);break;default:$(!1)}}}]),n}(lt,Symbol.toStringTag);var t_=h(B()),r_=h(U());var y3="VertexArray: attributes must be Buffers or constants (i.e. typed array)",_3=/^(.+)__LOCATION_([0-9]+)$/,b3=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],zc=function(){function t(r){(0,t_.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id||e.program&&e.program.id;this.id=n,this.gl=r,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new lu(r),Vs(this,"VertexArray","v6.0",b3),this.initialize(e),Object.seal(this)}return(0,r_.default)(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var e=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(e){var n=this;return Object.assign(this.attributes,e),this.vertexArrayObject.bind(function(){for(var i in e){var a=e[i];n._setAttribute(i,a)}n.gl.bindBuffer(34962,null)}),this}},{key:"setElementBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}},{key:"setBuffer",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);var a=this._resolveLocationAndAccessor(e,n,n.accessor,i),o=a.location,s=a.accessor;return o>=0&&(this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,s)),this}},{key:"setConstant",value:function(e,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i)),o=a.location,s=a.accessor;return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=s,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}},{key:"unbindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.vertexArrayObject.setElementBuffer(null),e.buffer=e.buffer||new se(e.gl,{accessor:{size:4}});for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++)e.values[n]instanceof se&&(e.gl.disableVertexAttribArray(n),e.gl.bindBuffer(34962,e.buffer.handle),e.gl.vertexAttribPointer(n,1,5126,!1,0,0))}),this}},{key:"bindBuffers",value:function(){var e=this;return this.vertexArrayObject.bind(function(){e.elements&&e.setElementBuffer(e.elements);for(var n=0;n<e.vertexArrayObject.MAX_ATTRIBUTES;n++){var i=e.values[n];i instanceof se&&e.setBuffer(n,i)}}),this}},{key:"bindForDraw",value:function(e,n,i){var a=this,o;return this.vertexArrayObject.bind(function(){a._setConstantAttributes(e,n),o=i()}),o}},{key:"_resolveLocationAndAccessor",value:function(e,n,i,a){var o=this,s={location:-1,accessor:null},u=this._getAttributeIndex(e),f=u.location,l=u.name;if(!Number.isFinite(f)||f<0)return this.unused[e]=n,q.once(3,function(){return"unused value ".concat(e," in ").concat(o.id)})(),s;var c=this._getAttributeInfo(l||f);if(!c)return s;var p=this.accessors[f]||{},d=Xt.resolve(c.accessor,p,i,a),v=d.size,m=d.type;return $(Number.isFinite(v)&&Number.isFinite(m)),{location:f,accessor:d}}},{key:"_getAttributeInfo",value:function(e){return this.configuration&&this.configuration.getAttributeInfo(e)}},{key:"_getAttributeIndex",value:function(e){var n=Number(e);if(Number.isFinite(n))return{location:n};var i=_3.exec(e),a=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+o,name:a}:{location:-1}}},{key:"_setAttribute",value:function(e,n){if(n instanceof se)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof se){var i=n[0],a=n[1];this.setBuffer(e,i,a)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){var o=n;this.setConstant(e,o)}else if(n.buffer instanceof se){var s=n;this.setBuffer(e,s.buffer,s)}else throw new Error(y3)}},{key:"_setConstantAttributes",value:function(e,n){var i=Math.max(e|0,n|0),a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,i);for(var o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)a=this.values[o],ArrayBuffer.isView(a)&&this._setConstantAttribute(o,a)}},{key:"_setConstantAttributeZero",value:function(e,n){if(lu.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}var i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}},{key:"_setConstantAttribute",value:function(e,n){lu.setConstant(this.gl,e,n)}},{key:"_updateDrawParams",value:function(){for(var e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}},{key:"_updateDrawParamsForLocation",value:function(e,n){var i=this.values[n],a=this.accessors[n];if(i){var o=a.divisor,s=o>0;if(e.isInstanced=e.isInstanced||s,i instanceof se){var u=i;if(s){var f=u.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,f)}else{var l=u.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,l)}}}}},{key:"setElements",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return q.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}]),t}();var cu=h(G());function w3(t,r){for(var e=r.maxElts,n=e===void 0?16:e,i=r.size,a=i===void 0?1:i,o="[",s=0;s<t.length&&s<n;++s)s>0&&(o+=",".concat(s%a===0?" ":"")),o+=ei(t[s],r);var u=t.length>n?"...":"]";return"".concat(o).concat(u)}function ei(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=1e-16,n=r.isInteger,i=n===void 0?!1:n;if(Array.isArray(t)||ArrayBuffer.isView(t))return w3(t,r);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<e)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2),o=a.indexOf(".0");return o===a.length-2?a.slice(0,-1):a}function Uc(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=x3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function x3(t,r){if(t){if(typeof t=="string")return n_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n_(t,r)}}function n_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function hu(t){var r=t.header,e=r===void 0?"Uniforms":r,n=t.program,i=t.uniforms,a=t.undefinedOnly,o=a===void 0?!1:a;$(n);var s=".*_.*",u=".*Matrix",f=n._uniformSetters,l={},c=Object.keys(f).sort(),p=0,d=Uc(c),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;!m.match(s)&&!m.match(u)&&Gc({table:l,header:e,uniforms:i,uniformName:m,undefinedOnly:o})&&p++}}catch(C){d.e(C)}finally{d.f()}var g=Uc(c),_;try{for(g.s();!(_=g.n()).done;){var x=_.value;x.match(u)&&Gc({table:l,header:e,uniforms:i,uniformName:x,undefinedOnly:o})&&p++}}catch(C){g.e(C)}finally{g.f()}var w=Uc(c),E;try{for(w.s();!(E=w.n()).done;){var T=E.value;l[T]||Gc({table:l,header:e,uniforms:i,uniformName:T,undefinedOnly:o})&&p++}}catch(C){w.e(C)}finally{w.f()}var P=0,A={};if(!o)for(var D in i){var L=i[D];l[D]||(P++,A[D]=(0,cu.default)({Type:"NOT USED: ".concat(L)},e,ei(L)))}return{table:l,count:p,unusedTable:A,unusedCount:P}}function Gc(t){var r=t.table,e=t.header,n=t.uniforms,i=t.uniformName,a=t.undefinedOnly,o=n[i],s=T3(o);if(!a||!s){var u;return r[i]=(u={},(0,cu.default)(u,e,s?ei(o):"N/A"),(0,cu.default)(u,"Uniform Type",s?o:"NOT PROVIDED"),u),!0}return!1}function T3(t){return t!=null}var ti=h(G());function $c(t){var r=t.vertexArray,e=t.header,n=e===void 0?"Attributes":e;if(!r.configuration)return{};var i={};r.elements&&(i.ELEMENT_ARRAY_BUFFER=i_(r,r.elements,null,n));var a=r.values;for(var o in a){var s=r._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),f=r.accessors[s.location];f&&(u="".concat(o,": ").concat(E3(s.name,f))),i[u]=i_(r,a[o],f,n)}}return i}function i_(t,r,e,n){var i,a=t.gl;if(!r){var o;return o={},(0,ti.default)(o,n,"null"),(0,ti.default)(o,"Format ","N/A"),o}var s="NOT PROVIDED",u=1,f=0,l=0,c,p,d;if(e&&(s=e.type,u=e.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),r instanceof se){var v,m=r,g=m.getDebugData(),_=g.data,x=g.changed;p=x?"*":"",d=_,l=m.byteLength,f=l/_.BYTES_PER_ELEMENT/u;var w;if(e){var E=e.divisor>0;w="".concat(E?"I ":"P "," ").concat(f," (x").concat(u,"=").concat(l," bytes ").concat(Yt(a,s),")")}else c=!0,w="".concat(l," bytes");return v={},(0,ti.default)(v,n,"".concat(p).concat(ei(d,{size:u,isInteger:c}))),(0,ti.default)(v,"Format ",w),v}return d=r,u=r.length,s=String(r.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,i={},(0,ti.default)(i,n,"".concat(ei(d,{size:u,isInteger:c})," (constant)")),(0,ti.default)(i,"Format ","".concat(u,"x").concat(s," (constant)")),i}function E3(t,r){var e=r.type,n=r.size,i=au(e,n);return i?"".concat(t," (").concat(i.name,")"):t}var Hc=h(G());function a_(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=P3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function P3(t,r){if(t){if(typeof t=="string")return o_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o_(t,r)}}function o_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Wc(t){var r={},e="Accessors for ".concat(t.id),n=a_(t.attributeInfos),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a){var o=s_(a);r["in ".concat(o)]=(0,Hc.default)({},e,JSON.stringify(a.accessor))}}}catch(c){n.e(c)}finally{n.f()}var s=a_(t.varyingInfos),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;if(f){var l=s_(f);r["out ".concat(l)]=(0,Hc.default)({},e,JSON.stringify(f.accessor))}}}catch(c){s.e(c)}finally{s.f()}return r}function s_(t){var r=t.accessor,e=r.type,n=r.size,i=au(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}var f_=h(qe()),l_=h(dt()),c_=h(B()),h_=h(U()),Yc=h(et());var u_=it()&&typeof document<"u",S3=0,pu=function(){function t(){(0,c_.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.onCreateContext,n=e===void 0?function(z){return Bi(z)}:e,i=r.onAddHTML,a=i===void 0?null:i,o=r.onInitialize,s=o===void 0?function(){}:o,u=r.onRender,f=u===void 0?function(){}:u,l=r.onFinalize,c=l===void 0?function(){}:l,p=r.onError,d=r.gl,v=d===void 0?null:d,m=r.glOptions,g=m===void 0?{}:m,_=r.debug,x=_===void 0?!1:_,w=r.createFramebuffer,E=w===void 0?!1:w,T=r.autoResizeViewport,P=T===void 0?!0:T,A=r.autoResizeDrawingBuffer,D=A===void 0?!0:A,L=r.stats,C=L===void 0?Wt.get("animation-loop-".concat(S3++)):L,F=r.useDevicePixels,j=F===void 0?!0:F;"useDevicePixelRatio"in r&&(q.deprecated("useDevicePixelRatio","useDevicePixels")(),j=r.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:a,onInitialize:s,onRender:f,onFinalize:c,onError:p,gl:v,glOptions:g,debug:x,createFramebuffer:E},this.gl=v,this.needsRedraw=null,this.timeline=null,this.stats=C,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:P,autoResizeDrawingBuffer:D,useDevicePixels:j}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}return(0,h_.default)(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(e){return $(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}},{key:"setProps",value:function(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}},{key:"start",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;var i=this._getPageLoadPromise().then(function(){return!e._running||e._initialized?null:(e._createWebGLContext(n),e._createFramebuffer(),e._startEventHandling(),e._initializeCallbackData(),e._updateCallbackData(),e._resizeCanvasDrawingBuffer(),e._resizeViewport(),e._gpuTimeQuery=su.isSupported(e.gl,["timers"])?new su(e.gl):null,e._initialized=!0,e.onInitialize(e.animationProps))}).then(function(a){e._running&&(e._addCallbackData(a||{}),a!==!1&&e._startLoop())});return this.props.onError&&i.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(e){return this.timeline=e,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var e=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(function(n){e._resolveNextFrame=n})),this._nextFramePromise}},{key:"toDataURL",value:function(){var r=(0,l_.default)(Yc.default.mark(function n(){return Yc.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setNeedsRedraw("toDataURL"),a.next=3,this.waitForRender();case 3:return a.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var e;return(e=this.props).onCreateContext.apply(e,arguments)}},{key:"onInitialize",value:function(){var e;return(e=this.props).onInitialize.apply(e,arguments)}},{key:"onRender",value:function(){var e;return(e=this.props).onRender.apply(e,arguments)}},{key:"onFinalize",value:function(){var e;return(e=this.props).onFinalize.apply(e,arguments)}},{key:"getHTMLControlValue",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=document.getElementById(e);return i?Number(i.value):n}},{key:"setViewParameters",value:function(){return q.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var e=this,n=function i(){e._running&&(e.redraw(),e._animationFrameId=e._requestAnimationFrame(i))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(n)}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=u_?new Promise(function(e,n){if(u_&&document.readyState==="complete"){e(document);return}window.addEventListener("load",function(){e(document)})}):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}},{key:"_cancelAnimationFrame",value:function(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):uc(e)}},{key:"_requestAnimationFrame",value:function(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):sc(e)}},{key:"_renderFrame",value:function(){if(this.display){var e;(e=this.display)._renderFrame.apply(e,arguments);return}this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var e=this._getSizeAndAspect(),n=e.width,i=e.height,a=e.aspect;(n!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),a!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=n,this.animationProps.height=i,this.animationProps.aspect=a,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(e){(0,f_.default)(e)==="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}},{key:"_createWebGLContext",value:function(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Jr(this.props.gl,e):this.onCreateContext(e),!Kr(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Fs(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";var n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);var i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}},{key:"_getSizeAndAspect",value:function(){var e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight,i=1,a=this.gl.canvas;return a&&a.clientHeight?i=a.clientWidth/a.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&ac(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new xe(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var e=this.gl.canvas;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}},{key:"_onMouseleave",value:function(e){this.animationProps._mousePosition=null}}]),t}();var Rb=h(G()),Cb=h(B()),Ib=h(U());var Pb=h(B()),Sb=h(U());var j_=h(Ue()),ih=h(G());var ri="vs",to="fs";var m_=h(B()),g_=h(U());function tt(t,r){if(!t)throw new Error(r||"shadertools: assertion failed.")}var d_=h(qe()),Xc={number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate:function(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function v_(t){var r={};for(var e in t){var n=t[e],i=O3(n);r[e]=i}return r}function O3(t){var r=p_(t);return r==="object"?t?"type"in t?Object.assign({},t,Xc[t.type]):"value"in t?(r=p_(t.value),Object.assign({type:r},t,Xc[r])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:r,value:t},Xc[r])}function p_(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":(0,d_.default)(t)}var A3="vs",M3="fs",du=function(){function t(r){(0,m_.default)(this,t);var e=r.name,n=r.vs,i=r.fs,a=r.dependencies,o=a===void 0?[]:a,s=r.uniforms,u=r.getUniforms,f=r.deprecations,l=f===void 0?[]:f,c=r.defines,p=c===void 0?{}:c,d=r.inject,v=d===void 0?{}:d,m=r.vertexShader,g=r.fragmentShader;tt(typeof e=="string"),this.name=e,this.vs=n||m,this.fs=i||g,this.getModuleUniforms=u,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=p,this.injections=k3(v),s&&(this.uniforms=v_(s))}return(0,g_.default)(t,[{key:"getModuleSource",value:function(e){var n;switch(e){case A3:n=this.vs||"";break;case M3:n=this.fs||"";break;default:tt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}},{key:"getUniforms",value:function(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(e,n){this.deprecations.forEach(function(i){i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}},{key:"_parseDeprecationDefinitions",value:function(e){return e.forEach(function(n){switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}},{key:"_defaultGetUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={},i=this.uniforms;for(var a in i){var o=i[a];a in e&&!o.private?(o.validate&&tt(o.validate(e[a],o),"".concat(this.name,": invalid ").concat(a)),n[a]=e[a]):n[a]=o.value}return n}}]),t}();function vu(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var r=new du(t);t.getUniforms=r.getUniforms.bind(r)}return t}function k3(t){var r={vs:{},fs:{}};for(var e in t){var n=t[e],i=e.slice(0,2);typeof n=="string"&&(n={order:0,injection:n}),r[i][e]=n}return r}function y_(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=R3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function R3(t,r){if(t){if(typeof t=="string")return __(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return __(t,r)}}function __(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function b_(t){return C3(x_(t))}function C3(t){var r={},e={};return w_({modules:t,level:0,moduleMap:r,moduleDepth:e}),Object.keys(e).sort(function(n,i){return e[i]-e[n]}).map(function(n){return r[n]})}function w_(t){var r=t.modules,e=t.level,n=t.moduleMap,i=t.moduleDepth;if(e>=5)throw new Error("Possible loop in shader dependency graph");var a=y_(r),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n[s.name]=s,(i[s.name]===void 0||i[s.name]<e)&&(i[s.name]=e)}}catch(c){a.e(c)}finally{a.f()}var u=y_(r),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;l.dependencies&&w_({modules:l.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}}catch(c){u.e(c)}finally{u.f()}}function x_(t,r){return t.map(function(e){return e instanceof du||(tt(typeof e!="string","Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),tt(e.name,"shader module has no name"),e=new du(e),e.dependencies=x_(e.dependencies)),e})}function qc(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=typeof window<"u"?window.navigator||{}:{},e=t.userAgent||r.userAgent||"",n=e.indexOf("MSIE ")!==-1,i=e.indexOf("Trident/")!==-1;return n||i}var I3=7936,L3=7937,D3=7938,j3=35724,Kc={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Sn={};Object.keys(Kc).forEach(function(t){Sn[t]=t});function F3(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function T_(t){var r=t.getExtension("WEBGL_debug_renderer_info"),e=t.getParameter(r&&r.UNMASKED_VENDOR_WEBGL||I3),n=t.getParameter(r&&r.UNMASKED_RENDERER_WEBGL||L3),i=N3(e,n),a={gpuVendor:i,vendor:e,renderer:n,version:t.getParameter(D3),shadingLanguageVersion:t.getParameter(j3)};return a}function N3(t,r){return t.match(/NVIDIA/i)||r.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||r.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||r.match(/AMD/i)||t.match(/ATI/i)||r.match(/ATI/i)?"AMD":"UNKNOWN GPU"}var Zc={};function Qc(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Kc[r];if(tt(n,r),!qc(e))return!0;if(r in Zc)return Zc[r];var i=n[0],a=e.behavior||"enable",o="#extension GL_".concat(i," : ").concat(a,`
void main(void) {}`),s=t.createShader(35633);t.shaderSource(s,o),t.compileShader(s);var u=t.getShaderParameter(s,35713);return t.deleteShader(s),Zc[r]=u,u}function B3(t,r){var e=Kc[r];tt(e,r);var n=F3(t)&&e[1]||e[0],i=typeof n=="string"?Boolean(t.getExtension(n)):n;return tt(i===!1||i===!0),i}function ro(t,r){return r=Array.isArray(r)?r:[r],r.every(function(e){return B3(t,e)})}function E_(t){var r=T_(t);switch(r.gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function P_(t,r,e){var n=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return ro(t,Sn.GLSL_FRAG_DEPTH)&&(n+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),ro(t,Sn.GLSL_DERIVATIVES)&&Qc(t,Sn.GLSL_DERIVATIVES)&&(n+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),ro(t,Sn.GLSL_FRAG_DATA)&&Qc(t,Sn.GLSL_FRAG_DATA,{behavior:"require"})&&(n+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),ro(t,Sn.GLSL_TEXTURE_LOD)&&(n+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),n}var eh=h(G());var S_=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,O_=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var mu,V3=(mu={},(0,eh.default)(mu,ri,S_),(0,eh.default)(mu,to,O_),mu),no="__LUMA_INJECT_DECLARATIONS__",A_=/void\s+main\s*\([^)]*\)\s*\{\n?/,M_=/}\n?[^{}]*$/,Jc=[];function gu(t,r,e){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=r===ri,a=function(u){var f=e[u];f.sort(function(d,v){return d.order-v.order}),Jc.length=f.length;for(var l=0,c=f.length;l<c;++l)Jc[l]=f[l].injection;var p="".concat(Jc.join(`
`),`
`);switch(u){case"vs:#decl":i&&(t=t.replace(no,p));break;case"vs:#main-start":i&&(t=t.replace(A_,function(d){return d+p}));break;case"vs:#main-end":i&&(t=t.replace(M_,function(d){return p+d}));break;case"fs:#decl":i||(t=t.replace(no,p));break;case"fs:#main-start":i||(t=t.replace(A_,function(d){return d+p}));break;case"fs:#main-end":i||(t=t.replace(M_,function(d){return p+d}));break;default:t=t.replace(u,function(d){return d+p})}};for(var o in e)a(o);return t=t.replace(no,""),n&&(t=t.replace(/\}\s*$/,function(s){return s+V3[r]})),t}function $i(t){var r={};return tt(Array.isArray(t)&&t.length>1),t.forEach(function(e){for(var n in e)r[n]=r[n]?"".concat(r[n],`
`).concat(e[n]):e[n]}),r}var R_=h(Ue());function z3(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=U3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function U3(t,r){if(t){if(typeof t=="string")return k_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return k_(t,r)}}function k_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Hi(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var C_=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],G3=[].concat(C_,[[Hi("attribute"),"in $1"],[Hi("varying"),"out $1"]]),$3=[].concat(C_,[[Hi("varying"),"in $1"]]),I_=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],H3=[].concat(I_,[[Hi("in"),"attribute $1"],[Hi("out"),"varying $1"]]),W3=[].concat(I_,[[Hi("in"),"varying $1"]]),th="gl_FragColor",rh=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,Y3=/void\s+main\s*\([^)]*\)\s*\{\n?/;function nh(t,r,e){switch(r){case 300:return e?yu(t,G3):X3(t);case 100:return e?yu(t,H3):q3(t);default:throw new Error("unknown GLSL version ".concat(r))}}function yu(t,r){var e=z3(r),n;try{for(e.s();!(n=e.n()).done;){var i=(0,R_.default)(n.value,2),a=i[0],o=i[1];t=t.replace(a,o)}}catch(s){e.e(s)}finally{e.f()}return t}function X3(t){t=yu(t,$3);var r=t.match(rh);if(r){var e=r[1];t=t.replace(new RegExp("\\b".concat(th,"\\b"),"g"),e)}else{var n="fragmentColor";t=t.replace(Y3,function(i){return"out vec4 ".concat(n,`;
`).concat(i)}).replace(new RegExp("\\b".concat(th,"\\b"),"g"),n)}return t}function q3(t){t=yu(t,W3);var r=t.match(rh);if(r){var e=r[1];t=t.replace(rh,"").replace(new RegExp("\\b".concat(e,"\\b"),"g"),th)}return t}var _u;function ah(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Z3(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Z3(t,r){if(t){if(typeof t=="string")return L_(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return L_(t,r)}}function L_(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var K3=`

`.concat(no,`

`),F_=(_u={},(0,ih.default)(_u,ri,"vertex"),(0,ih.default)(_u,to,"fragment"),_u),Q3=`precision highp float;

`;function oh(t,r){var e=r.vs,n=r.fs,i=b_(r.modules||[]);return{gl:t,vs:D_(t,Object.assign({},r,{source:e,type:ri,modules:i})),fs:D_(t,Object.assign({},r,{source:n,type:to,modules:i})),getUniforms:J3(i)}}function D_(t,r){var e=r.id,n=r.source,i=r.type,a=r.modules,o=r.defines,s=o===void 0?{}:o,u=r.hookFunctions,f=u===void 0?[]:u,l=r.inject,c=l===void 0?{}:l,p=r.transpileToGLSL100,d=p===void 0?!1:p,v=r.prologue,m=v===void 0?!0:v,g=r.log;tt(typeof n=="string","shader source must be a string");var _=i===ri,x=n.split(`
`),w=100,E="",T=n;x[0].indexOf("#version ")===0?(w=300,E=x[0],T=x.slice(1).join(`
`)):E="#version ".concat(w);var P={};a.forEach(function(ee){Object.assign(P,ee.getDefines())}),Object.assign(P,s);var A=m?"".concat(E,`
`).concat(tL({id:e,source:n,type:i}),`
`).concat(eL({type:i}),`
`).concat(E_(t),`
`).concat(P_(t,w,!_),`
`).concat(rL(P),`
`).concat(_?"":Q3,`
`):"".concat(E,`
`),D=iL(f),L={},C={},F={};for(var j in c){var z=typeof c[j]=="string"?{injection:c[j],order:0}:c[j],N=j.match(/^(v|f)s:(#)?([\w-]+)$/);if(N){var M=N[2],k=N[3];M?k==="decl"?C[j]=[z]:F[j]=[z]:L[j]=[z]}else F[j]=[z]}var R=ah(a),Y;try{for(R.s();!(Y=R.n()).done;){var V=Y.value;g&&V.checkDeprecations(T,g);var Q=V.getModuleSource(i,w);A+=Q;var J=V.injections[i];for(var re in J){var oe=re.match(/^(v|f)s:#([\w-]+)$/);if(oe){var ue=oe[2],Oe=ue==="decl"?C:F;Oe[re]=Oe[re]||[],Oe[re].push(J[re])}else L[re]=L[re]||[],L[re].push(J[re])}}}catch(ee){R.e(ee)}finally{R.f()}return A+=K3,A=gu(A,i,C),A+=nL(D[i],L),A+=T,A=gu(A,i,F),A=nh(A,d?100:w,_),A}function J3(t){return function(e){var n={},i=ah(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getUniforms(e,n);Object.assign(n,s)}}catch(u){i.e(u)}finally{i.f()}return n}}function eL(t){var r=t.type;return`
#define SHADER_TYPE_`.concat(F_[r].toUpperCase(),`
`)}function tL(t){var r=t.id,e=t.source,n=t.type,i=r&&typeof r=="string"&&e.indexOf("SHADER_NAME")===-1;return i?`
#define SHADER_NAME `.concat(r,"_").concat(F_[n],`

`):""}function rL(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=0,e="";for(var n in t){r===0&&(e+=`
// APPLICATION DEFINES
`),r++;var i=t[n];(i||Number.isFinite(i))&&(e+="#define ".concat(n.toUpperCase()," ").concat(t[n],`
`))}return r===0&&(e+=`
`),e}function nL(t,r){var e="";for(var n in t){var i=t[n];if(e+="void ".concat(i.signature,` {
`),i.header&&(e+="  ".concat(i.header)),r[n]){var a=r[n];a.sort(function(f,l){return f.order-l.order});var o=ah(a),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;e+="  ".concat(u.injection,`
`)}}catch(f){o.e(f)}finally{o.f()}}i.footer&&(e+="  ".concat(i.footer)),e+=`}
`}return e}function iL(t){var r={vs:{},fs:{}};return t.forEach(function(e){var n;typeof e!="string"?(n=e,e=n.hook):n={},e=e.trim();var i=e.split(":"),a=(0,j_.default)(i,2),o=a[0],s=a[1],u=e.replace(/\(.+/,"");r[o][u]=Object.assign(n,{signature:s})}),r}var N_=h(Ue());var aL="void main() {gl_FragColor = vec4(0);}",B_=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,oL=`#version 300 es
`.concat(B_);function bu(t,r){r=Array.isArray(r)?r:[r];var e=t.replace(/^\s+/,"").split(/\s+/),n=(0,N_.default)(e,3),i=n[0],a=n[1],o=n[2];if(!r.includes(i)||!a||!o)return null;var s=o.split(";")[0];return{qualifier:i,type:a,name:s}}function io(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.version,e=r===void 0?100:r,n=t.input,i=t.inputType,a=t.output;if(!n)return e===300?oL:e>300?"#version ".concat(e,`
`).concat(B_):aL;var o=V_(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function sh(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return tt(!1),null}}function uh(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return tt(!1),null}}function V_(t,r){switch(r){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return tt(!1),null}}var sL=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,wu={name:"fp32",vs:sL,fs:null};function Nt(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function z_(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bt(t,r,e){return r&&z_(t.prototype,r),e&&z_(t,e),t}function ao(t,r){return ao=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},ao(t,r)}function lr(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&ao(t,r)}function ni(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ni=function(e){return typeof e}:ni=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ni(t)}function fh(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cr(t,r){if(r&&(ni(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fh(t)}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(t)}function xu(t,r){if(!t)throw new Error("math.gl assertion ".concat(r))}var uL=1/Math.PI*180,fL=1/180*Math.PI,rt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function oo(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r.precision,n=e===void 0?rt.precision:e;return t=lL(t),"".concat(parseFloat(t.toPrecision(n)))}function rn(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Wi(t,r){return lh(t,function(e){return e*fL},r)}function On(t,r){return lh(t,function(e){return e*uL},r)}function Te(t,r,e){return lh(t,function(n){return Math.max(r,Math.min(e,n))})}function nn(t,r,e){return rn(t)?t.map(function(n,i){return nn(n,r[i],e)}):e*r+(1-e)*t}function Vt(t,r,e){var n=rt.EPSILON;e&&(rt.EPSILON=e);try{if(t===r)return!0;if(rn(t)&&rn(r)){if(t.length!==r.length)return!1;for(var i=0;i<t.length;++i)if(!Vt(t[i],r[i]))return!1;return!0}return t&&t.equals?t.equals(r):r&&r.equals?r.equals(t):typeof t=="number"&&typeof r=="number"?Math.abs(t-r)<=rt.EPSILON*Math.max(1,Math.abs(t),Math.abs(r)):!1}finally{rt.EPSILON=n}}function lL(t){return Math.round(t/rt.EPSILON)*rt.EPSILON}function cL(t){return t.clone?t.clone():new Array(t.length)}function lh(t,r,e){if(rn(t)){var n=t;e=e||cL(n);for(var i=0;i<e.length&&i<n.length;++i)e[i]=r(t[i],i,e);return e}return r(t)}function hL(t){var r=pL();return function(){var n=ct(t),i;if(r){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function pL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dL(t){function r(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return r.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t,r}var Tu=function(t){lr(e,t);var r=hL(e);function e(){return Nt(this,e),r.apply(this,arguments)}return Bt(e,[{key:"clone",value:function(){return new this.constructor().copy(this)}},{key:"fromArray",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)this[o]=i[o+a];return this.check()}},{key:"toArray",value:function(){for(var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=0;o<this.ELEMENTS;++o)i[a+o]=this[o];return i}},{key:"from",value:function(i){return Array.isArray(i)?this.copy(i):this.fromObject(i)}},{key:"to",value:function(i){return i===this?this:rn(i)?this.toArray(i):this.toObject(i)}},{key:"toTarget",value:function(i){return i?this.to(i):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(rt)}},{key:"formatString",value:function(i){for(var a="",o=0;o<this.ELEMENTS;++o)a+=(o>0?", ":"")+oo(this[o],i);return"".concat(i.printTypes?this.constructor.name:"","[").concat(a,"]")}},{key:"equals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(!Vt(this[a],i[a]))return!1;return!0}},{key:"exactEquals",value:function(i){if(!i||this.length!==i.length)return!1;for(var a=0;a<this.ELEMENTS;++a)if(this[a]!==i[a])return!1;return!0}},{key:"negate",value:function(){for(var i=0;i<this.ELEMENTS;++i)this[i]=-this[i];return this.check()}},{key:"lerp",value:function(i,a,o){if(o===void 0)return this.lerp(this,i,a);for(var s=0;s<this.ELEMENTS;++s){var u=i[s];this[s]=u+o*(a[s]-u)}return this.check()}},{key:"min",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.min(i[a],this[a]);return this.check()}},{key:"max",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=Math.max(i[a],this[a]);return this.check()}},{key:"clamp",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i[o]),a[o]);return this.check()}},{key:"add",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],l=0;l<this.ELEMENTS;++l)this[l]+=f[l];return this.check()}},{key:"subtract",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],l=0;l<this.ELEMENTS;++l)this[l]-=f[l];return this.check()}},{key:"scale",value:function(i){if(typeof i=="number")for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;else for(var o=0;o<this.ELEMENTS&&o<i.length;++o)this[o]*=i[o];return this.check()}},{key:"multiplyByScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"check",value:function(){if(rt.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var i=this.length===this.ELEMENTS,a=0;a<this.ELEMENTS;++a)i=i&&Number.isFinite(this[a]);return i}},{key:"sub",value:function(i){return this.subtract(i)}},{key:"setScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]=i;return this.check()}},{key:"addScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]+=i;return this.check()}},{key:"subScalar",value:function(i){return this.addScalar(-i)}},{key:"multiplyScalar",value:function(i){for(var a=0;a<this.ELEMENTS;++a)this[a]*=i;return this.check()}},{key:"divideScalar",value:function(i){return this.multiplyByScalar(1/i)}},{key:"clampScalar",value:function(i,a){for(var o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],i),a);return this.check()}},{key:"elements",get:function(){return this}}]),e}(dL(Array));function vL(t,r){if(t.length!==r)return!1;for(var e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function _t(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Eu(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(rt.debug&&!vL(t,r))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return t}function mL(t){var r=gL();return function(){var n=ct(t),i;if(r){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function gL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var U_=function(t){lr(e,t);var r=mL(e);function e(){return Nt(this,e),r.apply(this,arguments)}return Bt(e,[{key:"x",get:function(){return this[0]},set:function(i){this[0]=_t(i)}},{key:"y",get:function(){return this[1]},set:function(i){this[1]=_t(i)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var i=0,a=0;a<this.ELEMENTS;++a)i+=this[a]*this[a];return i}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(i){return Math.sqrt(this.distanceSquared(i))}},{key:"distanceSquared",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o){var s=this[o]-i[o];a+=s*s}return _t(a)}},{key:"dot",value:function(i){for(var a=0,o=0;o<this.ELEMENTS;++o)a+=this[o]*i[o];return _t(a)}},{key:"normalize",value:function(){var i=this.magnitude();if(i!==0)for(var a=0;a<this.ELEMENTS;++a)this[a]/=i;return this.check()}},{key:"multiply",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],l=0;l<this.ELEMENTS;++l)this[l]*=f[l];return this.check()}},{key:"divide",value:function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0,u=a;s<u.length;s++)for(var f=u[s],l=0;l<this.ELEMENTS;++l)this[l]/=f[l];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(i){return this.distance(i)}},{key:"distanceToSquared",value:function(i){return this.distanceSquared(i)}},{key:"getComponent",value:function(i){return xu(i>=0&&i<this.ELEMENTS,"index is out of range"),_t(this[i])}},{key:"setComponent",value:function(i,a){return xu(i>=0&&i<this.ELEMENTS,"index is out of range"),this[i]=a,this.check()}},{key:"addVectors",value:function(i,a){return this.copy(i).add(a)}},{key:"subVectors",value:function(i,a){return this.copy(i).subtract(a)}},{key:"multiplyVectors",value:function(i,a){return this.copy(i).multiply(a)}},{key:"addScaledVector",value:function(i,a){return this.add(new this.constructor(i).multiplyScalar(a))}}]),e}(Tu);var We=1e-6,Ir=typeof Float32Array<"u"?Float32Array:Array;var nH=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function yL(){var t=new Ir(2);return Ir!=Float32Array&&(t[0]=0,t[1]=0),t}function so(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function _L(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function $_(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function H_(t){var r=t[0],e=t[1];return Math.hypot(r,e)}function W_(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Su(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t}function Y_(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t}var X_=_L;var iH=function(){var t=yL();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function q_(t,r,e){var n=r[0],i=r[1],a=e[3]*n+e[7]*i||1;return t[0]=(e[0]*n+e[4]*i)/a,t[1]=(e[1]*n+e[5]*i)/a,t}function Ou(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a||1;return t[0]=(e[0]*n+e[4]*i+e[8]*a)/o,t[1]=(e[1]*n+e[5]*i+e[9]*a)/o,t[2]=(e[2]*n+e[6]*i+e[10]*a)/o,t}function Z_(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t[2]=r[2],t}function bL(){var t=new Ir(3);return Ir!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function K_(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function Q_(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function wL(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function J_(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function xL(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function eb(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function Au(t,r,e){var n=r[0],i=r[1],a=r[2],o=e[3]*n+e[7]*i+e[11]*a+e[15];return o=o||1,t[0]=(e[0]*n+e[4]*i+e[8]*a+e[12])/o,t[1]=(e[1]*n+e[5]*i+e[9]*a+e[13])/o,t[2]=(e[2]*n+e[6]*i+e[10]*a+e[14])/o,t}function tb(t,r,e){var n=r[0],i=r[1],a=r[2];return t[0]=n*e[0]+i*e[3]+a*e[6],t[1]=n*e[1]+i*e[4]+a*e[7],t[2]=n*e[2]+i*e[5]+a*e[8],t}function rb(t,r,e){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],f=r[2],l=i*f-a*u,c=a*s-n*f,p=n*u-i*s,d=i*p-a*c,v=a*l-n*p,m=n*c-i*l,g=o*2;return l*=g,c*=g,p*=g,d*=2,v*=2,m*=2,t[0]=s+l+d,t[1]=u+c+v,t[2]=f+p+m,t}function nb(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function ib(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function ab(t,r,e,n){var i=[],a=[];return i[0]=r[0]-e[0],i[1]=r[1]-e[1],i[2]=r[2]-e[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function ob(t,r){var e=t[0],n=t[1],i=t[2],a=r[0],o=r[1],s=r[2],u=Math.sqrt(e*e+n*n+i*i),f=Math.sqrt(a*a+o*o+s*s),l=u*f,c=l&&xL(t,r)/l;return Math.acos(Math.min(Math.max(c,-1),1))}var sb=wL;var oH=function(){var t=bL();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();function TL(t){var r=EL();return function(){var n=ct(t),i;if(r){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function EL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ch=[0,0,0],Mu,nt=function(t){lr(e,t);var r=TL(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return Nt(this,e),n=r.call(this,-0,-0,-0),arguments.length===1&&rn(i)?n.copy(i):(rt.debug&&(_t(i),_t(a),_t(o)),n[0]=i,n[1]=a,n[2]=o),n}return Bt(e,[{key:"set",value:function(i,a,o){return this[0]=i,this[1]=a,this[2]=o,this.check()}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this.check()}},{key:"fromObject",value:function(i){return rt.debug&&(_t(i.x),_t(i.y),_t(i.z)),this[0]=i.x,this[1]=i.y,this[2]=i.z,this.check()}},{key:"toObject",value:function(i){return i.x=this[0],i.y=this[1],i.z=this[2],i}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(i){this[2]=_t(i)}},{key:"angle",value:function(i){return ob(this,i)}},{key:"cross",value:function(i){return eb(this,this,i),this.check()}},{key:"rotateX",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?ch:o;return nb(this,this,s,a),this.check()}},{key:"rotateY",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?ch:o;return ib(this,this,s,a),this.check()}},{key:"rotateZ",value:function(i){var a=i.radians,o=i.origin,s=o===void 0?ch:o;return ab(this,this,s,a),this.check()}},{key:"transform",value:function(i){return this.transformAsPoint(i)}},{key:"transformAsPoint",value:function(i){return Au(this,this,i),this.check()}},{key:"transformAsVector",value:function(i){return Ou(this,this,i),this.check()}},{key:"transformByMatrix3",value:function(i){return tb(this,this,i),this.check()}},{key:"transformByMatrix2",value:function(i){return Z_(this,this,i),this.check()}},{key:"transformByQuaternion",value:function(i){return rb(this,this,i),this.check()}}],[{key:"ZERO",get:function(){return Mu||(Mu=new e(0,0,0),Object.freeze(Mu)),Mu}}]),e}(U_);function PL(t){var r=SL();return function(){var n=ct(t),i;if(r){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function SL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ub=function(t){lr(e,t);var r=PL(e);function e(){return Nt(this,e),r.apply(this,arguments)}return Bt(e,[{key:"toString",value:function(){var i="[";if(rt.printRowMajor){i+="row-major:";for(var a=0;a<this.RANK;++a)for(var o=0;o<this.RANK;++o)i+=" ".concat(this[o*this.RANK+a])}else{i+="column-major:";for(var s=0;s<this.ELEMENTS;++s)i+=" ".concat(this[s])}return i+="]",i}},{key:"getElementIndex",value:function(i,a){return a*this.RANK+i}},{key:"getElement",value:function(i,a){return this[a*this.RANK+i]}},{key:"setElement",value:function(i,a,o){return this[a*this.RANK+i]=_t(o),this}},{key:"getColumn",value:function(i){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0),o=i*this.RANK,s=0;s<this.RANK;++s)a[s]=this[o+s];return a}},{key:"setColumn",value:function(i,a){for(var o=i*this.RANK,s=0;s<this.RANK;++s)this[o+s]=a[s];return this}}]),e}(Tu);function OL(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fb(t,r){if(t===r){var e=r[1],n=r[2],i=r[3],a=r[6],o=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=a,t[11]=r[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function ku(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],f=r[7],l=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],_=r[15],x=e*s-n*o,w=e*u-i*o,E=e*f-a*o,T=n*u-i*s,P=n*f-a*s,A=i*f-a*u,D=l*m-c*v,L=l*g-p*v,C=l*_-d*v,F=c*g-p*m,j=c*_-d*m,z=p*_-d*g,N=x*z-w*j+E*F+T*C-P*L+A*D;return N?(N=1/N,t[0]=(s*z-u*j+f*F)*N,t[1]=(i*j-n*z-a*F)*N,t[2]=(m*A-g*P+_*T)*N,t[3]=(p*P-c*A-d*T)*N,t[4]=(u*C-o*z-f*L)*N,t[5]=(e*z-i*C+a*L)*N,t[6]=(g*E-v*A-_*w)*N,t[7]=(l*A-p*E+d*w)*N,t[8]=(o*j-s*C+f*D)*N,t[9]=(n*C-e*j-a*D)*N,t[10]=(v*P-m*E+_*x)*N,t[11]=(c*E-l*P-d*x)*N,t[12]=(s*L-o*F-u*D)*N,t[13]=(e*F-n*L+i*D)*N,t[14]=(m*w-v*T-g*x)*N,t[15]=(l*T-c*w+p*x)*N,t):null}function lb(t){var r=t[0],e=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],f=t[8],l=t[9],c=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],_=r*o-e*a,x=r*s-n*a,w=r*u-i*a,E=e*s-n*o,T=e*u-i*o,P=n*u-i*s,A=f*v-l*d,D=f*m-c*d,L=f*g-p*d,C=l*m-c*v,F=l*g-p*v,j=c*g-p*m;return _*j-x*F+w*C+E*L-T*D+P*A}function ii(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],f=r[6],l=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],_=r[14],x=r[15],w=e[0],E=e[1],T=e[2],P=e[3];return t[0]=w*n+E*s+T*c+P*m,t[1]=w*i+E*u+T*p+P*g,t[2]=w*a+E*f+T*d+P*_,t[3]=w*o+E*l+T*v+P*x,w=e[4],E=e[5],T=e[6],P=e[7],t[4]=w*n+E*s+T*c+P*m,t[5]=w*i+E*u+T*p+P*g,t[6]=w*a+E*f+T*d+P*_,t[7]=w*o+E*l+T*v+P*x,w=e[8],E=e[9],T=e[10],P=e[11],t[8]=w*n+E*s+T*c+P*m,t[9]=w*i+E*u+T*p+P*g,t[10]=w*a+E*f+T*d+P*_,t[11]=w*o+E*l+T*v+P*x,w=e[12],E=e[13],T=e[14],P=e[15],t[12]=w*n+E*s+T*c+P*m,t[13]=w*i+E*u+T*p+P*g,t[14]=w*a+E*f+T*d+P*_,t[15]=w*o+E*l+T*v+P*x,t}function ai(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,f,l,c,p,d,v,m,g,_;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],f=r[3],l=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],_=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=f,t[4]=l,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=_,t[12]=o*n+l*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=f*n+d*i+_*a+r[15]),t}function Yi(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function cb(t,r,e,n){var i=n[0],a=n[1],o=n[2],s=Math.hypot(i,a,o),u,f,l,c,p,d,v,m,g,_,x,w,E,T,P,A,D,L,C,F,j,z,N,M;return s<We?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(e),f=Math.cos(e),l=1-f,c=r[0],p=r[1],d=r[2],v=r[3],m=r[4],g=r[5],_=r[6],x=r[7],w=r[8],E=r[9],T=r[10],P=r[11],A=i*i*l+f,D=a*i*l+o*u,L=o*i*l-a*u,C=i*a*l-o*u,F=a*a*l+f,j=o*a*l+i*u,z=i*o*l+a*u,N=a*o*l-i*u,M=o*o*l+f,t[0]=c*A+m*D+w*L,t[1]=p*A+g*D+E*L,t[2]=d*A+_*D+T*L,t[3]=v*A+x*D+P*L,t[4]=c*C+m*F+w*j,t[5]=p*C+g*F+E*j,t[6]=d*C+_*F+T*j,t[7]=v*C+x*F+P*j,t[8]=c*z+m*N+w*M,t[9]=p*z+g*N+E*M,t[10]=d*z+_*N+T*M,t[11]=v*z+x*N+P*M,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function Ru(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[4],o=r[5],s=r[6],u=r[7],f=r[8],l=r[9],c=r[10],p=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*i+f*n,t[5]=o*i+l*n,t[6]=s*i+c*n,t[7]=u*i+p*n,t[8]=f*i-a*n,t[9]=l*i-o*n,t[10]=c*i-s*n,t[11]=p*i-u*n,t}function hb(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],f=r[8],l=r[9],c=r[10],p=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i-f*n,t[1]=o*i-l*n,t[2]=s*i-c*n,t[3]=u*i-p*n,t[8]=a*n+f*i,t[9]=o*n+l*i,t[10]=s*n+c*i,t[11]=u*n+p*i,t}function Cu(t,r,e){var n=Math.sin(e),i=Math.cos(e),a=r[0],o=r[1],s=r[2],u=r[3],f=r[4],l=r[5],c=r[6],p=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*i+f*n,t[1]=o*i+l*n,t[2]=s*i+c*n,t[3]=u*i+p*n,t[4]=f*i-a*n,t[5]=l*i-o*n,t[6]=c*i-s*n,t[7]=p*i-u*n,t}function pb(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=e+e,s=n+n,u=i+i,f=e*o,l=n*o,c=n*s,p=i*o,d=i*s,v=i*u,m=a*o,g=a*s,_=a*u;return t[0]=1-c-v,t[1]=l+_,t[2]=p-g,t[3]=0,t[4]=l-_,t[5]=1-f-v,t[6]=d+m,t[7]=0,t[8]=p+g,t[9]=d-m,t[10]=1-f-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function db(t,r,e,n,i,a,o){var s=1/(e-r),u=1/(i-n),f=1/(a-o);return t[0]=a*2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*u,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(i+n)*u,t[10]=(o+a)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*f,t[15]=0,t}function AL(t,r,e,n,i){var a=1/Math.tan(r/2),o;return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}var Iu=AL;function ML(t,r,e,n,i,a,o){var s=1/(r-e),u=1/(n-i),f=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(r+e)*s,t[13]=(i+n)*u,t[14]=(o+a)*f,t[15]=1,t}var vb=ML;function mb(t,r,e,n){var i,a,o,s,u,f,l,c,p,d,v=r[0],m=r[1],g=r[2],_=n[0],x=n[1],w=n[2],E=e[0],T=e[1],P=e[2];return Math.abs(v-E)<We&&Math.abs(m-T)<We&&Math.abs(g-P)<We?OL(t):(l=v-E,c=m-T,p=g-P,d=1/Math.hypot(l,c,p),l*=d,c*=d,p*=d,i=x*p-w*c,a=w*l-_*p,o=_*c-x*l,d=Math.hypot(i,a,o),d?(d=1/d,i*=d,a*=d,o*=d):(i=0,a=0,o=0),s=c*o-p*a,u=p*i-l*o,f=l*a-c*i,d=Math.hypot(s,u,f),d?(d=1/d,s*=d,u*=d,f*=d):(s=0,u=0,f=0),t[0]=i,t[1]=s,t[2]=l,t[3]=0,t[4]=a,t[5]=u,t[6]=c,t[7]=0,t[8]=o,t[9]=f,t[10]=p,t[11]=0,t[12]=-(i*v+a*m+o*g),t[13]=-(s*v+u*m+f*g),t[14]=-(l*v+c*m+p*g),t[15]=1,t)}function hh(t,r){var e=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],f=t[7],l=t[8],c=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],_=t[15],x=r[0],w=r[1],E=r[2],T=r[3],P=r[4],A=r[5],D=r[6],L=r[7],C=r[8],F=r[9],j=r[10],z=r[11],N=r[12],M=r[13],k=r[14],R=r[15];return Math.abs(e-x)<=We*Math.max(1,Math.abs(e),Math.abs(x))&&Math.abs(n-w)<=We*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(i-E)<=We*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-T)<=We*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(o-P)<=We*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(s-A)<=We*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-D)<=We*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(f-L)<=We*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(l-C)<=We*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(c-F)<=We*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(p-j)<=We*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(d-z)<=We*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(v-N)<=We*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(m-M)<=We*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(g-k)<=We*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(_-R)<=We*Math.max(1,Math.abs(_),Math.abs(R))}function kL(){var t=new Ir(4);return Ir!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function gb(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function Lu(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var SH=function(){var t=kL();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function CL(t){var r=IL();return function(){var n=ct(t),i;if(r){var a=ct(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return cr(this,i)}}function IL(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(mh||(mh={}));var LL=45*Math.PI/180,DL=1,dh=.1,vh=500,jL=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ve=function(t){lr(e,t);var r=CL(e);function e(n){var i;return Nt(this,e),i=r.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(n)?i.copy(n):i.identity(),i}return Bt(e,[{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"INDICES",get:function(){return mh}},{key:"copy",value:function(i){return this[0]=i[0],this[1]=i[1],this[2]=i[2],this[3]=i[3],this[4]=i[4],this[5]=i[5],this[6]=i[6],this[7]=i[7],this[8]=i[8],this[9]=i[9],this[10]=i[10],this[11]=i[11],this[12]=i[12],this[13]=i[13],this[14]=i[14],this[15]=i[15],this.check()}},{key:"set",value:function(i,a,o,s,u,f,l,c,p,d,v,m,g,_,x,w){return this[0]=i,this[1]=a,this[2]=o,this[3]=s,this[4]=u,this[5]=f,this[6]=l,this[7]=c,this[8]=p,this[9]=d,this[10]=v,this[11]=m,this[12]=g,this[13]=_,this[14]=x,this[15]=w,this.check()}},{key:"setRowMajor",value:function(i,a,o,s,u,f,l,c,p,d,v,m,g,_,x,w){return this[0]=i,this[1]=u,this[2]=p,this[3]=g,this[4]=a,this[5]=f,this[6]=d,this[7]=_,this[8]=o,this[9]=l,this[10]=v,this[11]=x,this[12]=s,this[13]=c,this[14]=m,this[15]=w,this.check()}},{key:"toRowMajor",value:function(i){return i[0]=this[0],i[1]=this[4],i[2]=this[8],i[3]=this[12],i[4]=this[1],i[5]=this[5],i[6]=this[9],i[7]=this[13],i[8]=this[2],i[9]=this[6],i[10]=this[10],i[11]=this[14],i[12]=this[3],i[13]=this[7],i[14]=this[11],i[15]=this[15],i}},{key:"identity",value:function(){return this.copy(jL)}},{key:"fromObject",value:function(i){return this.check()}},{key:"fromQuaternion",value:function(i){return pb(this,i),this.check()}},{key:"frustum",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,f=i.near,l=f===void 0?dh:f,c=i.far,p=c===void 0?vh:c;return p===1/0?BL(this,a,o,s,u,l):db(this,a,o,s,u,l,p),this.check()}},{key:"lookAt",value:function(i){var a=i.eye,o=i.center,s=o===void 0?[0,0,0]:o,u=i.up,f=u===void 0?[0,1,0]:u;return mb(this,a,s,f),this.check()}},{key:"ortho",value:function(i){var a=i.left,o=i.right,s=i.bottom,u=i.top,f=i.near,l=f===void 0?dh:f,c=i.far,p=c===void 0?vh:c;return vb(this,a,o,s,u,l,p),this.check()}},{key:"orthographic",value:function(i){var a=i.fovy,o=a===void 0?LL:a,s=i.aspect,u=s===void 0?DL:s,f=i.focalDistance,l=f===void 0?1:f,c=i.near,p=c===void 0?dh:c,d=i.far,v=d===void 0?vh:d;yb(o);var m=o/2,g=l*Math.tan(m),_=g*u;return this.ortho({left:-_,right:_,bottom:-g,top:g,near:p,far:v})}},{key:"perspective",value:function(i){var a=i.fovy,o=a===void 0?45*Math.PI/180:a,s=i.aspect,u=s===void 0?1:s,f=i.near,l=f===void 0?.1:f,c=i.far,p=c===void 0?500:c;return yb(o),Iu(this,o,u,l,p),this.check()}},{key:"determinant",value:function(){return lb(this)}},{key:"getScale",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),i[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),i[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),i}},{key:"getTranslation",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return i[0]=this[12],i[1]=this[13],i[2]=this[14],i}},{key:"getRotation",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],f=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*f,i[3]=0,i[4]=this[4]*s,i[5]=this[5]*u,i[6]=this[6]*f,i[7]=0,i[8]=this[8]*s,i[9]=this[9]*u,i[10]=this[10]*f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}},{key:"getRotationMatrix3",value:function(i,a){i=i||[-0,-0,-0,-0,-0,-0,-0,-0,-0],a=a||[-0,-0,-0];var o=this.getScale(a),s=1/o[0],u=1/o[1],f=1/o[2];return i[0]=this[0]*s,i[1]=this[1]*u,i[2]=this[2]*f,i[3]=this[4]*s,i[4]=this[5]*u,i[5]=this[6]*f,i[6]=this[8]*s,i[7]=this[9]*u,i[8]=this[10]*f,i}},{key:"transpose",value:function(){return fb(this,this),this.check()}},{key:"invert",value:function(){return ku(this,this),this.check()}},{key:"multiplyLeft",value:function(i){return ii(this,i,this),this.check()}},{key:"multiplyRight",value:function(i){return ii(this,this,i),this.check()}},{key:"rotateX",value:function(i){return Ru(this,this,i),this.check()}},{key:"rotateY",value:function(i){return hb(this,this,i),this.check()}},{key:"rotateZ",value:function(i){return Cu(this,this,i),this.check()}},{key:"rotateXYZ",value:function(i){return this.rotateX(i[0]).rotateY(i[1]).rotateZ(i[2])}},{key:"rotateAxis",value:function(i,a){return cb(this,this,i,a),this.check()}},{key:"scale",value:function(i){return Yi(this,this,Array.isArray(i)?i:[i,i,i]),this.check()}},{key:"translate",value:function(i){return ai(this,this,i),this.check()}},{key:"transform",value:function(i,a){return i.length===4?(a=Lu(a||[-0,-0,-0,-0],i,this),Eu(a,4),a):this.transformAsPoint(i,a)}},{key:"transformAsPoint",value:function(i,a){var o=i.length,s;switch(o){case 2:s=Y_(a||[-0,-0],i,this);break;case 3:s=Au(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return Eu(s,i.length),s}},{key:"transformAsVector",value:function(i,a){var o;switch(i.length){case 2:o=q_(a||[-0,-0],i,this);break;case 3:o=Ou(a||[-0,-0,-0],i,this);break;default:throw new Error("Illegal vector")}return Eu(o,i.length),o}},{key:"transformPoint",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformVector",value:function(i,a){return this.transformAsPoint(i,a)}},{key:"transformDirection",value:function(i,a){return this.transformAsVector(i,a)}},{key:"makeRotationX",value:function(i){return this.identity().rotateX(i)}},{key:"makeTranslation",value:function(i,a,o){return this.identity().translate([i,a,o])}}],[{key:"IDENTITY",get:function(){return NL()}},{key:"ZERO",get:function(){return FL()}}]),e}(ub);var Du,ju;function FL(){return Du||(Du=new Ve([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Du)),Du}function NL(){return ju||(ju=new Ve,Object.freeze(ju)),ju}function yb(t){if(t>Math.PI*2)throw Error("expected radians")}function BL(t,r,e,n,i,a){var o=2*a/(e-r),s=2*a/(i-n),u=(e+r)/(e-r),f=(i+n)/(i-n),l=-1,c=-1,p=-2*a;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=f,t[10]=l,t[11]=c,t[12]=0,t[13]=0,t[14]=p,t[15]=0,t}function gh(t){if(Array.isArray(t))return t}function yh(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function Fu(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _h(t,r){if(t){if(typeof t=="string")return Fu(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Fu(t,r)}}function bh(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wh(t,r){return gh(t)||yh(t,r)||_h(t,r)||bh()}function Xi(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var _b=1e-6,VL=6371e3,lo=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.phi,n=e===void 0?0:e,i=r.theta,a=i===void 0?0:i,o=r.radius,s=o===void 0?1:o,u=r.bearing,f=r.pitch,l=r.altitude,c=r.radiusScale,p=c===void 0?VL:c;Nt(this,t),Xi(this,"phi",void 0),Xi(this,"theta",void 0),Xi(this,"radius",void 0),Xi(this,"radiusScale",void 0),this.phi=n,this.theta=a,this.radius=s||l||1,this.radiusScale=p||1,u!==void 0&&(this.bearing=u),f!==void 0&&(this.pitch=f),this.check()}return Bt(t,[{key:"toString",value:function(){return this.formatString(rt)}},{key:"formatString",value:function(e){var n=e.printTypes,i=n===void 0?!1:n,a=oo;return"".concat(i?"Spherical":"","[rho:").concat(a(this.radius),",theta:").concat(a(this.theta),",phi:").concat(a(this.phi),"]")}},{key:"equals",value:function(e){return Vt(this.radius,e.radius)&&Vt(this.theta,e.theta)&&Vt(this.phi,e.phi)}},{key:"exactEquals",value:function(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}},{key:"bearing",get:function(){return 180-On(this.phi)},set:function(e){this.phi=Math.PI-Wi(e)}},{key:"pitch",get:function(){return On(this.theta)},set:function(e){this.theta=Wi(e)}},{key:"longitude",get:function(){return On(this.phi)}},{key:"latitude",get:function(){return On(this.theta)}},{key:"lng",get:function(){return On(this.phi)}},{key:"lat",get:function(){return On(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}},{key:"clone",value:function(){return new t().copy(this)}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}},{key:"fromLngLatZ",value:function(e){var n=wh(e,3),i=n[0],a=n[1],o=n[2];return this.radius=1+o/this.radiusScale,this.phi=Wi(a),this.theta=Wi(i),this.check()}},{key:"fromVector3",value:function(e){return this.radius=K_(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(Te(e[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new nt(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(_b,Math.min(Math.PI-_b,this.phi)),this}},{key:"check",value:function(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),t}();var xh=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;function zL(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=UL(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function UL(t,r){if(t){if(typeof t=="string")return bb(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bb(t,r)}}function bb(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var GL={lightSources:{}};function Th(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.color,e=r===void 0?[0,0,0]:r,n=t.intensity,i=n===void 0?1:n;return e.map(function(a){return a*i/255})}function $L(t){var r=t.ambientLight,e=t.pointLights,n=e===void 0?[]:e,i=t.directionalLights,a=i===void 0?[]:i,o={};return r?o["lighting_uAmbientLight.color"]=Th(r):o["lighting_uAmbientLight.color"]=[0,0,0],n.forEach(function(s,u){o["lighting_uPointLight[".concat(u,"].color")]=Th(s),o["lighting_uPointLight[".concat(u,"].position")]=s.position,o["lighting_uPointLight[".concat(u,"].attenuation")]=s.attenuation||[1,0,0]}),o.lighting_uPointLightCount=n.length,a.forEach(function(s,u){o["lighting_uDirectionalLight[".concat(u,"].color")]=Th(s),o["lighting_uDirectionalLight[".concat(u,"].direction")]=s.direction}),o.lighting_uDirectionalLightCount=a.length,o}function wb(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:GL;if("lightSources"in t){var r=t.lightSources||{},e=r.ambientLight,n=r.pointLights,i=r.directionalLights,a=e||n&&n.length>0||i&&i.length>0;return a?Object.assign({},$L({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){var o={pointLights:[],directionalLights:[]},s=zL(t.lights||[]),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;switch(f.type){case"ambient":o.ambientLight=f;break;case"directional":o.directionalLights.push(f);break;case"point":o.pointLights.push(f);break;default:}}}catch(l){s.e(l)}finally{s.f()}return wb({lightSources:o})}return{}}var Eh={name:"lights",vs:xh,fs:xh,getUniforms:wb,defines:{MAX_LIGHTS:3}};var HL=new Uint8Array([0,255,255,255]),WL={pickingSelectedColor:null,pickingHighlightColor:HL,pickingActive:!1,pickingAttribute:!1};function YL(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:WL,r={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)r.picking_uSelectedColorValid=0;else{var e=t.pickingSelectedColor.slice(0,3);r.picking_uSelectedColorValid=1,r.picking_uSelectedColor=e}if(t.pickingHighlightColor){var n=Array.from(t.pickingHighlightColor,function(i){return i/255});Number.isFinite(n[3])||(n[3]=1),r.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(r.picking_uActive=Boolean(t.pickingActive),r.picking_uAttribute=Boolean(t.pickingAttribute)),r}var XL=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,qL=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,Nu={name:"picking",vs:XL,fs:qL,getUniforms:YL};var Ph=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;var ZL={};function KL(t){var r=t.ambient,e=r===void 0?.35:r,n=t.diffuse,i=n===void 0?.6:n,a=t.shininess,o=a===void 0?32:a,s=t.specularColor,u=s===void 0?[30,30,30]:s;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:o,lighting_uSpecularColor:u.map(function(f){return f/255})}}function xb(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ZL;if(!("material"in t))return{};var r=t.material;return r?KL(r):{lighting_uEnabled:!1}}var co={name:"gouraud-lighting",dependencies:[Eh],vs:Ph,defines:{LIGHTING_VERTEX:1},getUniforms:xb},ho={name:"phong-lighting",dependencies:[Eh],fs:Ph,defines:{LIGHTING_FRAGMENT:1},getUniforms:xb};var QL=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,Sh={name:"transform",vs:QL,fs:null};function Tb(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=JL(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function JL(t,r){if(t){if(typeof t=="string")return Eb(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Eb(t,r)}}function Eb(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Lr=function(){function t(r){(0,Pb.default)(this,t),this.gl=r,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return(0,Sb.default)(t,[{key:"addDefaultModule",value:function(e){this._defaultModules.find(function(n){return n.name===e.name})||this._defaultModules.push(e),this.stateHash++}},{key:"removeDefaultModule",value:function(e){var n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(function(i){return i.name!==n}),this.stateHash++}},{key:"addShaderHook",value:function(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}},{key:"get",value:function(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.defines,f=u===void 0?{}:u,l=n.inject,c=l===void 0?{}:l,p=n.varyings,d=p===void 0?[]:p,v=n.bufferMode,m=v===void 0?35981:v,g=n.transpileToGLSL100,_=g===void 0?!1:g,x=this._getModuleList(n.modules),w=this._getHash(a),E=this._getHash(s),T=x.map(function(V){return e._getHash(V.name)}).sort(),P=d.map(function(V){return e._getHash(V)}),A=Object.keys(f).sort(),D=Object.keys(c).sort(),L=[],C=[],F=Tb(A),j;try{for(F.s();!(j=F.n()).done;){var z=j.value;L.push(this._getHash(z)),L.push(this._getHash(f[z]))}}catch(V){F.e(V)}finally{F.f()}var N=Tb(D),M;try{for(N.s();!(M=N.n()).done;){var k=M.value;C.push(this._getHash(k)),C.push(this._getHash(c[k]))}}catch(V){N.e(V)}finally{N.f()}var R="".concat(w,"/").concat(E,"D").concat(L.join("/"),"M").concat(T.join("/"),"I").concat(C.join("/"),"V").concat(P.join("/"),"H").concat(this.stateHash,"B").concat(m).concat(_?"T":"");if(!this._programCache[R]){var Y=oh(this.gl,{vs:a,fs:s,modules:x,inject:c,defines:f,hookFunctions:this._hookFunctions,transpileToGLSL100:_});this._programCache[R]=new En(this.gl,{hash:R,vs:Y.vs,fs:Y.fs,varyings:d,bufferMode:m}),this._getUniforms[R]=Y.getUniforms||function(V){},this._useCounts[R]=0}return this._useCounts[R]++,this._programCache[R]}},{key:"getUniforms",value:function(e){return this._getUniforms[e.hash]||null}},{key:"release",value:function(e){var n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}},{key:"_getHash",value:function(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}},{key:"_getModuleList",value:function(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=new Array(this._defaultModules.length+e.length),i={},a=0,o=0,s=this._defaultModules.length;o<s;++o){var u=this._defaultModules[o],f=u.name;n[a++]=u,i[f]=!0}for(var l=0,c=e.length;l<c;++l){var p=e[l],d=p.name;i[d]||(n[a++]=p,i[d]=!0)}return n.length=a,n}}],[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),t}();var Ab=h(G());function Ob(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function eD(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Ob(Object(e),!0).forEach(function(n){(0,Ab.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Ob(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tD={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Mb(t,r,e){var n={},i=r.indices;for(var a in r.attributes){var o=r.attributes[a],s=rD(a,e);if(a==="indices")i=o;else if(o.constant)n[s]=o.value;else{var u=o.value,f=eD({},o);delete f.value,n[s]=[new se(t,u),f],nD(a,f)}}if(i){var l=i.value||i;$(l instanceof Uint16Array||l instanceof Uint32Array,'attribute array for "indices" must be of integer type');var c={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};n.indices=[new se(t,{data:l,target:34963}),c]}return n}function rD(t,r){var e=r||{},n=e.attributeMap,i=n===void 0?tD:n;return i&&i[t]||t}function nD(t,r){var e;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":e="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":e="vectors";break;default:}switch(e){case"vectors":r.size=r.size||3;break;case"uvs":r.size=r.size||2;break;default:}$(Number.isFinite(r.size),"attribute ".concat(t," needs size"))}var qi=2,iD=1e4,aD="Model needs drawMode and vertexCount",kb=function(){},oD={},An=function(){function t(r){(0,Cb.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?Ae("model"):n;$(Kr(r)),this.id=i,this.gl=r,this.id=e.id||Ae("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(e)}return(0,Ib.default)(t,[{key:"initialize",value:function(e){this.props={},this.programManager=e.programManager||Lr.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var n=e.program,i=n===void 0?null:n,a=e.vs,o=e.fs,s=e.modules,u=e.defines,f=e.inject,l=e.varyings,c=e.bufferMode,p=e.transpileToGLSL100;this.programProps={program:i,vs:a,fs:o,modules:s,defines:u,inject:f,varyings:l,bufferMode:c,transpileToGLSL100:p},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},$(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),aD)}},{key:"setProps",value:function(e){this._setModelProps(e)}},{key:"delete",value:function(){for(var e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(e){var n=e.program,i=e.vs,a=e.fs,o=e.modules,s=e.defines,u=e.inject,f=e.varyings,l=e.bufferMode,c=e.transpileToGLSL100;this.programProps={program:n,vs:i,fs:a,modules:o,defines:s,inject:u,varyings:f,bufferMode:l,transpileToGLSL100:c},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(e){return this.drawMode=e,this}},{key:"setVertexCount",value:function(e){return $(Number.isFinite(e)),this.vertexCount=e,this}},{key:"setInstanceCount",value:function(e){return $(Number.isFinite(e)),this.instanceCount=e,this}},{key:"setGeometry",value:function(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Mb(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(kr(e))return this;var n={};for(var i in e){var a=e[i];n[i]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(n),this}},{key:"setUniforms",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}},{key:"getModuleUniforms",value:function(e){this._checkProgram();var n=this.programManager.getUniforms(this.program);return n?n(e):{}}},{key:"updateModuleSettings",value:function(e){var n=this.getModuleUniforms(e||{});return this.setUniforms(n)}},{key:"clear",value:function(e){return Cr(this.program.gl,e),this}},{key:"draw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();var n=e.moduleSettings,i=n===void 0?null:n,a=e.framebuffer,o=e.uniforms,s=o===void 0?{}:o,u=e.attributes,f=u===void 0?{}:u,l=e.transformFeedback,c=l===void 0?this.transformFeedback:l,p=e.parameters,d=p===void 0?{}:p,v=e.vertexArray,m=v===void 0?this.vertexArray:v;this.setAttributes(f),this.updateModuleSettings(i),this.setUniforms(s);var g;q.priority>=qi&&(g=this._logDrawCallStart(qi));var _=this.vertexArray.getDrawParams(),x=this.props,w=x.isIndexed,E=w===void 0?_.isIndexed:w,T=x.indexType,P=T===void 0?_.indexType:T,A=x.indexOffset,D=A===void 0?_.indexOffset:A,L=x.vertexArrayInstanced,C=L===void 0?_.isInstanced:L;C&&!this.isInstanced&&q.warn("Found instanced attributes on non-instanced model",this.id)();var F=this.isInstanced,j=this.instanceCount,z=this.props,N=z.onBeforeRender,M=N===void 0?kb:N,k=z.onAfterRender,R=k===void 0?kb:k;M(),this.program.setUniforms(this.uniforms);var Y=this.program.draw(Object.assign(oD,e,{logPriority:g,uniforms:null,framebuffer:a,parameters:d,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:m,transformFeedback:c,isIndexed:E,indexType:P,isInstanced:F,instanceCount:j,offset:E?D:0}));return R(),q.priority>=qi&&this._logDrawCallEnd(g,m,a),Y}},{key:"transform",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.discard,i=n===void 0?!0:n,a=e.feedbackBuffers,o=e.unbindModels,s=o===void 0?[]:o,u=e.parameters;a&&this._setFeedbackBuffers(a),i&&(u=Object.assign({},u,(0,Rb.default)({},35977,i))),s.forEach(function(f){return f.vertexArray.unbindBuffers()});try{this.draw(Object.assign({},e,{parameters:u}))}finally{s.forEach(function(f){return f.vertexArray.bindBuffers()})}return this}},{key:"render",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return q.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}},{key:"_setModelProps",value:function(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}},{key:"_checkProgram",value:function(){var e=this._programDirty||this.programManager.stateHash!==this._programManagerState;if(e){var n=this.programProps.program;if(n)this._managedProgram=!1;else{var i=this.programProps,a=i.vs,o=i.fs,s=i.modules,u=i.inject,f=i.defines,l=i.varyings,c=i.bufferMode,p=i.transpileToGLSL100;n=this.programManager.get({vs:a,fs:o,modules:s,inject:u,defines:f,varyings:l,bufferMode:c,transpileToGLSL100:p}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}$(n instanceof En,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new zc(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var e in this.geometryBuffers){var n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof se&&n.delete()}}},{key:"_setAnimationProps",value:function(e){this.animated&&$(e,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(kr(e))return this;var n=this.program.gl;return this.transformFeedback=this.transformFeedback||new Pn(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}},{key:"_logDrawCallStart",value:function(e){var n=e>3?0:iD;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),q.group(qi,">>> DRAWING MODEL ".concat(this.id),{collapsed:q.level<=2})(),e}},{key:"_logDrawCallEnd",value:function(e,n,i,a){if(e!==void 0){var o=$c({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),s=hu({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),u=s.table,f=s.unusedTable,l=s.unusedCount,c=hu({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0}),p=c.table,d=c.count;d>0&&q.log("MISSING UNIFORMS",Object.keys(p))(),l>0&&q.log("UNUSED UNIFORMS",Object.keys(f))();var v=Wc(this.vertexArray.configuration);q.table(e,o)(),q.table(e,u)(),q.table(e+1,v)(),a&&a.log({logLevel:qi,message:"Rendered to ".concat(a.id)}),q.groupEnd(qi)()}}}]),t}();var Hb=h(B()),Wb=h(U());var Db=h(B()),jb=h(U());function sD(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=uD(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function uD(t,r){if(t){if(typeof t=="string")return Lb(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Lb(t,r)}}function Lb(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Fb=function(){function t(r){(0,Db.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,jb.default)(t,[{key:"setupResources",value:function(e){var n=sD(this.bindings),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this._setupTransformFeedback(a,e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.varyings;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.transformFeedback,o=Object.assign({},i,e.attributes);return{attributes:o,transformFeedback:a}}},{key:"swap",value:function(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}},{key:"getBuffer",value:function(e){var n=this.bindings[this.currentIndex].feedbackBuffers,i=e?n[e]:null;return i?i instanceof se?i:i.buffer:null}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.varyingName,i=this.getBuffer(n);return i?i.getData():null}},{key:"delete",value:function(){for(var e in this.resources)this.resources[e].delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&$(te(this.gl))}},{key:"_getFeedbackBuffers",value:function(e){var n=e.sourceBuffers,i=n===void 0?{}:n,a={};if(this.bindings[this.currentIndex]&&Object.assign(a,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var o in this.feedbackMap){var s=this.feedbackMap[o];o in i&&(a[s]=o)}Object.assign(a,e.feedbackBuffers);for(var u in a){var f=a[u];if(typeof f=="string"){var l=i[f],c=l.byteLength,p=l.usage,d=l.accessor;a[u]=this._createNewBuffer(u,{byteLength:c,usage:p,accessor:d})}}return a}},{key:"_setupBuffers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=n===void 0?null:n;Object.assign(this.feedbackMap,e.feedbackMap);var a=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:i,feedbackBuffers:a})}},{key:"_setupTransformFeedback",value:function(e,n){var i=n.model,a=i.program;e.transformFeedback=new Pn(this.gl,{program:a,buffers:e.feedbackBuffers})}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var n=this._swapBuffers(this.bindings[this.currentIndex]),i=n.sourceBuffers,a=n.feedbackBuffers,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:i,feedbackBuffers:a})}}},{key:"_updateBinding",value:function(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}},{key:"_swapBuffers",value:function(e){if(!this.feedbackMap)return null;var n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(var a in this.feedbackMap){var o=this.feedbackMap[a];n[a]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[a],$(i[o]instanceof se)}return{sourceBuffers:n,feedbackBuffers:i}}},{key:"_createNewBuffer",value:function(e,n){var i=new se(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}();var zb=h(B()),Ub=h(U()),qt=h(G());var fD="transform_uSampler_",Bu="transform_uSize_",Nb="transform_position";function Bb(t){var r=t.vs,e=t.sourceTextureMap,n=t.targetTextureVarying,i=t.targetTexture,a=Object.keys(e),o=a.length,s=null,u={},f=r,l={};if(o>0||n){var c=f.split(`
`),p=c.slice();if(c.forEach(function(_,x,w){if(o>0){var E=pD(_,e);if(E){var T=E.updatedLine,P=E.inject;p[x]=T,l=$i([l,P]),Object.assign(u,E.samplerTextureMap),o--}}n&&!s&&(s=hD(_,n))}),n){$(i);var d="".concat(Bu).concat(n),v="uniform vec2 ".concat(d,`;
`),m="     vec2 ".concat(Nb," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(Nb,`, 0, 1.);
`),g={"vs:#decl":v,"vs:#main-start":m};l=$i([l,g])}f=p.join(`
`)}return{vs:f,targetTextureType:s,inject:l,samplerTextureMap:u}}function Vb(t){var r=t.sourceTextureMap,e=t.targetTextureVarying,n=t.targetTexture,i={},a,o;e&&(a=n.width,o=n.height,i["".concat(Bu).concat(e)]=[a,o]);for(var s in r){var u=r[s];a=u.width,o=u.height,i["".concat(Bu).concat(s)]=[a,o]}return i}function lD(t){return bu(t,["attribute","in"])}function cD(t){var r="".concat(fD).concat(t),e="".concat(Bu).concat(t),n="  uniform sampler2D ".concat(r,`;
  uniform vec2 `).concat(e,";");return{samplerName:r,sizeName:e,uniformDeclerations:n}}function hD(t,r){var e=bu(t,["varying","out"]);return e&&e.name===r?e.type:null}function pD(t,r){var e={},n=lD(t);if(!n)return null;var i=n.type,a=n.name;if(a&&r[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=cD(a),u=s.samplerName,f=s.sizeName,l=s.uniformDeclerations,c=sh(i),p="  ".concat(i," ").concat(a," = transform_getInput(").concat(u,", ").concat(f,").").concat(c,`;
`);e[u]=a;var d={"vs:#decl":l,"vs:#main-start":p};return{updatedLine:o,inject:d,samplerTextureMap:e}}return null}var Zi,dD=(Zi={},(0,qt.default)(Zi,10241,9728),(0,qt.default)(Zi,10240,9728),(0,qt.default)(Zi,10242,33071),(0,qt.default)(Zi,10243,33071),Zi),vD="transform_output",Gb=function(){function t(r){(0,zb.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(e),Object.seal(this)}return(0,Ub.default)(t,[{key:"updateModelProps",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this._processVertexShader(e);return Object.assign({},e,n)}},{key:"getDrawOptions",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceBuffers,a=n.sourceTextures,o=n.framebuffer,s=n.targetTexture,u=Object.assign({},i,e.attributes),f=Object.assign({},e.uniforms),l=Object.assign({},e.parameters),c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){u.transform_elementID=this.elementIDBuffer;for(var p in this.samplerTextureMap){var d=this.samplerTextureMap[p];f[p]=a[d]}this._setSourceTextureParameters();var v=Vb({sourceTextureMap:a,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(f,v)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,o.width,o.height]),{attributes:u,framebuffer:o,uniforms:f,discard:c,parameters:l}}},{key:"swap",value:function(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}},{key:"getTargetTexture",value:function(){var e=this.bindings[this.currentIndex].targetTexture;return e}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.packed,i=n===void 0?!1:n,a=this.bindings[this.currentIndex].framebuffer,o=en(a);if(!i)return o;for(var s=o.constructor,u=uh(this.targetTextureType),f=new s(o.length*u/4),l=0,c=0;c<o.length;c+=4)for(var p=0;p<u;p++)f[l++]=o[c+p];return f}},{key:"getFramebuffer",value:function(){var e=this.bindings[this.currentIndex];return e.framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e._targetTextureVarying,i=e._swapTexture;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}},{key:"_createTargetTexture",value:function(e){var n=e.sourceTextures,i=e.textureOrReference;if(i instanceof Ge)return i;var a=n[i];return a?(this._targetRefTexName=i,this._createNewTexture(a)):null}},{key:"_setupTextures",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.sourceBuffers,i=e._sourceTextures,a=i===void 0?{}:i,o=e._targetTexture,s=this._createTargetTexture({sourceTextures:a,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||a&&Object.keys(a).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:a,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}},{key:"_updateElementIDBuffer",value:function(e){if(!(typeof e!="number"||this.elementCount>=e)){var n=new Float32Array(e);n.forEach(function(i,a,o){o[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new se(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}}},{key:"_updateBindings",value:function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var n=this._swapTextures(this.bindings[this.currentIndex]),i=n.sourceTextures,a=n.targetTexture,o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:i,targetTexture:a})}}},{key:"_updateBinding",value:function(e,n){var i=n.sourceBuffers,a=n.sourceTextures,o=n.targetTexture;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;var s=o.width,u=o.height,f=e,l=f.framebuffer;l?(l.update({attachments:(0,qt.default)({},36064,o),resizeAttachments:!1}),l.resize({width:s,height:u})):e.framebuffer=new xe(this.gl,{id:"transform-framebuffer",width:s,height:u,attachments:(0,qt.default)({},36064,o)})}return e}},{key:"_setSourceTextureParameters",value:function(){var e=this.currentIndex,n=this.bindings[e].sourceTextures;for(var i in n)n[i].setParameters(dD)}},{key:"_swapTextures",value:function(e){if(!this._swapTexture)return null;var n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;var i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}},{key:"_createNewTexture",value:function(e){var n,i=Ui(e,{parameters:(n={},(0,qt.default)(n,10241,9728),(0,qt.default)(n,10240,9728),(0,qt.default)(n,10242,33071),(0,qt.default)(n,10243,33071),n),pixelStore:(0,qt.default)({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=i,i}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.bindings[this.currentIndex],i=n.sourceTextures,a=n.targetTexture,o=Bb({vs:e.vs,sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:a}),s=o.vs,u=o.uniforms,f=o.targetTextureType,l=o.inject,c=o.samplerTextureMap,p=$i([e.inject||{},l]);this.targetTextureType=f,this.samplerTextureMap=c;var d=e._fs||io({version:Gi(s),input:this.targetTextureVarying,inputType:f,output:vD}),v=this.hasSourceTextures||this.targetTextureVarying?[Sh].concat(e.modules||[]):e.modules;return{vs:s,fs:d,modules:v,uniforms:u,inject:p}}}]),t}();function po(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mD(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mD(t,r){if(t){if(typeof t=="string")return $b(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $b(t,r)}}function $b(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Dr=function(){function t(r){(0,Hb.default)(this,t);var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=r,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(e),Object.seal(this)}return(0,Wb.default)(t,[{key:"delete",value:function(){var e=this.model,n=this.bufferTransform,i=this.textureTransform;e&&e.delete(),n&&n.delete(),i&&i.delete()}},{key:"run",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.clearRenderTarget,i=n===void 0?!0:n,a=this._updateDrawOptions(e);i&&a.framebuffer&&a.framebuffer.clear({color:!0}),this.model.transform(a)}},{key:"swap",value:function(){var e=!1,n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=po(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;e=e||o.swap()}}catch(s){i.e(s)}finally{i.f()}$(e,"Nothing to swap")}},{key:"getBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}},{key:"getData",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=po(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getData(e);if(s)return s}}catch(u){i.e(u)}finally{i.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);var n=[this.bufferTransform,this.textureTransform].filter(Boolean),i=po(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.update(e)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_initialize",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=this.gl;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new An(n,Object.assign({},e,{fs:e.fs||io({version:Gi(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=po(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=s.updateModelProps(n)}}catch(u){a.e(u)}finally{a.f()}return n}},{key:"_buildResourceTransforms",value:function(e,n){gD(n)&&(this.bufferTransform=new Fb(e,n)),yD(n)&&(this.textureTransform=new Gb(e,n)),$(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(e){var n=Object.assign({},e),i=[this.bufferTransform,this.textureTransform].filter(Boolean),a=po(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;n=Object.assign(n,s.getDrawOptions(n))}}catch(u){a.e(u)}finally{a.f()}return n}}],[{key:"isSupported",value:function(e){return te(e)}}]),t}();function gD(t){return!!(!kr(t.feedbackBuffers)||!kr(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function yD(t){return!!(!kr(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}var qb=h(G()),Zb=h(B()),Kb=h(U());function Yb(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function _D(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Yb(Object(e),!0).forEach(function(n){(0,qb.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Yb(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Xb={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},bt=function(){function t(){(0,Zb.default)(this,t);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=r.id,n=e===void 0?Ae("geometry"):e,i=r.drawMode,a=i===void 0?Xb.TRIANGLES:i,o=r.attributes,s=o===void 0?{}:o,u=r.indices,f=u===void 0?null:u,l=r.vertexCount,c=l===void 0?null:l;this.id=n,this.drawMode=a|0,this.attributes={},this.userData={},this._setAttributes(s,f),this.vertexCount=c||this._calculateVertexCount(this.attributes,this.indices)}return(0,Kb.default)(t,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?_D({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(e){return"Geometry ".concat(this.id," attribute ").concat(e)}},{key:"_setAttributes",value:function(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(var i in e){var a=e[i];a=ArrayBuffer.isView(a)?{value:a}:a,$(ArrayBuffer.isView(a.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"?($(!this.indices),this.indices=a):this.attributes[i]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(e,n){if(n)return n.value.length;var i=1/0;for(var a in e){var o=e[a],s=o.value,u=o.size,f=o.constant;!f&&s&&u>=1&&(i=Math.min(i,s.length/u))}return $(Number.isFinite(i)),i}}],[{key:"DRAW_MODE",get:function(){return Xb}}]),t}();var a1=h(G()),o1=h(B()),s1=h(ie()),u1=h(ae()),Ah=h(ne());var Jb=h(G()),e1=h(B()),t1=h(ie()),r1=h(ae()),Oh=h(ne());function Qb(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Vu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Qb(Object(e),!0).forEach(function(n){(0,Jb.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Qb(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bD(t){var r=wD();return function(){var n=(0,Oh.default)(t),i;if(r){var a=(0,Oh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,r1.default)(this,i)}}function wD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xD={x:[2,0,1],y:[0,1,2],z:[1,2,0]},Mn=function(t){(0,t1.default)(e,t);var r=bD(e);function e(){(0,e1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("truncated-code-geometry"):i,o=TD(n),s=o.indices,u=o.attributes;return r.call(this,Vu(Vu({},n),{},{id:a,indices:s,attributes:Vu(Vu({},u),n.attributes)}))}return e}(bt);function TD(t){for(var r=t.bottomRadius,e=r===void 0?0:r,n=t.topRadius,i=n===void 0?0:n,a=t.height,o=a===void 0?1:a,s=t.nradial,u=s===void 0?10:s,f=t.nvertical,l=f===void 0?10:f,c=t.verticalAxis,p=c===void 0?"y":c,d=t.topCap,v=d===void 0?!1:d,m=t.bottomCap,g=m===void 0?!1:m,_=(v?2:0)+(g?2:0),x=(u+1)*(l+1+_),w=Math.atan2(e-i,o),E=Math.sin,T=Math.cos,P=Math.PI,A=T(w),D=E(w),L=v?-2:0,C=l+(g?2:0),F=u+1,j=new Uint16Array(u*(l+_)*6),z=xD[p],N=new Float32Array(x*3),M=new Float32Array(x*3),k=new Float32Array(x*2),R=0,Y=0,V=L;V<=C;V++){var Q=V/l,J=o*Q,re=void 0;V<0?(J=0,Q=1,re=e):V>l?(J=o,Q=1,re=i):re=e+(i-e)*(V/l),(V===-2||V===l+2)&&(re=0,Q=0),J-=o/2;for(var oe=0;oe<F;oe++){var ue=E(oe*P*2/u),Oe=T(oe*P*2/u);N[R+z[0]]=ue*re,N[R+z[1]]=J,N[R+z[2]]=Oe*re,M[R+z[0]]=V<0||V>l?0:ue*A,M[R+z[1]]=V<0?-1:V>l?1:D,M[R+z[2]]=V<0||V>l?0:Oe*A,k[Y+0]=oe/u,k[Y+1]=Q,Y+=2,R+=3}}for(var ee=0;ee<l+_;ee++)for(var Ee=0;Ee<u;Ee++){var de=(ee*u+Ee)*6;j[de+0]=F*(ee+0)+0+Ee,j[de+1]=F*(ee+0)+1+Ee,j[de+2]=F*(ee+1)+1+Ee,j[de+3]=F*(ee+0)+0+Ee,j[de+4]=F*(ee+1)+1+Ee,j[de+5]=F*(ee+1)+0+Ee}return{indices:j,attributes:{POSITION:{size:3,value:N},NORMAL:{size:3,value:M},TEXCOORD_0:{size:2,value:k}}}}function n1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function i1(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?n1(Object(e),!0).forEach(function(n){(0,a1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):n1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ED(t){var r=PD();return function(){var n=(0,Ah.default)(t),i;if(r){var a=(0,Ah.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,u1.default)(this,i)}}function PD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var zu=function(t){(0,s1.default)(e,t);var r=ED(e);function e(){(0,o1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("cone-geometry"):i,o=n.radius,s=o===void 0?1:o,u=n.cap,f=u===void 0?!0:u;return r.call(this,i1(i1({},n),{},{id:a,topRadius:0,topCap:Boolean(f),bottomCap:Boolean(f),bottomRadius:s}))}return e}(Mn);var l1=h(G()),c1=h(B()),h1=h(ie()),p1=h(ae()),Mh=h(ne());function f1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Uu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?f1(Object(e),!0).forEach(function(n){(0,l1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function SD(t){var r=OD();return function(){var n=(0,Mh.default)(t),i;if(r){var a=(0,Mh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,p1.default)(this,i)}}function OD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AD=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),MD=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),kD=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),RD=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),CD={POSITION:{size:3,value:new Float32Array(MD)},NORMAL:{size:3,value:new Float32Array(kD)},TEXCOORD_0:{size:2,value:new Float32Array(RD)}},Gu=function(t){(0,h1.default)(e,t);var r=SD(e);function e(){(0,c1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("cube-geometry"):i;return r.call(this,Uu(Uu({},n),{},{id:a,indices:{size:1,value:new Uint16Array(AD)},attributes:Uu(Uu({},CD),n.attributes)}))}return e}(bt);var m1=h(G()),g1=h(B()),y1=h(ie()),_1=h(ae()),kh=h(ne());function d1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function v1(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?d1(Object(e),!0).forEach(function(n){(0,m1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ID(t){var r=LD();return function(){var n=(0,kh.default)(t),i;if(r){var a=(0,kh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_1.default)(this,i)}}function LD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $u=function(t){(0,y1.default)(e,t);var r=ID(e);function e(){(0,g1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("cylinder-geometry"):i,o=n.radius,s=o===void 0?1:o;return r.call(this,v1(v1({},n),{},{id:a,bottomRadius:s,topRadius:s}))}return e}(Mn);var w1=h(G()),x1=h(B()),T1=h(ie()),E1=h(ae()),Rh=h(ne());function b1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?b1(Object(e),!0).forEach(function(n){(0,w1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):b1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function DD(t){var r=jD();return function(){var n=(0,Rh.default)(t),i;if(r){var a=(0,Rh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,E1.default)(this,i)}}function jD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FD=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],ND=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],Wu=function(t){(0,T1.default)(e,t);var r=DD(e);function e(){(0,x1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("ico-sphere-geometry"):i,o=BD(n),s=o.indices,u=o.attributes;return r.call(this,Hu(Hu({},n),{},{id:a,indices:s,attributes:Hu(Hu({},u),n.attributes)}))}return e}(bt);function BD(t){var r=t.iterations,e=r===void 0?0:r,n=Math.PI,i=n*2,a=[].concat(FD),o=[].concat(ND);a.push(),o.push();for(var s=function(){var ar={};return function(or,sr){or*=3,sr*=3;var Mi=or<sr?or:sr,Mt=or>sr?or:sr,La="".concat(Mi,"|").concat(Mt);if(La in ar)return ar[La];var Nl=a[or],Bl=a[or+1],Vl=a[or+2],zl=a[sr],vs=a[sr+1],ms=a[sr+2],$n=(Nl+zl)/2,Hn=(Bl+vs)/2,Yr=(Vl+ms)/2,Wn=Math.sqrt($n*$n+Hn*Hn+Yr*Yr);return $n/=Wn,Hn/=Wn,Yr/=Wn,a.push($n,Hn,Yr),ar[La]=a.length/3-1}}(),u=0;u<e;u++){for(var f=[],l=0;l<o.length;l+=3){var c=s(o[l+0],o[l+1]),p=s(o[l+1],o[l+2]),d=s(o[l+2],o[l+0]);f.push(d,o[l+0],c,c,o[l+1],p,p,o[l+2],d,c,p,d)}o=f}for(var v=new Array(a.length),m=new Array(a.length/3*2),g=o.length,_=g-3;_>=0;_-=3){var x=o[_+0],w=o[_+1],E=o[_+2],T=x*3,P=w*3,A=E*3,D=x*2,L=w*2,C=E*2,F=a[T+0],j=a[T+1],z=a[T+2],N=Math.acos(z/Math.sqrt(F*F+j*j+z*z)),M=Math.atan2(j,F)+n,k=N/n,R=1-M/i,Y=a[P+0],V=a[P+1],Q=a[P+2],J=Math.acos(Q/Math.sqrt(Y*Y+V*V+Q*Q)),re=Math.atan2(V,Y)+n,oe=J/n,ue=1-re/i,Oe=a[A+0],ee=a[A+1],Ee=a[A+2],de=Math.acos(Ee/Math.sqrt(Oe*Oe+ee*ee+Ee*Ee)),Qe=Math.atan2(ee,Oe)+n,mn=de/n,Sr=1-Qe/i,Un=[Oe-Y,ee-V,Ee-Q],Gn=[F-Y,j-V,z-Q],ut=new nt(Un).cross(Gn).normalize(),be=void 0;(R===0||ue===0||Sr===0)&&(R===0||R>.5)&&(ue===0||ue>.5)&&(Sr===0||Sr>.5)&&(a.push(a[T+0],a[T+1],a[T+2]),be=a.length/3-1,o.push(be),m[be*2+0]=1,m[be*2+1]=k,v[be*3+0]=ut.x,v[be*3+1]=ut.y,v[be*3+2]=ut.z,a.push(a[P+0],a[P+1],a[P+2]),be=a.length/3-1,o.push(be),m[be*2+0]=1,m[be*2+1]=oe,v[be*3+0]=ut.x,v[be*3+1]=ut.y,v[be*3+2]=ut.z,a.push(a[A+0],a[A+1],a[A+2]),be=a.length/3-1,o.push(be),m[be*2+0]=1,m[be*2+1]=mn,v[be*3+0]=ut.x,v[be*3+1]=ut.y,v[be*3+2]=ut.z),v[T+0]=v[P+0]=v[A+0]=ut.x,v[T+1]=v[P+1]=v[A+1]=ut.y,v[T+2]=v[P+2]=v[A+2]=ut.z,m[D+0]=R,m[D+1]=k,m[L+0]=ue,m[L+1]=oe,m[C+0]=Sr,m[C+1]=mn}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(v)},TEXCOORD_0:{size:2,value:new Float32Array(m)}}}}var O1=h(G()),A1=h(B()),M1=h(ie()),k1=h(ae()),Ch=h(ne());function P1(t){var r=t.indices,e=t.attributes;if(!r)return t;var n=r.value.length,i={};for(var a in e){var o=e[a],s=o.constant,u=o.value,f=o.size;if(!(s||!f)){for(var l=new u.constructor(n*f),c=0;c<n;++c)for(var p=r.value[c],d=0;d<f;d++)l[c*f+d]=u[p*f+d];i[a]={size:f,value:l}}}return{attributes:Object.assign({},e,i)}}function S1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Yu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?S1(Object(e),!0).forEach(function(n){(0,O1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):S1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function VD(t){var r=zD();return function(){var n=(0,Ch.default)(t),i;if(r){var a=(0,Ch.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,k1.default)(this,i)}}function zD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Xu=function(t){(0,M1.default)(e,t);var r=VD(e);function e(){(0,A1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("plane-geometry"):i,o=UD(n),s=o.indices,u=o.attributes;return r.call(this,Yu(Yu({},n),{},{id:a,indices:s,attributes:Yu(Yu({},u),n.attributes)}))}return e}(bt);function UD(t){var r=t.type,e=r===void 0?"x,y":r,n=t.offset,i=n===void 0?0:n,a=t.flipCull,o=a===void 0?!1:a,s=t.unpack,u=s===void 0?!1:s,f=e.split(","),l=t["".concat(f[0],"len")]||1,c=t["".concat(f[1],"len")]||1,p=t["n".concat(f[0])]||1,d=t["n".concat(f[1])]||1,v=(p+1)*(d+1),m=new Float32Array(v*3),g=new Float32Array(v*3),_=new Float32Array(v*2);o&&(l=-l);for(var x=0,w=0,E=0;E<=d;E++)for(var T=0;T<=p;T++){var P=T/p,A=E/d;switch(_[x+0]=o?1-P:P,_[x+1]=A,e){case"x,y":m[w+0]=l*P-l*.5,m[w+1]=c*A-c*.5,m[w+2]=i,g[w+0]=0,g[w+1]=0,g[w+2]=o?1:-1;break;case"x,z":m[w+0]=l*P-l*.5,m[w+1]=i,m[w+2]=c*A-c*.5,g[w+0]=0,g[w+1]=o?1:-1,g[w+2]=0;break;case"y,z":m[w+0]=i,m[w+1]=l*P-l*.5,m[w+2]=c*A-c*.5,g[w+0]=o?1:-1,g[w+1]=0,g[w+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}x+=2,w+=3}for(var D=p+1,L=new Uint16Array(p*d*6),C=0;C<d;C++)for(var F=0;F<p;F++){var j=(C*p+F)*6;L[j+0]=(C+0)*D+F,L[j+1]=(C+1)*D+F,L[j+2]=(C+0)*D+F+1,L[j+3]=(C+1)*D+F,L[j+4]=(C+1)*D+F+1,L[j+5]=(C+0)*D+F+1}var z={indices:{size:1,value:L},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:_}}};return u?P1(z):z}var C1=h(G()),I1=h(B()),L1=h(ie()),D1=h(ae()),Ih=h(ne());function R1(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function qu(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?R1(Object(e),!0).forEach(function(n){(0,C1.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):R1(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function GD(t){var r=$D();return function(){var n=(0,Ih.default)(t),i;if(r){var a=(0,Ih.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,D1.default)(this,i)}}function $D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Zu=function(t){(0,L1.default)(e,t);var r=GD(e);function e(){(0,I1.default)(this,e);var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.id,a=i===void 0?Ae("sphere-geometry"):i,o=HD(n),s=o.indices,u=o.attributes;return r.call(this,qu(qu({},n),{},{id:a,indices:s,attributes:qu(qu({},u),n.attributes)}))}return e}(bt);function HD(t){var r=t.nlat,e=r===void 0?10:r,n=t.nlong,i=n===void 0?10:n,a=t.radius,o=a===void 0?1:a,s=0,u=Math.PI,f=u-s,l=0,c=2*Math.PI,p=c-l,d=(e+1)*(i+1);if(typeof o=="number"){var v=o;o=function(ee,Ee,de,Qe,mn){return v}}for(var m=new Float32Array(d*3),g=new Float32Array(d*3),_=new Float32Array(d*2),x=d>65535?Uint32Array:Uint16Array,w=new x(e*i*6),E=0;E<=e;E++)for(var T=0;T<=i;T++){var P=T/i,A=E/e,D=T+E*(i+1),L=D*2,C=D*3,F=p*P,j=f*A,z=Math.sin(F),N=Math.cos(F),M=Math.sin(j),k=Math.cos(j),R=N*M,Y=k,V=z*M,Q=o(R,Y,V,P,A);m[C+0]=Q*R,m[C+1]=Q*Y,m[C+2]=Q*V,g[C+0]=R,g[C+1]=Y,g[C+2]=V,_[L+0]=P,_[L+1]=1-A}for(var J=i+1,re=0;re<i;re++)for(var oe=0;oe<e;oe++){var ue=(re*e+oe)*6;w[ue+0]=oe*J+re,w[ue+1]=oe*J+re+1,w[ue+2]=(oe+1)*J+re,w[ue+3]=(oe+1)*J+re,w[ue+4]=oe*J+re+1,w[ue+5]=(oe+1)*J+re+1}return{indices:{size:1,value:w},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:g},TEXCOORD_0:{size:2,value:_}}}}var F1=h(Ue()),N1=h(B()),B1=h(U());function Lh(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=WD(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function WD(t,r){if(t){if(typeof t=="string")return j1(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return j1(t,r)}}function j1(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var YD=1,XD=1,kn=function(){function t(){(0,N1.default)(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return(0,B1.default)(t,[{key:"addChannel",value:function(e){var n=e.delay,i=n===void 0?0:n,a=e.duration,o=a===void 0?Number.POSITIVE_INFINITY:a,s=e.rate,u=s===void 0?1:s,f=e.repeat,l=f===void 0?1:f,c=YD++,p={time:0,delay:i,duration:o,rate:u,repeat:l};return this._setChannelTime(p,this.time),this.channels.set(c,p),c}},{key:"removeChannel",value:function(e){this.channels.delete(e);var n=Lh(this.animations),i;try{for(n.s();!(i=n.n()).done;){var a=(0,F1.default)(i.value,2),o=a[0],s=a[1];s.channel===e&&this.detachAnimation(o)}}catch(u){n.e(u)}finally{n.f()}}},{key:"isFinished",value:function(e){var n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}},{key:"getTime",value:function(e){if(e===void 0)return this.time;var n=this.channels.get(e);return n===void 0?-1:n.time}},{key:"setTime",value:function(e){this.time=Math.max(0,e);var n=this.channels.values(),i=Lh(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;this._setChannelTime(o,this.time)}}catch(d){i.e(d)}finally{i.f()}var s=this.animations.values(),u=Lh(s),f;try{for(u.s();!(f=u.n()).done;){var l=f.value,c=l.animation,p=l.channel;c.setTime(this.getTime(p))}}catch(d){u.e(d)}finally{u.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(e,n){var i=XD++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}},{key:"detachAnimation",value:function(e){this.animations.delete(e)}},{key:"update",value:function(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}},{key:"_setChannelTime",value:function(e,n){var i=n-e.delay,a=e.duration*e.repeat;i>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}]),t}();var z1=h(B()),U1=h(ie()),G1=h(ae()),Dh=h(ne());function qD(t){var r=ZD();return function(){var n=(0,Dh.default)(t),i;if(r){var a=(0,Dh.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,G1.default)(this,i)}}function ZD(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var KD=`attribute vec2 aClipSpacePosition;
attribute vec2 aTexCoord;
attribute vec2 aCoordinate;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main(void) {
  gl_Position = vec4(aClipSpacePosition, 0., 1.);
  position = aClipSpacePosition;
  coordinate = aCoordinate;
  uv = aTexCoord;
}
`,V1=[-1,-1,1,-1,-1,1,1,1],Ku=function(t){(0,U1.default)(e,t);var r=qD(e);function e(n,i){var a;(0,z1.default)(this,e);var o=V1.map(function(s){return s===-1?0:s});return a=r.call(this,n,Object.assign({},i,{vs:KD,geometry:new bt({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(V1)},aTexCoord:{size:2,value:new Float32Array(o)},aCoordinate:{size:2,value:new Float32Array(o)}}})})),a.setVertexCount(4),a}return e}(An);var Gp={};Ps(Gp,{fetchFile:()=>Qi,load:()=>Cn,parse:()=>fi,registerLoaders:()=>Eo});var Fw=h(dt()),dp=h(et());function Rn(t,r){if(!t)throw new Error(r||"loader assertion failed.")}var H1=h(qe()),jr={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},QD=jr.self||jr.window||jr.global||{},JD=jr.window||jr.self||jr.global||{},ej=jr.global||jr.self||jr.window||{},tj=jr.document||{};var oi=Boolean((typeof process>"u"?"undefined":(0,H1.default)(process))!=="object"||String(process)!=="[object process]"||process.browser);var $1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),rj=$1&&parseFloat($1[1])||0;var W1="3.3.3";function wt(t,r){if(!t)throw new Error(r||"loaders.gl assertion failed.")}var X1=h(qe()),Fr={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},_Y=Fr.self||Fr.window||Fr.global||{},bY=Fr.window||Fr.self||Fr.global||{},wY=Fr.global||Fr.self||Fr.window||{},xY=Fr.document||{};var si=(typeof process>"u"?"undefined":(0,X1.default)(process))!=="object"||String(process)!=="[object process]"||process.browser;var q1=typeof window<"u"&&typeof window.orientation<"u",Y1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),TY=Y1&&parseFloat(Y1[1])||0;var Z1=h(B()),K1=h(U());var Q1=function(){function t(r,e){var n=this;(0,Z1.default)(this,t),X(this,"name",void 0),X(this,"workerThread",void 0),X(this,"isRunning",!0),X(this,"result",void 0),X(this,"_resolve",function(){}),X(this,"_reject",function(){}),this.name=r,this.workerThread=e,this.result=new Promise(function(i,a){n._resolve=i,n._reject=a})}return(0,K1.default)(t,[{key:"postMessage",value:function(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}},{key:"done",value:function(e){wt(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){wt(this.isRunning),this.isRunning=!1,this._reject(e)}}]),t}();var aw=h(B()),ow=h(U());var J1=h(B()),ew=h(U()),Qu=function(){function t(){(0,J1.default)(this,t)}return(0,ew.default)(t,[{key:"terminate",value:function(){}}]),t}();var Fh=new Map;function tw(t){wt(t.source&&!t.url||!t.source&&t.url);var r=Fh.get(t.source||t.url);return r||(t.url&&(r=nj(t.url),Fh.set(t.url,r)),t.source&&(r=rw(t.source),Fh.set(t.source,r))),wt(r),r}function nj(t){if(!t.startsWith("http"))return t;var r=ij(t);return rw(r)}function rw(t){var r=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(r)}function ij(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}var iw=h(qe());function Nh(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0,n=e||new Set;if(t){if(nw(t))n.add(t);else if(nw(t.buffer))n.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(r&&(0,iw.default)(t)==="object")for(var i in t)Nh(t[i],r,n)}}return e===void 0?Array.from(n):[]}function nw(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var Bh=function(){},vo=function(){function t(r){(0,aw.default)(this,t),X(this,"name",void 0),X(this,"source",void 0),X(this,"url",void 0),X(this,"terminated",!1),X(this,"worker",void 0),X(this,"onMessage",void 0),X(this,"onError",void 0),X(this,"_loadableURL","");var e=r.name,n=r.source,i=r.url;wt(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=Bh,this.onError=function(a){return console.log(a)},this.worker=si?this._createBrowserWorker():this._createNodeWorker()}return(0,ow.default)(t,[{key:"destroy",value:function(){this.onMessage=Bh,this.onError=Bh,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,n){n=n||Nh(e),this.worker.postMessage(e,n)}},{key:"_getErrorFromErrorEvent",value:function(e){var n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=tw({source:this.source,url:this.url});var n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=function(i){i.data?e.onMessage(i.data):e.onError(new Error("No data received"))},n.onerror=function(i){e.onError(e._getErrorFromErrorEvent(i)),e.terminated=!0},n.onmessageerror=function(i){return console.error(i)},n}},{key:"_createNodeWorker",value:function(){var e=this,n;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/"),a=i?this.url:"./".concat(this.url);n=new Qu(a,{eval:!1})}else if(this.source)n=new Qu(this.source,{eval:!0});else throw new Error("no worker");return n.on("message",function(o){e.onMessage(o)}),n.on("error",function(o){e.onError(o)}),n.on("exit",function(o){}),n}}],[{key:"isSupported",value:function(){return typeof Worker<"u"&&si||typeof Qu<"u"&&!si}}]),t}();var mw=h(G()),gw=h(B()),yw=h(U());var Vh=h(dt()),fw=h(G()),lw=h(B()),cw=h(U()),mo=h(et());function sw(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function uw(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sw(Object(e),!0).forEach(function(n){(0,fw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sw(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var hw=function(){function t(r){(0,lw.default)(this,t),X(this,"name","unnamed"),X(this,"source",void 0),X(this,"url",void 0),X(this,"maxConcurrency",1),X(this,"maxMobileConcurrency",1),X(this,"onDebug",function(){}),X(this,"reuseWorkers",!0),X(this,"props",{}),X(this,"jobQueue",[]),X(this,"idleQueue",[]),X(this,"count",0),X(this,"isDestroyed",!1),this.source=r.source,this.url=r.url,this.setProps(r)}return(0,cw.default)(t,[{key:"destroy",value:function(){this.idleQueue.forEach(function(e){return e.destroy()}),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=uw(uw({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}},{key:"startJob",value:function(){var r=(0,Vh.default)(mo.default.mark(function n(i){var a=this,o,s,u,f=arguments;return mo.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=f.length>1&&f[1]!==void 0?f[1]:function(p,d,v){return p.done(v)},s=f.length>2&&f[2]!==void 0?f[2]:function(p,d){return p.error(d)},u=new Promise(function(p){return a.jobQueue.push({name:i,onMessage:o,onError:s,onStart:p}),a}),this._startQueuedJob(),c.next=6,u;case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_startQueuedJob",value:function(){var r=(0,Vh.default)(mo.default.mark(function n(){var i,a,o;return mo.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(this.jobQueue.length){u.next=2;break}return u.abrupt("return");case 2:if(i=this._getAvailableWorker(),i){u.next=5;break}return u.abrupt("return");case 5:if(a=this.jobQueue.shift(),!a){u.next=18;break}return this.onDebug({message:"Starting job",name:a.name,workerThread:i,backlog:this.jobQueue.length}),o=new Q1(a.name,i),i.onMessage=function(f){return a.onMessage(o,f.type,f.payload)},i.onError=function(f){return a.onError(o,f)},a.onStart(o),u.prev=12,u.next=15,o.result;case 15:return u.prev=15,this.returnWorkerToQueue(i),u.finish(15);case 18:case"end":return u.stop()}},n,this,[[12,,15,18]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"returnWorkerToQueue",value:function(e){var n=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();n?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new vo({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return q1?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return vo.isSupported()}}]),t}();function pw(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=aj(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function aj(t,r){if(t){if(typeof t=="string")return dw(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return dw(t,r)}}function dw(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function vw(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function zh(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vw(Object(e),!0).forEach(function(n){(0,mw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vw(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var oj={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},go=function(){function t(r){(0,gw.default)(this,t),X(this,"props",void 0),X(this,"workerPools",new Map),this.props=zh({},oj),this.setProps(r),this.workerPools=new Map}return(0,yw.default)(t,[{key:"destroy",value:function(){var e=pw(this.workerPools.values()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.destroy()}}catch(a){e.e(a)}finally{e.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=zh(zh({},this.props),e);var n=pw(this.workerPools.values()),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.setProps(this._getWorkerPoolProps())}}catch(o){n.e(o)}finally{n.f()}}},{key:"getWorkerPool",value:function(e){var n=e.name,i=e.source,a=e.url,o=this.workerPools.get(n);return o||(o=new hw({name:n,source:i,url:a}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return vo.isSupported()}},{key:"getWorkerFarm",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}}]),t}();X(go,"_workerFarm",void 0);var sj="latest";function Uh(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=r[t.id]||{},n="".concat(t.id,"-worker.js"),i=e.workerUrl;if(!i&&t.id==="compression"&&(i=r.workerUrl),r._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(n)),!i){var a=t.version;a==="latest"&&(a=sj);var o=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(n)}return wt(i),i}function Gh(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:W1;wt(t,"no worker provided");var e=t.version;return!(!r||!e)}var Wh=h(dt()),yo=h(et());function Yh(t,r){return!go.isSupported()||!si&&!(r!=null&&r._nodeWorkers)?!1:t.worker&&r?.worker}function Xh(t,r,e,n,i){return $h.apply(this,arguments)}function $h(){return $h=(0,Wh.default)(yo.default.mark(function t(r,e,n,i,a){var o,s,u,f,l,c;return yo.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return o=r.id,s=Uh(r,n),u=go.getWorkerFarm(n),f=u.getWorkerPool({name:o,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),d.next=8,f.startJob("process-on-worker",fj.bind(null,a));case 8:return l=d.sent,l.postMessage("process",{input:e,options:n,context:i}),d.next=12,l.result;case 12:return c=d.sent,d.next=15,c.result;case 15:return d.abrupt("return",d.sent);case 16:case"end":return d.stop()}},t)})),$h.apply(this,arguments)}function fj(t,r,e,n){return Hh.apply(this,arguments)}function Hh(){return Hh=(0,Wh.default)(yo.default.mark(function t(r,e,n,i){var a,o,s,u,f;return yo.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:c.t0=n,c.next=c.t0==="done"?3:c.t0==="error"?5:c.t0==="process"?7:20;break;case 3:return e.done(i),c.abrupt("break",21);case 5:return e.error(new Error(i.error)),c.abrupt("break",21);case 7:return a=i.id,o=i.input,s=i.options,c.prev=8,c.next=11,r(o,s);case 11:u=c.sent,e.postMessage("done",{id:a,result:u}),c.next=19;break;case 15:c.prev=15,c.t1=c.catch(8),f=c.t1 instanceof Error?c.t1.message:"unknown error",e.postMessage("error",{id:a,error:f});case 19:return c.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return c.stop()}},t,null,[[8,15]])})),Hh.apply(this,arguments)}function lj(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cj(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cj(t,r){if(t){if(typeof t=="string")return bw(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return bw(t,r)}}function bw(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function qh(t,r,e){if(e=e||t.byteLength,t.byteLength<e||r.byteLength<e)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(r),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function Zh(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n=r.map(function(l){return l instanceof ArrayBuffer?new Uint8Array(l):l}),i=n.reduce(function(l,c){return l+c.byteLength},0),a=new Uint8Array(i),o=0,s=lj(n),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;a.set(f,o),o+=f.byteLength}}catch(l){s.e(l)}finally{s.f()}return a.buffer}var Sw=h(dt()),Ow=h(Ju()),ep=h(et());function rp(t){return tp.apply(this,arguments)}function tp(){return tp=(0,Sw.default)(ep.default.mark(function t(r){var e,n,i,a,o,s,u;return ep.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:e=[],n=!1,i=!1,l.prev=3,o=(0,Ow.default)(r);case 5:return l.next=7,o.next();case 7:if(!(n=!(s=l.sent).done)){l.next=13;break}u=s.value,e.push(u);case 10:n=!1,l.next=5;break;case 13:l.next=19;break;case 15:l.prev=15,l.t0=l.catch(3),i=!0,a=l.t0;case 19:if(l.prev=19,l.prev=20,!(n&&o.return!=null)){l.next=24;break}return l.next=24,o.return();case 24:if(l.prev=24,!i){l.next=27;break}throw a;case 27:return l.finish(24);case 28:return l.finish(19);case 29:return l.abrupt("return",Zh.apply(void 0,e));case 30:case"end":return l.stop()}},t,null,[[3,15,19,29],[20,,24,28]])})),tp.apply(this,arguments)}var yj="",Aw={};function np(t){for(var r in Aw)if(t.startsWith(r)){var e=Aw[r];t=t.replace(r,e)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(yj).concat(t)),t}var ip=h(qe()),ap=h(Mw());function kw(t){return t&&(0,ip.default)(t)==="object"&&t.isBuffer}function ef(t){if(kw(t))return ap.toArrayBuffer(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){var r=t,e=new TextEncoder().encode(r);return e.buffer}if(t&&(0,ip.default)(t)==="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var tf={};Ps(tf,{dirname:()=>bj,filename:()=>_j,join:()=>wj});function _j(t){var r=t&&t.lastIndexOf("/");return r>=0?t.substr(r+1):""}function bj(t){var r=t&&t.lastIndexOf("/");return r>=0?t.substr(0,r):""}function wj(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];var n="/";return r=r.map(function(i,a){return a&&(i=i.replace(new RegExp("^".concat(n)),"")),a!==r.length-1&&(i=i.replace(new RegExp("".concat(n,"$")),"")),i}),r.join(n)}var wo=h(dt()),an=h(et());var op=h(qe()),xj=function(r){return typeof r=="boolean"},bo=function(r){return typeof r=="function"},Ki=function(r){return r!==null&&(0,op.default)(r)==="object"},sp=function(r){return Ki(r)&&r.constructor==={}.constructor};var Rw=function(r){return r&&typeof r[Symbol.iterator]=="function"},Cw=function(r){return r&&typeof r[Symbol.asyncIterator]=="function"};var hr=function(r){return typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json};var pr=function(r){return typeof Blob<"u"&&r instanceof Blob},Iw=function(r){return r&&(0,op.default)(r)==="object"&&r.isBuffer};var Tj=function(r){return typeof ReadableStream<"u"&&r instanceof ReadableStream||Ki(r)&&bo(r.tee)&&bo(r.cancel)&&bo(r.getReader)};var Ej=function(r){return Ki(r)&&bo(r.read)&&bo(r.pipe)&&xj(r.readable)},rf=function(r){return Tj(r)||Ej(r)};var Pj=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Sj=/^([-\w.]+\/[-\w.+]+)/;function Lw(t){var r=Sj.exec(t);return r?r[1]:t}function up(t){var r=Pj.exec(t);return r?r[1]:""}var Oj=/\?.*/;function ui(t){if(hr(t)){var r=fp(t.url||""),e=t.headers.get("content-type")||"";return{url:r,type:Lw(e)||up(r)}}return pr(t)?{url:fp(t.name||""),type:t.type||""}:typeof t=="string"?{url:fp(t),type:up(t)}:{url:"",type:""}}function Dw(t){return hr(t)?t.headers["content-length"]||-1:pr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function fp(t){return t.replace(Oj,"")}function nf(t){return lp.apply(this,arguments)}function lp(){return lp=(0,wo.default)(an.default.mark(function t(r){var e,n,i,a,o,s,u;return an.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!hr(r)){l.next=2;break}return l.abrupt("return",r);case 2:return e={},n=Dw(r),n>=0&&(e["content-length"]=String(n)),i=ui(r),a=i.url,o=i.type,o&&(e["content-type"]=o),l.next=9,Mj(r);case 9:return s=l.sent,s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r)),u=new Response(r,{headers:e}),Object.defineProperty(u,"url",{value:a}),l.abrupt("return",u);case 15:case"end":return l.stop()}},t)})),lp.apply(this,arguments)}function jw(t){return cp.apply(this,arguments)}function cp(){return cp=(0,wo.default)(an.default.mark(function t(r){var e;return an.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.ok){i.next=5;break}return i.next=3,Aj(r);case 3:throw e=i.sent,new Error(e);case 5:case"end":return i.stop()}},t)})),cp.apply(this,arguments)}function Aj(t){return hp.apply(this,arguments)}function hp(){return hp=(0,wo.default)(an.default.mark(function t(r){var e,n,i;return an.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),o.prev=1,n=r.headers.get("Content-Type"),i=r.statusText,!n.includes("application/json")){o.next=11;break}return o.t0=i,o.t1=" ",o.next=9,r.text();case 9:o.t2=o.sent,i=o.t0+=o.t1.concat.call(o.t1,o.t2);case 11:e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e,o.next=17;break;case 15:o.prev=15,o.t3=o.catch(1);case 17:return o.abrupt("return",e);case 18:case"end":return o.stop()}},t,null,[[1,15]])})),hp.apply(this,arguments)}function Mj(t){return pp.apply(this,arguments)}function pp(){return pp=(0,wo.default)(an.default.mark(function t(r){var e,n,i,a;return an.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(e=5,typeof r!="string"){s.next=3;break}return s.abrupt("return","data:,".concat(r.slice(0,e)));case 3:if(!(r instanceof Blob)){s.next=8;break}return n=r.slice(0,5),s.next=7,new Promise(function(u){var f=new FileReader;f.onload=function(l){var c;return u(l==null||(c=l.target)===null||c===void 0?void 0:c.result)},f.readAsDataURL(n)});case 7:return s.abrupt("return",s.sent);case 8:if(!(r instanceof ArrayBuffer)){s.next=12;break}return i=r.slice(0,e),a=kj(i),s.abrupt("return","data:base64,".concat(a));case 12:return s.abrupt("return",null);case 13:case"end":return s.stop()}},t)})),pp.apply(this,arguments)}function kj(t){for(var r="",e=new Uint8Array(t),n=0;n<e.byteLength;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function Qi(t,r){return vp.apply(this,arguments)}function vp(){return vp=(0,Fw.default)(dp.default.mark(function t(r,e){var n;return dp.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(typeof r!="string"){a.next=7;break}return r=np(r),n=e,e!=null&&e.fetch&&typeof e?.fetch!="function"&&(n=e.fetch),a.next=6,fetch(r,n);case 6:return a.abrupt("return",a.sent);case 7:return a.next=9,nf(r);case 9:return a.abrupt("return",a.sent);case 10:case"end":return a.stop()}},t)})),vp.apply(this,arguments)}var Hw=h(G());var mp=h(B()),gp=h(U());var yp=new $t({id:"loaders.gl"}),Nw=function(){function t(){(0,mp.default)(this,t)}return(0,gp.default)(t,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),t}(),Bw=function(){function t(){(0,mp.default)(this,t),X(this,"console",void 0),this.console=console}return(0,gp.default)(t,[{key:"log",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.log).bind.apply(e,[this.console].concat(i))}},{key:"info",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.info).bind.apply(e,[this.console].concat(i))}},{key:"warn",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.warn).bind.apply(e,[this.console].concat(i))}},{key:"error",value:function(){for(var e,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=this.console.error).bind.apply(e,[this.console].concat(i))}}]),t}();var _p={fetch:null,mimeType:void 0,nothrow:!1,log:new Bw,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:oi,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Vw={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ww(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Rj(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Rj(t,r){if(t){if(typeof t=="string")return zw(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return zw(t,r)}}function zw(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function Uw(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function af(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Uw(Object(e),!0).forEach(function(n){(0,Hw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Uw(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function bp(){globalThis.loaders=globalThis.loaders||{};var t=globalThis.loaders;return t._state=t._state||{},t._state}var Yw=function(){var r=bp();return r.globalOptions=r.globalOptions||af({},_p),r.globalOptions};function Xw(t,r,e,n){return e=e||[],e=Array.isArray(e)?e:[e],Cj(t,e),Lj(r,t,n)}function of(t,r){var e=Yw(),n=t||e;return typeof n.fetch=="function"?n.fetch:Ki(n.fetch)?function(i){return Qi(i,n)}:r!=null&&r.fetch?r?.fetch:Qi}function Cj(t,r){Gw(t,null,_p,Vw,r);var e=Ww(r),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=t&&t[i.id]||{},o=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};Gw(a,i.id,o,s,r)}}catch(u){e.e(u)}finally{e.f()}}function Gw(t,r,e,n,i){var a=r||"Top level",o=r?"".concat(r,"."):"";for(var s in t){var u=!r&&Ki(t[s]),f=s==="baseUri"&&!r,l=s==="workerUrl"&&r;if(!(s in e)&&!f&&!l){if(s in n)yp.warn("".concat(a," loader option '").concat(o).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!u){var c=Ij(s,i);yp.warn("".concat(a," loader option '").concat(o).concat(s,"' not recognized. ").concat(c))()}}}}function Ij(t,r){var e=t.toLowerCase(),n="",i=Ww(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;for(var s in o.options){if(t===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var u=s.toLowerCase(),f=e.startsWith(u)||u.startsWith(e);f&&(n=n||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(l){i.e(l)}finally{i.f()}return n}function Lj(t,r,e){var n=t.options||{},i=af({},n);return Dj(i,e),i.log===null&&(i.log=new Nw),$w(i,Yw()),$w(i,r),i}function $w(t,r){for(var e in r)if(e in r){var n=r[e];sp(n)&&sp(t[e])?t[e]=af(af({},t[e]),r[e]):t[e]=r[e]}}function Dj(t,r){r&&!("baseUri"in t)&&(t.baseUri=r)}var Zw=h(G());function qw(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function sf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qw(Object(e),!0).forEach(function(n){(0,Zw.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qw(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function xo(t){var r;if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=Array.isArray((r=t)===null||r===void 0?void 0:r.extensions);return e}function To(t){var r,e;Rn(t,"null loader"),Rn(xo(t),"invalid loader");var n;return Array.isArray(t)&&(n=t[1],t=t[0],t=sf(sf({},t),{},{options:sf(sf({},t.options),n)})),((r=t)!==null&&r!==void 0&&r.parseTextSync||(e=t)!==null&&e!==void 0&&e.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function jj(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Fj(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Fj(t,r){if(t){if(typeof t=="string")return Kw(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Kw(t,r)}}function Kw(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Qw=function(){var r=bp();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function Eo(t){var r=Qw();t=Array.isArray(t)?t:[t];var e=jj(t),n;try{var i=function(){var o=n.value,s=To(o);r.find(function(u){return s===u})||r.unshift(s)};for(e.s();!(n=e.n()).done;)i()}catch(a){e.e(a)}finally{e.f()}}function Jw(){return Qw()}var ox=h(G()),sx=h(qe()),ux=h(Ri()),fx=h(dt()),xp=h(et());var ex=new $t({id:"loaders.gl"});function tx(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function rx(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?tx(Object(e),!0).forEach(function(n){(0,ox.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):tx(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Po(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Nj(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Nj(t,r){if(t){if(typeof t=="string")return nx(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nx(t,r)}}function nx(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var Bj=/\.([^.]+)$/;function lx(t){return Tp.apply(this,arguments)}function Tp(){return Tp=(0,fx.default)(xp.default.mark(function t(r){var e,n,i,a,o=arguments;return xp.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(e=o.length>1&&o[1]!==void 0?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,cx(r)){u.next=5;break}return u.abrupt("return",null);case 5:if(a=ix(r,e,rx(rx({},n),{},{nothrow:!0}),i),!a){u.next=8;break}return u.abrupt("return",a);case 8:if(!pr(r)){u.next=13;break}return u.next=11,r.slice(0,10).arrayBuffer();case 11:r=u.sent,a=ix(r,e,n,i);case 13:if(!(!a&&!(n!=null&&n.nothrow))){u.next=15;break}throw new Error(hx(r));case 15:return u.abrupt("return",a);case 16:case"end":return u.stop()}},t)})),Tp.apply(this,arguments)}function ix(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!cx(t))return null;if(r&&!Array.isArray(r))return To(r);var i=[];if(r&&(i=i.concat(r)),!(e!=null&&e.ignoreRegisteredLoaders)){var a;(a=i).push.apply(a,(0,ux.default)(Jw()))}zj(i);var o=Vj(t,i,e,n);if(!o&&!(e!=null&&e.nothrow))throw new Error(hx(t));return o}function Vj(t,r,e,n){var i=ui(t),a=i.url,o=i.type,s=a||n?.url,u=null,f="";if(e!=null&&e.mimeType&&(u=wp(r,e?.mimeType),f="match forced by supplied MIME type ".concat(e?.mimeType)),u=u||Uj(r,s),f=f||(u?"matched url ".concat(s):""),u=u||wp(r,o),f=f||(u?"matched MIME type ".concat(o):""),u=u||$j(r,t),f=f||(u?"matched initial data ".concat(px(t)):""),u=u||wp(r,e?.fallbackMimeType),f=f||(u?"matched fallback MIME type ".concat(o):""),f){var l;ex.log(1,"selectLoader selected ".concat((l=u)===null||l===void 0?void 0:l.name,": ").concat(f,"."))}return u}function cx(t){return!(t instanceof Response&&t.status===204)}function hx(t){var r=ui(t),e=r.url,n=r.type,i="No valid loader found (";i+=e?"".concat(tf.filename(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");var a=t?px(t):"";return i+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available",i+=")",i}function zj(t){var r=Po(t),e;try{for(r.s();!(e=r.n()).done;){var n=e.value;To(n)}}catch(i){r.e(i)}finally{r.f()}}function Uj(t,r){var e=r&&Bj.exec(r),n=e&&e[1];return n?Gj(t,n):null}function Gj(t,r){r=r.toLowerCase();var e=Po(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value,a=Po(i.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;if(s.toLowerCase()===r)return i}}catch(u){a.e(u)}finally{a.f()}}}catch(u){e.e(u)}finally{e.f()}return null}function wp(t,r){var e=Po(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(r)||r==="application/x.".concat(i.id))return i}}catch(a){e.e(a)}finally{e.f()}return null}function $j(t,r){if(!r)return null;var e=Po(t),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;if(typeof r=="string"){if(Hj(r,i))return i}else if(ArrayBuffer.isView(r)){if(ax(r.buffer,r.byteOffset,i))return i}else if(r instanceof ArrayBuffer){var a=0;if(ax(r,a,i))return i}}}catch(o){e.e(o)}finally{e.f()}return null}function Hj(t,r){if(r.testText)return r.testText(t);var e=Array.isArray(r.tests)?r.tests:[r.tests];return e.some(function(n){return t.startsWith(n)})}function ax(t,r,e){var n=Array.isArray(e.tests)?e.tests:[e.tests];return n.some(function(i){return Wj(t,r,e,i)})}function Wj(t,r,e,n){if(n instanceof ArrayBuffer)return qh(n,t,n.byteLength);switch((0,sx.default)(n)){case"function":return n(t,e);case"string":var i=Ep(t,r,n.length);return n===i;default:return!1}}function px(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof t=="string")return t.slice(0,r);if(ArrayBuffer.isView(t))return Ep(t.buffer,t.byteOffset,r);if(t instanceof ArrayBuffer){var e=0;return Ep(t,e,r)}return""}function Ep(t,r,e){if(t.byteLength<r+e)return"";for(var n=new DataView(t),i="",a=0;a<e;a++)i+=String.fromCharCode(n.getUint8(r+a));return i}var Sx=h(qe()),Vp=h(dt()),Oo=h(et());var _x=h(dt()),Dp=h(et());var Pp=h(et()),Yj=Pp.default.mark(Sp),Xj=256*1024;function Sp(t,r){var e,n,i,a,o;return Pp.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:e=r?.chunkSize||Xj,n=0,i=new TextEncoder;case 3:if(!(n<t.length)){u.next=11;break}return a=Math.min(t.length-n,e),o=t.slice(n,n+a),n+=a,u.next=9,i.encode(o);case 9:u.next=3;break;case 11:case"end":return u.stop()}},Yj)}var Op=h(et()),qj=Op.default.mark(Ap),Zj=256*1024;function Ap(t){var r,e,n,i,a,o,s,u,f=arguments;return Op.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r=f.length>1&&f[1]!==void 0?f[1]:{},e=r.chunkSize,n=e===void 0?Zj:e,i=0;case 3:if(!(i<t.byteLength)){c.next=14;break}return a=Math.min(t.byteLength-i,n),o=new ArrayBuffer(a),s=new Uint8Array(t,i,a),u=new Uint8Array(o),u.set(s),i+=a,c.next=12,o;case 12:c.next=3;break;case 14:case"end":return c.stop()}},qj)}var dx=h(Qh()),vx=h(Jh()),Mp=h(et()),Kj=1024*1024;function mx(t,r){return kp.apply(this,arguments)}function kp(){return kp=(0,vx.default)(Mp.default.mark(function t(r,e){var n,i,a,o;return Mp.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=e?.chunkSize||Kj,i=0;case 2:if(!(i<r.size)){u.next=12;break}return a=i+n,u.next=6,(0,dx.default)(r.slice(i,a).arrayBuffer());case 6:return o=u.sent,i=a,u.next=10,o;case 10:u.next=2;break;case 12:case"end":return u.stop()}},t)})),kp.apply(this,arguments)}var gx=h(Ju()),uf=h(Qh()),Ip=h(Jh()),So=h(et());function Lp(t,r){return oi?Qj(t,r):Jj(t,r)}function Qj(t,r){return Rp.apply(this,arguments)}function Rp(){return Rp=(0,Ip.default)(So.default.mark(function t(r,e){var n,i,a,o,s,u;return So.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:n=r.getReader(),l.prev=1;case 2:return a=i||n.read(),e!=null&&e._streamReadAhead&&(i=n.read()),l.next=7,(0,uf.default)(a);case 7:if(o=l.sent,s=o.done,u=o.value,!s){l.next=12;break}return l.abrupt("return");case 12:return l.next=14,ef(u);case 14:l.next=2;break;case 16:l.next=21;break;case 18:l.prev=18,l.t0=l.catch(1),n.releaseLock();case 21:case"end":return l.stop()}},t,null,[[1,18]])})),Rp.apply(this,arguments)}function Jj(t,r){return Cp.apply(this,arguments)}function Cp(){return Cp=(0,Ip.default)(So.default.mark(function t(r,e){var n,i,a,o,s,u;return So.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:n=!1,i=!1,l.prev=2,o=(0,gx.default)(r);case 4:return l.next=6,(0,uf.default)(o.next());case 6:if(!(n=!(s=l.sent).done)){l.next=13;break}return u=s.value,l.next=10,ef(u);case 10:n=!1,l.next=4;break;case 13:l.next=19;break;case 15:l.prev=15,l.t0=l.catch(2),i=!0,a=l.t0;case 19:if(l.prev=19,l.prev=20,!(n&&o.return!=null)){l.next=24;break}return l.next=24,(0,uf.default)(o.return());case 24:if(l.prev=24,!i){l.next=27;break}throw a;case 27:return l.finish(24);case 28:return l.finish(19);case 29:case"end":return l.stop()}},t,null,[[2,15,19,29],[20,,24,28]])})),Cp.apply(this,arguments)}function yx(t,r){if(typeof t=="string")return Sp(t,r);if(t instanceof ArrayBuffer)return Ap(t,r);if(pr(t))return mx(t,r);if(rf(t))return Lp(t,r);if(hr(t)){var e=t;return Lp(e.body,r)}throw new Error("makeIterator")}var bx="Cannot convert supplied data type";function eF(t,r,e){if(r.text&&typeof t=="string")return t;if(Iw(t)&&(t=t.buffer),t instanceof ArrayBuffer){var n=t;if(r.text&&!r.binary){var i=new TextDecoder("utf8");return i.decode(n)}return n}if(ArrayBuffer.isView(t)){if(r.text&&!r.binary){var a=new TextDecoder("utf8");return a.decode(t)}var o=t.buffer,s=t.byteLength||t.length;return(t.byteOffset!==0||s!==o.byteLength)&&(o=o.slice(t.byteOffset,t.byteOffset+s)),o}throw new Error(bx)}function wx(t,r,e){return jp.apply(this,arguments)}function jp(){return jp=(0,_x.default)(Dp.default.mark(function t(r,e,n){var i,a;return Dp.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r instanceof ArrayBuffer||ArrayBuffer.isView(r),!(typeof r=="string"||i)){s.next=3;break}return s.abrupt("return",eF(r,e,n));case 3:if(!pr(r)){s.next=7;break}return s.next=6,nf(r);case 6:r=s.sent;case 7:if(!hr(r)){s.next=21;break}return a=r,s.next=11,jw(a);case 11:if(!e.binary){s.next=17;break}return s.next=14,a.arrayBuffer();case 14:s.t0=s.sent,s.next=20;break;case 17:return s.next=19,a.text();case 19:s.t0=s.sent;case 20:return s.abrupt("return",s.t0);case 21:if(rf(r)&&(r=yx(r,n)),!(Rw(r)||Cw(r))){s.next=24;break}return s.abrupt("return",rp(r));case 24:throw new Error(bx);case 25:case"end":return s.stop()}},t)})),jp.apply(this,arguments)}var Fp=h(Ri()),Tx=h(G());function xx(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tF(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xx(Object(e),!0).forEach(function(n){(0,Tx.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xx(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ex(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(e)return e;var n=tF({fetch:of(r,t)},t);return Array.isArray(n.loaders)||(n.loaders=null),n}function Px(t,r){if(!r&&t&&!Array.isArray(t))return t;var e;if(t&&(e=Array.isArray(t)?t:[t]),r&&r.loaders){var n=Array.isArray(r.loaders)?r.loaders:[r.loaders];e=e?[].concat((0,Fp.default)(e),(0,Fp.default)(n)):n}return e&&e.length?e:null}function fi(t,r,e,n){return Np.apply(this,arguments)}function Np(){return Np=(0,Vp.default)(Oo.default.mark(function t(r,e,n,i){var a,o,s,u,f;return Oo.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return wt(!i||(0,Sx.default)(i)==="object"),e&&!Array.isArray(e)&&!xo(e)&&(i=void 0,n=e,e=void 0),c.next=4,r;case 4:return r=c.sent,n=n||{},a=ui(r),o=a.url,s=e,u=Px(s,i),c.next=11,lx(r,u,n);case 11:if(f=c.sent,f){c.next=14;break}return c.abrupt("return",null);case 14:return n=Xw(n,f,u,o),i=Ex({url:o,parse:fi,loaders:u},n,i),c.next=18,rF(f,r,n,i);case 18:return c.abrupt("return",c.sent);case 19:case"end":return c.stop()}},t)})),Np.apply(this,arguments)}function rF(t,r,e,n){return Bp.apply(this,arguments)}function Bp(){return Bp=(0,Vp.default)(Oo.default.mark(function t(r,e,n,i){var a,o,s,u,f,l,c,p;return Oo.default.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return Gh(r),hr(e)&&(a=e,o=a.ok,s=a.redirected,u=a.status,f=a.statusText,l=a.type,c=a.url,p=Object.fromEntries(a.headers.entries()),i.response={headers:p,ok:o,redirected:s,status:u,statusText:f,type:l,url:c}),v.next=4,wx(e,r,n);case 4:if(e=v.sent,!(r.parseTextSync&&typeof e=="string")){v.next=8;break}return n.dataType="text",v.abrupt("return",r.parseTextSync(e,n,i,r));case 8:if(!Yh(r,n)){v.next=12;break}return v.next=11,Xh(r,e,n,i,fi);case 11:return v.abrupt("return",v.sent);case 12:if(!(r.parseText&&typeof e=="string")){v.next=16;break}return v.next=15,r.parseText(e,n,i,r);case 15:return v.abrupt("return",v.sent);case 16:if(!r.parse){v.next=20;break}return v.next=19,r.parse(e,n,i,r);case 19:return v.abrupt("return",v.sent);case 20:throw wt(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"));case 22:case"end":return v.stop()}},t)})),Bp.apply(this,arguments)}var Ox=h(dt()),zp=h(et());function Cn(t,r,e,n){return Up.apply(this,arguments)}function Up(){return Up=(0,Ox.default)(zp.default.mark(function t(r,e,n,i){var a,o;return zp.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!Array.isArray(e)&&!xo(e)&&(i=void 0,n=e,e=void 0),a=of(n),o=r,typeof r!="string"){u.next=7;break}return u.next=6,a(r);case 6:o=u.sent;case 7:if(!pr(r)){u.next=11;break}return u.next=10,a(r);case 10:o=u.sent;case 11:return u.next=13,fi(o,e,n);case 13:return u.abrupt("return",u.sent);case 14:case"end":return u.stop()}},t)})),Up.apply(this,arguments)}var Vx=h(G());var Ax="3.3.3";var jx=h(dt()),id=h(et());var nF=globalThis._parseImageNode,$p=typeof Image<"u",Hp=typeof ImageBitmap<"u",iF=Boolean(nF),Wp=oi?!0:iF;function Mx(t){switch(t){case"auto":return Hp||$p||Wp;case"imagebitmap":return Hp;case"image":return $p;case"data":return Wp;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function kx(){if(Hp)return"imagebitmap";if($p)return"image";if(Wp)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}var Rx=h(qe());function aF(t){var r=oF(t);if(!r)throw new Error("Not an image");return r}function Cx(t){switch(aF(t)){case"data":return t;case"image":case"imagebitmap":var r=document.createElement("canvas"),e=r.getContext("2d");if(!e)throw new Error("getImageData");return r.width=t.width,r.height=t.height,e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function oF(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&(0,Rx.default)(t)==="object"&&t.data&&t.width&&t.height?"data":null}var Zp=h(dt()),Ao=h(et());var sF=/^data:image\/svg\+xml/,uF=/\.svg((\?|#).*)?$/;function ff(t){return t&&(sF.test(t)||uF.test(t))}function Ix(t,r){if(ff(r)){var e=new TextDecoder,n=e.decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(a){throw new Error(a.message)}var i="data:image/svg+xml;base64,".concat(btoa(n));return i}return Yp(t,r)}function Yp(t,r){if(ff(r))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function Mo(t,r,e){return Xp.apply(this,arguments)}function Xp(){return Xp=(0,Zp.default)(Ao.default.mark(function t(r,e,n){var i,a,o;return Ao.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return i=Ix(r,n),a=self.URL||self.webkitURL,o=typeof i!="string"&&a.createObjectURL(i),u.prev=3,u.next=6,fF(o||i,e);case 6:return u.abrupt("return",u.sent);case 7:return u.prev=7,o&&a.revokeObjectURL(o),u.finish(7);case 10:case"end":return u.stop()}},t,null,[[3,,7,10]])})),Xp.apply(this,arguments)}function fF(t,r){return qp.apply(this,arguments)}function qp(){return qp=(0,Zp.default)(Ao.default.mark(function t(r,e){var n;return Ao.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=new Image,n.src=r,!(e.image&&e.image.decode&&n.decode)){a.next=6;break}return a.next=5,n.decode();case 5:return a.abrupt("return",n);case 6:return a.next=8,new Promise(function(o,s){try{n.onload=function(){return o(n)},n.onerror=function(u){return s(new Error("Could not load image ".concat(r,": ").concat(u)))}}catch(u){s(u)}});case 8:return a.abrupt("return",a.sent);case 9:case"end":return a.stop()}},t)})),qp.apply(this,arguments)}var Jp=h(dt()),ko=h(et());var lF={},Lx=!0;function ed(t,r,e){return Kp.apply(this,arguments)}function Kp(){return Kp=(0,Jp.default)(ko.default.mark(function t(r,e,n){var i,a,o;return ko.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!ff(n)){u.next=7;break}return u.next=3,Mo(r,e,n);case 3:a=u.sent,i=a,u.next=8;break;case 7:i=Yp(r,n);case 8:return o=e&&e.imagebitmap,u.next=11,cF(i,o);case 11:return u.abrupt("return",u.sent);case 12:case"end":return u.stop()}},t)})),Kp.apply(this,arguments)}function cF(t){return Qp.apply(this,arguments)}function Qp(){return Qp=(0,Jp.default)(ko.default.mark(function t(r){var e,n=arguments;return ko.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(e=n.length>1&&n[1]!==void 0?n[1]:null,(hF(e)||!Lx)&&(e=null),!e){a.next=13;break}return a.prev=3,a.next=6,createImageBitmap(r,e);case 6:return a.abrupt("return",a.sent);case 9:a.prev=9,a.t0=a.catch(3),console.warn(a.t0),Lx=!1;case 13:return a.next=15,createImageBitmap(r);case 15:return a.abrupt("return",a.sent);case 16:case"end":return a.stop()}},t,null,[[3,9]])})),Qp.apply(this,arguments)}function hF(t){for(var r in t||lF)return!1;return!0}var Dx=h(dt()),td=h(et());var Nr=!1,Ro=!0;function lf(t){var r=Co(t);return pF(r)||mF(r)||dF(r)||vF(r)}function pF(t){var r=Co(t),e=r.byteLength>=24&&r.getUint32(0,Nr)===2303741511;return e?{mimeType:"image/png",width:r.getUint32(16,Nr),height:r.getUint32(20,Nr)}:null}function dF(t){var r=Co(t),e=r.byteLength>=10&&r.getUint32(0,Nr)===1195984440;return e?{mimeType:"image/gif",width:r.getUint16(6,Ro),height:r.getUint16(8,Ro)}:null}function vF(t){var r=Co(t),e=r.byteLength>=14&&r.getUint16(0,Nr)===16973&&r.getUint32(2,Ro)===r.byteLength;return e?{mimeType:"image/bmp",width:r.getUint32(18,Ro),height:r.getUint32(22,Ro)}:null}function mF(t){var r=Co(t),e=r.byteLength>=3&&r.getUint16(0,Nr)===65496&&r.getUint8(2)===255;if(!e)return null;for(var n=gF(),i=n.tableMarkers,a=n.sofMarkers,o=2;o+9<r.byteLength;){var s=r.getUint16(o,Nr);if(a.has(s))return{mimeType:"image/jpeg",height:r.getUint16(o+5,Nr),width:r.getUint16(o+7,Nr)};if(!i.has(s))return null;o+=2,o+=r.getUint16(o,Nr)}return null}function gF(){for(var t=new Set([65499,65476,65484,65501,65534]),r=65504;r<65520;++r)t.add(r);var e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function Co(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}function nd(t,r){return rd.apply(this,arguments)}function rd(){return rd=(0,Dx.default)(td.default.mark(function t(r,e){var n,i,a;return td.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=lf(r)||{},i=n.mimeType,a=globalThis._parseImageNode,Rn(a),s.next=5,a(r,i);case 5:return s.abrupt("return",s.sent);case 6:case"end":return s.stop()}},t)})),rd.apply(this,arguments)}function od(t,r,e){return ad.apply(this,arguments)}function ad(){return ad=(0,jx.default)(id.default.mark(function t(r,e,n){var i,a,o,s,u,f;return id.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=e||{},i=e.image||{},a=i.type||"auto",o=n||{},s=o.url,u=yF(a),c.t0=u,c.next=c.t0==="imagebitmap"?8:c.t0==="image"?12:c.t0==="data"?16:20;break;case 8:return c.next=10,ed(r,e,s);case 10:return f=c.sent,c.abrupt("break",21);case 12:return c.next=14,Mo(r,e,s);case 14:return f=c.sent,c.abrupt("break",21);case 16:return c.next=18,nd(r,e);case 18:return f=c.sent,c.abrupt("break",21);case 20:Rn(!1);case 21:return a==="data"&&(f=Cx(f)),c.abrupt("return",f);case 23:case"end":return c.stop()}},t)})),ad.apply(this,arguments)}function yF(t){switch(t){case"auto":case"data":return kx();default:return Mx(t),t}}var _F=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],bF=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],wF={image:{type:"auto",decode:!0}},sd={id:"image",module:"images",name:"Images",version:Ax,mimeTypes:bF,extensions:_F,parse:od,tests:[function(t){return Boolean(lf(new DataView(t)))}],options:wF};var le=new $t({id:"deck"});var ud={};function cf(t){ud=t}function Ke(t,r,e,n){le.level>0&&ud[t]&&ud[t].call(null,r,e,n)}function xF(t){var r=t[0],e=t[t.length-1];return r==="{"&&e==="}"||r==="["&&e==="]"}var Fx={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:xF,parseTextSync:JSON.parse};function Nx(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Bx(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Nx(Object(e),!0).forEach(function(n){(0,Vx.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Nx(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function TF(){var t="8.9.11",r=globalThis.deck&&globalThis.deck.VERSION;if(r&&r!==t)throw new Error("deck.gl - multiple versions detected: ".concat(r," vs ").concat(t));return r||(le.log(1,"deck.gl ".concat(t))(),globalThis.deck=Bx(Bx({},globalThis.deck),{},{VERSION:t,version:t,log:le,_registerLoggers:cf}),Eo([Fx,[sd,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var hf=TF();var me={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(me,"IDENTITY",{get:function(){return le.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0}});var xt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Io={common:0,meters:1,pixels:2},fd={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},zx={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};var VT=h(B()),zT=h(U()),zt=h(G());var Ux=h(B()),Lo=h(G()),EF=[255,255,255],PF=1,SF=0,pf=function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ux.default)(this,t),(0,Lo.default)(this,"id",void 0),(0,Lo.default)(this,"color",void 0),(0,Lo.default)(this,"intensity",void 0),(0,Lo.default)(this,"type","ambient");var e=r.color,n=e===void 0?EF:e,i=r.intensity,a=i===void 0?PF:i;this.id=r.id||"ambient-".concat(SF++),this.color=n,this.intensity=a};var Gx=h(B()),$x=h(U()),li=h(G());var OF=[255,255,255],AF=1,MF=[0,0,-1],kF=0,ci=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Gx.default)(this,t),(0,li.default)(this,"id",void 0),(0,li.default)(this,"color",void 0),(0,li.default)(this,"intensity",void 0),(0,li.default)(this,"type","directional"),(0,li.default)(this,"direction",void 0),(0,li.default)(this,"shadow",void 0);var e=r.color,n=e===void 0?OF:e,i=r.intensity,a=i===void 0?AF:i,o=r.direction,s=o===void 0?MF:o,u=r._shadow,f=u===void 0?!1:u;this.id=r.id||"directional-".concat(kF++),this.color=n,this.intensity=a,this.type="directional",this.direction=new nt(s).normalize().toArray(),this.shadow=f}return(0,$x.default)(t,[{key:"getProjectedLight",value:function(e){return this}}]),t}();var iT=h(B()),aT=h(U()),vf=h(we()),oT=h(kt()),sT=h(ie()),uT=h(ae()),mf=h(ne()),dr=h(G());var qx=h(B()),Zx=h(U()),Kx=h(we()),Qx=h(ie()),Jx=h(ae()),cd=h(ne()),eT=h(G());var Wx=h(B()),Yx=h(U()),Do=h(G());function Hx(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function RF(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?Hx(Object(e),!0).forEach(function(n){(0,Do.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Hx(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var df=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};(0,Wx.default)(this,t),(0,Do.default)(this,"id",void 0),(0,Do.default)(this,"gl",void 0),(0,Do.default)(this,"props",void 0);var n=e.id;this.id=n,this.gl=r,this.props=RF({},e)}return(0,Yx.default)(t,[{key:"setProps",value:function(e){Object.assign(this.props,e)}},{key:"render",value:function(e){}},{key:"cleanup",value:function(){}}]),t}();function ld(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=CF(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function CF(t,r){if(t){if(typeof t=="string")return Xx(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Xx(t,r)}}function Xx(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function IF(t){var r=LF();return function(){var n=(0,cd.default)(t),i;if(r){var a=(0,cd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,Jx.default)(this,i)}}function LF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var In=function(t){(0,Qx.default)(e,t);var r=IF(e);function e(){var n;(0,qx.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,eT.default)((0,Kx.default)(n),"_lastRenderIndex",-1),n}return(0,Zx.default)(e,[{key:"render",value:function(i){var a=this.gl;return at(a,{framebuffer:i.target}),this._drawLayers(i)}},{key:"_drawLayers",value:function(i){var a=i.target,o=i.moduleParameters,s=i.viewports,u=i.views,f=i.onViewportActive,l=i.clearStack,c=l===void 0?!0:l,p=i.clearCanvas,d=p===void 0?!0:p;i.pass=i.pass||"unknown";var v=this.gl;d&&jF(v,a),c&&(this._lastRenderIndex=-1);var m=[],g=ld(s),_;try{for(g.s();!(_=g.n()).done;){var x=_.value,w=u&&u[x.id];f?.(x);var E=this._getDrawLayerParams(x,i),T=x.subViewports||[x],P=ld(T),A;try{for(P.s();!(A=P.n()).done;){var D=A.value,L=this._drawLayersInViewport(v,{target:a,moduleParameters:o,viewport:D,view:w,pass:i.pass,layers:i.layers},E);m.push(L)}}catch(C){P.e(C)}finally{P.f()}}}catch(C){g.e(C)}finally{g.f()}return m}},{key:"_getDrawLayerParams",value:function(i,a){for(var o=a.layers,s=a.pass,u=a.isPicking,f=u===void 0?!1:u,l=a.layerFilter,c=a.cullRect,p=a.effects,d=a.moduleParameters,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,m=[],g=tT(this._lastRenderIndex+1),_={layer:o[0],viewport:i,isPicking:f,renderPass:s,cullRect:c},x={},w=0;w<o.length;w++){var E=o[w],T=this._shouldDrawLayer(E,_,l,x),P={shouldDrawLayer:T};T&&!v&&(P.layerRenderIndex=g(E,T),P.moduleParameters=this._getModuleParameters(E,p,s,d),P.layerParameters=this.getLayerParameters(E,w,i)),m[w]=P}return m}},{key:"_drawLayersInViewport",value:function(i,a,o){var s=a.layers,u=a.moduleParameters,f=a.pass,l=a.target,c=a.viewport,p=a.view,d=DF(i,{moduleParameters:u,target:l,viewport:c});if(p&&p.props.clear){var v=p.props.clear===!0?{color:!0,depth:!0}:p.props.clear;Re(i,{scissorTest:!0,scissor:d},function(){return Cr(i,v)})}var m={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};at(i,{viewport:d});for(var g=0;g<s.length;g++){var _=s[g],x=o[g],w=x.shouldDrawLayer,E=x.layerRenderIndex,T=x.moduleParameters,P=x.layerParameters;if(w&&_.props.pickable&&m.pickableCount++,_.isComposite)m.compositeCount++;else if(w){m.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,E),T.viewport=c;try{_._drawLayer({moduleParameters:T,uniforms:{layerIndex:E},parameters:P})}catch(A){_.raiseError(A,"drawing ".concat(_," to ").concat(f))}}}return m}},{key:"shouldDrawLayer",value:function(i){return!0}},{key:"getModuleParameters",value:function(i,a){return null}},{key:"getLayerParameters",value:function(i,a,o){return i.props.parameters}},{key:"_shouldDrawLayer",value:function(i,a,o,s){var u=i.props.visible&&this.shouldDrawLayer(i);if(!u)return!1;a.layer=i;for(var f=i.parent;f;){if(!f.props.visible||!f.filterSubLayer(a))return!1;a.layer=f,f=f.parent}if(o){var l=a.layer.id;if(l in s||(s[l]=o(a)),!s[l])return!1}return i.activateViewport(a.viewport),!0}},{key:"_getModuleParameters",value:function(i,a,o,s){var u,f=Object.assign(Object.create(((u=i.internalState)===null||u===void 0?void 0:u.propsInTransition)||i.props),{autoWrapLongitude:i.wrapLongitude,viewport:i.context.viewport,mousePosition:i.context.mousePosition,pickingActive:0,devicePixelRatio:Lt(this.gl)});if(a){var l=ld(a),c;try{for(l.s();!(c=l.n()).done;){var p,d=c.value;Object.assign(f,(p=d.getModuleParameters)===null||p===void 0?void 0:p.call(d,i))}}catch(v){l.e(v)}finally{l.f()}}return Object.assign(f,this.getModuleParameters(i,a),s)}}]),e}(df);function tT(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={},n=function i(a,o){var s=a.props._offset,u=a.id,f=a.parent&&a.parent.id,l;if(f&&!(f in r)&&i(a.parent,!1),f in e){var c=e[f]=e[f]||tT(r[f],r);l=c(a,o),e[u]=c}else Number.isFinite(s)?(l=s+(r[f]||0),e[u]=null):l=t;return o&&l>=t&&(t=l+1),r[u]=l,l};return n}function DF(t,r){var e=r.moduleParameters,n=r.target,i=r.viewport,a=n&&n.id!=="default-framebuffer",o=e&&e.devicePixelRatio||Lt(t),s=a?n.height:t.drawingBufferHeight,u=i;return[u.x*o,s-(u.y+u.height)*o,u.width*o,u.height*o]}function jF(t,r){var e=r?r.width:t.drawingBufferWidth,n=r?r.height:t.drawingBufferHeight;at(t,{viewport:[0,0,e,n]}),t.clear(16640)}function rT(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rT(Object(e),!0).forEach(function(n){(0,dr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rT(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function FF(t){var r=NF();return function(){var n=(0,mf.default)(t),i;if(r){var a=(0,mf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,uT.default)(this,i)}}function NF(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fT=function(t){(0,sT.default)(e,t);var r=FF(e);function e(n,i){var a,o,s;return(0,iT.default)(this,e),s=r.call(this,n,i),(0,dr.default)((0,vf.default)(s),"shadowMap",void 0),(0,dr.default)((0,vf.default)(s),"depthBuffer",void 0),(0,dr.default)((0,vf.default)(s),"fbo",void 0),s.shadowMap=new Ge(n,{width:1,height:1,parameters:(a={},(0,dr.default)(a,10241,9729),(0,dr.default)(a,10240,9729),(0,dr.default)(a,10242,33071),(0,dr.default)(a,10243,33071),a)}),s.depthBuffer=new jt(n,{format:33189,width:1,height:1}),s.fbo=new xe(n,{id:"shadowmap",width:1,height:1,attachments:(o={},(0,dr.default)(o,36064,s.shadowMap),(0,dr.default)(o,36096,s.depthBuffer),o)}),s}return(0,aT.default)(e,[{key:"render",value:function(i){var a=this,o=this.fbo;Re(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},function(){var s=i.viewports[0],u=Lt(a.gl),f=s.width*u,l=s.height*u;(f!==o.width||l!==o.height)&&o.resize({width:f,height:l}),(0,oT.default)((0,mf.default)(e.prototype),"render",a).call(a,nT(nT({},i),{},{target:o,pass:"shadow"}))})}},{key:"shouldDrawLayer",value:function(i){return i.props.shadowEnabled!==!1}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),e}(In);var mi=h(Ri()),jT=h(Ue());var lT="#define SMOOTH_EDGE_RADIUS 0.5",BF=`
`.concat(lT,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),VF=`
`.concat(lT,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),cT={name:"geometry",vs:BF,fs:VF};var zF=Object.keys(me).map(function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(me[t],";")}).join(""),UF=Object.keys(xt).map(function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(xt[t],";")}).join(""),GF=Object.keys(Io).map(function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(Io[t],";")}).join(""),hT="".concat(zF,`
`).concat(UF,`
`).concat(GF,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);var on=typeof Float32Array<"u"?Float32Array:Array;var nK=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});function pd(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],o=r[4],s=r[5],u=r[6],f=r[7],l=r[8],c=r[9],p=r[10],d=r[11],v=r[12],m=r[13],g=r[14],_=r[15],x=e*s-n*o,w=e*u-i*o,E=e*f-a*o,T=n*u-i*s,P=n*f-a*s,A=i*f-a*u,D=l*m-c*v,L=l*g-p*v,C=l*_-d*v,F=c*g-p*m,j=c*_-d*m,z=p*_-d*g,N=x*z-w*j+E*F+T*C-P*L+A*D;return N?(N=1/N,t[0]=(s*z-u*j+f*F)*N,t[1]=(i*j-n*z-a*F)*N,t[2]=(m*A-g*P+_*T)*N,t[3]=(p*P-c*A-d*T)*N,t[4]=(u*C-o*z-f*L)*N,t[5]=(e*z-i*C+a*L)*N,t[6]=(g*E-v*A-_*w)*N,t[7]=(l*A-p*E+d*w)*N,t[8]=(o*j-s*C+f*D)*N,t[9]=(n*C-e*j-a*D)*N,t[10]=(v*P-m*E+_*x)*N,t[11]=(c*E-l*P-d*x)*N,t[12]=(s*L-o*F-u*D)*N,t[13]=(e*F-n*L+i*D)*N,t[14]=(m*w-v*T-g*x)*N,t[15]=(l*T-c*w+p*x)*N,t):null}function hi(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],f=r[6],l=r[7],c=r[8],p=r[9],d=r[10],v=r[11],m=r[12],g=r[13],_=r[14],x=r[15],w=e[0],E=e[1],T=e[2],P=e[3];return t[0]=w*n+E*s+T*c+P*m,t[1]=w*i+E*u+T*p+P*g,t[2]=w*a+E*f+T*d+P*_,t[3]=w*o+E*l+T*v+P*x,w=e[4],E=e[5],T=e[6],P=e[7],t[4]=w*n+E*s+T*c+P*m,t[5]=w*i+E*u+T*p+P*g,t[6]=w*a+E*f+T*d+P*_,t[7]=w*o+E*l+T*v+P*x,w=e[8],E=e[9],T=e[10],P=e[11],t[8]=w*n+E*s+T*c+P*m,t[9]=w*i+E*u+T*p+P*g,t[10]=w*a+E*f+T*d+P*_,t[11]=w*o+E*l+T*v+P*x,w=e[12],E=e[13],T=e[14],P=e[15],t[12]=w*n+E*s+T*c+P*m,t[13]=w*i+E*u+T*p+P*g,t[14]=w*a+E*f+T*d+P*_,t[15]=w*o+E*l+T*v+P*x,t}function pT(t,r,e){var n=e[0],i=e[1],a=e[2],o,s,u,f,l,c,p,d,v,m,g,_;return r===t?(t[12]=r[0]*n+r[4]*i+r[8]*a+r[12],t[13]=r[1]*n+r[5]*i+r[9]*a+r[13],t[14]=r[2]*n+r[6]*i+r[10]*a+r[14],t[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],s=r[1],u=r[2],f=r[3],l=r[4],c=r[5],p=r[6],d=r[7],v=r[8],m=r[9],g=r[10],_=r[11],t[0]=o,t[1]=s,t[2]=u,t[3]=f,t[4]=l,t[5]=c,t[6]=p,t[7]=d,t[8]=v,t[9]=m,t[10]=g,t[11]=_,t[12]=o*n+l*i+v*a+r[12],t[13]=s*n+c*i+m*a+r[13],t[14]=u*n+p*i+g*a+r[14],t[15]=f*n+d*i+_*a+r[15]),t}function dT(t,r,e){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*i,t[5]=r[5]*i,t[6]=r[6]*i,t[7]=r[7]*i,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function $F(){var t=new on(4);return on!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function yT(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function pi(t,r,e){var n=r[0],i=r[1],a=r[2],o=r[3];return t[0]=e[0]*n+e[4]*i+e[8]*a+e[12]*o,t[1]=e[1]*n+e[5]*i+e[9]*a+e[13]*o,t[2]=e[2]*n+e[6]*i+e[10]*a+e[14]*o,t[3]=e[3]*n+e[7]*i+e[11]*a+e[15]*o,t}var iK=function(){var t=$F();return function(r,e,n,i,a,o){var s,u;for(e||(e=4),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function HF(t,r){if(t===r)return!0;if(Array.isArray(t)){var e=t.length;if(!r||r.length!==e)return!1;for(var n=0;n<e;n++)if(t[n]!==r[n])return!1;return!0}return!1}function Zt(t){var r={},e;return function(n){for(var i in n)if(!HF(n[i],r[i])){e=t(n),r=n;break}return e}}var _T=[0,0,0,0],WF=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bT=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],YF=[0,0,0],wT=[0,0,0],XF=Zt(ZF);function vd(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:wT;e.length<3&&(e=[e[0],e[1],0]);var n=e,i,a=!0;switch(r===me.LNGLAT_OFFSETS||r===me.METER_OFFSETS?i=e:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case xt.WEB_MERCATOR:(r===me.LNGLAT||r===me.CARTESIAN)&&(i=[0,0,0],a=!1);break;case xt.WEB_MERCATOR_AUTO_OFFSET:r===me.LNGLAT?n=i:r===me.CARTESIAN&&(n=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(n),n[0]-=e[0],n[1]-=e[1],n[2]-=e[2]);break;case xt.IDENTITY:n=t.position.map(Math.fround),n[2]=n[2]||0;break;case xt.GLOBE:a=!1,i=null;break;default:a=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:a}}function qF(t,r,e){var n=t.viewMatrixUncentered,i=t.projectionMatrix,a=t.viewMatrix,o=t.viewProjectionMatrix,s=_T,u=_T,f=t.cameraPosition,l=vd(t,r,e),c=l.geospatialOrigin,p=l.shaderCoordinateOrigin,d=l.offsetMode;return d&&(u=t.projectPosition(c||p),f=[f[0]-u[0],f[1]-u[1],f[2]-u[2]],u[3]=1,s=pi([],u,o),a=n||a,o=hi([],i,a),o=hi([],o,WF)),{viewMatrix:a,viewProjectionMatrix:o,projectionCenter:s,originCommon:u,cameraPosCommon:f,shaderCoordinateOrigin:p,geospatialOrigin:c}}function gf(t){var r=t.viewport,e=t.devicePixelRatio,n=e===void 0?1:e,i=t.modelMatrix,a=i===void 0?null:i,o=t.coordinateSystem,s=o===void 0?me.DEFAULT:o,u=t.coordinateOrigin,f=u===void 0?wT:u,l=t.autoWrapLongitude,c=l===void 0?!1:l;s===me.DEFAULT&&(s=r.isGeospatial?me.LNGLAT:me.CARTESIAN);var p=XF({viewport:r,devicePixelRatio:n,coordinateSystem:s,coordinateOrigin:f});return p.project_uWrapLongitude=c,p.project_uModelMatrix=a||bT,p}function ZF(t){var r=t.viewport,e=t.devicePixelRatio,n=t.coordinateSystem,i=t.coordinateOrigin,a=qF(r,n,i),o=a.projectionCenter,s=a.viewProjectionMatrix,u=a.originCommon,f=a.cameraPosCommon,l=a.shaderCoordinateOrigin,c=a.geospatialOrigin,p=r.getDistanceScales(),d=[r.width*e,r.height*e],v=pi([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,m={project_uCoordinateSystem:n,project_uProjectionMode:r.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:u.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(r._pseudoMeters),project_uViewportSize:d,project_uDevicePixelRatio:e,project_uFocalDistance:v,project_uCommonUnitsPerMeter:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit:p.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:YF,project_uScale:r.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:bT,project_uCameraPosition:f};if(c){var g=r.getDistanceScales(c);switch(n){case me.METER_OFFSETS:m.project_uCommonUnitsPerWorldUnit=g.unitsPerMeter,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerMeter2;break;case me.LNGLAT:case me.LNGLAT_OFFSETS:r._pseudoMeters||(m.project_uCommonUnitsPerMeter=g.unitsPerMeter),m.project_uCommonUnitsPerWorldUnit=g.unitsPerDegree,m.project_uCommonUnitsPerWorldUnit2=g.unitsPerDegree2;break;case me.CARTESIAN:m.project_uCommonUnitsPerWorldUnit=[1,1,g.unitsPerMeter[2]],m.project_uCommonUnitsPerWorldUnit2=[0,0,g.unitsPerMeter2[2]];break;default:break}}return m}var KF={};function QF(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:KF;return"viewport"in t?gf(t):{}}var Ln={name:"project",dependencies:[wu,cT],vs:hT,getUniforms:QF};function Ji(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function md(t){if(Array.isArray(t))return Ji(t)}function gd(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function jo(t,r){if(t){if(typeof t=="string")return Ji(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return Ji(t,r)}}function yd(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ea(t){return md(t)||gd(t)||jo(t)||yd()}function _d(t){if(Array.isArray(t))return t}function bd(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var n=[],i=!0,a=!1,o,s;try{for(e=e.call(t);!(i=(o=e.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(u){a=!0,s=u}finally{try{!i&&e.return!=null&&e.return()}finally{if(a)throw s}}return n}}function wd(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ht(t,r){return _d(t)||bd(t,r)||jo(t,r)||wd()}function xd(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function xT(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Td(t,r,e){return r&&xT(t.prototype,r),e&&xT(t,e),t}function Ie(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function ta(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Dn(t,r){var e=Lu([],r,t);return gb(e,e,1/e[3]),e}function Ed(t,r){var e=t%r;return e<0?r+e:e}function TT(t,r,e){return e*r+(1-e)*t}function Fo(t,r,e){return t<r?r:t>e?e:t}function JF(t){return Math.log(t)*Math.LOG2E}var ra=Math.log2||JF;function Kt(t,r){if(!t)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var vr=Math.PI,ET=vr/4,Qt=vr/180,Pd=180/vr,na=512,yf=4003e4,ia=85.051129,Sd=1.5;function aa(t){return Math.pow(2,t)}function _f(t){return ra(t)}function Pt(t){var r=ht(t,2),e=r[0],n=r[1];Kt(Number.isFinite(e)),Kt(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=e*Qt,a=n*Qt,o=na*(i+vr)/(2*vr),s=na*(vr+Math.log(Math.tan(ET+a*.5)))/(2*vr);return[o,s]}function mt(t){var r=ht(t,2),e=r[0],n=r[1],i=e/na*(2*vr)-vr,a=2*(Math.atan(Math.exp(n/na*(2*vr)-vr))-ET);return[i*Pd,a*Pd]}function No(t){var r=t.latitude;Kt(Number.isFinite(r));var e=Math.cos(r*Qt);return _f(yf*e)-9}function Bo(t){var r=Math.cos(t*Qt);return na/yf/r}function di(t){var r=t.latitude,e=t.longitude,n=t.highPrecision,i=n===void 0?!1:n;Kt(Number.isFinite(r)&&Number.isFinite(e));var a=na,o=Math.cos(r*Qt),s=a/360,u=s/o,f=a/yf/o,l={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[s,u,f],degreesPerUnit:[1/s,1/u,1/f]};if(i){var c=Qt*Math.tan(r*Qt)/o,p=s*c/2,d=a/yf*c,v=d/u*f;l.unitsPerDegree2=[0,p,d],l.unitsPerMeter2=[v,0,v]}return l}function Vo(t,r){var e=ht(t,3),n=e[0],i=e[1],a=e[2],o=ht(r,3),s=o[0],u=o[1],f=o[2],l=di({longitude:n,latitude:i,highPrecision:!0}),c=l.unitsPerMeter,p=l.unitsPerMeter2,d=Pt(t);d[0]+=s*(c[0]+p[0]*u),d[1]+=u*(c[1]+p[1]*u);var v=mt(d),m=(a||0)+(f||0);return Number.isFinite(a)||Number.isFinite(f)?[v[0],v[1],m]:v}function zo(t){var r=t.height,e=t.pitch,n=t.bearing,i=t.altitude,a=t.scale,o=t.center,s=ta();ai(s,s,[0,0,-i]),Ru(s,s,-e*Qt),Cu(s,s,n*Qt);var u=a/r;return Yi(s,s,[u,u,u]),o&&ai(s,s,J_([],o)),s}function bf(t){var r=t.width,e=t.height,n=t.altitude,i=t.pitch,a=i===void 0?0:i,o=t.offset,s=t.center,u=t.scale,f=t.nearZMultiplier,l=f===void 0?1:f,c=t.farZMultiplier,p=c===void 0?1:c,d=t.fovy,v=d===void 0?sn(Sd):d;n!==void 0&&(v=sn(n));var m=v*Qt,g=a*Qt,_=jn(v),x=_;s&&(x+=s[2]*u/Math.cos(g)/e);var w=m*(.5+(o?o[1]:0)/e),E=Math.sin(w)*x/Math.sin(Fo(Math.PI/2-g-w,.01,Math.PI-.01)),T=Math.sin(g)*E+x,P=x*10,A=Math.min(T*p,P);return{fov:m,aspect:r/e,focalDistance:_,near:l,far:A}}function Od(t){var r=bf(t),e=r.fov,n=r.aspect,i=r.near,a=r.far,o=Iu([],e,n,i,a);return o}function sn(t){return 2*Math.atan(.5/t)*Pd}function jn(t){return .5/Math.tan(.5*t*Qt)}function vi(t,r){var e=ht(t,3),n=e[0],i=e[1],a=e[2],o=a===void 0?0:a;return Kt(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),Dn(r,[n,i,o,1])}function Rt(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=ht(t,3),i=n[0],a=n[1],o=n[2];if(Kt(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=Dn(r,[i,a,o,1]);return s}var u=Dn(r,[i,a,0,1]),f=Dn(r,[i,a,1,1]),l=u[2],c=f[2],p=l===c?0:((e||0)-l)/(c-l);return Su([],u,f,p)}function oa(t){var r=t.width,e=t.height,n=t.bounds,i=t.minExtent,a=i===void 0?0:i,o=t.maxZoom,s=o===void 0?24:o,u=t.offset,f=u===void 0?[0,0]:u,l=ht(n,2),c=ht(l[0],2),p=c[0],d=c[1],v=ht(l[1],2),m=v[0],g=v[1],_=eN(t.padding),x=Pt([p,Fo(g,-ia,ia)]),w=Pt([m,Fo(d,-ia,ia)]),E=[Math.max(Math.abs(w[0]-x[0]),a),Math.max(Math.abs(w[1]-x[1]),a)],T=[r-_.left-_.right-Math.abs(f[0])*2,e-_.top-_.bottom-Math.abs(f[1])*2];Kt(T[0]>0&&T[1]>0);var P=T[0]/E[0],A=T[1]/E[1],D=(_.right-_.left)/2/P,L=(_.bottom-_.top)/2/A,C=[(w[0]+x[0])/2+D,(w[1]+x[1])/2+L],F=mt(C),j=Math.min(s,ra(Math.abs(Math.min(P,A))));return Kt(Number.isFinite(j)),{longitude:F[0],latitude:F[1],zoom:j}}function eN(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Kt(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var PT=Math.PI/180;function sa(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=t.width,n=t.height,i=t.unproject,a={targetZ:r},o=i([0,n],a),s=i([e,n],a),u,f,l=t.fovy?.5*t.fovy*PT:Math.atan(.5/t.altitude),c=(90-t.pitch)*PT;return l>c-.01?(u=ST(t,0,r),f=ST(t,e,r)):(u=i([0,0],a),f=i([e,0],a)),[o,s,f,u]}function ST(t,r,e){var n=t.pixelUnprojectionMatrix,i=Dn(n,[r,0,1,1]),a=Dn(n,[r,t.height,1,1]),o=e*t.distanceScales.unitsPerMeter[2],s=(o-i[2])/(a[2]-i[2]),u=Su([],i,a,s),f=mt(u);return f.push(e),f}var OT=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};xd(this,t),Ie(this,"latitude",void 0),Ie(this,"longitude",void 0),Ie(this,"zoom",void 0),Ie(this,"pitch",void 0),Ie(this,"bearing",void 0),Ie(this,"altitude",void 0),Ie(this,"fovy",void 0),Ie(this,"meterOffset",void 0),Ie(this,"center",void 0),Ie(this,"width",void 0),Ie(this,"height",void 0),Ie(this,"scale",void 0),Ie(this,"distanceScales",void 0),Ie(this,"viewMatrix",void 0),Ie(this,"projectionMatrix",void 0),Ie(this,"viewProjectionMatrix",void 0),Ie(this,"pixelProjectionMatrix",void 0),Ie(this,"pixelUnprojectionMatrix",void 0),Ie(this,"equals",function(j){return j instanceof t?j.width===r.width&&j.height===r.height&&hh(j.projectionMatrix,r.projectionMatrix)&&hh(j.viewMatrix,r.viewMatrix):!1}),Ie(this,"project",function(j){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},N=z.topLeft,M=N===void 0?!0:N,k=r.projectPosition(j),R=vi(k,r.pixelProjectionMatrix),Y=ht(R,2),V=Y[0],Q=Y[1],J=M?Q:r.height-Q;return j.length===2?[V,J]:[V,J,R[2]]}),Ie(this,"unproject",function(j){var z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},N=z.topLeft,M=N===void 0?!0:N,k=z.targetZ,R=k===void 0?void 0:k,Y=ht(j,3),V=Y[0],Q=Y[1],J=Y[2],re=M?Q:r.height-Q,oe=R&&R*r.distanceScales.unitsPerMeter[2],ue=Rt([V,re,J],r.pixelUnprojectionMatrix,oe),Oe=r.unprojectPosition(ue),ee=ht(Oe,3),Ee=ee[0],de=ee[1],Qe=ee[2];return Number.isFinite(J)?[Ee,de,Qe]:Number.isFinite(R)?[Ee,de,R]:[Ee,de]}),Ie(this,"projectPosition",function(j){var z=Pt(j),N=ht(z,2),M=N[0],k=N[1],R=(j[2]||0)*r.distanceScales.unitsPerMeter[2];return[M,k,R]}),Ie(this,"unprojectPosition",function(j){var z=mt(j),N=ht(z,2),M=N[0],k=N[1],R=(j[2]||0)*r.distanceScales.metersPerUnit[2];return[M,k,R]});var n=e.width,i=e.height,a=e.altitude,o=a===void 0?null:a,s=e.fovy,u=s===void 0?null:s,f=e.latitude,l=f===void 0?0:f,c=e.longitude,p=c===void 0?0:c,d=e.zoom,v=d===void 0?0:d,m=e.pitch,g=m===void 0?0:m,_=e.bearing,x=_===void 0?0:_,w=e.position,E=w===void 0?null:w,T=e.nearZMultiplier,P=T===void 0?.02:T,A=e.farZMultiplier,D=A===void 0?1.01:A;n=n||1,i=i||1,u===null&&o===null?(o=Sd,u=sn(o)):u===null?u=sn(o):o===null&&(o=jn(u));var L=aa(v);o=Math.max(.75,o);var C=di({longitude:p,latitude:l}),F=Pt([p,l]);F.push(0),E&&Q_(F,F,sb([],E,C.unitsPerMeter)),this.projectionMatrix=Od({width:n,height:i,scale:L,center:F,pitch:g,fovy:u,nearZMultiplier:P,farZMultiplier:D}),this.viewMatrix=zo({height:i,scale:L,center:F,pitch:g,bearing:x,altitude:o}),this.width=n,this.height=i,this.scale=L,this.latitude=l,this.longitude=p,this.zoom=v,this.pitch=g,this.bearing=x,this.altitude=o,this.fovy=u,this.center=F,this.meterOffset=E||[0,0,0],this.distanceScales=C,this._initMatrices(),Object.freeze(this)}return Td(t,[{key:"_initMatrices",value:function(){var e=this.width,n=this.height,i=this.projectionMatrix,a=this.viewMatrix,o=ta();ii(o,o,i),ii(o,o,a),this.viewProjectionMatrix=o;var s=ta();Yi(s,s,[e/2,-n/2,1]),ai(s,s,[1,-1,0]),ii(s,s,o);var u=ku(ta(),s);if(!u)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=u}},{key:"projectFlat",value:function(e){return Pt(e)}},{key:"unprojectFlat",value:function(e){return mt(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var n=e.lngLat,i=e.pos,a=Rt(i,this.pixelUnprojectionMatrix),o=Pt(n),s=so([],o,W_([],a)),u=so([],this.center,s);return mt(u)}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,a=this.height,o=oa(Object.assign({width:i,height:a,bounds:e},n)),s=o.longitude,u=o.latitude,f=o.zoom;return new t({width:i,height:a,longitude:s,latitude:u,zoom:f})}},{key:"getBounds",value:function(e){var n=this.getBoundingRegion(e),i=Math.min.apply(Math,ea(n.map(function(u){return u[0]}))),a=Math.max.apply(Math,ea(n.map(function(u){return u[0]}))),o=Math.min.apply(Math,ea(n.map(function(u){return u[1]}))),s=Math.max.apply(Math,ea(n.map(function(u){return u[1]})));return[[i,o],[a,s]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return sa(this,e.z||0)}},{key:"getLocationAtPoint",value:function(e){var n=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),t}();var AT=512;function wf(t){var r=t.width,e=t.height,n=t.pitch,i=n===void 0?0:n,a=t.longitude,o=t.latitude,s=t.zoom,u=t.bearing,f=u===void 0?0:u;(a<-180||a>180)&&(a=Ed(a+180,360)-180),(f<-180||f>180)&&(f=Ed(f+180,360)-180);var l=ra(e/AT);if(s<=l)s=l,o=0;else{var c=e/2/Math.pow(2,s),p=mt([0,c])[1];if(o<p)o=p;else{var d=mt([0,AT-c])[1];o>d&&(o=d)}}return{width:r,height:e,longitude:a,latitude:o,zoom:s,pitch:i,bearing:f}}function MT(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function kT(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?MT(Object(e),!0).forEach(function(n){Ie(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):MT(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function tN(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=rN(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function rN(t,r){if(t){if(typeof t=="string")return RT(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return RT(t,r)}}function RT(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var CT=.01,nN=["longitude","latitude","zoom"],IT={curve:1.414,speed:1.2};function xf(t,r,e,n){var i=LT(t,r,n),a=i.startZoom,o=i.startCenterXY,s=i.uDelta,u=i.w0,f=i.u1,l=i.S,c=i.rho,p=i.rho2,d=i.r0;if(f<CT){var v={},m=tN(nN),g;try{for(m.s();!(g=m.n()).done;){var _=g.value,x=t[_],w=r[_];v[_]=TT(x,w,e)}}catch(F){m.e(F)}finally{m.f()}return v}var E=e*l,T=Math.cosh(d)/Math.cosh(d+c*E),P=u*((Math.cosh(d)*Math.tanh(d+c*E)-Math.sinh(d))/p)/f,A=1/T,D=a+_f(A),L=$_([],s,P);so(L,L,o);var C=mt(L);return{longitude:C[0],latitude:C[1],zoom:D}}function Ad(t,r,e){var n=kT(kT({},IT),e),i=n.screenSpeed,a=n.speed,o=n.maxDuration,s=LT(t,r,n),u=s.S,f=s.rho,l=1e3*u,c;return Number.isFinite(i)?c=l/(i/f):c=l/a,Number.isFinite(o)&&c>o?0:c}function LT(t,r,e){e=Object.assign({},IT,e);var n=e.curve,i=t.zoom,a=[t.longitude,t.latitude],o=aa(i),s=r.zoom,u=[r.longitude,r.latitude],f=aa(s-i),l=Pt(a),c=Pt(u),p=X_([],c,l),d=Math.max(t.width,t.height),v=d/f,m=H_(p)*o,g=Math.max(m,CT),_=n*n,x=(v*v-d*d+_*_*g*g)/(2*d*_*g),w=(v*v-d*d-_*_*g*g)/(2*v*_*g),E=Math.log(Math.sqrt(x*x+1)-x),T=Math.log(Math.sqrt(w*w+1)-w),P=(T-E)/n;return{startZoom:i,startCenterXY:l,uDelta:p,w0:d,u1:m,S:P,rho:n,rho2:_,r0:E,r1:T}}function iN(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=aN(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function aN(t,r){if(t){if(typeof t=="string")return DT(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return DT(t,r)}}function DT(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var oN=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,sN=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,uN=Zt(pN),fN=Zt(dN),lN=[0,0,0,1],cN=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function hN(t,r){var e=(0,jT.default)(t,3),n=e[0],i=e[1],a=e[2],o=Rt([n,i,a],r);return Number.isFinite(a)?o:[o[0],o[1],0]}function pN(t){var r=t.viewport,e=t.center;return new Ve(r.viewProjectionMatrix).invert().transform(e)}function dN(t){var r=t.viewport,e=t.shadowMatrices,n=[],i=r.pixelUnprojectionMatrix,a=r.isGeospatial?void 0:1,o=[[0,0,a],[r.width,0,a],[0,r.height,a],[r.width,r.height,a],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(function(l){return hN(l,i)}),s=iN(e),u;try{var f=function(){var c=u.value,p=c.clone().translate(new nt(r.center).negate()),d=o.map(function(m){return p.transform(m)}),v=new Ve().ortho({left:Math.min.apply(Math,(0,mi.default)(d.map(function(m){return m[0]}))),right:Math.max.apply(Math,(0,mi.default)(d.map(function(m){return m[0]}))),bottom:Math.min.apply(Math,(0,mi.default)(d.map(function(m){return m[1]}))),top:Math.max.apply(Math,(0,mi.default)(d.map(function(m){return m[1]}))),near:Math.min.apply(Math,(0,mi.default)(d.map(function(m){return-m[2]}))),far:Math.max.apply(Math,(0,mi.default)(d.map(function(m){return-m[2]})))});n.push(v.multiplyRight(c))};for(s.s();!(u=s.n()).done;)f()}catch(l){s.e(l)}finally{s.f()}return n}function vN(t,r){var e=t.shadowEnabled,n=e===void 0?!0:e;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};for(var i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||lN,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},a=uN({viewport:t.viewport,center:r.project_uCenter}),o=[],s=fN({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),u=0;u<t.shadowMatrices.length;u++){var f=s[u],l=f.clone().translate(new nt(t.viewport.center).negate());r.project_uCoordinateSystem===me.LNGLAT&&r.project_uProjectionMode===xt.WEB_MERCATOR?(s[u]=l,o[u]=a):(s[u]=f.clone().multiplyRight(cN),o[u]=l.transform(a))}for(var c=0;c<s.length;c++)i["shadow_uViewProjectionMatrices[".concat(c,"]")]=s[c],i["shadow_uProjectCenters[".concat(c,"]")]=o[c],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(c)]=t.shadowMaps[c]:i["shadow_uShadowMap".concat(c)]=t.dummyShadowMap;return i}var gi={name:"shadow",dependencies:[Ln],vs:oN,fs:sN,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?vN(r,e):{}}};function FT(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=mN(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function mN(t,r){if(t){if(typeof t=="string")return NT(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return NT(t,r)}}function NT(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var gN={color:[255,255,255],intensity:1},BT=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],yN=[0,0,0,200/255],Uo=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,VT.default)(this,t),(0,zt.default)(this,"id","lighting-effect"),(0,zt.default)(this,"props",void 0),(0,zt.default)(this,"shadowColor",yN),(0,zt.default)(this,"shadow",void 0),(0,zt.default)(this,"ambientLight",void 0),(0,zt.default)(this,"directionalLights",void 0),(0,zt.default)(this,"pointLights",void 0),(0,zt.default)(this,"shadowPasses",[]),(0,zt.default)(this,"shadowMaps",[]),(0,zt.default)(this,"dummyShadowMap",null),(0,zt.default)(this,"programManager",void 0),(0,zt.default)(this,"shadowMatrices",void 0),this.setProps(r)}return(0,zT.default)(t,[{key:"setProps",value:function(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(var n in e){var i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(function(a){return a.shadow}),this.props=e}},{key:"preRender",value:function(e,n){var i=n.layers,a=n.layerFilter,o=n.viewports,s=n.onViewportActive,u=n.views;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Lr.getDefaultProgramManager(e),gi&&this.programManager.addDefaultModule(gi)),this.dummyShadowMap||(this.dummyShadowMap=new Ge(e,{width:1,height:1}));for(var f=0;f<this.shadowPasses.length;f++){var l=this.shadowPasses[f];l.render({layers:i,layerFilter:a,viewports:o,onViewportActive:s,views:u,moduleParameters:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}}},{key:"getModuleParameters",value:function(e){var n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(function(i){return i.getProjectedLight({layer:e})}),pointLights:this.pointLights.map(function(i){return i.getProjectedLight({layer:e})})},n}},{key:"cleanup",value:function(){var e=FT(this.shadowPasses),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(gi),this.programManager=null)}},{key:"_calculateMatrices",value:function(){var e=[],n=FT(this.directionalLights),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=new Ve().lookAt({eye:new nt(a.direction).negate()});e.push(o)}}catch(s){n.e(s)}finally{n.f()}return e}},{key:"_createShadowPasses",value:function(e){for(var n=0;n<this.directionalLights.length;n++){var i=new fT(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}},{key:"_applyDefaultLights",value:function(){var e=this.ambientLight,n=this.pointLights,i=this.directionalLights;!e&&n.length===0&&i.length===0&&(this.ambientLight=new pf(gN),this.directionalLights.push(new ci(BT[0]),new ci(BT[1])))}}]),t}();var fE=h(B()),lE=h(U()),un=h(G());var Af=h(Ue());var Pf=h(Ue()),eE=h(B()),tE=h(U()),gr=h(we()),Rd=h(kt()),rE=h(ie()),nE=h(ae()),$o=h(ne()),Jt=h(G());var la=h(Ue()),ZT=h(B()),KT=h(U()),Ne=h(G());var UT=h(B()),GT=h(U()),Md=h(G()),_N=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,UT.default)(this,t),(0,Md.default)(this,"_pool",[]),(0,Md.default)(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(r)}return(0,GT.default)(t,[{key:"setOptions",value:function(e){Object.assign(this.opts,e)}},{key:"allocate",value:function(e,n,i){var a=i.size,o=a===void 0?1:a,s=i.type,u=i.padding,f=u===void 0?0:u,l=i.copy,c=l===void 0?!1:l,p=i.initialize,d=p===void 0?!1:p,v=i.maxCount,m=s||e&&e.constructor||Float32Array,g=n*o+f;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new m(e.buffer,0,g)}var _=1/0;v&&(_=v*o+f);var x=this._allocate(m,g,d,_);return e&&c?x.set(e):d||x.fill(0,0,4),this._release(e),x}},{key:"release",value:function(e){this._release(e)}},{key:"_allocate",value:function(e,n,i,a){var o=Math.max(Math.ceil(n*this.opts.overAlloc),1);o>a&&(o=a);var s=this._pool,u=e.BYTES_PER_ELEMENT*o,f=s.findIndex(function(c){return c.byteLength>=u});if(f>=0){var l=new e(s.splice(f,1)[0],0,o);return i&&l.fill(0),l}return new e(o)}},{key:"_release",value:function(e){if(ArrayBuffer.isView(e)){var n=this._pool,i=e.buffer,a=i.byteLength,o=n.findIndex(function(s){return s.byteLength>=a});o<0?n.push(i):(o>0||n.length<this.opts.poolSize)&&n.splice(o,0,i),n.length>this.opts.poolSize&&n.shift()}}}]),t}(),mr=new _N;function bN(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=wN(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function wN(t,r){if(t){if(typeof t=="string")return $T(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return $T(t,r)}}function $T(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function fa(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yi(t,r){var e=t%r;return e<0?r+e:e}function WT(t){return[t[12],t[13],t[14]]}function YT(t){return{left:ua(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ua(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ua(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ua(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ua(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ua(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var HT=new nt;function ua(t,r,e,n){HT.set(t,r,e);var i=HT.len();return{distance:n/i,normal:new nt(-t/i,-r/i,-e/i)}}function kd(t){return t-Math.fround(t)}var Go;function Tf(t,r){var e=r.size,n=e===void 0?1:e,i=r.startIndex,a=i===void 0?0:i,o=r.endIndex!==void 0?r.endIndex:t.length,s=(o-a)/n;Go=mr.allocate(Go,s,{type:Float32Array,size:n*2});for(var u=a,f=0;u<o;){for(var l=0;l<n;l++){var c=t[u++];Go[f+l]=c,Go[f+l+n]=kd(c)}f+=n*2}return Go.subarray(0,s*n*2)}function XT(t){var r=null,e=!1,n=bN(t),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a&&(r?(e||(r=[[r[0][0],r[0][1]],[r[1][0],r[1][1]]],e=!0),r[0][0]=Math.min(r[0][0],a[0][0]),r[0][1]=Math.min(r[0][1],a[0][1]),r[1][0]=Math.max(r[1][0],a[1][0]),r[1][1]=Math.max(r[1][1],a[1][1])):r=a)}}catch(o){n.e(o)}finally{n.f()}return r}var xN=Math.PI/180,TN=fa(),qT=[0,0,0],EN={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function PN(t){var r=t.width,e=t.height,n=t.orthographic,i=t.fovyRadians,a=t.focalDistance,o=t.padding,s=t.near,u=t.far,f=r/e,l=n?new Ve().orthographic({fovy:i,aspect:f,focalDistance:a,near:s,far:u}):new Ve().perspective({fovy:i,aspect:f,near:s,far:u});if(o){var c=o.left,p=c===void 0?0:c,d=o.right,v=d===void 0?0:d,m=o.top,g=m===void 0?0:m,_=o.bottom,x=_===void 0?0:_,w=Te((p+r-v)/2,0,r)-r/2,E=Te((g+e-x)/2,0,e)-e/2;l[8]-=w*2/r,l[9]+=E*2/e}return l}var gt=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ZT.default)(this,t),(0,Ne.default)(this,"id",void 0),(0,Ne.default)(this,"x",void 0),(0,Ne.default)(this,"y",void 0),(0,Ne.default)(this,"width",void 0),(0,Ne.default)(this,"height",void 0),(0,Ne.default)(this,"padding",void 0),(0,Ne.default)(this,"isGeospatial",void 0),(0,Ne.default)(this,"zoom",void 0),(0,Ne.default)(this,"focalDistance",void 0),(0,Ne.default)(this,"position",void 0),(0,Ne.default)(this,"modelMatrix",void 0),(0,Ne.default)(this,"distanceScales",void 0),(0,Ne.default)(this,"scale",void 0),(0,Ne.default)(this,"center",void 0),(0,Ne.default)(this,"cameraPosition",void 0),(0,Ne.default)(this,"projectionMatrix",void 0),(0,Ne.default)(this,"viewMatrix",void 0),(0,Ne.default)(this,"viewMatrixUncentered",void 0),(0,Ne.default)(this,"viewMatrixInverse",void 0),(0,Ne.default)(this,"viewProjectionMatrix",void 0),(0,Ne.default)(this,"pixelProjectionMatrix",void 0),(0,Ne.default)(this,"pixelUnprojectionMatrix",void 0),(0,Ne.default)(this,"resolution",void 0),(0,Ne.default)(this,"_frustumPlanes",{}),this.id=r.id||this.constructor.displayName||"viewport",this.x=r.x||0,this.y=r.y||0,this.width=r.width||1,this.height=r.height||1,this.zoom=r.zoom||0,this.padding=r.padding,this.distanceScales=r.distanceScales||EN,this.focalDistance=r.focalDistance||1,this.position=r.position||qT,this.modelMatrix=r.modelMatrix||null;var e=r.longitude,n=r.latitude;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(e),this._initProps(r),this._initMatrices(r),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,KT.default)(t,[{key:"subViewports",get:function(){return null}},{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?xt.WEB_MERCATOR:xt.WEB_MERCATOR_AUTO_OFFSET:xt.IDENTITY}},{key:"equals",value:function(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Vt(e.projectionMatrix,this.projectionMatrix)&&Vt(e.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(e),s=vi(o,this.pixelProjectionMatrix),u=(0,la.default)(s,2),f=u[0],l=u[1],c=a?l:this.height-l;return e.length===2?[f,c]:[f,c,s[2]]}},{key:"unproject",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,s=(0,la.default)(e,3),u=s[0],f=s[1],l=s[2],c=a?f:this.height-f,p=o&&o*this.distanceScales.unitsPerMeter[2],d=Rt([u,c,l],this.pixelUnprojectionMatrix,p),v=this.unprojectPosition(d),m=(0,la.default)(v,3),g=m[0],_=m[1],x=m[2];return Number.isFinite(l)?[g,_,x]:Number.isFinite(o)?[g,_,o]:[g,_]}},{key:"projectPosition",value:function(e){var n=this.projectFlat(e),i=(0,la.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[a,o,s]}},{key:"unprojectPosition",value:function(e){var n=this.unprojectFlat(e),i=(0,la.default)(n,2),a=i[0],o=i[1],s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[a,o,s]}},{key:"projectFlat",value:function(e){if(this.isGeospatial){var n=Pt(e);return n[1]=Te(n[1],-318,830),n}return e}},{key:"unprojectFlat",value:function(e){return this.isGeospatial?mt(e):e}},{key:"getBounds",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n={targetZ:e.z||0},i=this.unproject([0,0],n),a=this.unproject([this.width,0],n),o=this.unproject([0,this.height],n),s=this.unproject([this.width,this.height],n);return[Math.min(i[0],a[0],o[0],s[0]),Math.min(i[1],a[1],o[1],s[1]),Math.max(i[0],a[0],o[0],s[0]),Math.max(i[1],a[1],o[1],s[1])]}},{key:"getDistanceScales",value:function(e){return e?di({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(e){var n=e.x,i=e.y,a=e.width,o=a===void 0?1:a,s=e.height,u=s===void 0?1:s;return n<this.x+this.width&&this.x<n+o&&i<this.y+this.height&&this.y<i+u}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,YT(this.viewProjectionMatrix)),this._frustumPlanes)}},{key:"panByPosition",value:function(e,n){return null}},{key:"_initProps",value:function(e){var n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=No({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||di({latitude:i,longitude:n}));var a=Math.pow(2,this.zoom);this.scale=a;var o=e.position,s=e.modelMatrix,u=qT;if(o&&(u=s?new Ve(s).transformAsVector(o,[]):o),this.isGeospatial){var f=this.projectPosition([n,i,0]);this.center=new nt(u).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(u)}},{key:"_initMatrices",value:function(e){var n=e.viewMatrix,i=n===void 0?TN:n,a=e.projectionMatrix,o=a===void 0?null:a,s=e.orthographic,u=s===void 0?!1:s,f=e.fovyRadians,l=e.fovy,c=l===void 0?75:l,p=e.near,d=p===void 0?.1:p,v=e.far,m=v===void 0?1e3:v,g=e.padding,_=g===void 0?null:g,x=e.focalDistance,w=x===void 0?1:x;this.viewMatrixUncentered=i,this.viewMatrix=new Ve().multiplyRight(i).translate(new nt(this.center).negate()),this.projectionMatrix=o||PN({width:this.width,height:this.height,orthographic:u,fovyRadians:f||c*xN,focalDistance:w,padding:_,near:d,far:m});var E=fa();hi(E,E,this.projectionMatrix),hi(E,E,this.viewMatrix),this.viewProjectionMatrix=E,this.viewMatrixInverse=pd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=WT(this.viewMatrixInverse);var T=fa(),P=fa();dT(T,T,[this.width/2,-this.height/2,1]),pT(T,T,[1,-1,0]),hi(P,T,this.viewProjectionMatrix),this.pixelProjectionMatrix=P,this.pixelUnprojectionMatrix=pd(fa(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||le.warn("Pixel project matrix not invertible")()}}]),t}();(0,Ne.default)(gt,"displayName","Viewport");function SN(){var t=new on(2);return on!=Float32Array&&(t[0]=0,t[1]=0),t}function ca(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function Ef(t,r){return t[0]=-r[0],t[1]=-r[1],t}var WQ=function(){var t=SN();return function(r,e,n,i,a,o){var s,u;for(e||(e=2),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],a(t,t,o),r[s]=t[0],r[s+1]=t[1];return r}}();function JT(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ha(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JT(Object(e),!0).forEach(function(n){(0,Jt.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JT(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function ON(t){var r=AN();return function(){var n=(0,$o.default)(t),i;if(r){var a=(0,$o.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,nE.default)(this,i)}}function AN(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var _i=function(t){(0,rE.default)(e,t);var r=ON(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,eE.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,f=i.zoom,l=f===void 0?0:f,c=i.pitch,p=c===void 0?0:c,d=i.bearing,v=d===void 0?0:d,m=i.nearZMultiplier,g=m===void 0?.1:m,_=i.farZMultiplier,x=_===void 0?1.01:_,w=i.orthographic,E=w===void 0?!1:w,T=i.projectionMatrix,P=i.repeat,A=P===void 0?!1:P,D=i.worldOffset,L=D===void 0?0:D,C=i.position,F=i.padding,j=i.legacyMeterSizes,z=j===void 0?!1:j,N=i.width,M=i.height,k=i.altitude,R=k===void 0?1.5:k,Y=Math.pow(2,l);N=N||1,M=M||1;var V,Q=null;if(T)R=T[5]/2,V=sn(R);else{i.fovy?(V=i.fovy,R=jn(V)):V=sn(R);var J;if(F){var re=F.top,oe=re===void 0?0:re,ue=F.bottom,Oe=ue===void 0?0:ue;J=[0,Te((oe+M-Oe)/2,0,M)-M/2]}Q=bf({width:N,height:M,scale:Y,center:C&&[0,0,C[2]*Bo(o)],offset:J,pitch:p,fovy:V,nearZMultiplier:g,farZMultiplier:x})}var ee=zo({height:M,pitch:p,bearing:v,scale:Y,altitude:R});if(L){var Ee=new Ve().translate([512*L,0,0]);ee=Ee.multiplyLeft(ee)}return n=r.call(this,ha(ha(ha({},i),{},{width:N,height:M,viewMatrix:ee,longitude:u,latitude:o,zoom:l},Q),{},{fovy:V,focalDistance:R})),(0,Jt.default)((0,gr.default)(n),"longitude",void 0),(0,Jt.default)((0,gr.default)(n),"latitude",void 0),(0,Jt.default)((0,gr.default)(n),"pitch",void 0),(0,Jt.default)((0,gr.default)(n),"bearing",void 0),(0,Jt.default)((0,gr.default)(n),"altitude",void 0),(0,Jt.default)((0,gr.default)(n),"fovy",void 0),(0,Jt.default)((0,gr.default)(n),"orthographic",void 0),(0,Jt.default)((0,gr.default)(n),"_subViewports",void 0),(0,Jt.default)((0,gr.default)(n),"_pseudoMeters",void 0),n.latitude=o,n.longitude=u,n.zoom=l,n.pitch=p,n.bearing=v,n.altitude=R,n.fovy=V,n.orthographic=E,n._subViewports=A?[]:null,n._pseudoMeters=z,Object.freeze((0,gr.default)(n)),n}return(0,tE.default)(e,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var i=this.getBounds(),a=Math.floor((i[0]+180)/360),o=Math.ceil((i[2]-180)/360),s=a;s<=o;s++){var u=s?new e(ha(ha({},this),{},{worldOffset:s})):this;this._subViewports.push(u)}return this._subViewports}},{key:"projectPosition",value:function(i){if(this._pseudoMeters)return(0,Rd.default)((0,$o.default)(e.prototype),"projectPosition",this).call(this,i);var a=this.projectFlat(i),o=(0,Pf.default)(a,2),s=o[0],u=o[1],f=(i[2]||0)*Bo(i[1]);return[s,u,f]}},{key:"unprojectPosition",value:function(i){if(this._pseudoMeters)return(0,Rd.default)((0,$o.default)(e.prototype),"unprojectPosition",this).call(this,i);var a=this.unprojectFlat(i),o=(0,Pf.default)(a,2),s=o[0],u=o[1],f=(i[2]||0)/Bo(u);return[s,u,f]}},{key:"addMetersToLngLat",value:function(i,a){return Vo(i,a)}},{key:"panByPosition",value:function(i,a){var o=Rt(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=ca([],s,Ef([],o)),f=ca([],this.center,u),l=this.unprojectFlat(f),c=(0,Pf.default)(l,2),p=c[0],d=c[1];return{longitude:p,latitude:d}}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=sa(this,i.z||0);return[Math.min(a[0][0],a[1][0],a[2][0],a[3][0]),Math.min(a[0][1],a[1][1],a[2][1],a[3][1]),Math.max(a[0][0],a[1][0],a[2][0],a[3][0]),Math.max(a[0][1],a[1][1],a[2][1],a[3][1])]}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,s=this.height,u=oa(ha({width:o,height:s,bounds:i},a)),f=u.longitude,l=u.latitude,c=u.zoom;return new e({width:o,height:s,longitude:f,latitude:l,zoom:c})}}]),e}(gt);(0,Jt.default)(_i,"displayName","WebMercatorViewport");function MN(){var t=new on(3);return on!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function kN(t){var r=t[0],e=t[1],n=t[2];return Math.hypot(r,e,n)}function RN(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function CN(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n}function iE(t,r,e,n){var i=r[0],a=r[1],o=r[2];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t[2]=o+n*(e[2]-o),t}var Sf=RN;var aE=kN,Of=CN,KQ=function(){var t=MN();return function(r,e,n,i,a,o){var s,u;for(e||(e=3),n||(n=0),i?u=Math.min(i*e+n,r.length):u=r.length,s=n;s<u;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],a(t,t,o),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2];return r}}();var sE=[0,0,0];function Cd(t,r){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r.projectPosition(t);if(e&&r instanceof _i){var i=(0,Af.default)(t,3),a=i[0],o=i[1],s=i[2],u=s===void 0?0:s,f=r.getDistanceScales([a,o]);n[2]=u*f.unitsPerMeter[2]}return n}function IN(t){var r=t.viewport,e=t.modelMatrix,n=t.coordinateOrigin,i=t.coordinateSystem,a=t.fromCoordinateSystem,o=t.fromCoordinateOrigin;return i===me.DEFAULT&&(i=r.isGeospatial?me.LNGLAT:me.CARTESIAN),a===void 0&&(a=i),o===void 0&&(o=n),{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:e,fromCoordinateSystem:a,fromCoordinateOrigin:o}}function Id(t,r){var e=r.viewport,n=r.modelMatrix,i=r.coordinateSystem,a=r.coordinateOrigin,o=r.offsetMode,s=(0,Af.default)(t,3),u=s[0],f=s[1],l=s[2],c=l===void 0?0:l;if(n){var p=pi([],[u,f,c,1],n),d=(0,Af.default)(p,3);u=d[0],f=d[1],c=d[2]}switch(i){case me.LNGLAT:return Cd([u,f,c],e,o);case me.LNGLAT_OFFSETS:return Cd([u+a[0],f+a[1],c+(a[2]||0)],e,o);case me.METER_OFFSETS:return Cd(Vo(a,[u,f,c]),e,o);case me.CARTESIAN:default:return e.isGeospatial?[u+a[0],f+a[1],c+a[2]]:e.projectPosition([u,f,c])}}function Mf(t,r){var e=IN(r),n=e.viewport,i=e.coordinateSystem,a=e.coordinateOrigin,o=e.modelMatrix,s=e.fromCoordinateSystem,u=e.fromCoordinateOrigin,f=r.autoOffset,l=f===void 0?!0:f,c=l?vd(n,i,a):{},p=c.geospatialOrigin,d=p===void 0?sE:p,v=c.shaderCoordinateOrigin,m=v===void 0?sE:v,g=c.offsetMode,_=g===void 0?!1:g,x=Id(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:u,offsetMode:_});if(_){var w=n.projectPosition(d||m);Sf(x,x,w)}return x}function uE(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function LN(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?uE(Object(e),!0).forEach(function(n){(0,un.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):uE(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var DN=[255,255,255],jN=1,FN=[0,0,1],NN=[0,0,1],BN=0,kf=function(){function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,fE.default)(this,t),(0,un.default)(this,"id",void 0),(0,un.default)(this,"color",void 0),(0,un.default)(this,"intensity",void 0),(0,un.default)(this,"type","point"),(0,un.default)(this,"position",void 0),(0,un.default)(this,"attenuation",void 0),(0,un.default)(this,"projectedLight",void 0);var e=r.color,n=e===void 0?DN:e,i=r.intensity,a=i===void 0?jN:i,o=r.position,s=o===void 0?NN:o;this.id=r.id||"point-".concat(BN++),this.color=n,this.intensity=a,this.type="point",this.position=s,this.attenuation=VN(r),this.projectedLight=LN({},this)}return(0,lE.default)(t,[{key:"getProjectedLight",value:function(e){var n=e.layer,i=this.projectedLight,a=n.context.viewport,o=n.props,s=o.coordinateSystem,u=o.coordinateOrigin,f=Mf(this.position,{viewport:a,coordinateSystem:s,coordinateOrigin:u,fromCoordinateSystem:a.isGeospatial?me.LNGLAT:me.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return i.color=this.color,i.intensity=this.intensity,i.position=f,i}}]),t}();function VN(t){return t.attenuation?t.attenuation:"intensity"in t?[0,0,t.intensity||0]:FN}var cE=h(B()),hE=h(U()),pE=h(ie()),dE=h(ae()),Ld=h(ne());function zN(t){var r=UN();return function(){var n=(0,Ld.default)(t),i;if(r){var a=(0,Ld.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,dE.default)(this,i)}}function UN(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vE=function(t){(0,pE.default)(e,t);var r=zN(e);function e(){return(0,cE.default)(this,e),r.apply(this,arguments)}return(0,hE.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=this.projectedLight,s=a.context.viewport,u=a.props,f=u.coordinateSystem,l=u.coordinateOrigin,c=u.modelMatrix,p=gf({viewport:s,modelMatrix:c,coordinateSystem:f,coordinateOrigin:l}),d=p.project_uCameraPosition;return o.color=this.color,o.intensity=this.intensity,o.position=d,o}}]),e}(kf);var gE=h(Ue()),yE=h(B()),_E=h(U()),bE=h(we()),wE=h(ie()),xE=h(ae()),Dd=h(ne()),TE=h(G());var bi=Math.PI/180,GN=1e3*60*60*24,$N=2440588,HN=2451545,Rf=bi*23.4397,WN=357.5291,YN=.98560028,XN=280.147,qN=360.9856235;function mE(t,r,e){var n=bi*-e,i=bi*r,a=KN(t),o=aB(a),s=rB(a,n)-o.rightAscension;return{azimuth:eB(s,i,o.declination),altitude:tB(s,i,o.declination)}}function Cf(t,r,e){var n=mE(t,r,e),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]}function ZN(t){var r=typeof t=="number"?t:t.getTime();return r/GN-.5+$N}function KN(t){return ZN(t)-HN}function QN(t,r){var e=t;return Math.atan2(Math.sin(e)*Math.cos(Rf)-Math.tan(r)*Math.sin(Rf),Math.cos(e))}function JN(t,r){var e=t;return Math.asin(Math.sin(r)*Math.cos(Rf)+Math.cos(r)*Math.sin(Rf)*Math.sin(e))}function eB(t,r,e){var n=t,i=r,a=e;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function tB(t,r,e){var n=t,i=r,a=e;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}function rB(t,r){return bi*(XN+qN*t)-r}function nB(t){return bi*(WN+YN*t)}function iB(t){var r=t,e=bi*(1.9148*Math.sin(r)+.02*Math.sin(2*r)+3e-4*Math.sin(3*r)),n=bi*102.9372;return r+e+n+Math.PI}function aB(t){var r=nB(t),e=iB(r);return{declination:JN(e,0),rightAscension:QN(e,0)}}function oB(t){var r=sB();return function(){var n=(0,Dd.default)(t),i;if(r){var a=(0,Dd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,xE.default)(this,i)}}function sB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var EE=function(t){(0,wE.default)(e,t);var r=oB(e);function e(n){var i;return(0,yE.default)(this,e),i=r.call(this,n),(0,TE.default)((0,bE.default)(i),"timestamp",void 0),i.timestamp=n.timestamp,i}return(0,_E.default)(e,[{key:"getProjectedLight",value:function(i){var a=i.layer,o=a.context.viewport,s=o.resolution&&o.resolution>0;if(s){var u=Cf(this.timestamp,0,0),f=(0,gE.default)(u,3),l=f[0],c=f[1],p=f[2];this.direction=[l,-p,c]}else{var d=o.latitude,v=o.longitude;this.direction=Cf(this.timestamp,d,v)}return this}}]),e}(ci);var IE=h(B()),LE=h(U()),Ho=h(G());var PE=h(B()),SE=h(U()),OE=h(we()),AE=h(ie()),ME=h(ae()),jd=h(ne()),kE=h(G());function uB(t){var r=fB();return function(){var n=(0,jd.default)(t),i;if(r){var a=(0,jd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ME.default)(this,i)}}function fB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fd=function(t){(0,AE.default)(e,t);var r=uB(e);function e(n,i){var a;(0,PE.default)(this,e),a=r.call(this,n,i),(0,kE.default)((0,OE.default)(a),"model",void 0);var o=i.module,s=i.fs,u=i.id;return a.model=new Ku(n,{id:u,fs:s,modules:[o]}),a}return(0,SE.default)(e,[{key:"render",value:function(i){var a=this,o=this.gl;at(o,{viewport:[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}),Re(o,{framebuffer:i.outputBuffer,clearColor:[0,0,0,0]},function(){return a._renderPass(o,i)})}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(i,a){var o=a.inputBuffer;Cr(i,{color:!0}),this.model.draw({moduleSettings:a.moduleSettings,uniforms:{texture:o,texSize:[o.width,o.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),e}(df);function lB(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=cB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function cB(t,r){if(t){if(typeof t=="string")return RE(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return RE(t,r)}}function RE(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var DE=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,IE.default)(this,t),(0,Ho.default)(this,"id",void 0),(0,Ho.default)(this,"props",void 0),(0,Ho.default)(this,"module",void 0),(0,Ho.default)(this,"passes",void 0),this.id="".concat(r.name,"-pass"),this.props=e,vu(r),this.module=r}return(0,LE.default)(t,[{key:"setProps",value:function(e){this.props=e}},{key:"preRender",value:function(){}},{key:"postRender",value:function(e,n){var i=this.passes||hB(e,this.module,this.id);this.passes=i;for(var a=n.target,o=n.inputBuffer,s=n.swapBuffer,u=0;u<this.passes.length;u++){a&&u===this.passes.length-1&&(s=a),this.passes[u].render({inputBuffer:o,outputBuffer:s,moduleSettings:this.props});var f=s;s=o,o=f}return o}},{key:"cleanup",value:function(){if(this.passes){var e=lB(this.passes),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.passes=void 0}}}]),t}();function hB(t,r,e){if(!r.passes){var n=CE(r),i=new Fd(t,{id:e,module:r,fs:n});return[i]}return r.passes.map(function(a,o){var s=CE(r,a),u="".concat(e,"-").concat(o);return new Fd(t,{id:u,module:r,fs:s})})}var pB=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = texture2D(texture, texCoord);
  gl_FragColor = `.concat(r,`(gl_FragColor, texSize, texCoord);
}
`)},dB=function(r){return`uniform sampler2D texture;
uniform vec2 texSize;

varying vec2 position;
varying vec2 coordinate;
varying vec2 uv;

void main() {
  vec2 texCoord = coordinate;

  gl_FragColor = `.concat(r,`(texture, texSize, texCoord);
}
`)};function CE(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t;if(r.filter){var e=typeof r.filter=="string"?r.filter:"".concat(t.name,"_filterColor");return pB(e)}if(r.sampler){var n=typeof r.sampler=="string"?r.sampler:"".concat(t.name,"_sampleColor");return dB(n)}return null}var NE=h(B()),BE=h(U()),Bd=h(we()),Vd=h(kt()),VE=h(ie()),zE=h(ae()),Wo=h(ne()),If=h(G());function jE(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Nd(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?jE(Object(e),!0).forEach(function(n){(0,If.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):jE(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function vB(t){var r=mB();return function(){var n=(0,Wo.default)(t),i;if(r){var a=(0,Wo.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zE.default)(this,i)}}function mB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FE={blendFunc:[1,0,32771,0],blendEquation:32774},pa=function(t){(0,VE.default)(e,t);var r=vB(e);function e(){var n;(0,NE.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,If.default)((0,Bd.default)(n),"pickZ",void 0),(0,If.default)((0,Bd.default)(n),"_colorEncoderState",null),n}return(0,BE.default)(e,[{key:"render",value:function(i){return"pickingFBO"in i?this._drawPickingBuffer(i):(0,Vd.default)((0,Wo.default)(e.prototype),"render",this).call(this,i)}},{key:"_drawPickingBuffer",value:function(i){var a=this,o=i.layers,s=i.layerFilter,u=i.views,f=i.viewports,l=i.onViewportActive,c=i.pickingFBO,p=i.deviceRect,d=p.x,v=p.y,m=p.width,g=p.height,_=i.cullRect,x=i.effects,w=i.pass,E=w===void 0?"picking":w,T=i.pickZ,P=i.moduleParameters,A=this.gl;this.pickZ=T;var D=this._resetColorEncoder(T),L=Re(A,Nd(Nd({scissorTest:!0,scissor:[d,v,m,g],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},FE),{},{blend:!T}),function(){return(0,Vd.default)((0,Wo.default)(e.prototype),"render",a).call(a,{target:c,layers:o,layerFilter:s,views:u,viewports:f,onViewportActive:l,cullRect:_,effects:x?.filter(function(F){return F.useInPicking}),pass:E,isPicking:!0,moduleParameters:P})});this._colorEncoderState=null;var C=D&&yB.bind(null,D);return{decodePickingColor:C,stats:L}}},{key:"shouldDrawLayer",value:function(i){var a=i.props,o=a.pickable,s=a.operation;return o&&s.includes("draw")||s.includes("terrain")}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(i,a,o){var s=Nd({},i.props.parameters),u=i.props,f=u.pickable,l=u.operation;return this._colorEncoderState?f&&l.includes("draw")&&(Object.assign(s,FE),s.blend=!0,s.blendColor=gB(this._colorEncoderState,i,o)):s.blend=!1,l.includes("terrain")&&(s.blend=!1),s}},{key:"_resetColorEncoder",value:function(i){return this._colorEncoderState=i?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}]),e}(In);function gB(t,r,e){var n=t.byLayer,i=t.byAlpha,a,o=n.get(r);return o?(o.viewports.push(e),a=o.a):(a=n.size+1,a<=255?(o={a,layer:r,viewports:[e]},n.set(r,o),i[a]=o):(le.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function yB(t,r){var e=t.byAlpha[r[3]];return e&&{pickedLayer:e.layer,pickedViewports:e.viewports,pickedObjectIndex:e.layer.decodePickingColor(r)}}var RO=h(B()),CO=h(U()),Me=h(G());var rP=h(B()),nP=h(U()),Vr=h(G());var Fn={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},da=Symbol.for("component"),er=Symbol.for("propTypes"),Lf=Symbol.for("deprecatedProps"),fn=Symbol.for("asyncPropDefaults"),Br=Symbol.for("asyncPropOriginal"),yr=Symbol.for("asyncPropResolved");function Nn(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};return Array.isArray(t)?UE(t,r,[]):r(t)?[t]:[]}function UE(t,r,e){for(var n=-1;++n<t.length;){var i=t[n];Array.isArray(i)?UE(i,r,e):r(i)&&e.push(i)}return e}function Df(t){for(var r=t.target,e=t.source,n=t.start,i=n===void 0?0:n,a=t.count,o=a===void 0?1:a,s=e.length,u=o*s,f=0,l=i;f<s;f++)r[l++]=e[f];for(;f<u;)f<u-f?(r.copyWithin(i+f,i,i+f),f*=2):(r.copyWithin(i+f,i,i+u-f),f=u);return r}var YE=h(B()),XE=h(U()),va=h(G());var $E=h(B()),HE=h(U()),_r=h(G());function _B(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bB(t,r){if(t){if(typeof t=="string")return GE(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GE(t,r)}}function GE(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var WE=function(){function t(r,e,n){(0,$E.default)(this,t),(0,_r.default)(this,"id",void 0),(0,_r.default)(this,"context",void 0),(0,_r.default)(this,"isLoaded",void 0),(0,_r.default)(this,"persistent",void 0),(0,_r.default)(this,"_loadCount",0),(0,_r.default)(this,"_subscribers",new Set),(0,_r.default)(this,"_data",void 0),(0,_r.default)(this,"_loader",void 0),(0,_r.default)(this,"_error",void 0),(0,_r.default)(this,"_content",void 0),this.id=r,this.context=n,this.setData(e)}return(0,HE.default)(t,[{key:"subscribe",value:function(e){this._subscribers.add(e)}},{key:"unsubscribe",value:function(e){this._subscribers.delete(e)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var e=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(function(){return e.getData()})}},{key:"setData",value:function(e,n){var i=this;if(!(e===this._data&&!n)){this._data=e;var a=++this._loadCount,o=e;typeof e=="string"&&(o=Cn(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(function(l){i._loadCount===a&&(i.isLoaded=!0,i._error=void 0,i._content=l)}).catch(function(l){i._loadCount===a&&(i.isLoaded=!0,i._error=l||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);var s=_B(this._subscribers),u;try{for(s.s();!(u=s.n()).done;){var f=u.value;f.onChange(this.getData())}}catch(l){s.e(l)}finally{s.f()}}}}]),t}();var qE=function(){function t(r){var e=r.gl,n=r.protocol;(0,YE.default)(this,t),(0,va.default)(this,"protocol",void 0),(0,va.default)(this,"_context",void 0),(0,va.default)(this,"_resources",void 0),(0,va.default)(this,"_consumers",void 0),(0,va.default)(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return(0,XE.default)(t,[{key:"contains",value:function(e){return e.startsWith(this.protocol)?!0:e in this._resources}},{key:"add",value:function(e){var n=e.resourceId,i=e.data,a=e.forceUpdate,o=a===void 0?!1:a,s=e.persistent,u=s===void 0?!0:s,f=this._resources[n];f?f.setData(i,o):(f=new WE(n,i,this._context),this._resources[n]=f),f.persistent=u}},{key:"remove",value:function(e){var n=this._resources[e];n&&(n.delete(),delete this._resources[e])}},{key:"unsubscribe",value:function(e){var n=e.consumerId,i=this._consumers[n];if(i){for(var a in i){var o=i[a],s=this._resources[o.resourceId];s&&s.unsubscribe(o)}delete this._consumers[n],this.prune()}}},{key:"subscribe",value:function(e){var n=e.resourceId,i=e.onChange,a=e.consumerId,o=e.requestId,s=o===void 0?"default":o,u=this._resources,f=this.protocol;n.startsWith(f)&&(n=n.replace(f,""),u[n]||this.add({resourceId:n,data:null,persistent:!1}));var l=u[n];if(this._track(a,s,l,i),l)return l.getData()}},{key:"prune",value:function(){var e=this;this._pruneRequest||(this._pruneRequest=setTimeout(function(){return e._prune()},0))}},{key:"finalize",value:function(){for(var e in this._resources)this._resources[e].delete()}},{key:"_track",value:function(e,n,i,a){var o=this._consumers,s=o[e]=o[e]||{},u=s[n]||{},f=u.resourceId&&this._resources[u.resourceId];f&&(f.unsubscribe(u),this.prune()),i&&(s[n]=u,u.onChange=a,u.resourceId=i.id,i.subscribe(u))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var e=0,n=Object.keys(this._resources);e<n.length;e++){var i=n[e],a=this._resources[i];!a.persistent&&!a.inUse()&&(a.delete(),delete this._resources[i])}}}]),t}();var wB=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,zd={name:"project32",dependencies:[Ln],vs:wB};var KE=h(G());function ZE(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function xB(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ZE(Object(e),!0).forEach(function(n){(0,KE.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ZE(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Ud=xB({inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Nu);function QE(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=TB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function TB(t,r){if(t){if(typeof t=="string")return JE(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return JE(t,r)}}function JE(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var EB=[Ln],PB=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function eP(t){var r=Lr.getDefaultProgramManager(t),e=QE(EB),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;r.addDefaultModule(i)}}catch(u){e.e(u)}finally{e.f()}var a=QE(PB),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;r.addShaderHook(s)}}catch(u){a.e(u)}finally{a.f()}return r}function Yo(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=SB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function SB(t,r){if(t){if(typeof t=="string")return tP(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return tP(t,r)}}function tP(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var OB="layerManager.setLayers",AB="layerManager.activateViewport",jf=function(){function t(r){var e=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.deck,a=n.stats,o=n.viewport,s=n.timeline;(0,rP.default)(this,t),(0,Vr.default)(this,"layers",void 0),(0,Vr.default)(this,"context",void 0),(0,Vr.default)(this,"resourceManager",void 0),(0,Vr.default)(this,"_lastRenderedLayers",[]),(0,Vr.default)(this,"_needsRedraw",!1),(0,Vr.default)(this,"_needsUpdate",!1),(0,Vr.default)(this,"_nextLayers",null),(0,Vr.default)(this,"_debug",!1),(0,Vr.default)(this,"activateViewport",function(u){Ke(AB,e,u),u&&(e.context.viewport=u)}),this.layers=[],this.resourceManager=new qE({gl:r,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:r,deck:i,programManager:r&&eP(r),stats:a||new Kn({id:"deck.gl"}),viewport:o||new gt({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new kn,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}return(0,nP.default)(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var e=Yo(this.layers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this._finalizeLayer(i)}}catch(a){e.e(a)}finally{e.f()}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=Yo(this.layers),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=o.getNeedsRedraw(e);n=n||s}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(e){this._needsRedraw=this._needsRedraw||e}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e}},{key:"getLayers",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.layerIds;return n?this.layers.filter(function(i){return n.find(function(a){return i.id.indexOf(a)===0})}):this.layers}},{key:"setProps",value:function(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}},{key:"setLayers",value:function(e,n){Ke(OB,this,n,e),this._lastRenderedLayers=e;var i=Nn(e,Boolean),a=Yo(i),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context}}catch(u){a.e(u)}finally{a.f()}this._updateLayers(this.layers,i)}},{key:"updateLayers",value:function(){var e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}},{key:"_handleError",value:function(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}},{key:"_updateLayers",value:function(e,n){var i={},a=Yo(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i[s.id]?le.warn("Multiple old layers with same id ".concat(s.id))():i[s.id]=s}}catch(d){a.e(d)}finally{a.f()}var u=[];this._updateSublayersRecursively(n,i,u),this._finalizeOldLayers(i);for(var f=!1,l=0,c=u;l<c.length;l++){var p=c[l];if(p.hasUniformTransition()){f="Uniform transition in ".concat(p);break}}this._needsUpdate=f,this.layers=u}},{key:"_updateSublayersRecursively",value:function(e,n,i){var a=Yo(e),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.context=this.context;var u=n[s.id];u===null&&le.warn("Multiple new layers with same id ".concat(s.id))(),n[s.id]=null;var f=null;try{this._debug&&u!==s&&s.validateProps(),u?(this._transferLayerState(u,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),f=s.isComposite?s.getSubLayers():null}catch(l){this._handleError("matching",l,s)}f&&this._updateSublayersRecursively(f,n,i)}}catch(l){a.e(l)}finally{a.f()}}},{key:"_finalizeOldLayers",value:function(e){for(var n in e){var i=e[n];i&&this._finalizeLayer(i)}}},{key:"_initializeLayer",value:function(e){try{e._initialize(),e.lifecycle=Fn.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}},{key:"_transferLayerState",value:function(e,n){n._transferState(e),n.lifecycle=Fn.MATCHED,n!==e&&(e.lifecycle=Fn.AWAITING_GC)}},{key:"_updateLayer",value:function(e){try{e._update()}catch(n){this._handleError("update",n,e)}}},{key:"_finalizeLayer",value:function(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Fn.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fn.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}]),t}();var aP=h(B()),oP=h(U()),St=h(G());var Gd=h(qe());function st(t,r,e){if(t===r)return!0;if(!e||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!st(t[n],r[n],e-1))return!1;return!0}if(Array.isArray(r))return!1;if((0,Gd.default)(t)==="object"&&(0,Gd.default)(r)==="object"){var i=Object.keys(t),a=Object.keys(r);if(i.length!==a.length)return!1;for(var o=0,s=i;o<s.length;o++){var u=s[o];if(!r.hasOwnProperty(u)||!st(t[u],r[u],e-1))return!1}return!0}return!1}function iP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Xo(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iP(Object(e),!0).forEach(function(n){(0,St.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var sP=function(){function t(r){(0,aP.default)(this,t),(0,St.default)(this,"width",void 0),(0,St.default)(this,"height",void 0),(0,St.default)(this,"views",void 0),(0,St.default)(this,"viewState",void 0),(0,St.default)(this,"controllers",void 0),(0,St.default)(this,"timeline",void 0),(0,St.default)(this,"_viewports",void 0),(0,St.default)(this,"_viewportMap",void 0),(0,St.default)(this,"_isUpdating",void 0),(0,St.default)(this,"_needsRedraw",void 0),(0,St.default)(this,"_needsUpdate",void 0),(0,St.default)(this,"_eventManager",void 0),(0,St.default)(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=r.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=r.eventManager,this._eventCallbacks={onViewStateChange:r.onViewStateChange,onInteractionStateChange:r.onInteractionStateChange},Object.seal(this),this.setProps(r)}return(0,oP.default)(t,[{key:"finalize",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.finalize()}this.controllers={}}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"setNeedsUpdate",value:function(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}},{key:"updateViewStates",value:function(){for(var e in this.controllers){var n=this.controllers[e];n&&n.updateTransition()}}},{key:"getViewports",value:function(e){return e?this._viewports.filter(function(n){return n.containsPixel(e)}):this._viewports}},{key:"getViews",value:function(){var e={};return this.views.forEach(function(n){e[n.id]=n}),e}},{key:"getView",value:function(e){return this.views.find(function(n){return n.id===e})}},{key:"getViewState",value:function(e){var n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}},{key:"getViewport",value:function(e){return this._viewportMap[e]}},{key:"unproject",value:function(e,n){for(var i=this.getViewports(),a={x:e[0],y:e[1]},o=i.length-1;o>=0;--o){var s=i[o];if(s.containsPixel(a)){var u=e.slice();return u[0]-=s.x,u[1]-=s.y,s.unproject(u,n)}}return null}},{key:"setProps",value:function(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(e){e=Nn(e,Boolean);var n=this._diffViews(e,this.views);n&&this.setNeedsUpdate("views changed"),this.views=e}},{key:"_setViewState",value:function(e){if(e){var n=!st(e,this.viewState,3);n&&this.setNeedsUpdate("viewState changed"),this.viewState=e}else le.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(Xo(Xo({},n),{},{viewId:e}))}},{key:"_createController",value:function(e,n){var i=this,a=n.type,o=new a({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(u){var f;return(f=i.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:i.width,height:i.height})}});return o}},{key:"_updateController",value:function(e,n,i,a){var o=e.controller;if(o){var s=Xo(Xo(Xo({},n),o),{},{id:e.id,x:i.x,y:i.y,width:i.width,height:i.height});return a||(a=this._createController(e,s)),a&&a.setProps(s),a}return null}},{key:"_rebuildViewports",value:function(){var e=this.views,n=this.controllers;this._viewports=[],this.controllers={};for(var i=!1,a=e.length;a--;){var o=e[a],s=this.getViewState(o),u=o.makeViewport({viewState:s,width:this.width,height:this.height}),f=n[o.id],l=Boolean(o.controller);l&&!f&&(i=!0),(i||!l)&&f&&(f.finalize(),f=null),this.controllers[o.id]=this._updateController(o,s,u,f),this._viewports.unshift(u)}for(var c in n){var p=n[c];p&&!this.controllers[c]&&p.finalize()}this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var e=this;this._viewportMap={},this._viewports.forEach(function(n){n.id&&(e._viewportMap[n.id]=e._viewportMap[n.id]||n)})}},{key:"_diffViews",value:function(e,n){return e.length!==n.length?!0:e.some(function(i,a){return!e[a].equals(n[a])})}}]),t}();var GP=h(B()),$P=h(U()),HP=h(ie()),WP=h(ae()),Zd=h(ne()),YP=h(G());var lP=h(qe()),cP=h(B()),hP=h(U()),zr=h(G());var uP=h(qe()),MB=/([0-9]+\.?[0-9]*)(%|px)/;function ln(t){switch((0,uP.default)(t)){case"number":return{position:t,relative:!1};case"string":var r=MB.exec(t);if(r&&r.length>=3){var e=r[2]==="%",n=parseFloat(r[1]);return{position:e?n/100:n,relative:e}}default:throw new Error("Could not parse position string ".concat(t))}}function cn(t,r){return t.relative?Math.round(t.position*r):t.position}function ke(t,r){if(!t)throw new Error(r||"deck.gl: assertion failed.")}function fP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?fP(Object(e),!0).forEach(function(n){(0,zr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):fP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var tr=function(){function t(r){(0,cP.default)(this,t),(0,zr.default)(this,"id",void 0),(0,zr.default)(this,"viewportInstance",void 0),(0,zr.default)(this,"_x",void 0),(0,zr.default)(this,"_y",void 0),(0,zr.default)(this,"_width",void 0),(0,zr.default)(this,"_height",void 0),(0,zr.default)(this,"_padding",void 0),(0,zr.default)(this,"props",void 0);var e=r||{},n=e.id,i=e.x,a=i===void 0?0:i,o=e.y,s=o===void 0?0:o,u=e.width,f=u===void 0?"100%":u,l=e.height,c=l===void 0?"100%":l,p=e.padding,d=p===void 0?null:p,v=e.viewportInstance;ke(!v||v instanceof gt),this.viewportInstance=v,this.id=n||this.constructor.displayName||"view",this.props=wi(wi({},r),{},{id:this.id}),this._x=ln(a),this._y=ln(s),this._width=ln(f),this._height=ln(c),this._padding=d&&{left:ln(d.left||0),right:ln(d.right||0),top:ln(d.top||0),bottom:ln(d.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}return(0,hP.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&st(this.props,e.props,2)}},{key:"makeViewport",value:function(e){var n=e.width,i=e.height,a=e.viewState;if(this.viewportInstance)return this.viewportInstance;a=this.filterViewState(a);var o=this.getDimensions({width:n,height:i});return new this.ViewportType(wi(wi(wi({},a),this.props),o))}},{key:"getViewStateId",value:function(){var e=this.props.viewState;return typeof e=="string"?e:e?.id||this.id}},{key:"filterViewState",value:function(e){if(this.props.viewState&&(0,lP.default)(this.props.viewState)==="object"){if(!this.props.viewState.id)return this.props.viewState;var n=wi({},e);for(var i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}},{key:"getDimensions",value:function(e){var n=e.width,i=e.height,a={x:cn(this._x,n),y:cn(this._y,i),width:cn(this._width,n),height:cn(this._height,i)};return this._padding&&(a.padding={left:cn(this._padding.left,n),top:cn(this._padding.top,i),right:cn(this._padding.right,n),bottom:cn(this._padding.bottom,i)}),a}},{key:"controller",get:function(){var e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:wi({type:this.ControllerType},e):null}}]),t}();var VP=h(kt()),Wd=h(B()),Yd=h(U()),Zo=h(we()),Xd=h(ie()),zP=h(ae()),zf=h(ne()),ba=h(G());var LP=h(B()),DP=h(U()),ze=h(G());var gP=h(B()),yP=h(U()),hn=h(G());var pP=h(B()),dP=h(U()),ma=h(G()),Ur=function(){function t(r){(0,pP.default)(this,t),(0,ma.default)(this,"_inProgress",void 0),(0,ma.default)(this,"_handle",void 0),(0,ma.default)(this,"_timeline",void 0),(0,ma.default)(this,"time",void 0),(0,ma.default)(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=r,this.time=0,this.settings={duration:0}}return(0,dP.default)(t,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}},{key:"end",value:function(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}},{key:"cancel",value:function(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}},{key:"update",value:function(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){var i=this._timeline,a=this.settings;this._handle=i.addChannel({delay:i.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),t}();function vP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Ff(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vP(Object(e),!0).forEach(function(n){(0,hn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var mP=function(){},qo={BREAK:1,SNAP_TO_END:2,IGNORE:3},kB=function(r){return r},RB=qo.BREAK,_P=function(){function t(r){var e=this;(0,gP.default)(this,t),(0,hn.default)(this,"getControllerState",void 0),(0,hn.default)(this,"props",void 0),(0,hn.default)(this,"propsInTransition",void 0),(0,hn.default)(this,"transition",void 0),(0,hn.default)(this,"onViewStateChange",void 0),(0,hn.default)(this,"onStateChange",void 0),(0,hn.default)(this,"_onTransitionUpdate",function(n){var i=n.time,a=n.settings,o=a.interpolator,s=a.startProps,u=a.endProps,f=a.duration,l=a.easing,c=l(i/f),p=o.interpolateProps(s,u,c);e.propsInTransition=e.getControllerState(Ff(Ff({},e.props),p)).getViewportProps(),e.onViewStateChange({viewState:e.propsInTransition,oldViewState:e.props})}),this.getControllerState=r.getControllerState,this.propsInTransition=null,this.transition=new Ur(r.timeline),this.onViewStateChange=r.onViewStateChange||mP,this.onStateChange=r.onStateChange||mP}return(0,yP.default)(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(e){var n=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){var a=i;if(this.transition.inProgress){var o=this.transition.settings,s=o.interruption,u=o.endProps;a=Ff(Ff({},i),s===qo.SNAP_TO_END?u:this.propsInTransition||i)}this._triggerTransition(a,e),n=!0}else this.transition.cancel();return n}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(e){var n=e.transitionDuration,i=e.transitionInterpolator;return(n>0||n==="auto")&&Boolean(i)}},{key:"_isUpdateDueToCurrentTransition",value:function(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(e,n){return this.transition.inProgress?this.transition.settings.interruption===qo.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}},{key:"_triggerTransition",value:function(e,n){var i=this.getControllerState(e),a=this.getControllerState(n).shortestPathFrom(i),o=n.transitionInterpolator,s=o.getDuration?o.getDuration(e,n):n.transitionDuration;if(s!==0){var u=o.initializeProps(e,a);this.propsInTransition={};var f={duration:s,easing:n.transitionEasing||kB,interpolator:o,interruption:n.transitionInterruption||RB,startProps:u.start,endProps:u.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(e){var n=this;return function(i){n.propsInTransition=null,n.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(i)}}}]),t}();var OP=h(B()),AP=h(U()),MP=h(we()),kP=h(kt()),RP=h(ie()),CP=h(ae()),Bf=h(ne()),$d=h(G());var xP=h(B()),TP=h(U()),Nf=h(G());function bP(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=CB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function CB(t,r){if(t){if(typeof t=="string")return wP(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wP(t,r)}}function wP(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var ga=function(){function t(r){(0,xP.default)(this,t),(0,Nf.default)(this,"_propsToCompare",void 0),(0,Nf.default)(this,"_propsToExtract",void 0),(0,Nf.default)(this,"_requiredProps",void 0);var e=r.compare,n=r.extract,i=r.required;this._propsToCompare=e,this._propsToExtract=n||e,this._requiredProps=i}return(0,TP.default)(t,[{key:"arePropsEqual",value:function(e,n){var i=bP(this._propsToCompare),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!(o in e)||!(o in n)||!Vt(e[o],n[o]))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}},{key:"initializeProps",value:function(e,n){var i={},a={},o=bP(this._propsToExtract),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;(u in e||u in n)&&(i[u]=e[u],a[u]=n[u])}}catch(f){o.e(f)}finally{o.f()}return this._checkRequiredProps(i),this._checkRequiredProps(a),{start:i,end:a}}},{key:"getDuration",value:function(e,n){return n.transitionDuration}},{key:"_checkRequiredProps",value:function(e){this._requiredProps&&this._requiredProps.forEach(function(n){var i=e[n];ke(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}]),t}();function EP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function PP(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?EP(Object(e),!0).forEach(function(n){(0,$d.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):EP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function IB(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=LB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function LB(t,r){if(t){if(typeof t=="string")return SP(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return SP(t,r)}}function SP(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function DB(t){var r=jB();return function(){var n=(0,Bf.default)(t),i;if(r){var a=(0,Bf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,CP.default)(this,i)}}function jB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var FB=["longitude","latitude","zoom","bearing","pitch"],NB=["longitude","latitude","zoom"],Ct=function(t){(0,RP.default)(e,t);var r=DB(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,OP.default)(this,e);var a=Array.isArray(i)?i:i.transitionProps,o=Array.isArray(i)?{}:i;return o.transitionProps=Array.isArray(a)?{compare:a,required:a}:a||{compare:FB,required:NB},n=r.call(this,o.transitionProps),(0,$d.default)((0,MP.default)(n),"opts",void 0),n.opts=o,n}return(0,AP.default)(e,[{key:"initializeProps",value:function(i,a){var o=(0,kP.default)((0,Bf.default)(e.prototype),"initializeProps",this).call(this,i,a),s=this.opts,u=s.makeViewport,f=s.around;if(u&&f){var l=u(i),c=u(a),p=l.unproject(f);o.start.around=f,Object.assign(o.end,{around:c.project(p),aroundPosition:p,width:a.width,height:a.height})}return o}},{key:"interpolateProps",value:function(i,a,o){var s={},u=IB(this._propsToExtract),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;s[l]=nn(i[l]||0,a[l]||0,o)}}catch(p){u.e(p)}finally{u.f()}if(a.aroundPosition&&this.opts.makeViewport){var c=this.opts.makeViewport(PP(PP({},a),s));Object.assign(s,c.panByPosition(a.aroundPosition,nn(i.around,a.around,o)))}return s}}]),e}(ga);function IP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Xe(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?IP(Object(e),!0).forEach(function(n){(0,ze.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):IP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Bn={transitionDuration:0},BB=300,Vf=function(r){return 1-(1-r)*(1-r)},ya={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},xi={},rr=function(){function t(r){var e=this;(0,LP.default)(this,t),(0,ze.default)(this,"props",void 0),(0,ze.default)(this,"state",{}),(0,ze.default)(this,"transitionManager",void 0),(0,ze.default)(this,"eventManager",void 0),(0,ze.default)(this,"onViewStateChange",void 0),(0,ze.default)(this,"onStateChange",void 0),(0,ze.default)(this,"makeViewport",void 0),(0,ze.default)(this,"_controllerState",void 0),(0,ze.default)(this,"_events",{}),(0,ze.default)(this,"_interactionState",{isDragging:!1}),(0,ze.default)(this,"_customEvents",[]),(0,ze.default)(this,"_eventStartBlocked",null),(0,ze.default)(this,"_panMove",!1),(0,ze.default)(this,"invertPan",!1),(0,ze.default)(this,"dragMode","rotate"),(0,ze.default)(this,"inertia",0),(0,ze.default)(this,"scrollZoom",!0),(0,ze.default)(this,"dragPan",!0),(0,ze.default)(this,"dragRotate",!0),(0,ze.default)(this,"doubleClickZoom",!0),(0,ze.default)(this,"touchZoom",!0),(0,ze.default)(this,"touchRotate",!1),(0,ze.default)(this,"keyboard",!0),this.transitionManager=new _P(Xe(Xe({},r),{},{getControllerState:function(i){return new e.ControllerState(i)},onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)})),this.handleEvent=this.handleEvent.bind(this),this.eventManager=r.eventManager,this.onViewStateChange=r.onViewStateChange||function(){},this.onStateChange=r.onStateChange||function(){},this.makeViewport=r.makeViewport}return(0,DP.default)(t,[{key:"events",set:function(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}},{key:"finalize",value:function(){for(var e in this._events)if(this._events[e]){var n;(n=this.eventManager)===null||n===void 0||n.off(e,this.handleEvent)}this.transitionManager.finalize()}},{key:"handleEvent",value:function(e){this._controllerState=void 0;var n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}},{key:"controllerState",get:function(){return this._controllerState=this._controllerState||new this.ControllerState(Xe(Xe({makeViewport:this.makeViewport},this.props),this.state)),this._controllerState}},{key:"getCenter",value:function(e){var n=this.props,i=n.x,a=n.y,o=e.offsetCenter;return[o.x-i,o.y-a]}},{key:"isPointInBounds",value:function(e,n){var i=this.props,a=i.width,o=i.height;if(n&&n.handled)return!1;var s=e[0]>=0&&e[0]<=a&&e[1]>=0&&e[1]<=o;return s&&n&&n.stopPropagation(),s}},{key:"isFunctionKeyPressed",value:function(e){var n=e.srcEvent;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging||!1}},{key:"blockEvents",value:function(e){var n=this,i=setTimeout(function(){n._eventStartBlocked===i&&(n._eventStartBlocked=null)},e);this._eventStartBlocked=i}},{key:"setProps",value:function(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);var n=e.inertia;this.inertia=Number.isFinite(n)?n:n===!0?BB:0;var i=e.scrollZoom,a=i===void 0?!0:i,o=e.dragPan,s=o===void 0?!0:o,u=e.dragRotate,f=u===void 0?!0:u,l=e.doubleClickZoom,c=l===void 0?!0:l,p=e.touchZoom,d=p===void 0?!0:p,v=e.touchRotate,m=v===void 0?!1:v,g=e.keyboard,_=g===void 0?!0:g,x=Boolean(this.onViewStateChange);this.toggleEvents(ya.WHEEL,x&&a),this.toggleEvents(ya.PAN,x&&(s||f)),this.toggleEvents(ya.PINCH,x&&(d||m)),this.toggleEvents(ya.TRIPLE_PAN,x&&m),this.toggleEvents(ya.DOUBLE_TAP,x&&c),this.toggleEvents(ya.KEYBOARD,x&&_),this.scrollZoom=a,this.dragPan=s,this.dragRotate=f,this.doubleClickZoom=c,this.touchZoom=d,this.touchRotate=m,this.keyboard=_}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(e,n){var i=this;this.eventManager&&e.forEach(function(a){i._events[a]!==n&&(i._events[a]=n,n?i.eventManager.on(a,i.handleEvent):i.eventManager.off(a,i.handleEvent))})}},{key:"updateViewport",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=Xe(Xe({},e.getViewportProps()),n),o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){var s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:s})}}},{key:"_onTransition",value:function(e){this.onViewStateChange(Xe(Xe({},e),{},{interactionState:this._interactionState}))}},{key:"_setInteractionState",value:function(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);var a=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(a,Bn,{isDragging:!0}),!0}},{key:"_onPan",value:function(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}},{key:"_onPanEnd",value:function(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}},{key:"_onPanMove",value:function(e){if(!this.dragPan)return!1;var n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Bn,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(e){var n=this.inertia;if(this.dragPan&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(o,Xe(Xe({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Vf}),{isDragging:!1,isPanning:!0})}else{var s=this.controllerState.panEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(e){if(!this.dragRotate)return!1;var n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Bn,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(e){var n=this.inertia;if(this.dragRotate&&n&&e.velocity){var i=this.getCenter(e),a=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],o=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(o,Xe(Xe({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Vf}),{isDragging:!1,isRotating:!0})}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.scrollZoom===!0?{}:this.scrollZoom,a=i.speed,o=a===void 0?.01:a,s=i.smooth,u=s===void 0?!1:s,f=e.delta,l=2/(1+Math.exp(-Math.abs(f*o)));f<0&&l!==0&&(l=1/l);var c=this.controllerState.zoom({pos:n,scale:l});return this.updateViewport(c,Xe(Xe({},this._getTransitionProps({around:n})),{},{transitionDuration:u?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Bn,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(e){if(!this.touchRotate||!this.isDragging())return!1;var n=this.getCenter(e);n[0]-=e.deltaX;var i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Bn,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia;if(this.touchRotate&&n&&e.velocityY){var i=this.getCenter(e),a=[i[0],i[1]+=e.velocityY*n/2],o=this.controllerState.rotate({pos:a});this.updateViewport(o,Xe(Xe({},this._getTransitionProps()),{},{transitionDuration:n,transitionEasing:Vf}),{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{var s=this.controllerState.rotateEnd();this.updateViewport(s,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(e){var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return xi._startPinchRotation=e.rotation,xi._lastPinchEvent=e,this.updateViewport(i,Bn,{isDragging:!0}),!0}},{key:"_onPinch",value:function(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;var n=this.controllerState;if(this.touchZoom){var i=e.scale,a=this.getCenter(e);n=n.zoom({pos:a,scale:i})}if(this.touchRotate){var o=e.rotation;n=n.rotate({deltaAngleX:xi._startPinchRotation-o})}return this.updateViewport(n,Bn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),xi._lastPinchEvent=e,!0}},{key:"_onPinchEnd",value:function(e){if(!this.isDragging())return!1;var n=this.inertia,i=xi._lastPinchEvent;if(this.touchZoom&&n&&i&&e.scale!==i.scale){var a=this.getCenter(e),o=this.controllerState.rotateEnd(),s=Math.log2(e.scale),u=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),f=Math.pow(2,s+u*n/2);o=o.zoom({pos:a,scale:f}).zoomEnd(),this.updateViewport(o,Xe(Xe({},this._getTransitionProps({around:a})),{},{transitionDuration:n,transitionEasing:Vf}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{var l=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(l,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return xi._startPinchRotation=null,xi._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(e){if(!this.doubleClickZoom)return!1;var n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;var i=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(a,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(e){if(!this.keyboard)return!1;var n=this.isFunctionKeyPressed(e),i=this.keyboard===!0?{}:this.keyboard,a=i.zoomSpeed,o=i.moveSpeed,s=i.rotateSpeedX,u=i.rotateSpeedY,f=this.controllerState,l,c={};switch(e.srcEvent.code){case"Minus":l=n?f.zoomOut(a).zoomOut(a):f.zoomOut(a),c.isZooming=!0;break;case"Equal":l=n?f.zoomIn(a).zoomIn(a):f.zoomIn(a),c.isZooming=!0;break;case"ArrowLeft":n?(l=f.rotateLeft(s),c.isRotating=!0):(l=f.moveLeft(o),c.isPanning=!0);break;case"ArrowRight":n?(l=f.rotateRight(s),c.isRotating=!0):(l=f.moveRight(o),c.isPanning=!0);break;case"ArrowUp":n?(l=f.rotateUp(u),c.isRotating=!0):(l=f.moveUp(o),c.isPanning=!0);break;case"ArrowDown":n?(l=f.rotateDown(u),c.isRotating=!0):(l=f.moveDown(o),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}},{key:"_getTransitionProps",value:function(e){var n=this.transition;return!n||!n.transitionInterpolator?Bn:e?Xe(Xe({},n),{},{transitionInterpolator:new Ct(Xe(Xe(Xe({},e),n.transitionInterpolator.opts),{},{makeViewport:this.controllerState.makeViewport}))}):n}}]),t}();var jP=h(B()),FP=h(U()),Hd=h(G()),_a=function(){function t(r,e){(0,jP.default)(this,t),(0,Hd.default)(this,"_viewportProps",void 0),(0,Hd.default)(this,"_state",void 0),this._viewportProps=this.applyConstraints(r),this._state=e}return(0,FP.default)(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}}]),t}();function NP(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function pn(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?NP(Object(e),!0).forEach(function(n){(0,ba.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):NP(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function UP(t){var r=VB();return function(){var n=(0,zf.default)(t),i;if(r){var a=(0,zf.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,zP.default)(this,i)}}function VB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var BP=5,zB=1.2,qd=function(t){(0,Xd.default)(e,t);var r=UP(e);function e(n){var i;(0,Wd.default)(this,e);var a=n.width,o=n.height,s=n.latitude,u=n.longitude,f=n.zoom,l=n.bearing,c=l===void 0?0:l,p=n.pitch,d=p===void 0?0:p,v=n.altitude,m=v===void 0?1.5:v,g=n.position,_=g===void 0?[0,0,0]:g,x=n.maxZoom,w=x===void 0?20:x,E=n.minZoom,T=E===void 0?0:E,P=n.maxPitch,A=P===void 0?60:P,D=n.minPitch,L=D===void 0?0:D,C=n.startPanLngLat,F=n.startZoomLngLat,j=n.startRotatePos,z=n.startBearing,N=n.startPitch,M=n.startZoom,k=n.normalize,R=k===void 0?!0:k;return ke(Number.isFinite(u)),ke(Number.isFinite(s)),ke(Number.isFinite(f)),i=r.call(this,{width:a,height:o,latitude:s,longitude:u,zoom:f,bearing:c,pitch:d,altitude:m,maxZoom:w,minZoom:T,maxPitch:A,minPitch:L,normalize:R,position:_},{startPanLngLat:C,startZoomLngLat:F,startRotatePos:j,startBearing:z,startPitch:N,startZoom:M}),(0,ba.default)((0,Zo.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,Yd.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanLngLat:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPos,s=this.getState().startPanLngLat||this._unproject(o);if(!s)return this;var u=this.makeViewport(this.getViewportProps()),f=u.panByPosition(s,a);return this._getUpdatedState(f)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,l=this.getState(),c=l.startRotatePos,p=l.startBearing,d=l.startPitch;if(!c||p===void 0||d===void 0)return this;var v;return a?v=this._getNewRotation(a,c,d,p):v={bearing:p+s,pitch:d+f},this._getUpdatedState(v)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomLngLat:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),f=u.startZoom,l=u.startZoomLngLat;if(l||(f=this.getViewportProps().zoom,l=this._unproject(o)||this._unproject(a)),!l)return this;var c=this.getViewportProps(),p=c.maxZoom,d=c.minZoom,v=f+Math.log2(s);v=Te(v,d,p);var m=this.makeViewport(pn(pn({},this.getViewportProps()),{},{zoom:v}));return this._getUpdatedState(pn({zoom:v},m.panByPosition(l,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(i)}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/i)}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=pn({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=Te(s,o,a);var u=i.maxPitch,f=i.minPitch,l=i.pitch;i.pitch=Te(l,f,u);var c=i.normalize,p=c===void 0?!0:c;return p&&Object.assign(i,wf(i)),i}},{key:"_zoomFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.zoom({pos:[o/2,s/2],scale:i})}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height;return this.pan({startPos:[o/2,s/2],pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(pn(pn(pn({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_getNewRotation",value:function(i,a,o,s){var u=i[0]-a[0],f=i[1]-a[1],l=i[1],c=a[1],p=this.getViewportProps(),d=p.width,v=p.height,m=u/d,g=0;f>0?Math.abs(v-c)>BP&&(g=f/(c-v)*zB):f<0&&c>BP&&(g=1-l/c),g=Te(g,-1,1);var _=this.getViewportProps(),x=_.minPitch,w=_.maxPitch,E=s+180*m,T=o;return g>0?T=o+g*(w-o):g<0&&(T=o-g*(x-o)),{pitch:T,bearing:E}}}]),e}(_a),Uf=function(t){(0,Xd.default)(e,t);var r=UP(e);function e(){var n;(0,Wd.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ba.default)((0,Zo.default)(n),"ControllerState",qd),(0,ba.default)((0,Zo.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Ct({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),(0,ba.default)((0,Zo.default)(n),"dragMode","pan"),n}return(0,Yd.default)(e,[{key:"setProps",value:function(i){i.position=i.position||[0,0,0];var a=this.props;(0,VP.default)((0,zf.default)(e.prototype),"setProps",this).call(this,i);var o=!a||a.height!==i.height;o&&this.updateViewport(new this.ControllerState(pn(pn({makeViewport:this.makeViewport},i),this.state)))}}]),e}(rr);function UB(t){var r=GB();return function(){var n=(0,Zd.default)(t),i;if(r){var a=(0,Zd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,WP.default)(this,i)}}function GB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ko=function(t){(0,HP.default)(e,t);var r=UB(e);function e(){return(0,GP.default)(this,e),r.apply(this,arguments)}return(0,$P.default)(e,[{key:"ViewportType",get:function(){return _i}},{key:"ControllerType",get:function(){return Uf}}]),e}(tr);(0,YP.default)(Ko,"displayName","MapView");var qP=h(B()),ZP=h(U()),Qo=h(G());function Kd(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=$B(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function $B(t,r){if(t){if(typeof t=="string")return XP(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return XP(t,r)}}function XP(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var HB=new Uo;function WB(t,r){var e,n,i=(e=t.order)!==null&&e!==void 0?e:1/0,a=(n=r.order)!==null&&n!==void 0?n:1/0;return i-a}var KP=function(){function t(){(0,qP.default)(this,t),(0,Qo.default)(this,"effects",void 0),(0,Qo.default)(this,"_resolvedEffects",[]),(0,Qo.default)(this,"_defaultEffects",[]),(0,Qo.default)(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}return(0,ZP.default)(t,[{key:"addDefaultEffect",value:function(e){var n=this._defaultEffects;if(!n.find(function(a){return a.id===e.id})){var i=n.findIndex(function(a){return WB(a,e)>0});i<0?n.push(e):n.splice(i,0,e),this._setEffects(this.effects)}}},{key:"setProps",value:function(e){"effects"in e&&(st(e.effects,this.effects,1)||this._setEffects(e.effects))}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"getEffects",value:function(){return this._resolvedEffects}},{key:"_setEffects",value:function(e){var n={},i=Kd(this.effects),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n[o.id]=o}}catch(d){i.e(d)}finally{i.f()}var s=[],u=Kd(e),f;try{for(u.s();!(f=u.n()).done;){var l=f.value,c=n[l.id];c&&c!==l?c.setProps?(c.setProps(l.props),s.push(c)):(c.cleanup(),s.push(l)):s.push(l),delete n[l.id]}}catch(d){u.e(d)}finally{u.f()}for(var p in n)n[p].cleanup();this.effects=s,this._resolvedEffects=s.concat(this._defaultEffects),e.some(function(d){return d instanceof Uo})||this._resolvedEffects.push(HB),this._needsRedraw="effects changed"}},{key:"finalize",value:function(){var e=Kd(this._resolvedEffects),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.cleanup()}}catch(a){e.e(a)}finally{e.f()}this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}]),t}();var aS=h(B()),oS=h(U()),br=h(G());var QP=h(B()),JP=h(U()),eS=h(ie()),tS=h(ae()),Qd=h(ne());function YB(t){var r=XB();return function(){var n=(0,Qd.default)(t),i;if(r){var a=(0,Qd.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tS.default)(this,i)}}function XB(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var rS=function(t){(0,eS.default)(e,t);var r=YB(e);function e(){return(0,QP.default)(this,e),r.apply(this,arguments)}return(0,JP.default)(e,[{key:"shouldDrawLayer",value:function(i){var a=i.props.operation;return a.includes("draw")||a.includes("terrain")}}]),e}(In);function Gf(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=qB(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function qB(t,r){if(t){if(typeof t=="string")return nS(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return nS(t,r)}}function nS(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function iS(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function wa(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?iS(Object(e),!0).forEach(function(n){(0,br.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):iS(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var ZB="deckRenderer.renderLayers",$f=function(){function t(r){(0,aS.default)(this,t),(0,br.default)(this,"gl",void 0),(0,br.default)(this,"layerFilter",void 0),(0,br.default)(this,"drawPickingColors",void 0),(0,br.default)(this,"drawLayersPass",void 0),(0,br.default)(this,"pickLayersPass",void 0),(0,br.default)(this,"renderCount",void 0),(0,br.default)(this,"_needsRedraw",void 0),(0,br.default)(this,"renderBuffers",void 0),(0,br.default)(this,"lastPostProcessEffect",void 0),this.gl=r,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new rS(r),this.pickLayersPass=new pa(r),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return(0,oS.default)(t,[{key:"setProps",value:function(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(e){var n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i=wa(wa({layerFilter:this.layerFilter,isPicking:this.drawPickingColors},e),{},{target:e.target||xe.getDefaultFramebuffer(this.gl)});i.effects&&this._preRender(i.effects,i);var a=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,o=n.render(wa(wa({},i),{},{target:a}));i.effects&&this._postRender(i.effects,i),this.renderCount++,Ke(ZB,this,o,e)}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}},{key:"finalize",value:function(){var e=this.renderBuffers,n=Gf(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.delete()}}catch(o){n.e(o)}finally{n.f()}e.length=0}},{key:"_preRender",value:function(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};var i=Gf(e),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.preRenderStats[o.id]=o.preRender(this.gl,n),o.postRender&&(this.lastPostProcessEffect=o.id)}}catch(s){i.e(s)}finally{i.f()}this.lastPostProcessEffect&&this._resizeRenderBuffers()}},{key:"_resizeRenderBuffers",value:function(){var e=this.renderBuffers;e.length===0&&e.push(new xe(this.gl),new xe(this.gl));var n=Gf(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.resize()}}catch(o){n.e(o)}finally{n.f()}}},{key:"_postRender",value:function(e,n){var i=this.renderBuffers,a=wa(wa({},n),{},{inputBuffer:i[0],swapBuffer:i[1],target:null}),o=Gf(e),s;try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u.postRender){if(u.id===this.lastPostProcessEffect){a.target=n.target,u.postRender(this.gl,a);break}var f=u.postRender(this.gl,a);a.inputBuffer=f,a.swapBuffer=f===i[0]?i[1]:i[0]}}}catch(l){o.e(l)}finally{o.f()}}}]),t}();var mS=h(B()),gS=h(U()),Gr=h(G());var uS=h(G());function sS(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sS(Object(e),!0).forEach(function(n){(0,uS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sS(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var KB={pickedColor:null,pickedObjectIndex:-1};function fS(t){for(var r=t.pickedColors,e=t.decodePickingColor,n=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect,s=o.x,u=o.y,f=o.width,l=o.height,c=a*a,p=-1,d=0,v=0;v<l;v++){var m=v+u-i,g=m*m;if(g>c)d+=4*f;else for(var _=0;_<f;_++){var x=r[d+3]-1;if(x>=0){var w=_+s-n,E=w*w+g;E<=c&&(c=E,p=d)}d+=4}}if(p>=0){var T=r.slice(p,p+4),P=e(T);if(P){var A=Math.floor(p/4/f),D=p/4-A*f;return Hf(Hf({},P),{},{pickedColor:T,pickedX:s+D,pickedY:u+A})}le.error("Picked non-existent layer. Is picking buffer corrupt?")()}return KB}function lS(t){var r=t.pickedColors,e=t.decodePickingColor,n=new Map;if(r)for(var i=0;i<r.length;i+=4){var a=r[i+3]-1;if(a>=0){var o=r.slice(i,i+4),s=o.join(",");if(!n.has(s)){var u=e(o);u?n.set(s,Hf(Hf({},u),{},{color:o})):le.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}var hS=h(G());function cS(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function QB(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cS(Object(e),!0).forEach(function(n){(0,hS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cS(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Jd(t){var r=t.pickInfo,e=t.viewports,n=t.pixelRatio,i=t.x,a=t.y,o=t.z,s=e[0];e.length>1&&(s=JB(r?.pickedViewports||e,{x:i,y:a}));var u;if(s){var f=[i-s.x,a-s.y];o!==void 0&&(f[2]=o),u=s.unproject(f)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:u,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:n}}function pS(t){var r=t.pickInfo,e=t.lastPickedInfo,n=t.mode,i=t.layers,a=r.pickedColor,o=r.pickedLayer,s=r.pickedObjectIndex,u=o?[o]:[];if(n==="hover"){var f=e.index,l=e.layerId,c=o?o.props.id:null;if(c!==l||s!==f){if(c!==l){var p=i.find(function(m){return m.props.id===l});p&&u.unshift(p)}e.layerId=c,e.index=s,e.info=null}}var d=Jd(t),v=new Map;return v.set(null,d),u.forEach(function(m){var g=QB({},d);m===o&&(g.color=a,g.index=s,g.picked=!0),g=ev({layer:m,info:g,mode:n});var _=g.layer;m===o&&n==="hover"&&(e.info=g),v.set(_.id,g),n==="hover"&&_.updateAutoHighlight(g)}),v}function ev(t){for(var r=t.layer,e=t.info,n=t.mode;r&&e;){var i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:n,sourceLayer:i}),r=r.parent}return e}function JB(t,r){for(var e=t.length-1;e>=0;e--){var n=t[e];if(n.containsPixel(r))return n}return t[0]}function tv(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=e4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function e4(t,r){if(t){if(typeof t=="string")return dS(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return dS(t,r)}}function dS(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function vS(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Wf(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vS(Object(e),!0).forEach(function(n){(0,Gr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vS(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var yS=function(){function t(r){(0,mS.default)(this,t),(0,Gr.default)(this,"gl",void 0),(0,Gr.default)(this,"pickingFBO",void 0),(0,Gr.default)(this,"depthFBO",void 0),(0,Gr.default)(this,"pickLayersPass",void 0),(0,Gr.default)(this,"layerFilter",void 0),(0,Gr.default)(this,"lastPickedInfo",void 0),(0,Gr.default)(this,"_pickable",!0),this.gl=r,this.pickLayersPass=new pa(r),this.lastPickedInfo={index:-1,layerId:null,info:null}}return(0,gS.default)(t,[{key:"setProps",value:function(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(e){return this._pickClosestObject(e)}},{key:"pickObjects",value:function(e){return this._pickVisibleObjects(e)}},{key:"getLastPickedObject",value:function(e){var n=e.x,i=e.y,a=e.layers,o=e.viewports,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info,u=s&&s.layer&&s.layer.id,f=s&&s.viewport&&s.viewport.id,l=u?a.find(function(v){return v.id===u}):null,c=f&&o.find(function(v){return v.id===f})||o[0],p=c&&c.unproject([n-c.x,i-c.y]),d={x:n,y:i,viewport:c,coordinate:p,layer:l};return Wf(Wf({},s),d)}},{key:"_resizeBuffer",value:function(){var e,n,i=this.gl;if(!this.pickingFBO&&(this.pickingFBO=new xe(i),xe.isSupported(i,{colorBufferFloat:!0}))){var a=new xe(i);a.attach((0,Gr.default)({},36064,new Ge(i,{format:te(i)?34836:6408,type:5126}))),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}},{key:"_getPickable",value:function(e){var n=this;if(this._pickable===!1)return null;var i=e.filter(function(a){return n.pickLayersPass.shouldDrawLayer(a)&&!a.isComposite});return i.length?i:null}},{key:"_pickClosestObject",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.radius,f=u===void 0?0:u,l=e.depth,c=l===void 0?1:l,p=e.mode,d=p===void 0?"query":p,v=e.unproject3D,m=e.onViewportActive,g=e.effects,_=this._getPickable(n),x=Lt(this.gl);if(!_)return{result:[],emptyInfo:Jd({viewports:a,x:o,y:s,pixelRatio:x})};this._resizeBuffer();for(var w=Ni(this.gl,[o,s],!0),E=[w.x+Math.floor(w.width/2),w.y+Math.floor(w.height/2)],T=Math.round(f*x),P=this.pickingFBO,A=P.width,D=P.height,L=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:T,deviceWidth:A,deviceHeight:D}),C={x:o-f,y:s-f,width:f*2+1,height:f*2+1},F,j=[],z=new Set,N=0;N<c;N++){var M=void 0;if(L){var k=this._drawAndSample({layers:_,views:i,viewports:a,onViewportActive:m,deviceRect:L,cullRect:C,effects:g,pass:"picking:".concat(d)});M=fS(Wf(Wf({},k),{},{deviceX:E[0],deviceY:E[1],deviceRadius:T,deviceRect:L}))}else M={pickedColor:null,pickedObjectIndex:-1};var R=void 0;if(M.pickedLayer&&v&&this.depthFBO){var Y=this._drawAndSample({layers:[M.pickedLayer],views:i,viewports:a,onViewportActive:m,deviceRect:{x:M.pickedX,y:M.pickedY,width:1,height:1},cullRect:C,effects:g,pass:"picking:".concat(d,":z")},!0),V=Y.pickedColors;V[3]&&(R=V[0])}M.pickedLayer&&N+1<c&&(z.add(M.pickedLayer),M.pickedLayer.disablePickingIndex(M.pickedObjectIndex)),F=pS({pickInfo:M,lastPickedInfo:this.lastPickedInfo,mode:d,layers:_,viewports:a,x:o,y:s,z:R,pixelRatio:x});var Q=tv(F.values()),J;try{for(Q.s();!(J=Q.n()).done;){var re=J.value;re.layer&&j.push(re)}}catch(ee){Q.e(ee)}finally{Q.f()}if(!M.pickedColor)break}var oe=tv(z),ue;try{for(oe.s();!(ue=oe.n()).done;){var Oe=ue.value;Oe.restorePickingColors()}}catch(ee){oe.e(ee)}finally{oe.f()}return{result:j,emptyInfo:F.get(null)}}},{key:"_pickVisibleObjects",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.x,s=e.y,u=e.width,f=u===void 0?1:u,l=e.height,c=l===void 0?1:l,p=e.mode,d=p===void 0?"query":p,v=e.maxObjects,m=v===void 0?null:v,g=e.onViewportActive,_=e.effects,x=this._getPickable(n);if(!x)return[];this._resizeBuffer();for(var w=Lt(this.gl),E=Ni(this.gl,[o,s],!0),T=E.x,P=E.y+E.height,A=Ni(this.gl,[o+f,s+c],!0),D=A.x+A.width,L=A.y,C={x:T,y:L,width:D-T,height:P-L},F=this._drawAndSample({layers:x,views:i,viewports:a,onViewportActive:g,deviceRect:C,cullRect:{x:o,y:s,width:f,height:c},effects:_,pass:"picking:".concat(d)}),j=lS(F),z=new Map,N=Number.isFinite(m),M=0;M<j.length&&!(N&&m&&z.size>=m);M++){var k=j[M],R={color:k.pickedColor,layer:null,index:k.pickedObjectIndex,picked:!0,x:o,y:s,pixelRatio:w};R=ev({layer:k.pickedLayer,info:R,mode:d}),z.has(R.object)||z.set(R.object,R)}return Array.from(z.values())}},{key:"_drawAndSample",value:function(e){var n=e.layers,i=e.views,a=e.viewports,o=e.onViewportActive,s=e.deviceRect,u=e.cullRect,f=e.effects,l=e.pass,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=c?this.depthFBO:this.pickingFBO,d={layers:n,layerFilter:this.layerFilter,views:i,viewports:a,onViewportActive:o,pickingFBO:p,deviceRect:s,cullRect:u,effects:f,pass:l,pickZ:c,preRenderStats:{}},v=tv(f),m;try{for(v.s();!(m=v.n()).done;){var g=m.value;g.useInPicking&&(d.preRenderStats[g.id]=g.preRender(this.gl,d))}}catch(D){v.e(D)}finally{v.f()}var _=this.pickLayersPass.render(d),x=_.decodePickingColor,w=s.x,E=s.y,T=s.width,P=s.height,A=new(c?Float32Array:Uint8Array)(T*P*4);return en(p,{sourceX:w,sourceY:E,sourceWidth:T,sourceHeight:P,target:A}),{pickedColors:A,decodePickingColor:x}}},{key:"_getPickingRect",value:function(e){var n=e.deviceX,i=e.deviceY,a=e.deviceRadius,o=e.deviceWidth,s=e.deviceHeight,u=Math.max(0,n-a),f=Math.max(0,i-a),l=Math.min(o,n+a+1)-u,c=Math.min(s,i+a+1)-f;return l<=0||c<=0?null:{x:u,y:f,width:l,height:c}}}]),t}();var _S=h(B()),bS=h(U()),rv=h(G()),t4={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},wS=function(){function t(r){(0,_S.default)(this,t),(0,rv.default)(this,"el",null),(0,rv.default)(this,"isVisible",!1);var e=r.parentElement;e&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,t4),e.appendChild(this.el))}return(0,bS.default)(t,[{key:"setTooltip",value:function(e,n,i){var a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className),Object.assign(a.style,e.style);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}},{key:"remove",value:function(){this.el&&(this.el.remove(),this.el=null)}}]),t}();var EO=h(Ue()),PO=h(G()),SO=h(B()),OO=h(U());var Jo=h(xS());var TS=1,ES=2,nv=4,r4={mousedown:TS,mousemove:ES,mouseup:nv};function n4(t,r){for(var e=0;e<t.length;e++)if(r(t[e]))return!0;return!1}function PS(t){var r=t.prototype.handler;t.prototype.handler=function(n){var i=this.store;n.button>0&&n.type==="pointerdown"&&(n4(i,function(a){return a.pointerId===n.pointerId})||i.push(n)),r.call(this,n)}}function SS(t){t.prototype.handler=function(e){var n=r4[e.type];n&TS&&e.button>=0&&(this.pressed=!0),n&ES&&e.which===0&&(n=nv),this.pressed&&(n&nv&&(this.pressed=!1),this.callback(this.manager,n,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}}PS(Jo.default.PointerEventInput);SS(Jo.default.MouseInput);var OS=Jo.default.Manager,wr=Jo.default;var BS=h(B()),VS=h(U()),zS=h(ie()),US=h(ae()),ov=h(ne());var MS=h(G()),kS=h(B());function AS(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function i4(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?AS(Object(e),!0).forEach(function(n){(0,MS.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):AS(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Vn=function t(r,e,n){(0,kS.default)(this,t),this.element=r,this.callback=e,this.options=i4({enable:!0},n)};var RS=wr?[[wr.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[wr.Rotate,{enable:!1}],[wr.Pinch,{enable:!1}],[wr.Swipe,{enable:!1}],[wr.Pan,{threshold:0,enable:!1}],[wr.Press,{enable:!1}],[wr.Tap,{event:"doubletap",taps:2,enable:!1}],[wr.Tap,{event:"anytap",enable:!1}],[wr.Tap,{enable:!1}]]:null,iv={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},CS={doubletap:["tap"]},IS={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},xa={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},LS={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},av={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"};var jS=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ti=typeof window<"u"?window:global;var Xf=!1;try{DS={get passive(){return Xf=!0,!0}},Ti.addEventListener("test",null,DS),Ti.removeEventListener("test",null)}catch{Xf=!1}var DS;function a4(t){var r=o4();return function(){var n=(0,ov.default)(t),i;if(r){var a=(0,ov.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,US.default)(this,i)}}function o4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var s4=jS.indexOf("firefox")!==-1,u4=xa.WHEEL_EVENTS,FS="wheel",NS=4.000244140625,f4=40,l4=.25,GS=function(t){(0,zS.default)(e,t);var r=a4(e);function e(n,i,a){var o;return(0,BS.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){if(o.options.enable){var u=s.deltaY;Ti.WheelEvent&&(s4&&s.deltaMode===Ti.WheelEvent.DOM_DELTA_PIXEL&&(u/=Ti.devicePixelRatio),s.deltaMode===Ti.WheelEvent.DOM_DELTA_LINE&&(u*=f4)),u!==0&&u%NS===0&&(u=Math.floor(u/NS)),s.shiftKey&&u&&(u=u*l4),o.callback({type:FS,center:{x:s.clientX,y:s.clientY},delta:-u,srcEvent:s,pointerType:"mouse",target:s.target})}},o.events=(o.options.events||[]).concat(u4),o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent,Xf?{passive:!1}:!1)}),o}return(0,VS.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===FS&&(this.options.enable=a)}}]),e}(Vn);var qS=h(B()),ZS=h(U()),KS=h(ie()),QS=h(ae()),sv=h(ne());function c4(t){var r=h4();return function(){var n=(0,sv.default)(t),i;if(r){var a=(0,sv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,QS.default)(this,i)}}function h4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var p4=xa.MOUSE_EVENTS,$S="pointermove",HS="pointerover",WS="pointerout",YS="pointerenter",XS="pointerleave",JS=function(t){(0,KS.default)(e,t);var r=c4(e);function e(n,i,a){var o;(0,qS.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(u){o.handleOverEvent(u),o.handleOutEvent(u),o.handleEnterEvent(u),o.handleLeaveEvent(u),o.handleMoveEvent(u)},o.pressed=!1;var s=o.options.enable;return o.enableMoveEvent=s,o.enableLeaveEvent=s,o.enableEnterEvent=s,o.enableOutEvent=s,o.enableOverEvent=s,o.events=(o.options.events||[]).concat(p4),o.events.forEach(function(u){return n.addEventListener(u,o.handleEvent)}),o}return(0,ZS.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===$S&&(this.enableMoveEvent=a),i===HS&&(this.enableOverEvent=a),i===WS&&(this.enableOutEvent=a),i===YS&&(this.enableEnterEvent=a),i===XS&&(this.enableLeaveEvent=a)}},{key:"handleOverEvent",value:function(i){this.enableOverEvent&&i.type==="mouseover"&&this._emit(HS,i)}},{key:"handleOutEvent",value:function(i){this.enableOutEvent&&i.type==="mouseout"&&this._emit(WS,i)}},{key:"handleEnterEvent",value:function(i){this.enableEnterEvent&&i.type==="mouseenter"&&this._emit(YS,i)}},{key:"handleLeaveEvent",value:function(i){this.enableLeaveEvent&&i.type==="mouseleave"&&this._emit(XS,i)}},{key:"handleMoveEvent",value:function(i){if(this.enableMoveEvent)switch(i.type){case"mousedown":i.button>=0&&(this.pressed=!0);break;case"mousemove":i.which===0&&(this.pressed=!1),this.pressed||this._emit($S,i);break;case"mouseup":this.pressed=!1;break;default:}}},{key:"_emit",value:function(i,a){this.callback({type:i,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})}}]),e}(Vn);var rO=h(B()),nO=h(U()),iO=h(ie()),aO=h(ae()),uv=h(ne());function d4(t){var r=v4();return function(){var n=(0,uv.default)(t),i;if(r){var a=(0,uv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,aO.default)(this,i)}}function v4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m4=xa.KEY_EVENTS,eO="keydown",tO="keyup",oO=function(t){(0,iO.default)(e,t);var r=d4(e);function e(n,i,a){var o;return(0,rO.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){var u=s.target||s.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(o.enableDownEvent&&s.type==="keydown"&&o.callback({type:eO,srcEvent:s,key:s.key,target:s.target}),o.enableUpEvent&&s.type==="keyup"&&o.callback({type:tO,srcEvent:s,key:s.key,target:s.target}))},o.enableDownEvent=o.options.enable,o.enableUpEvent=o.options.enable,o.events=(o.options.events||[]).concat(m4),n.tabIndex=o.options.tabIndex||0,n.style.outline="none",o.events.forEach(function(s){return n.addEventListener(s,o.handleEvent)}),o}return(0,nO.default)(e,[{key:"destroy",value:function(){var i=this;this.events.forEach(function(a){return i.element.removeEventListener(a,i.handleEvent)})}},{key:"enableEventType",value:function(i,a){i===eO&&(this.enableDownEvent=a),i===tO&&(this.enableUpEvent=a)}}]),e}(Vn);var uO=h(B()),fO=h(U()),lO=h(ie()),cO=h(ae()),fv=h(ne());function g4(t){var r=y4();return function(){var n=(0,fv.default)(t),i;if(r){var a=(0,fv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,cO.default)(this,i)}}function y4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var sO="contextmenu",hO=function(t){(0,lO.default)(e,t);var r=g4(e);function e(n,i,a){var o;return(0,uO.default)(this,e),o=r.call(this,n,i,a),o.handleEvent=function(s){o.options.enable&&o.callback({type:sO,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},n.addEventListener("contextmenu",o.handleEvent),o}return(0,fO.default)(e,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(i,a){i===sO&&(this.options.enable=a)}}]),e}(Vn);var mO=h(G()),gO=h(B()),yO=h(U());var lv=1,qf=2,cv=4,_4={pointerdown:lv,pointermove:qf,pointerup:cv,mousedown:lv,mousemove:qf,mouseup:cv},b4=1,w4=2,x4=3,T4=0,E4=1,P4=2,S4=1,O4=2,A4=4;function pO(t){var r=_4[t.srcEvent.type];if(!r)return null;var e=t.srcEvent,n=e.buttons,i=e.button,a=e.which,o=!1,s=!1,u=!1;return r===cv||r===qf&&!Number.isFinite(n)?(o=a===b4,s=a===w4,u=a===x4):r===qf?(o=Boolean(n&S4),s=Boolean(n&A4),u=Boolean(n&O4)):r===lv&&(o=i===T4,s=i===E4,u=i===P4),{leftButton:o,middleButton:s,rightButton:u}}function dO(t,r){var e=t.center;if(!e)return null;var n=r.getBoundingClientRect(),i=n.width/r.offsetWidth||1,a=n.height/r.offsetHeight||1,o={x:(e.x-n.left-r.clientLeft)/i,y:(e.y-n.top-r.clientTop)/a};return{center:e,offsetCenter:o}}function vO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function $r(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?vO(Object(e),!0).forEach(function(n){(0,mO.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):vO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var hv={srcElement:"root",priority:0},_O=function(){function t(r){var e=this;(0,gO.default)(this,t),this.handleEvent=function(n){if(!e.isEmpty()){for(var i=e._normalizeEvent(n),a=n.srcEvent.target;a&&a!==i.rootElement;){if(e._emit(i,a),i.handled)return;a=a.parentNode}e._emit(i,"root")}},this.eventManager=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}return(0,yO.default)(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(e,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,s=this.handlers,u=this.handlersByElement,f=hv;typeof i=="string"||i&&i.addEventListener?f=$r($r({},hv),{},{srcElement:i}):i&&(f=$r($r({},hv),i));var l=u.get(f.srcElement);l||(l=[],u.set(f.srcElement,l));var c={type:e,handler:n,srcElement:f.srcElement,priority:f.priority};a&&(c.once=!0),o&&(c.passive=!0),s.push(c),this._active=this._active||!c.passive;for(var p=l.length-1;p>=0&&!(l[p].priority>=c.priority);)p--;l.splice(p+1,0,c)}},{key:"remove",value:function(e,n){for(var i=this.handlers,a=this.handlersByElement,o=i.length-1;o>=0;o--){var s=i[o];if(s.type===e&&s.handler===n){i.splice(o,1);var u=a.get(s.srcElement);u.splice(u.indexOf(s),1),u.length===0&&a.delete(s.srcElement)}}this._active=i.some(function(f){return!f.passive})}},{key:"_emit",value:function(e,n){var i=this.handlersByElement.get(n);if(i){for(var a=!1,o=function(){e.handled=!0},s=function(){e.handled=!0,a=!0},u=[],f=0;f<i.length;f++){var l=i[f],c=l.type,p=l.handler,d=l.once;if(p($r($r({},e),{},{type:c,stopPropagation:o,stopImmediatePropagation:s})),d&&u.push(i[f]),a)break}for(var v=0;v<u.length;v++){var m=u[v],g=m.type,_=m.handler;this.remove(g,_)}}}},{key:"_normalizeEvent",value:function(e){var n=this.eventManager.getElement();return $r($r($r($r({},e),pO(e)),dO(e,n)),{},{preventDefault:function(){e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n})}}]),t}();function bO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=M4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function M4(t,r){if(t){if(typeof t=="string")return wO(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return wO(t,r)}}function wO(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function xO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function TO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?xO(Object(e),!0).forEach(function(n){(0,PO.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):xO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var k4={events:null,recognizers:null,recognizerOptions:{},Manager:OS,touchAction:"none",tabIndex:0},pv=function(){function t(){var r=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0;(0,SO.default)(this,t),this._onBasicInput=function(a){var o=a.srcEvent,s=IS[o.type];s&&r.manager.emit(s,a)},this._onOtherEvent=function(a){r.manager.emit(a.type,a)},this.options=TO(TO({},k4),n),this.events=new Map,this.setElement(e);var i=this.options.events;i&&this.on(i)}return(0,OO.default)(t,[{key:"getElement",value:function(){return this.element}},{key:"setElement",value:function(e){var n=this;if(this.element&&this.destroy(),this.element=e,!!e){var i=this.options,a=i.Manager;this.manager=new a(e,{touchAction:i.touchAction,recognizers:i.recognizers||RS}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(iv).forEach(function(v){var m=n.manager.get(v);m&&iv[v].forEach(function(g){m.recognizeWith(g)})});for(var o in i.recognizerOptions){var s=this.manager.get(o);if(s){var u=i.recognizerOptions[o];delete u.enable,s.set(u)}}this.wheelInput=new GS(e,this._onOtherEvent,{enable:!1}),this.moveInput=new JS(e,this._onOtherEvent,{enable:!1}),this.keyInput=new oO(e,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new hO(e,this._onOtherEvent,{enable:!1});var f=bO(this.events),l;try{for(f.s();!(l=f.n()).done;){var c=(0,EO.default)(l.value,2),p=c[0],d=c[1];d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(p,d.handleEvent))}}catch(v){f.e(v)}finally{f.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(e,n,i){this._addEventHandler(e,n,i,!1)}},{key:"once",value:function(e,n,i){this._addEventHandler(e,n,i,!0)}},{key:"watch",value:function(e,n,i){this._addEventHandler(e,n,i,!1,!0)}},{key:"off",value:function(e,n){this._removeEventHandler(e,n)}},{key:"_toggleRecognizer",value:function(e,n){var i=this.manager;if(i){var a=i.get(e);if(a&&a.options.enable!==n){a.set({enable:n});var o=CS[e];o&&!this.options.recognizers&&o.forEach(function(s){var u=i.get(s);n?(u.requireFailure(e),a.dropRequireFailure(s)):u.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}}},{key:"_addEventHandler",value:function(e,n,i,a,o){if(typeof e!="string"){i=n;for(var s in e)this._addEventHandler(s,e[s],i,a,o);return}var u=this.manager,f=this.events,l=av[e]||e,c=f.get(l);c||(c=new _O(this),f.set(l,c),c.recognizerName=LS[l]||l,u&&u.on(l,c.handleEvent)),c.add(e,n,i,a,o),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}},{key:"_removeEventHandler",value:function(e,n){if(typeof e!="string"){for(var i in e)this._removeEventHandler(i,e[i]);return}var a=this.events,o=av[e]||e,s=a.get(o);if(s&&(s.remove(e,n),s.isEmpty())){var u=s.recognizerName,f=!1,l=bO(a.values()),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;if(p.recognizerName===u&&!p.isEmpty()){f=!0;break}}}catch(d){l.e(d)}finally{l.f()}f||this._toggleRecognizer(u,!1)}}}]),t}();function AO(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=R4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function R4(t,r){if(t){if(typeof t=="string")return MO(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return MO(t,r)}}function MO(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function kO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function dn(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?kO(Object(e),!0).forEach(function(n){(0,Me.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):kO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Ei(){}var C4=function(r){var e=r.isDragging;return e?"grabbing":"grab"},IO={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Ei,onResize:Ei,onViewStateChange:Ei,onInteractionStateChange:Ei,onBeforeRender:Ei,onAfterRender:Ei,onLoad:Ei,onError:function(r){return le.error(r.message)()},onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:C4,getTooltip:null,debug:!1,drawPickingColors:!1},Ta=function(){function t(r){var e=this;(0,RO.default)(this,t),(0,Me.default)(this,"props",void 0),(0,Me.default)(this,"width",0),(0,Me.default)(this,"height",0),(0,Me.default)(this,"userData",{}),(0,Me.default)(this,"canvas",null),(0,Me.default)(this,"viewManager",null),(0,Me.default)(this,"layerManager",null),(0,Me.default)(this,"effectManager",null),(0,Me.default)(this,"deckRenderer",null),(0,Me.default)(this,"deckPicker",null),(0,Me.default)(this,"eventManager",null),(0,Me.default)(this,"tooltip",null),(0,Me.default)(this,"metrics",void 0),(0,Me.default)(this,"animationLoop",void 0),(0,Me.default)(this,"stats",void 0),(0,Me.default)(this,"viewState",void 0),(0,Me.default)(this,"cursorState",void 0),(0,Me.default)(this,"_needsRedraw",void 0),(0,Me.default)(this,"_pickRequest",void 0),(0,Me.default)(this,"_lastPointerDownInfo",null),(0,Me.default)(this,"_metricsCounter",void 0),(0,Me.default)(this,"_onPointerMove",function(n){var i=e._pickRequest;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;var a=n.offsetCenter;if(!a)return;i.x=a.x,i.y=a.y,i.radius=e.props.pickingRadius}e.layerManager&&(e.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),(0,Me.default)(this,"_onEvent",function(n){var i=fd[n.type],a=n.offsetCenter;if(!(!i||!a||!e.layerManager)){var o=e.layerManager.getLayers(),s=e.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:o,viewports:e.getViewports(a)},e._lastPointerDownInfo),u=s.layer,f=u&&(u[i.handler]||u.props[i.handler]),l=e.props[i.handler],c=!1;f&&(c=f.call(u,s,n)),!c&&l&&l(s,n)}}),(0,Me.default)(this,"_onPointerDown",function(n){var i=n.offsetCenter,a=e._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:e.props.pickingRadius});e._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props=dn(dn({},IO),r),r=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},r.viewState&&r.initialViewState&&le.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Ii()==="IE"&&le.warn("IE 11 is not supported")(),this.viewState=r.initialViewState,r.gl||typeof document<"u"&&(this.canvas=this._createCanvas(r)),this.animationLoop=this._createAnimationLoop(r),this.stats=new Kn({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(r),r._typedArrayManagerProps&&mr.setOptions(r._typedArrayManagerProps),this.animationLoop.start()}return(0,CO.default)(t,[{key:"finalize",value:function(){var e,n,i,a,o,s,u;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(u=this.tooltip)===null||u===void 0||u.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var f;(f=this.canvas.parentElement)===null||f===void 0||f.removeChild(this.canvas),this.canvas=null}}},{key:"setProps",value:function(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&le.removed("onLayerHover","onHover")(),"onLayerClick"in e&&le.removed("onLayerClick","onClick")(),e.initialViewState&&!st(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);var n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";var n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);var i=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return n=n||i||a||o||s,n}},{key:"redraw",value:function(e){if(this.layerManager){var n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}}},{key:"isInitialized",get:function(){return this.viewManager!==null}},{key:"getViews",value:function(){return ke(this.viewManager),this.viewManager.views}},{key:"getViewports",value:function(e){return ke(this.viewManager),this.viewManager.getViewports(e)}},{key:"pickObject",value:function(e){var n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}},{key:"pickMultipleObjects",value:function(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}},{key:"pickObjects",value:function(e){return this._pick("pickObjects","pickObjects Time",e)}},{key:"_addResources",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(var i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}},{key:"_removeResources",value:function(e){var n=AO(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.layerManager.resourceManager.remove(a)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_addDefaultEffect",value:function(e){this.effectManager.addDefaultEffect(e)}},{key:"_pick",value:function(e,n,i){ke(this.deckPicker);var a=this.stats;a.get("Pick Count").incrementCount(),a.get(n).timeStart();var o=this.deckPicker[e](dn({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},i));return a.get(n).timeEnd(),o}},{key:"_createCanvas",value:function(e){var n=e.canvas;if(typeof n=="string"&&(n=document.getElementById(n),ke(n)),!n){n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay";var i=e.parent||document.body;i.appendChild(n)}return Object.assign(n.style,e.style),n}},{key:"_setCanvasSize",value:function(e){if(this.canvas){var n=e.width,i=e.height;if(n||n===0){var a=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=a}if(i||i===0){var o,s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=s}}}},{key:"_updateCanvasSize",value:function(){var e=this.canvas;if(e){var n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var a;this.width=n,this.height=i,(a=this.viewManager)===null||a===void 0||a.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}}},{key:"_createAnimationLoop",value:function(e){var n=this,i=e.width,a=e.height,o=e.gl,s=e.glOptions,u=e.debug,f=e.onError,l=e.onBeforeRender,c=e.onAfterRender,p=e.useDevicePixels;return new pu({width:i,height:a,useDevicePixels:p,autoResizeViewport:!1,gl:o,onCreateContext:function(v){return Bi(dn(dn(dn({},s),v),{},{canvas:n.canvas,debug:u,onContextLost:function(){return n._onContextLost()}}))},onInitialize:function(v){return n._setGLContext(v.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:f})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var e=this.props.views||[new Ko({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}},{key:"_onContextLost",value:function(){var e=this.props.onError;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}},{key:"_pickAndCallback",value:function(){var e=this._pickRequest;if(e.event){var n=this._pick("pickObject","pickObject Time",e),i=n.result,a=n.emptyInfo;this.cursorState.isHovering=i.length>0;var o=a,s=!1,u=AO(i),f;try{for(u.s();!(f=u.n()).done;){var l,c=f.value;o=c,s=((l=c.layer)===null||l===void 0?void 0:l.onHover(c,e.event))||s}}catch(d){u.e(d)}finally{u.f()}if(!s&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){var p=this.props.getTooltip(o);this.tooltip.setTooltip(p,o.x,o.y)}e.event=null}}},{key:"_updateCursor",value:function(){var e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}},{key:"_setGLContext",value:function(e){if(!this.layerManager){this.canvas||(this.canvas=e.canvas,Jr(e,{enable:!0,copyState:!0})),this.tooltip=new wS(this.canvas),at(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);var n=new kn;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new pv(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(var i in fd)this.eventManager.on(i,this._onEvent);this.viewManager=new sP({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var a=this.viewManager.getViewports()[0];this.layerManager=new jf(e,{deck:this,stats:this.stats,viewport:a,timeline:n}),this.effectManager=new KP,this.deckRenderer=new $f(e),this.deckPicker=new yS(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(e,n){var i=this.layerManager.context.gl;at(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers(dn({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects()},n)),this.props.onAfterRender({gl:i})}},{key:"_onRenderFrame",value:function(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),le.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(e){var n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=dn(dn({},this.viewState),{},(0,Me.default)({},e.viewId,n)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}},{key:"_getFrameStats",value:function(){var e=this.stats;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();var n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var e=this.metrics,n=this.stats;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();var i=Wt.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}]),t}();(0,Me.default)(Ta,"defaultProps",IO);(0,Me.default)(Ta,"VERSION",hf);var wA=h(B()),xA=h(U()),xr=h(G());var vv=h(Ue()),QO=h(B()),JO=h(U()),eA=h(we()),ul=h(kt()),tA=h(ie()),rA=h(ae()),Pa=h(ne()),mv=h(G());var VO=h(B()),zO=h(U()),nr=h(G());var jO=h(B()),FO=h(U()),Zf=h(G());function LO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function DO(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?LO(Object(e),!0).forEach(function(n){(0,Zf.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):LO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var Kf=function(){function t(r,e){(0,jO.default)(this,t),(0,Zf.default)(this,"opts",void 0),(0,Zf.default)(this,"source",void 0),this.opts=e,this.source=r}return(0,FO.default)(t,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];var i=this.source.value,a=n.size,o=i;if(i&&i.length!==a){o=new Float32Array(a);for(var s=n.elementOffset||0,u=0;u<a;++u)o[u]=i[s+u]}return o}},{key:"getAccessor",value:function(){return DO(DO({},this.source.getAccessor()),this.opts)}}]),t}();function NO(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function BO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Hr(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?BO(Object(e),!0).forEach(function(n){(0,nr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):BO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Qf(t){return t.stride||t.size*t.bytesPerElement}function UO(t,r){r.offset&&le.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var e=Qf(t),n=r.vertexOffset!==void 0?r.vertexOffset:t.vertexOffset||0,i=r.elementOffset||0,a=n*e+i*t.bytesPerElement+(t.offset||0);return Hr(Hr({},r),{},{offset:a,stride:e})}function I4(t,r){var e=UO(t,r);return{high:e,low:Hr(Hr({},e),{},{offset:e.offset+t.size*4})}}var GO=function(){function t(r,e,n){(0,VO.default)(this,t),(0,nr.default)(this,"gl",void 0),(0,nr.default)(this,"id",void 0),(0,nr.default)(this,"size",void 0),(0,nr.default)(this,"settings",void 0),(0,nr.default)(this,"value",void 0),(0,nr.default)(this,"doublePrecision",void 0),(0,nr.default)(this,"_buffer",void 0),(0,nr.default)(this,"state",void 0),this.gl=r,this.id=e.id||"",this.size=e.size||1;var i=e.logicalType||e.type,a=i===5130,o=e.defaultValue;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);var s;a?s=5126:!i&&e.isIndexed?s=r&&qa(r,Se.ELEMENT_INDEX_UINT32)?5125:5123:s=i||5126;var u=NO(i||s||5126);this.doublePrecision=a,a&&e.fp64===!1&&(u=Float32Array),this.value=null,this.settings=Hr(Hr({},e),{},{defaultType:u,defaultValue:o,logicalType:i,type:s,size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT}),this.state=Hr(Hr({},n),{},{externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}),this._buffer=null}return(0,zO.default)(t,[{key:"isConstant",get:function(){return this.state.constant}},{key:"buffer",get:function(){if(!this._buffer){var e=this.settings,n=e.isIndexed,i=e.type;this._buffer=new se(this.gl,{id:this.id,target:n?34963:34962,accessor:{type:i}})}return this._buffer}},{key:"byteOffset",get:function(){var e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Qf(e):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(e){this.state.numInstances=e}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),mr.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(e,n){if(this.doublePrecision){var i={},a=this.value instanceof Float64Array,o=I4(this.getAccessor(),n||{});return i[e]=new Kf(this,o.high),i["".concat(e,"64Low")]=a?new Kf(this,o.low):new Float32Array(this.size),i}if(n){var s=UO(this.getAccessor(),n);return(0,nr.default)({},e,new Kf(this,s))}return(0,nr.default)({},e,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var e=null;if(this.state.constant&&this.value){var n=Array.from(this.value);e=[n,n]}else{var i=this.value,a=this.numInstances,o=this.size,s=a*o;if(i&&s&&i.length>=s){for(var u=new Array(o).fill(1/0),f=new Array(o).fill(-1/0),l=0;l<s;)for(var c=0;c<o;c++){var p=i[l++];p<u[c]&&(u[c]=p),p>f[c]&&(f[c]=p)}e=[u,f]}}return this.state.bounds=e,e}},{key:"setData",value:function(e){var n=this.state,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof se?i={buffer:e}:i=e;var a=Hr(Hr({},this.settings),i);if(n.bufferAccessor=a,n.bounds=null,i.constant){var o=i.value;o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o));var s=!n.constant||!this._areValuesEqual(o,this.value);if(!s)return!1;n.externalBuffer=null,n.constant=!0,this.value=o}else if(i.buffer){var u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;var f=i.value instanceof Float64Array;a.type=i.type||u.accessor.type,a.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),a.stride=Qf(a)}else if(i.value){this._checkExternalBuffer(i);var l=i.value;n.externalBuffer=null,n.constant=!1,this.value=l,a.bytesPerElement=l.BYTES_PER_ELEMENT,a.stride=Qf(a);var c=this.buffer,p=this.byteOffset;this.doublePrecision&&l instanceof Float64Array&&(l=Tf(l,a));var d=l.byteLength+p+a.stride*2;c.byteLength<d&&c.reallocate(d),c.setAccessor(null),c.subData({data:l,offset:p}),a.type=i.type||c.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;var n=this.value,i=e.startOffset,a=i===void 0?0:i,o=e.endOffset;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?Tf(n,{size:this.size,startIndex:a,endIndex:o}):n.subarray(a,o),offset:a*n.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.state,a=i.allocatedValue,o=mr.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=o;var s=this.buffer,u=this.byteOffset;return s.byteLength<o.byteLength+u&&(s.reallocate(o.byteLength+u),n&&a&&s.subData({data:a instanceof Float64Array?Tf(a,this):a,offset:u})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(e){var n=e.value;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));var i=this.settings.defaultType,a=!1;if(this.doublePrecision&&(a=n.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&le.warn("Attribute ".concat(this.id," is normalized"))()}},{key:"normalizeConstant",value:function(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(function(n){return(n+128)/255*2-1});case 5122:return new Float32Array(e).map(function(n){return(n+32768)/65535*2-1});case 5121:return new Float32Array(e).map(function(n){return n/255});case 5123:return new Float32Array(e).map(function(n){return n/65535});default:return e}}},{key:"_normalizeValue",value:function(e,n,i){var a=this.settings,o=a.defaultValue,s=a.size;if(Number.isFinite(e))return n[i]=e,n;if(!e){for(var u=s;--u>=0;)n[i+u]=o[u];return n}switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:for(var f=s;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:o[f]}return n}},{key:"_areValuesEqual",value:function(e,n){if(!e||!n)return!1;for(var i=this.size,a=0;a<i;a++)if(e[a]!==n[a])return!1;return!0}}]),t}();var $O=[],HO=[];function Ea(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,n=$O,i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?n=t:t.length>0&&(HO.length=t.length,n=HO):n=$O,(r>0||Number.isFinite(e))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(r,e),i.index=r-1),{iterable:n,objectInfo:i}}function Jf(t){return t&&t[Symbol.asyncIterator]}function el(t,r){var e=r.size,n=r.stride,i=r.offset,a=r.startIndices,o=r.nested,s=t.BYTES_PER_ELEMENT,u=n?n/s:e,f=i?i/s:0,l=Math.floor((t.length-f)/u);return function(c,p){var d=p.index,v=p.target;if(!a){for(var m=d*u+f,g=0;g<e;g++)v[g]=t[m+g];return v}var _=a[d],x=a[d+1]||l,w;if(o){w=new Array(x-_);for(var E=_;E<x;E++){var T=E*u+f;v=new Array(e);for(var P=0;P<e;P++)v[P]=t[T+P];w[E-_]=v}}else if(u===e)w=t.subarray(_*e+f,x*e+f);else{w=new t.constructor((x-_)*e);for(var A=0,D=_;D<x;D++)for(var L=D*u+f,C=0;C<e;C++)w[A++]=t[L+C]}return w}}var WO=[],es=[[0,1/0]];function YO(t,r){if(t===es||(r[0]<0&&(r[0]=0),r[0]>=r[1]))return t;for(var e=[],n=t.length,i=0,a=0;a<n;a++){var o=t[a];o[1]<r[0]?(e.push(o),i=a+1):o[0]>r[1]?e.push(o):r=[Math.min(o[0],r[0]),Math.max(o[1],r[1])]}return e.splice(i,0,r),e}var ZO=h(G());function dv(t){var r=t.source,e=t.target,n=t.start,i=n===void 0?0:n,a=t.size,o=t.getData,s=t.end||e.length,u=r.length,f=s-i;if(u>f){e.set(r.subarray(0,f),i);return}if(e.set(r,i),!!o)for(var l=u;l<f;)for(var c=o(l,r),p=0;p<a;p++)e[i+l]=c[p]||0,l++}function XO(t){var r=t.source,e=t.target,n=t.size,i=t.getData,a=t.sourceStartIndices,o=t.targetStartIndices;if(!Array.isArray(o))return dv({source:r,target:e,size:n,getData:i}),e;for(var s=0,u=0,f=i&&function(v,m){return i(v+u,m)},l=Math.min(a.length,o.length),c=1;c<l;c++){var p=a[c]*n,d=o[c]*n;dv({source:r.subarray(s,p),target:e,start:u,end:d,size:n,getData:f}),s=p,u=d}return u<e.length&&dv({source:[],target:e,start:u,size:n,getData:f}),e}function qO(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function tl(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?qO(Object(e),!0).forEach(function(n){(0,ZO.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):qO(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var D4={interpolation:{duration:0,easing:function(r){return r}},spring:{stiffness:.05,damping:.5}};function rl(t,r){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});var e=t.type||"interpolation";return tl(tl(tl(tl({},D4[e]),r),t),{},{type:e})}function nl(t,r){var e=r.getBuffer();return e?[e,{divisor:0,size:r.size,normalized:r.settings.normalized}]:r.value}function il(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function al(t){t.push(t.shift())}function ts(t,r){var e=t.doublePrecision,n=t.settings,i=t.value,a=t.size,o=e&&i instanceof Float64Array?2:1;return(n.noAlloc?i.length:r*a)*o}function ol(t){var r=t.buffer,e=t.numInstances,n=t.attribute,i=t.fromLength,a=t.fromStartIndices,o=t.getData,s=o===void 0?function(E){return E}:o,u=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*u,l=n.byteOffset,c=n.startIndices,p=a&&c,d=ts(n,e),v=n.isConstant;if(!(!p&&i>=d)){var m=v?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!v){var g=s;s=function(T,P){return n.normalizeConstant(g(T,P))}}var _=v?function(E,T){return s(m,T)}:function(E,T){return s(m.subarray(E,E+f),T)},x=r.getData({length:i}),w=new Float32Array(d);XO({source:x,target:w,sourceStartIndices:a,targetStartIndices:c,size:f,getData:_}),r.byteLength<w.byteLength+l&&r.reallocate(w.byteLength+l),r.subData({data:w,offset:l})}}function sl(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=j4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function j4(t,r){if(t){if(typeof t=="string")return KO(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return KO(t,r)}}function KO(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function F4(t){var r=N4();return function(){var n=(0,Pa.default)(t),i;if(r){var a=(0,Pa.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rA.default)(this,i)}}function N4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Sa=function(t){(0,tA.default)(e,t);var r=F4(e);function e(n,i){var a;return(0,QO.default)(this,e),a=r.call(this,n,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:es}),(0,mv.default)((0,eA.default)(a),"constant",!1),a.settings.update=i.update||(i.accessor?a._autoUpdater:void 0),Object.seal(a.settings),Object.seal(a.state),a._validateAttributeUpdaters(),a}return(0,JO.default)(e,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(i){this.state.startIndices=i}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.clearChangedFlags,o=a===void 0?!1:a,s=this.state.needsRedraw;return this.state.needsRedraw=s&&!o,s}},{key:"getUpdateTriggers",value:function(){var i=this.settings.accessor;return[this.id].concat(typeof i!="function"&&i||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(i){if(!i||!this.supportsTransition())return null;var a=this.settings.accessor,o=this.settings.transition,s=Array.isArray(a)?i[a.find(function(u){return i[u]})]:i[a];return rl(s,o)}},{key:"setNeedsUpdate",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,a=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||i,this.setNeedsRedraw(i),a){var o=a.startRow,s=o===void 0?0:o,u=a.endRow,f=u===void 0?1/0:u;this.state.updateRanges=YO(this.state.updateRanges,[s,f])}else this.state.updateRanges=es}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=WO}},{key:"setNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||i}},{key:"allocate",value:function(i){var a=this.state,o=this.settings;return o.noAlloc?!1:o.update?((0,ul.default)((0,Pa.default)(e.prototype),"allocate",this).call(this,i,a.updateRanges!==es),!0):!1}},{key:"updateBuffer",value:function(i){var a=i.numInstances,o=i.data,s=i.props,u=i.context;if(!this.needsUpdate())return!1;var f=this.state.updateRanges,l=this.settings,c=l.update,p=l.noAlloc,d=!0;if(c){var v=sl(f),m;try{for(v.s();!(m=v.n()).done;){var g=(0,vv.default)(m.value,2),_=g[0],x=g[1];c.call(u,this,{data:o,startRow:_,endRow:x,props:s,numInstances:a})}}catch(C){v.e(C)}finally{v.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var w=sl(f),E;try{for(w.s();!(E=w.n()).done;){var T=(0,vv.default)(E.value,2),P=T[0],A=T[1],D=Number.isFinite(P)?this.getVertexOffset(P):0,L=Number.isFinite(A)?this.getVertexOffset(A):p||!Number.isFinite(a)?this.value.length:a*this.size;(0,ul.default)((0,Pa.default)(e.prototype),"updateSubBuffer",this).call(this,{startOffset:D,endOffset:L})}}catch(C){w.e(C)}finally{w.f()}}this._checkAttributeArray()}else d=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),d}},{key:"setConstantValue",value:function(i){if(i===void 0||typeof i=="function")return!1;var a=this.setData({constant:!0,value:i});return a&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}},{key:"setExternalBuffer",value:function(i){var a=this.state;return i?(this.clearNeedsUpdate(),a.lastExternalBuffer===i||(a.lastExternalBuffer=i,this.setNeedsRedraw(),this.setData(i)),!0):(a.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,o=this.state,s=this.settings;if(!i)return o.binaryValue=null,o.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(o.binaryValue===i)return this.clearNeedsUpdate(),!0;o.binaryValue=i,this.setNeedsRedraw();var u=s.transform||a!==this.startIndices;if(u){ArrayBuffer.isView(i)&&(i={value:i});var f=i;ke(ArrayBuffer.isView(f.value),"invalid ".concat(s.accessor));var l=Boolean(f.size)&&f.size!==this.size;return o.binaryAccessor=el(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:a,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(i),!0}},{key:"getVertexOffset",value:function(i){var a=this.startIndices,o=a?i<a.length?a[i]:this.numInstances:i;return o*this.size}},{key:"getShaderAttributes",value:function(){var i=this.settings.shaderAttributes||(0,mv.default)({},this.id,null),a={};for(var o in i)Object.assign(a,(0,ul.default)((0,Pa.default)(e.prototype),"getShaderAttributes",this).call(this,o,i[o]));return a}},{key:"_autoUpdater",value:function(i,a){var o=a.data,s=a.startRow,u=a.endRow,f=a.props,l=a.numInstances;if(!i.constant){var c=i.settings,p=i.state,d=i.value,v=i.size,m=i.startIndices,g=c.accessor,_=c.transform,x=p.binaryAccessor||(typeof g=="function"?g:f[g]);ke(typeof x=="function",'accessor "'.concat(g,'" is not a function'));var w=i.getVertexOffset(s),E=Ea(o,s,u),T=E.iterable,P=E.objectInfo,A=sl(T),D;try{for(A.s();!(D=A.n()).done;){var L=D.value;P.index++;var C=x(L,P);if(_&&(C=_.call(this,C)),m){var F=(P.index<m.length-1?m[P.index+1]:l)-m[P.index];if(C&&Array.isArray(C[0])){var j=w,z=sl(C),N;try{for(z.s();!(N=z.n()).done;){var M=N.value;i._normalizeValue(M,d,j),j+=v}}catch(k){z.e(k)}finally{z.f()}}else C&&C.length>v?d.set(C,w):(i._normalizeValue(C,P.target,0),Df({target:d,source:P.target,start:w,count:F}));w+=F*v}else i._normalizeValue(C,d,w),w+=v}}catch(k){A.e(k)}finally{A.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var i=this.settings,a=i.noAlloc||typeof i.update=="function";if(!a)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var i=this.value,a=Math.min(4,this.size);if(i&&i.length>=a){var o=!0;switch(a){case 4:o=o&&Number.isFinite(i[3]);case 3:o=o&&Number.isFinite(i[2]);case 2:o=o&&Number.isFinite(i[1]);case 1:o=o&&Number.isFinite(i[0]);break;default:o=!1}if(!o)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),e}(GO);var vA=h(B()),mA=h(U()),zn=h(G());var oA=h(B()),sA=h(U()),ir=h(G());function nA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function B4(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?nA(Object(e),!0).forEach(function(n){(0,ir.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):nA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function iA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=V4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function V4(t,r){if(t){if(typeof t=="string")return aA(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return aA(t,r)}}function aA(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var uA=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,oA.default)(this,t),(0,ir.default)(this,"gl",void 0),(0,ir.default)(this,"type","interpolation"),(0,ir.default)(this,"attributeInTransition",void 0),(0,ir.default)(this,"settings",void 0),(0,ir.default)(this,"attribute",void 0),(0,ir.default)(this,"transition",void 0),(0,ir.default)(this,"currentStartIndices",void 0),(0,ir.default)(this,"currentLength",void 0),(0,ir.default)(this,"transform",void 0),(0,ir.default)(this,"buffers",void 0),this.gl=e,this.transition=new Ur(i),this.attribute=n,this.attributeInTransition=new Sa(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=U4(e,n);var a={byteLength:0,usage:35050};this.buffers=[new se(e,a),new se(e,a)]}return(0,sA.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;var i=this.gl,a=this.buffers,o=this.attribute;al(a);var s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=iA(a),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;ol(B4({buffer:l},s))}}catch(c){u.e(c)}finally{u.f()}this.currentStartIndices=o.startIndices,this.currentLength=ts(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:a[0],aTo:nl(i,o)},feedbackBuffers:{vCurrent:a[1]}})}},{key:"update",value:function(){var e=this.transition.update();if(e){var n=this.settings,i=n.duration,a=n.easing,o=this.transition.time,s=o/i;a&&(s=a(s)),this.transform.run({uniforms:{time:s}})}return e}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=iA(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0}}]),t}();var z4=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function U4(t,r){var e=il(r.size);return new Dr(t,{vs:z4,defines:{ATTRIBUTE_TYPE:e},varyings:["vCurrent"]})}var hA=h(B()),pA=h(U()),Ot=h(G());function fA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=G4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function G4(t,r){if(t){if(typeof t=="string")return lA(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return lA(t,r)}}function lA(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function cA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function rs(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?cA(Object(e),!0).forEach(function(n){(0,Ot.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):cA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var dA=function(){function t(r){var e=r.gl,n=r.attribute,i=r.timeline;(0,hA.default)(this,t),(0,Ot.default)(this,"gl",void 0),(0,Ot.default)(this,"type","spring"),(0,Ot.default)(this,"attributeInTransition",void 0),(0,Ot.default)(this,"settings",void 0),(0,Ot.default)(this,"attribute",void 0),(0,Ot.default)(this,"transition",void 0),(0,Ot.default)(this,"currentStartIndices",void 0),(0,Ot.default)(this,"currentLength",void 0),(0,Ot.default)(this,"texture",void 0),(0,Ot.default)(this,"framebuffer",void 0),(0,Ot.default)(this,"transform",void 0),(0,Ot.default)(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Ur(i),this.attribute=n,this.attributeInTransition=new Sa(e,rs(rs({},n.settings),{},{normalized:!1})),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=H4(e),this.framebuffer=W4(e,this.texture),this.transform=$4(e,n,this.framebuffer);var a={byteLength:0,usage:35050};this.buffers=[new se(e,a),new se(e,a),new se(e,a)]}return(0,pA.default)(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(e,n){var i=this.gl,a=this.buffers,o=this.attribute,s={numInstances:n,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter},u=fA(a),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;ol(rs({buffer:l},s))}}catch(c){u.e(c)}finally{u.f()}this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=ts(o,n),this.attributeInTransition.setData({buffer:a[1],value:o.value}),this.transition.start(rs(rs({},e),{},{duration:1/0})),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:nl(i,o)}})}},{key:"update",value:function(){var e=this.buffers,n=this.transform,i=this.framebuffer,a=this.transition,o=a.update();if(!o)return!1;var s=this.settings;n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:s.stiffness,damping:s.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),al(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value});var u=en(i)[0]>0;return u||a.end(),!0}},{key:"cancel",value:function(){this.transition.cancel(),this.transform.delete();var e=fA(this.buffers),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;i.delete()}}catch(a){e.e(a)}finally{e.f()}this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}]),t}();function $4(t,r,e){var n=il(r.size);return new Dr(t,{framebuffer:e,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}function H4(t){return new Ge(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function W4(t,r){return new xe(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:(0,Ot.default)({},36064,r)})}var Y4={interpolation:uA,spring:dA},gA=function(){function t(r,e){var n=e.id,i=e.timeline;(0,vA.default)(this,t),(0,zn.default)(this,"id",void 0),(0,zn.default)(this,"isSupported",void 0),(0,zn.default)(this,"gl",void 0),(0,zn.default)(this,"timeline",void 0),(0,zn.default)(this,"transitions",void 0),(0,zn.default)(this,"needsRedraw",void 0),(0,zn.default)(this,"numInstances",void 0),this.id=n,this.gl=r,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Dr.isSupported(r)}return(0,mA.default)(t,[{key:"finalize",value:function(){for(var e in this.transitions)this._removeTransition(e)}},{key:"update",value:function(e){var n=e.attributes,i=e.transitions,a=e.numInstances;this.numInstances=a||1;for(var o in n){var s=n[o],u=s.getTransitionSetting(i);u&&this._updateAttribute(o,s,u)}for(var f in this.transitions){var l=n[f];(!l||!l.getTransitionSetting(i))&&this._removeTransition(f)}}},{key:"hasAttribute",value:function(e){var n=this.transitions[e];return n&&n.inProgress}},{key:"getAttributes",value:function(){var e={};for(var n in this.transitions){var i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}},{key:"run",value:function(){if(!this.isSupported||this.numInstances===0)return!1;for(var e in this.transitions){var n=this.transitions[e].update();n&&(this.needsRedraw=!0)}var i=this.needsRedraw;return this.needsRedraw=!1,i}},{key:"_removeTransition",value:function(e){this.transitions[e].cancel(),delete this.transitions[e]}},{key:"_updateAttribute",value:function(e,n,i){var a=this.transitions[e],o=!a||a.type!==i.type;if(o){if(!this.isSupported){le.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);var s=Y4[i.type];s?this.transitions[e]=new s({attribute:n,timeline:this.timeline,gl:this.gl}):(le.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}]),t}();function yA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function gv(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?yA(Object(e),!0).forEach(function(n){(0,xr.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):yA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function X4(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=q4(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function q4(t,r){if(t){if(typeof t=="string")return _A(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return _A(t,r)}}function _A(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var bA="attributeManager.invalidate",Z4="attributeManager.updateStart",K4="attributeManager.updateEnd",Q4="attribute.updateStart",J4="attribute.allocate",eV="attribute.updateEnd",fl=function(){function t(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.id,i=n===void 0?"attribute-manager":n,a=e.stats,o=e.timeline;(0,wA.default)(this,t),(0,xr.default)(this,"id",void 0),(0,xr.default)(this,"gl",void 0),(0,xr.default)(this,"attributes",void 0),(0,xr.default)(this,"updateTriggers",void 0),(0,xr.default)(this,"needsRedraw",void 0),(0,xr.default)(this,"userData",void 0),(0,xr.default)(this,"stats",void 0),(0,xr.default)(this,"attributeTransitionManager",void 0),(0,xr.default)(this,"mergeBoundsMemoized",Zt(XT)),this.id=i,this.gl=r,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new gA(r,{id:"".concat(i,"-transitions"),timeline:o}),Object.seal(this)}return(0,xA.default)(t,[{key:"finalize",value:function(){for(var e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}},{key:"setNeedsRedraw",value:function(){this.needsRedraw=!0}},{key:"add",value:function(e){this._add(e)}},{key:"addInstanced",value:function(e){this._add(e,{instanced:1})}},{key:"remove",value:function(e){var n=X4(e),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;this.attributes[a]!==void 0&&(this.attributes[a].delete(),delete this.attributes[a])}}catch(o){n.e(o)}finally{n.f()}}},{key:"invalidate",value:function(e,n){var i=this._invalidateTrigger(e,n);Ke(bA,this,e,i)}},{key:"invalidateAll",value:function(e){for(var n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ke(bA,this,"all")}},{key:"update",value:function(e){var n=e.data,i=e.numInstances,a=e.startIndices,o=a===void 0?null:a,s=e.transitions,u=e.props,f=u===void 0?{}:u,l=e.buffers,c=l===void 0?{}:l,p=e.context,d=p===void 0?{}:p,v=!1;Ke(Z4,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(var m in this.attributes){var g=this.attributes[m],_=g.settings.accessor;g.startIndices=o,g.numInstances=i,f[m]&&le.removed("props.".concat(m),"data.attributes.".concat(m))(),g.setExternalBuffer(c[m])||g.setBinaryValue(typeof _=="string"?c[_]:void 0,n.startIndices)||typeof _=="string"&&!c[_]&&g.setConstantValue(f[_])||g.needsUpdate()&&(v=!0,this._updateAttribute({attribute:g,numInstances:i,data:n,props:f,context:d})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}v&&Ke(K4,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:s})}},{key:"updateTransition",value:function(){var e=this.attributeTransitionManager,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getBounds",value:function(e){var n=this,i=e.map(function(a){var o;return(o=n.attributes[a])===null||o===void 0?void 0:o.getBounds()});return this.mergeBoundsMemoized(i)}},{key:"getChangedAttributes",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1},n=this.attributes,i=this.attributeTransitionManager,a=gv({},i.getAttributes());for(var o in n){var s=n[o];s.needsRedraw(e)&&!i.hasAttribute(o)&&(a[o]=s)}return a}},{key:"getShaderAttributes",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());var i={};for(var a in e)n[a]||Object.assign(i,e[a].getShaderAttributes());return i}},{key:"_add",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(var i in e){var a=e[i];this.attributes[i]=this._createAttribute(i,a,n)}this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(e,n,i){var a=gv(gv({},n),{},{id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0});return new Sa(this.gl,a)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var e=this,n={},i=function(s){var u=e.attributes[s];u.getUpdateTriggers().forEach(function(f){n[f]||(n[f]=[]),n[f].push(s)})};for(var a in this.attributes)i(a);this.updateTriggers=n}},{key:"_invalidateTrigger",value:function(e,n){var i=this.attributes,a=this.updateTriggers,o=a[e];return o&&o.forEach(function(s){var u=i[s];u&&u.setNeedsUpdate(u.id,n)}),o}},{key:"_updateAttribute",value:function(e){var n=e.attribute,i=e.numInstances;if(Ke(Q4,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ke(J4,n,i);var a=n.updateBuffer(e);a&&(this.needsRedraw=!0,Ke(eV,n,i))}}]),t}();var kv=h(Ue()),E2=h(B()),P2=h(U()),Ma=h(we()),S2=h(ie()),O2=h(ae()),Rv=h(ne()),vn=h(G());var VA=h(Ue()),zA=h(G()),UA=h(B()),GA=h(U());var TA=h(B()),EA=h(U()),PA=h(ie()),SA=h(ae()),yv=h(ne());function tV(t){var r=rV();return function(){var n=(0,yv.default)(t),i;if(r){var a=(0,yv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,SA.default)(this,i)}}function rV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var OA=function(t){(0,PA.default)(e,t);var r=tV(e);function e(){return(0,TA.default)(this,e),r.apply(this,arguments)}return(0,EA.default)(e,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var i=this.time,a=this.settings,o=a.fromValue,s=a.toValue,u=a.duration,f=a.easing,l=f(i/u);this._value=nn(o,s,l)}}]),e}(Ur);var RA=h(B()),CA=h(U()),IA=h(ie()),LA=h(ae()),_v=h(ne());function nV(t){var r=iV();return function(){var n=(0,_v.default)(t),i;if(r){var a=(0,_v.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,LA.default)(this,i)}}function iV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var AA=1e-5;function MA(t,r,e,n,i){var a=r-t,o=e-r,s=o*i,u=-a*n;return s+u+a+r}function aV(t,r,e,n,i){if(Array.isArray(e)){for(var a=[],o=0;o<e.length;o++)a[o]=MA(t[o],r[o],e[o],n,i);return a}return MA(t,r,e,n,i)}function kA(t,r){if(Array.isArray(t)){for(var e=0,n=0;n<t.length;n++){var i=t[n]-r[n];e+=i*i}return Math.sqrt(e)}return Math.abs(t-r)}var DA=function(t){(0,IA.default)(e,t);var r=nV(e);function e(){return(0,RA.default)(this,e),r.apply(this,arguments)}return(0,CA.default)(e,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var i=this.settings,a=i.fromValue,o=i.toValue,s=i.damping,u=i.stiffness,f=this._prevValue,l=f===void 0?a:f,c=this._currValue,p=c===void 0?a:c,d=aV(l,p,o,s,u),v=kA(d,o),m=kA(d,p);v<AA&&m<AA&&(d=o,this.end()),this._prevValue=p,this._currValue=d}}]),e}(Ur);function jA(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=oV(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function oV(t,r){if(t){if(typeof t=="string")return FA(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return FA(t,r)}}function FA(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function NA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function BA(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?NA(Object(e),!0).forEach(function(n){(0,zA.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):NA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var sV={interpolation:OA,spring:DA},$A=function(){function t(r){(0,UA.default)(this,t),this.transitions=new Map,this.timeline=r}return(0,GA.default)(t,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(e,n,i,a){var o=this.transitions;if(o.has(e)){var s=o.get(e),u=s.value,f=u===void 0?s.settings.fromValue:u;n=f,this.remove(e)}if(a=rl(a),!!a){var l=sV[a.type];if(!l){le.error("unsupported transition type '".concat(a.type,"'"))();return}var c=new l(this.timeline);c.start(BA(BA({},a),{},{fromValue:n,toValue:i})),o.set(e,c)}}},{key:"remove",value:function(e){var n=this.transitions;n.has(e)&&(n.get(e).cancel(),n.delete(e))}},{key:"update",value:function(){var e={},n=jA(this.transitions),i;try{for(n.s();!(i=n.n()).done;){var a=(0,VA.default)(i.value,2),o=a[0],s=a[1];s.update(),e[o]=s.value,s.inProgress||this.remove(o)}}catch(u){n.e(u)}finally{n.f()}return e}},{key:"clear",value:function(){var e=jA(this.transitions.keys()),n;try{for(e.s();!(n=e.n()).done;){var i=n.value;this.remove(i)}}catch(a){e.e(a)}finally{e.f()}}}]),t}();var bv=h(qe());function WA(t){var r=t[er];for(var e in r){var n=r[e],i=n.validate;if(i&&!i(t[e],n))throw new Error("Invalid prop ".concat(e,": ").concat(t[e]))}}function YA(t,r){var e=ll({newProps:t,oldProps:r,propTypes:t[er],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=fV(t,r),i=!1;return n||(i=lV(t,r)),{dataChanged:n,propsChanged:e,updateTriggersChanged:i,extensionsChanged:cV(t,r),transitionsChanged:uV(t,r)}}function uV(t,r){if(!t.transitions)return!1;var e={},n=t[er],i=!1;for(var a in t.transitions){var o=n[a],s=o&&o.type,u=s==="number"||s==="color"||s==="array";u&&wv(t[a],r[a],o)&&(e[a]=!0,i=!0)}return i?e:!1}function ll(t){var r=t.newProps,e=t.oldProps,n=t.ignoreProps,i=n===void 0?{}:n,a=t.propTypes,o=a===void 0?{}:a,s=t.triggerName,u=s===void 0?"props":s;if(e===r)return!1;if((0,bv.default)(r)!=="object"||r===null||(0,bv.default)(e)!=="object"||e===null)return"".concat(u," changed shallowly");for(var f=0,l=Object.keys(r);f<l.length;f++){var c=l[f];if(!(c in i)){if(!(c in e))return"".concat(u,".").concat(c," added");var p=wv(r[c],e[c],o[c]);if(p)return"".concat(u,".").concat(c," ").concat(p)}}for(var d=0,v=Object.keys(e);d<v.length;d++){var m=v[d];if(!(m in i)){if(!(m in r))return"".concat(u,".").concat(m," dropped");if(!Object.hasOwnProperty.call(r,m)){var g=wv(r[m],e[m],o[m]);if(g)return"".concat(u,".").concat(m," ").concat(g)}}}return!1}function wv(t,r,e){var n=e&&e.equal;return n&&!n(t,r,e)||!n&&(n=t&&r&&t.equals,n&&!n.call(t,r))?"changed deeply":!n&&r!==t?"changed shallowly":null}function fV(t,r){if(r===null)return"oldProps is null, initial diff";var e=!1,n=t.dataComparator,i=t._dataDiff;return n?n(t.data,r.data)||(e="Data comparator detected a change"):t.data!==r.data&&(e="A new data container was supplied"),e&&i&&(e=i(t.data,r.data)||e),e}function lV(t,r){if(r===null)return{all:!0};if("all"in t.updateTriggers){var e=HA(t,r,"all");if(e)return{all:!0}}var n={},i=!1;for(var a in t.updateTriggers)if(a!=="all"){var o=HA(t,r,a);o&&(n[a]=!0,i=!0)}return i?n:!1}function cV(t,r){if(r===null)return!0;var e=r.extensions,n=t.extensions;if(n===e)return!1;if(!e||!n||n.length!==e.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(e[i]))return!0;return!1}function HA(t,r,e){var n=t.updateTriggers[e];n=n??{};var i=r.updateTriggers[e];i=i??{};var a=ll({oldProps:i,newProps:n,triggerName:e});return a}var xv=h(qe()),hV="count(): argument not an object",pV="count(): argument not a container";function cl(t){if(!vV(t))throw new Error(hV);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(dV(t))return Object.keys(t).length;throw new Error(pV)}function dV(t){return t!==null&&(0,xv.default)(t)==="object"&&t.constructor===Object}function vV(t){return t!==null&&(0,xv.default)(t)==="object"}var qA=h(G());function XA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ns(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?XA(Object(e),!0).forEach(function(n){(0,qA.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):XA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function hl(t,r){if(!r)return t;var e=ns(ns({},t),r);if("defines"in r&&(e.defines=ns(ns({},t.defines),r.defines)),"modules"in r&&(e.modules=(t.modules||[]).concat(r.modules),r.modules.some(function(o){return o.name==="project64"}))){var n=e.modules.findIndex(function(o){return o.name==="project32"});n>=0&&e.modules.splice(n,1)}if("inject"in r)if(!t.inject)e.inject=r.inject;else{var i=ns({},t.inject);for(var a in r.inject)i[a]=(i[a]||"")+r.inject[a];e.inject=i}return e}var u2=h(B()),f2=h(U()),Si=h(G());var e2=h(qe()),t2=h(Ue()),r2=h(G());var Pi=h(G());var Oa;function ZA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function is(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ZA(Object(e),!0).forEach(function(n){(0,Pi.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ZA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var mV=(Oa={},(0,Pi.default)(Oa,10241,9987),(0,Pi.default)(Oa,10240,9729),(0,Pi.default)(Oa,10242,33071),(0,Pi.default)(Oa,10243,33071),Oa),Tv={};function KA(t,r,e){if(r instanceof Ge)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});var n=null;r.compressed&&(n=(0,Pi.default)({},10241,r.data.length>1?9985:9729));var i=new Ge(t,is(is({},r),{},{parameters:is(is(is({},mV),n),e)}));return Tv[i.id]=!0,i}function QA(t){!t||!(t instanceof Ge)||Tv[t.id]&&(t.delete(),delete Tv[t.id])}function JA(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function os(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?JA(Object(e),!0).forEach(function(n){(0,r2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):JA(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var gV={boolean:{validate:function(r,e){return!0},equal:function(r,e,n){return Boolean(r)===Boolean(e)}},number:{validate:function(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate:function(r,e){return e.optional&&!r||Ev(r)&&(r.length===3||r.length===4)},equal:function(r,e,n){return st(r,e,1)}},accessor:{validate:function(r,e){var n=pl(r);return n==="function"||n===pl(e.value)},equal:function(r,e,n){return typeof e=="function"?!0:st(r,e,1)}},array:{validate:function(r,e){return e.optional&&!r||Ev(r)},equal:function(r,e,n){var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?st(r,e,a):r===e}},object:{equal:function(r,e,n){if(n.ignore)return!0;var i=n.compare,a=Number.isInteger(i)?i:i?1:0;return i?st(r,e,a):r===e}},function:{validate:function(r,e){return e.optional&&!r||typeof r=="function"},equal:function(r,e,n){var i=!n.compare&&n.ignore!==!1;return i||r===e}},data:{transform:function(r,e,n){var i=n.props.dataTransform;return i&&r?i(r):r}},image:{transform:function(r,e,n){var i=n.context;return!i||!i.gl?null:KA(i.gl,r,os(os({},e.parameters),n.props.textureParameters))},release:function(r){QA(r)}}};function n2(t){for(var r={},e={},n={},i=0,a=Object.entries(t);i<a.length;i++){var o=(0,t2.default)(a[i],2),s=o[0],u=o[1],f=u?.deprecatedFor;if(f)n[s]=Array.isArray(f)?f:[f];else{var l=yV(s,u);r[s]=l,e[s]=l.value}}return{propTypes:r,defaultProps:e,deprecatedProps:n}}function yV(t,r){switch(pl(r)){case"object":return as(t,r);case"array":return as(t,{type:"array",value:r,compare:!1});case"boolean":return as(t,{type:"boolean",value:r});case"number":return as(t,{type:"number",value:r});case"function":return as(t,{type:"function",value:r,compare:!0});default:return{name:t,type:"unknown",value:r}}}function as(t,r){return"type"in r?os(os({name:t},gV[r.type]),r):"value"in r?os({name:t,type:pl(r.value)},r):{name:t,type:"object",value:r}}function Ev(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function pl(t){return Ev(t)?"array":t===null?"null":(0,e2.default)(t)}function Sv(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_V(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function _V(t,r){if(t){if(typeof t=="string")return i2(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return i2(t,r)}}function i2(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function a2(t,r){for(var e,n=r.length-1;n>=0;n--){var i=r[n];"extensions"in i&&(e=i.extensions)}var a=Pv(t.constructor,e),o=Object.create(a);o[da]=t,o[Br]={},o[yr]={};for(var s=0;s<r.length;++s){var u=r[s];for(var f in u)o[f]=u[f]}return Object.freeze(o),o}var bV="_mergedDefaultProps";function Pv(t,r){var e=bV;if(r){var n=Sv(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.constructor;o&&(e+=":".concat(o.extensionName||o.name))}}catch(u){n.e(u)}finally{n.f()}}var s=o2(t,e);return s||(t[e]=wV(t,r||[]))}function wV(t,r){var e=t.prototype;if(!e)return null;var n=Object.getPrototypeOf(t),i=Pv(n),a=o2(t,"defaultProps")||{},o=n2(a),s=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i?.[er],o.propTypes),f=Object.assign(Object.create(null),i?.[Lf],o.deprecatedProps),l=Sv(r),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,d=Pv(p.constructor);d&&(Object.assign(s,d),Object.assign(u,d[er]),Object.assign(f,d[Lf]))}}catch(v){l.e(v)}finally{l.f()}return xV(s,t),EV(s,u),TV(s,f),s[er]=u,s[Lf]=f,r.length===0&&!Ov(t,"_propTypes")&&(t._propTypes=u),s}function xV(t,r){var e=SV(r);Object.defineProperties(t,{id:{writable:!0,value:e}})}function TV(t,r){var e=function(a){Object.defineProperty(t,a,{enumerable:!1,set:function(s){var u="".concat(this.id,": ").concat(a),f=Sv(r[a]),l;try{for(f.s();!(l=f.n()).done;){var c=l.value;Ov(this,c)||(this[c]=s)}}catch(p){f.e(p)}finally{f.f()}le.deprecated(u,r[a].join("/"))()}})};for(var n in r)e(n)}function EV(t,r){var e={},n={};for(var i in r){var a=r[i],o=a.name,s=a.value;a.async&&(e[o]=s,n[o]=PV(o))}t[fn]=e,t[Br]={},Object.defineProperties(t,n)}function PV(t){return{enumerable:!0,set:function(e){typeof e=="string"||e instanceof Promise||Jf(e)?this[Br][t]=e:this[yr][t]=e},get:function(){if(this[yr]){if(t in this[yr]){var e=this[yr][t];return e||this[fn][t]}if(t in this[Br]){var n=this[da]&&this[da].internalState;if(n&&n.hasAsyncProp(t))return n.getAsyncProp(t)||this[fn][t]}}return this[fn][t]}}}function Ov(t,r){return Object.prototype.hasOwnProperty.call(t,r)}function o2(t,r){return Ov(t,r)&&t[r]}function SV(t){var r=t.componentName;return r||le.warn("".concat(t.name,".componentName not specified"))(),r||t.name}function s2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Av(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?s2(Object(e),!0).forEach(function(n){(0,Si.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var OV=0,dl=function(){function t(){(0,u2.default)(this,t),(0,Si.default)(this,"id",void 0),(0,Si.default)(this,"props",void 0),(0,Si.default)(this,"count",void 0);for(var r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];this.props=a2(this,e),this.id=this.props.id,this.count=OV++}return(0,f2.default)(t,[{key:"clone",value:function(e){var n=this.props,i={};for(var a in n[fn])a in n[yr]?i[a]=n[yr][a]:a in n[Br]&&(i[a]=n[Br][a]);return new this.constructor(Av(Av(Av({},n),i),e))}}]),t}();(0,Si.default)(dl,"componentName","Component");(0,Si.default)(dl,"defaultProps",{});var v2=h(B()),m2=h(U()),Tr=h(we()),g2=h(kt()),y2=h(ie()),_2=h(ae()),vl=h(ne()),Er=h(G());var l2=h(dt()),c2=h(B()),h2=h(U()),Aa=h(G()),p2=h(Ju()),Mv=h(et());var AV=Object.freeze({}),d2=function(){function t(r){(0,c2.default)(this,t),(0,Aa.default)(this,"component",void 0),(0,Aa.default)(this,"onAsyncPropUpdated",void 0),(0,Aa.default)(this,"asyncProps",void 0),(0,Aa.default)(this,"oldProps",void 0),(0,Aa.default)(this,"oldAsyncProps",void 0),this.component=r,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}return(0,h2.default)(t,[{key:"finalize",value:function(){for(var e in this.asyncProps){var n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||AV}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}},{key:"hasAsyncProp",value:function(e){return e in this.asyncProps}},{key:"getAsyncProp",value:function(e){var n=this.asyncProps[e];return n&&n.resolvedValue}},{key:"isAsyncPropLoading",value:function(e){if(e){var n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(var i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}},{key:"reloadAsyncProp",value:function(e,n){this._watchPromise(e,Promise.resolve(n))}},{key:"setAsyncProps",value:function(e){this.component=e[da]||this.component;var n=e[yr]||{},i=e[Br]||e,a=e[fn]||{};for(var o in n){var s=n[o];this._createAsyncPropData(o,a[o]),this._updateAsyncProp(o,s),n[o]=this.getAsyncProp(o)}for(var u in i){var f=i[u];this._createAsyncPropData(u,a[u]),this._updateAsyncProp(u,f)}}},{key:"_fetch",value:function(e,n){return null}},{key:"_onResolve",value:function(e,n){}},{key:"_onError",value:function(e,n){}},{key:"_updateAsyncProp",value:function(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Jf(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(var e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}},{key:"_didAsyncInputValueChange",value:function(e,n){var i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}},{key:"_setPropValue",value:function(e,n){this._freezeAsyncOldProps();var i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(e,n,i){var a=this.asyncProps[e];a&&i>=a.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=n,a.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}},{key:"_watchPromise",value:function(e,n){var i=this,a=this.asyncProps[e];if(a){a.pendingLoadCount++;var o=a.pendingLoadCount;n.then(function(s){i.component&&(s=i._postProcessValue(a,s),i._setAsyncPropValue(e,s,o),i._onResolve(e,s))}).catch(function(s){i._onError(e,s)})}}},{key:"_resolveAsyncIterable",value:function(){var r=(0,l2.default)(Mv.default.mark(function n(i,a){var o,s,u,f,l,c,p,d,v,m,g;return Mv.default.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(i==="data"){x.next=3;break}return this._setPropValue(i,a),x.abrupt("return");case 3:if(o=this.asyncProps[i],o){x.next=6;break}return x.abrupt("return");case 6:o.pendingLoadCount++,s=o.pendingLoadCount,u=[],f=0,l=!1,c=!1,x.prev=12,d=(0,p2.default)(a);case 14:return x.next=16,d.next();case 16:if(!(l=!(v=x.sent).done)){x.next=28;break}if(m=v.value,this.component){x.next=20;break}return x.abrupt("return");case 20:g=this.component.props.dataTransform,g?u=g(m,u):u=u.concat(m),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(i,u,s);case 25:l=!1,x.next=14;break;case 28:x.next=34;break;case 30:x.prev=30,x.t0=x.catch(12),c=!0,p=x.t0;case 34:if(x.prev=34,x.prev=35,!(l&&d.return!=null)){x.next=39;break}return x.next=39,d.return();case 39:if(x.prev=39,!c){x.next=42;break}throw p;case 42:return x.finish(39);case 43:return x.finish(34);case 44:this._onResolve(i,u);case 45:case"end":return x.stop()}},n,this,[[12,30,34,44],[35,,39,43]])}));function e(n,i){return r.apply(this,arguments)}return e}()},{key:"_postProcessValue",value:function(e,n){var i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}},{key:"_createAsyncPropData",value:function(e,n){var i=this.asyncProps[e];if(!i){var a=this.component&&this.component.props[er];this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}]),t}();function MV(t){var r=kV();return function(){var n=(0,vl.default)(t),i;if(r){var a=(0,vl.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,_2.default)(this,i)}}function kV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var b2=function(t){(0,y2.default)(e,t);var r=MV(e);function e(n){var i,a=n.attributeManager,o=n.layer;return(0,v2.default)(this,e),i=r.call(this,o),(0,Er.default)((0,Tr.default)(i),"attributeManager",void 0),(0,Er.default)((0,Tr.default)(i),"needsRedraw",void 0),(0,Er.default)((0,Tr.default)(i),"needsUpdate",void 0),(0,Er.default)((0,Tr.default)(i),"subLayers",void 0),(0,Er.default)((0,Tr.default)(i),"usesPickingColorCache",void 0),(0,Er.default)((0,Tr.default)(i),"hasPickingBuffer",void 0),(0,Er.default)((0,Tr.default)(i),"changeFlags",void 0),(0,Er.default)((0,Tr.default)(i),"viewport",void 0),(0,Er.default)((0,Tr.default)(i),"uniformTransitions",void 0),(0,Er.default)((0,Tr.default)(i),"propsInTransition",void 0),i.attributeManager=a,i.needsRedraw=!0,i.needsUpdate=!0,i.subLayers=null,i.usesPickingColorCache=!1,i}return(0,m2.default)(e,[{key:"layer",get:function(){return this.component}},{key:"_fetch",value:function(i,a){var o=this.layer,s=o?.props.fetch;return s?s(a,{propName:i,layer:o}):(0,g2.default)((0,vl.default)(e.prototype),"_fetch",this).call(this,i,a)}},{key:"_onResolve",value:function(i,a){var o=this.layer;if(o){var s=o.props.onDataLoad;i==="data"&&s&&s(a,{propName:i,layer:o})}}},{key:"_onError",value:function(i,a){var o=this.layer;o&&o.raiseError(a,"loading ".concat(i," of ").concat(this.layer))}}]),e}(d2);function Pr(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=RV(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function RV(t,r){if(t){if(typeof t=="string")return w2(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w2(t,r)}}function w2(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function CV(t){var r=IV();return function(){var n=(0,Rv.default)(t),i;if(r){var a=(0,Rv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,O2.default)(this,i)}}function IV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function ss(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?x2(Object(e),!0).forEach(function(n){(0,vn.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}var LV="layer.changeFlag",DV="layer.initialize",jV="layer.update",FV="layer.finalize",NV="layer.matched",T2=Math.pow(2,24)-1,BV=Object.freeze([]),VV=Zt(function(t){var r=t.oldViewport,e=t.viewport;return r.equals(e)}),Wr=new Uint8ClampedArray(0),zV={data:{type:"data",value:BV,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:function(r){return r&&r.__diff},optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:function(r,e){var n=e.propName,i=e.layer,a=e.loaders,o=e.loadOptions,s=e.signal,u=i.context.resourceManager;if(o=o||i.getLoadOptions(),a=a||i.props.loaders,s){var f;o=ss(ss({},o),{},{fetch:ss(ss({},(f=o)===null||f===void 0?void 0:f.fetch),{},{signal:s})})}var l=u.contains(r);return!l&&!o&&(u.add({resourceId:r,data:Cn(r,a),persistent:!1}),l=!0),l?u.subscribe({resourceId:r,onChange:function(p){var d;return(d=i.internalState)===null||d===void 0?void 0:d.reloadAsyncProp(n,p)},consumerId:i.id,requestId:n}):Cn(r,a,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:me.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:function(r){var e=r.layerIndex;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},ka=function(t){(0,S2.default)(e,t);var r=CV(e);function e(){var n;(0,E2.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,vn.default)((0,Ma.default)(n),"internalState",null),(0,vn.default)((0,Ma.default)(n),"lifecycle",Fn.NO_STATE),(0,vn.default)((0,Ma.default)(n),"context",void 0),(0,vn.default)((0,Ma.default)(n),"state",void 0),(0,vn.default)((0,Ma.default)(n),"parent",null),n}return(0,P2.default)(e,[{key:"root",get:function(){for(var i=this;i.parent;)i=i.parent;return i}},{key:"toString",value:function(){var i=this.constructor.layerName||this.constructor.name;return"".concat(i,"({id: '").concat(this.props.id,"'})")}},{key:"project",value:function(i){ke(this.internalState);var a=this.internalState.viewport||this.context.viewport,o=Id(i,{viewport:a,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),s=vi(o,a.pixelProjectionMatrix),u=(0,kv.default)(s,3),f=u[0],l=u[1],c=u[2];return i.length===2?[f,l]:[f,l,c]}},{key:"unproject",value:function(i){ke(this.internalState);var a=this.internalState.viewport||this.context.viewport;return a.unproject(i)}},{key:"projectPosition",value:function(i,a){ke(this.internalState);var o=this.internalState.viewport||this.context.viewport;return Mf(i,ss({viewport:o,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},a))}},{key:"isComposite",get:function(){return!1}},{key:"setState",value:function(i){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,i),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!0)}},{key:"setNeedsUpdate",value:function(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}},{key:"isLoaded",get:function(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}},{key:"setModuleParameters",value:function(i){var a=Pr(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateModuleSettings(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"use64bitPositions",value:function(){var i=this.props.coordinateSystem;return i===me.DEFAULT||i===me.LNGLAT||i===me.CARTESIAN}},{key:"onHover",value:function(i,a){return this.props.onHover&&this.props.onHover(i,a)||!1}},{key:"onClick",value:function(i,a){return this.props.onClick&&this.props.onClick(i,a)||!1}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a[0]=i+1&255,a[1]=i+1>>8&255,a[2]=i+1>>8>>8&255,a}},{key:"decodePickingColor",value:function(i){ke(i instanceof Uint8Array);var a=(0,kv.default)(i,3),o=a[0],s=a[1],u=a[2],f=o+s*256+u*65536-1;return f}},{key:"getNumInstances",value:function(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:cl(this.props.data)}},{key:"getStartIndices",value:function(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["positions","instancePositions"])}},{key:"getShaders",value:function(i){var a=Pr(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;i=hl(i,s.getShaders.call(this,s))}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"shouldUpdateState",value:function(i){return i.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(i){var a=this,o=this.getAttributeManager(),s=i.changeFlags.dataChanged;if(s&&o)if(Array.isArray(s)){var u=Pr(s),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;o.invalidateAll(l)}}catch(x){u.e(x)}finally{u.f()}}else o.invalidateAll();if(o){var c=i.props,p=this.internalState.hasPickingBuffer,d=Number.isInteger(c.highlightedObjectIndex)||c.pickable||c.extensions.some(function(x){return x.getNeedsPickingBuffer.call(a,x)});if(p!==d){this.internalState.hasPickingBuffer=d;var v=o.attributes,m=v.pickingColors,g=v.instancePickingColors,_=m||g;_&&(d&&_.constant&&(_.constant=!1,o.invalidate(_.id)),!_.value&&!d&&(_.constant=!0,_.value=[0,0,0]))}}}},{key:"finalizeState",value:function(i){var a=Pr(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.delete()}}catch(f){a.e(f)}finally{a.f()}var u=this.getAttributeManager();u&&u.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}},{key:"draw",value:function(i){var a=Pr(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.draw(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"getPickingInfo",value:function(i){var a=i.info,o=i.mode,s=i.sourceLayer,u=a.index;return u>=0&&Array.isArray(this.props.data)&&(a.object=this.props.data[u]),a}},{key:"raiseError",value:function(i,a){var o,s;if(a&&(i.message="".concat(a,": ").concat(i.message)),!((o=(s=this.props).onError)!==null&&o!==void 0&&o.call(s,i))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,i,this)}}},{key:"getNeedsRedraw",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(i)}},{key:"needsUpdate",value:function(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}},{key:"hasUniformTransition",value:function(){var i;return((i=this.internalState)===null||i===void 0?void 0:i.uniformTransitions.active)||!1}},{key:"activateViewport",value:function(i){if(this.internalState){var a=this.internalState.viewport;this.internalState.viewport=i,(!a||!VV({oldViewport:a,viewport:i}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}}},{key:"invalidateAttribute",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all",a=this.getAttributeManager();a&&(i==="all"?a.invalidateAll():a.invalidate(i))}},{key:"updateAttributes",value:function(i){var a=Pr(this.getModels()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;this._setModelAttributes(s,i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_updateAttributes",value:function(){var i=this.getAttributeManager();if(i){var a=this.props,o=this.getNumInstances(),s=this.getStartIndices();i.update({data:a.data,numInstances:o,startIndices:s,props:a,transitions:a.transitions,buffers:a.data.attributes,context:this});var u=i.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}}},{key:"_updateAttributeTransition",value:function(){var i=this.getAttributeManager();i&&i.updateTransition()}},{key:"_updateUniformTransition",value:function(){var i=this.internalState.uniformTransitions;if(i.active){var a=i.update(),o=Object.create(this.props);for(var s in a)Object.defineProperty(o,s,{value:a[s]});return o}return this.props}},{key:"calculateInstancePickingColors",value:function(i,a){var o=a.numInstances;if(!i.constant){var s=Math.floor(Wr.length/3);if(this.internalState.usesPickingColorCache=!0,s<o){o>T2&&le.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Wr=mr.allocate(Wr,o,{size:3,copy:!0,maxCount:Math.max(o,T2)});for(var u=Math.floor(Wr.length/3),f=[],l=s;l<u;l++)this.encodePickingColor(l,f),Wr[l*3+0]=f[0],Wr[l*3+1]=f[1],Wr[l*3+2]=f[2]}i.value=Wr.subarray(0,o*3)}}},{key:"_setModelAttributes",value:function(i,a){var o=this.getAttributeManager(),s=i.userData.excludeAttributes||{},u=o.getShaderAttributes(a,s);i.setAttributes(u)}},{key:"disablePickingIndex",value:function(i){var a=this.props.data;if(!("attributes"in a)){this._disablePickingIndex(i);return}var o=this.getAttributeManager().attributes,s=o.pickingColors,u=o.instancePickingColors,f=s||u,l=f&&a.attributes&&a.attributes[f.id];if(l&&l.value)for(var c=l.value,p=this.encodePickingColor(i),d=0;d<a.length;d++){var v=f.getVertexOffset(d);c[v]===p[0]&&c[v+1]===p[1]&&c[v+2]===p[2]&&this._disablePickingIndex(d)}else this._disablePickingIndex(i)}},{key:"_disablePickingIndex",value:function(i){var a=this.getAttributeManager().attributes,o=a.pickingColors,s=a.instancePickingColors,u=o||s;if(u){var f=u.getVertexOffset(i),l=u.getVertexOffset(i+1);u.buffer.subData({data:new Uint8Array(l-f),offset:f})}}},{key:"restorePickingColors",value:function(){var i=this.getAttributeManager().attributes,a=i.pickingColors,o=i.instancePickingColors,s=a||o;s&&(this.internalState.usesPickingColorCache&&s.value.buffer!==Wr.buffer&&(s.value=Wr.subarray(0,s.value.length)),s.updateSubBuffer({startOffset:0}))}},{key:"_initialize",value:function(){ke(!this.internalState),ke(Number.isFinite(this.props.coordinateSystem)),Ke(DV,this);var i=this._getAttributeManager();i&&i.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new b2({attributeManager:i,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return le.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),i}}),this.internalState.uniformTransitions=new $A(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);var a=Pr(this.props.extensions),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.initializeState.call(this,this.context,s)}}catch(u){a.e(u)}finally{a.f()}this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}},{key:"_transferState",value:function(i){Ke(NV,this,this===i);var a=i.state,o=i.internalState;this!==i&&(this.internalState=o,this.state=a,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}},{key:"_update",value:function(){var i=this.needsUpdate();if(Ke(jV,this,i),!!i){var a=this.props,o=this.context,s=this.internalState,u=o.viewport,f=this._updateUniformTransition();s.propsInTransition=f,o.viewport=s.viewport||u,this.props=f;try{var l=this._getUpdateParams(),c=this.getModels();if(o.gl)this.updateState(l);else try{this.updateState(l)}catch{}var p=Pr(this.props.extensions),d;try{for(p.s();!(d=p.n()).done;){var v=d.value;v.updateState.call(this,l,v)}}catch(g){p.e(g)}finally{p.f()}var m=this.getModels()[0]!==c[0];this._postUpdate(l,m)}finally{o.viewport=u,this.props=a,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}}},{key:"_finalize",value:function(){Ke(FV,this),this.finalizeState(this.context);var i=Pr(this.props.extensions),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.finalizeState.call(this,this.context,o)}}catch(s){i.e(s)}finally{i.f()}}},{key:"_drawLayer",value:function(i){var a=this,o=i.moduleParameters,s=o===void 0?null:o,u=i.uniforms,f=u===void 0?{}:u,l=i.parameters,c=l===void 0?{}:l;this._updateAttributeTransition();var p=this.props,d=this.context;this.props=this.internalState.propsInTransition||p;var v=this.props.opacity;f.opacity=Math.pow(v,1/2.2);try{s&&this.setModuleParameters(s);var m=this.props.getPolygonOffset,g=m&&m(f)||[0,0];at(d.gl,{polygonOffset:g}),Re(d.gl,c,function(){var _={moduleParameters:s,uniforms:f,parameters:c,context:d},x=Pr(a.props.extensions),w;try{for(x.s();!(w=x.n()).done;){var E=w.value;E.draw.call(a,_,E)}}catch(T){x.e(T)}finally{x.f()}a.draw(_)})}finally{this.props=p}}},{key:"getChangeFlags",value:function(){var i;return(i=this.internalState)===null||i===void 0?void 0:i.changeFlags}},{key:"setChangeFlags",value:function(i){if(this.internalState){var a=this.internalState.changeFlags;for(var o in i)if(i[o]){var s=!1;switch(o){case"dataChanged":var u=i[o],f=a[o];u&&Array.isArray(f)&&(a.dataChanged=Array.isArray(u)?f.concat(u):u,s=!0);default:a[o]||(a[o]=i[o],s=!0)}s&&Ke(LV,this,o,i)}var l=Boolean(a.dataChanged||a.updateTriggersChanged||a.propsChanged||a.extensionsChanged);a.propsOrDataChanged=l,a.somethingChanged=l||a.viewportChanged||a.stateChanged}}},{key:"_clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"_diffProps",value:function(i,a){var o=YA(i,a);if(o.updateTriggersChanged)for(var s in o.updateTriggersChanged)o.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(o.transitionsChanged)for(var u in o.transitionsChanged){var f;this.internalState.uniformTransitions.add(u,a[u],i[u],(f=i.transitions)===null||f===void 0?void 0:f[u])}return this.setChangeFlags(o)}},{key:"validateProps",value:function(){WA(this.props)}},{key:"updateAutoHighlight",value:function(i){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(i)}},{key:"_updateAutoHighlight",value:function(i){var a={pickingSelectedColor:i.picked?i.color:null},o=this.props.highlightColor;i.picked&&typeof o=="function"&&(a.pickingHighlightColor=o(i)),this.setModuleParameters(a),this.setNeedsRedraw()}},{key:"_getAttributeManager",value:function(){var i=this.context;return new fl(i.gl,{id:this.props.id,stats:i.stats,timeline:i.timeline})}},{key:"_postUpdate",value:function(i,a){var o=i.props,s=i.oldProps;this.setNeedsRedraw(),this._updateAttributes();var u=this.state.model;u?.setInstanceCount(this.getNumInstances());var f=o.autoHighlight,l=o.highlightedObjectIndex,c=o.highlightColor;if(a||s.autoHighlight!==f||s.highlightedObjectIndex!==l||s.highlightColor!==c){var p={};f||(p.pickingSelectedColor=null),Array.isArray(c)&&(p.pickingHighlightColor=c),(a||l!==s.highlightedObjectIndex)&&(p.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(p)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(i){if(!this.internalState)return!1;var a=!1;a=a||this.internalState.needsRedraw&&this.id;var o=this.getAttributeManager(),s=o?o.getNeedsRedraw(i):!1;if(a=a||s,a){var u=Pr(this.props.extensions),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;l.onNeedsRedraw.call(this,l)}}catch(c){u.e(c)}finally{u.f()}}return this.internalState.needsRedraw=this.internalState.needsRedraw&&!i.clearRedrawFlags,a}},{key:"_onAsyncPropUpdated",value:function(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}}]),e}(dl);(0,vn.default)(ka,"defaultProps",zV);(0,vn.default)(ka,"layerName","Layer");var R2=h(B()),C2=h(U()),Iv=h(kt()),I2=h(ie()),L2=h(ae()),us=h(ne()),Lv=h(G());function Cv(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=UV(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function UV(t,r){if(t){if(typeof t=="string")return A2(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return A2(t,r)}}function A2(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function M2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function k2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?M2(Object(e),!0).forEach(function(n){(0,Lv.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):M2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function GV(t){var r=$V();return function(){var n=(0,us.default)(t),i;if(r){var a=(0,us.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,L2.default)(this,i)}}function $V(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var HV="compositeLayer.renderLayers",Dv=function(t){(0,I2.default)(e,t);var r=GV(e);function e(){return(0,R2.default)(this,e),r.apply(this,arguments)}return(0,C2.default)(e,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return(0,Iv.default)((0,us.default)(e.prototype),"isLoaded",this)&&this.getSubLayers().every(function(i){return i.isLoaded})}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(i){}},{key:"setState",value:function(i){(0,Iv.default)((0,us.default)(e.prototype),"setState",this).call(this,i),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(i){var a=i.info,o=a.object,s=o&&o.__source&&o.__source.parent&&o.__source.parent.id===this.id;return s&&(a.object=o.__source.object,a.index=o.__source.index),a}},{key:"filterSubLayer",value:function(i){return!0}},{key:"shouldRenderSubLayer",value:function(i,a){return a&&a.length}},{key:"getSubLayerClass",value:function(i,a){var o=this.props._subLayerProps;return o&&o[i]&&o[i].type||a}},{key:"getSubLayerRow",value:function(i,a,o){return i.__source={parent:this,object:a,index:o},i}},{key:"getSubLayerAccessor",value:function(i){if(typeof i=="function"){var a={index:-1,data:this.props.data,target:[]};return function(o,s){return o&&o.__source?(a.index=o.__source.index,i(o.__source.object,a)):i(o,s)}}return i}},{key:"getSubLayerProps",value:function(){var i,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,s=o.opacity,u=o.pickable,f=o.visible,l=o.parameters,c=o.getPolygonOffset,p=o.highlightedObjectIndex,d=o.autoHighlight,v=o.highlightColor,m=o.coordinateSystem,g=o.coordinateOrigin,_=o.wrapLongitude,x=o.positionFormat,w=o.modelMatrix,E=o.extensions,T=o.fetch,P=o.operation,A=o._subLayerProps,D={id:"",updateTriggers:{},opacity:s,pickable:u,visible:f,parameters:l,getPolygonOffset:c,highlightedObjectIndex:p,autoHighlight:d,highlightColor:v,coordinateSystem:m,coordinateOrigin:g,wrapLongitude:_,positionFormat:x,modelMatrix:w,extensions:E,fetch:T,operation:P},L=A&&a.id&&A[a.id],C=L&&L.updateTriggers,F=a.id||"sublayer";if(L){var j=this.props[er],z=a.type?a.type._propTypes:{};for(var N in L){var M=z[N]||j[N];M&&M.type==="accessor"&&(L[N]=this.getSubLayerAccessor(L[N]))}}Object.assign(D,a,L),D.id="".concat(this.props.id,"-").concat(F),D.updateTriggers=k2(k2({all:(i=this.props.updateTriggers)===null||i===void 0?void 0:i.all},a.updateTriggers),C);var k=Cv(E),R;try{for(k.s();!(R=k.n()).done;){var Y=R.value,V=Y.getSubLayerProps.call(this,Y);V&&Object.assign(D,V,{updateTriggers:Object.assign(D.updateTriggers,V.updateTriggers)})}}catch(Q){k.e(Q)}finally{k.f()}return D}},{key:"_updateAutoHighlight",value:function(i){var a=Cv(this.getSubLayers()),o;try{for(a.s();!(o=a.n()).done;){var s=o.value;s.updateAutoHighlight(i)}}catch(u){a.e(u)}finally{a.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_postUpdate",value:function(i,a){var o=this.internalState.subLayers,s=!o||this.needsUpdate();if(s){var u=this.renderLayers();o=Nn(u,Boolean),this.internalState.subLayers=o}Ke(HV,this,s,o);var f=Cv(o),l;try{for(f.s();!(l=f.n()).done;){var c=l.value;c.parent=this}}catch(p){f.e(p)}finally{f.f()}}}]),e}(ka);(0,Lv.default)(Dv,"layerName","CompositeLayer");var fs=h(Ue()),N2=h(B()),B2=h(U()),gl=h(we()),V2=h(ie()),z2=h(ae()),Fv=h(ne()),ls=h(G());function D2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function j2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?D2(Object(e),!0).forEach(function(n){(0,ls.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):D2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function WV(t){var r=YV();return function(){var n=(0,Fv.default)(t),i;if(r){var a=(0,Fv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,z2.default)(this,i)}}function YV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ml=Math.PI/180,F2=180/Math.PI,yl=6370972,Ra=256;function XV(){var t=Ra/yl,r=Math.PI/180*Ra;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[r,r,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/r,1/r,1/t]}}var _l=function(t){(0,V2.default)(e,t);var r=WV(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,N2.default)(this,e);var a=i.latitude,o=a===void 0?0:a,s=i.longitude,u=s===void 0?0:s,f=i.zoom,l=f===void 0?0:f,c=i.nearZMultiplier,p=c===void 0?.1:c,d=i.farZMultiplier,v=d===void 0?2:d,m=i.resolution,g=m===void 0?10:m,_=i.height,x=i.altitude,w=x===void 0?1.5:x;_=_||1,w=Math.max(.75,w);var E=new Ve().lookAt({eye:[0,-w,0],up:[0,0,1]}),T=Math.pow(2,l);E.rotateX(o*ml),E.rotateZ(-u*ml),E.scale(T/_);var P=Math.atan(.5/w),A=Ra*2*T/_;return n=r.call(this,j2(j2({},i),{},{height:_,viewMatrix:E,longitude:u,latitude:o,zoom:l,distanceScales:XV(),fovyRadians:P*2,focalDistance:w,near:p,far:Math.min(2,1/A+1)*w*v})),(0,ls.default)((0,gl.default)(n),"longitude",void 0),(0,ls.default)((0,gl.default)(n),"latitude",void 0),(0,ls.default)((0,gl.default)(n),"resolution",void 0),n.latitude=o,n.longitude=u,n.resolution=g,n}return(0,B2.default)(e,[{key:"projectionMode",get:function(){return xt.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a={targetZ:i.z||0},o=this.unproject([0,this.height/2],a),s=this.unproject([this.width/2,0],a),u=this.unproject([this.width,this.height/2],a),f=this.unproject([this.width/2,this.height],a);return u[0]<this.longitude&&(u[0]+=360),o[0]>this.longitude&&(o[0]-=360),[Math.min(o[0],u[0],s[0],f[0]),Math.min(o[1],u[1],s[1],f[1]),Math.max(o[0],u[0],s[0],f[0]),Math.max(o[1],u[1],s[1],f[1])]}},{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=a.targetZ,f=(0,fs.default)(i,3),l=f[0],c=f[1],p=f[2],d=s?c:this.height-c,v=this.pixelUnprojectionMatrix,m;if(Number.isFinite(p))m=jv(v,[l,d,p,1]);else{var g=jv(v,[l,d,-1,1]),_=jv(v,[l,d,1,1]),x=((u||0)/yl+1)*Ra,w=Of(Sf([],g,_)),E=Of(g),T=Of(_),P=(4*E*T-Math.pow(w-E-T,2))/16,A=4*P/w,D=Math.sqrt(E-A),L=Math.sqrt(Math.max(0,x*x-A)),C=(D-L)/Math.sqrt(w);m=iE([],g,_,C)}var F=this.unprojectPosition(m),j=(0,fs.default)(F,3),z=j[0],N=j[1],M=j[2];return Number.isFinite(p)?[z,N,M]:Number.isFinite(u)?[z,N,u]:[z,N]}},{key:"projectPosition",value:function(i){var a=(0,fs.default)(i,3),o=a[0],s=a[1],u=a[2],f=u===void 0?0:u,l=o*ml,c=s*ml,p=Math.cos(c),d=(f/yl+1)*Ra;return[Math.sin(l)*p*d,-Math.cos(l)*p*d,Math.sin(c)*d]}},{key:"unprojectPosition",value:function(i){var a=(0,fs.default)(i,3),o=a[0],s=a[1],u=a[2],f=aE(i),l=Math.asin(u/f),c=Math.atan2(o,-s),p=c*F2,d=l*F2,v=(f/Ra-1)*yl;return[p,d,v]}},{key:"projectFlat",value:function(i){return i}},{key:"unprojectFlat",value:function(i){return i}},{key:"panByPosition",value:function(i,a){var o=this.unproject(a);return{longitude:i[0]-o[0]+this.longitude,latitude:i[1]-o[1]+this.latitude}}}]),e}(gt);function jv(t,r){var e=pi([],r,t);return yT(e,e,1/e[3]),e}var Bv=h(Ue()),$2=h(B()),H2=h(U()),W2=h(we()),Y2=h(ie()),X2=h(ae()),Vv=h(ne()),zv=h(G());function U2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function G2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?U2(Object(e),!0).forEach(function(n){(0,zv.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):U2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function qV(t){var r=ZV();return function(){var n=(0,Vv.default)(t),i;if(r){var a=(0,Vv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,X2.default)(this,i)}}function ZV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Nv=Math.PI/180;function KV(t){var r=t.height,e=t.focalDistance,n=t.orbitAxis,i=t.rotationX,a=t.rotationOrbit,o=t.zoom,s=n==="Z"?[0,0,1]:[0,1,0],u=n==="Z"?[0,-e,0]:[0,0,e],f=new Ve().lookAt({eye:u,up:s});f.rotateX(i*Nv),n==="Z"?f.rotateZ(a*Nv):f.rotateY(a*Nv);var l=Math.pow(2,o)/r;return f.scale(l),f}var bl=function(t){(0,Y2.default)(e,t);var r=qV(e);function e(n){var i;(0,$2.default)(this,e);var a=n.height,o=n.projectionMatrix,s=n.fovy,u=s===void 0?50:s,f=n.orbitAxis,l=f===void 0?"Z":f,c=n.target,p=c===void 0?[0,0,0]:c,d=n.rotationX,v=d===void 0?0:d,m=n.rotationOrbit,g=m===void 0?0:m,_=n.zoom,x=_===void 0?0:_,w=o?o[5]/2:jn(u);return i=r.call(this,G2(G2({},n),{},{longitude:void 0,viewMatrix:KV({height:a||1,focalDistance:w,orbitAxis:l,rotationX:v,rotationOrbit:g,zoom:x}),fovy:u,focalDistance:w,position:p,zoom:x})),(0,zv.default)((0,W2.default)(i),"projectedCenter",void 0),i.projectedCenter=i.project(i.center),i}return(0,H2.default)(e,[{key:"unproject",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a.topLeft,s=o===void 0?!0:o,u=(0,Bv.default)(i,3),f=u[0],l=u[1],c=u[2],p=c===void 0?this.projectedCenter[2]:c,d=s?l:this.height-l,v=Rt([f,d,p],this.pixelUnprojectionMatrix),m=(0,Bv.default)(v,3),g=m[0],_=m[1],x=m[2];return[g,_,x]}},{key:"panByPosition",value:function(i,a){var o=this.project(i),s=[this.width/2+o[0]-a[0],this.height/2+o[1]-a[1],this.projectedCenter[2]];return{target:this.unproject(s)}}}]),e}(gt);var Uv=h(Ue()),K2=h(G()),Q2=h(B()),J2=h(U()),eM=h(ie()),tM=h(ae()),Gv=h(ne());function q2(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Z2(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?q2(Object(e),!0).forEach(function(n){(0,K2.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):q2(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function QV(t){var r=JV();return function(){var n=(0,Gv.default)(t),i;if(r){var a=(0,Gv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,tM.default)(this,i)}}function JV(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ez=new Ve().lookAt({eye:[0,0,1]});function tz(t){var r=t.width,e=t.height,n=t.near,i=t.far,a=t.padding,o=-r/2,s=r/2,u=-e/2,f=e/2;if(a){var l=a.left,c=l===void 0?0:l,p=a.right,d=p===void 0?0:p,v=a.top,m=v===void 0?0:v,g=a.bottom,_=g===void 0?0:g,x=Te((c+r-d)/2,0,r)-r/2,w=Te((m+e-_)/2,0,e)-e/2;o-=x,s-=x,u+=w,f+=w}return new Ve().ortho({left:o,right:s,bottom:u,top:f,near:n,far:i})}var wl=function(t){(0,eM.default)(e,t);var r=QV(e);function e(n){(0,Q2.default)(this,e);var i=n.width,a=n.height,o=n.near,s=o===void 0?.1:o,u=n.far,f=u===void 0?1e3:u,l=n.zoom,c=l===void 0?0:l,p=n.target,d=p===void 0?[0,0,0]:p,v=n.padding,m=v===void 0?null:v,g=n.flipY,_=g===void 0?!0:g,x=Array.isArray(c)?c[0]:c,w=Array.isArray(c)?c[1]:c,E=Math.min(x,w),T=Math.pow(2,E),P;if(x!==w){var A=Math.pow(2,x),D=Math.pow(2,w);P={unitsPerMeter:[A/T,D/T,1],metersPerUnit:[T/A,T/D,1]}}return r.call(this,Z2(Z2({},n),{},{longitude:void 0,position:d,viewMatrix:ez.clone().scale([T,T*(_?-1:1),T]),projectionMatrix:tz({width:i||1,height:a||1,padding:m,near:s,far:f}),zoom:E,distanceScales:P}))}return(0,J2.default)(e,[{key:"projectFlat",value:function(i){var a=(0,Uv.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.unitsPerMeter;return[o*u[0],s*u[1]]}},{key:"unprojectFlat",value:function(i){var a=(0,Uv.default)(i,2),o=a[0],s=a[1],u=this.distanceScales.metersPerUnit;return[o*u[0],s*u[1]]}},{key:"panByPosition",value:function(i,a){var o=Rt(a,this.pixelUnprojectionMatrix),s=this.projectFlat(i),u=ca([],s,Ef([],o)),f=ca([],this.center,u);return{target:this.unprojectFlat(f)}}}]),e}(gt);var iM=h(B()),$v=h(we()),aM=h(ie()),oM=h(ae()),Hv=h(ne()),xl=h(G());function rM(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function nM(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?rM(Object(e),!0).forEach(function(n){(0,xl.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):rM(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function rz(t){var r=nz();return function(){var n=(0,Hv.default)(t),i;if(r){var a=(0,Hv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,oM.default)(this,i)}}function nz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tl=function(t){(0,aM.default)(e,t);var r=rz(e);function e(n){var i;(0,iM.default)(this,e);var a=n.longitude,o=n.latitude,s=n.modelMatrix,u=n.bearing,f=u===void 0?0:u,l=n.pitch,c=l===void 0?0:l,p=n.up,d=p===void 0?[0,0,1]:p,v=new lo({bearing:f,pitch:c===-90?1e-4:90+c}),m=v.toVector3().normalize(),g=s?new Ve(s).transformAsVector(m):m,_=Number.isFinite(o)?No({latitude:o}):0,x=Math.pow(2,_),w=new Ve().lookAt({eye:[0,0,0],center:g,up:d}).scale(x);return i=r.call(this,nM(nM({},n),{},{zoom:_,viewMatrix:w})),(0,xl.default)((0,$v.default)(i),"longitude",void 0),(0,xl.default)((0,$v.default)(i),"latitude",void 0),i.latitude=o,i.longitude=a,i}return e}(gt);var cM=h(B()),hM=h(U()),pM=h(ie()),dM=h(ae()),Zv=h(ne()),vM=h(G());var Wv=h(we()),Pl=h(G()),Xv=h(B()),uM=h(U()),qv=h(ie()),fM=h(ae()),Yv=h(ne());function sM(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function El(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?sM(Object(e),!0).forEach(function(n){(0,Pl.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):sM(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function lM(t){var r=iz();return function(){var n=(0,Yv.default)(t),i;if(r){var a=(0,Yv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,fM.default)(this,i)}}function iz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var cs=20,az=function(t){(0,qv.default)(e,t);var r=lM(e);function e(n){(0,Xv.default)(this,e);var i=n.width,a=n.height,o=n.position,s=o===void 0?[0,0,0]:o,u=n.bearing,f=u===void 0?0:u,l=n.pitch,c=l===void 0?0:l,p=n.longitude,d=p===void 0?null:p,v=n.latitude,m=v===void 0?null:v,g=n.maxPitch,_=g===void 0?90:g,x=n.minPitch,w=x===void 0?-90:x,E=n.startRotatePos,T=n.startBearing,P=n.startPitch,A=n.startZoomPosition;return r.call(this,{width:i,height:a,position:s,bearing:f,pitch:c,longitude:d,latitude:m,maxPitch:_,minPitch:w},{startRotatePos:E,startBearing:T,startPitch:P,startZoomPosition:A})}return(0,uM.default)(e,[{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,l=this.getState(),c=l.startRotatePos,p=l.startBearing,d=l.startPitch,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var _;if(a){var x=(a[0]-c[0])/m,w=(a[1]-c[1])/g;_={bearing:p-x*180,pitch:d-w*90}}else _={bearing:p-s,pitch:d-f};return this._getUpdatedState(_)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}},{key:"zoom",value:function(i){var a=i.scale,o=this.getState(),s=o.startZoomPosition;s||(s=this.getViewportProps().position);var u=this.getDirection();return this._move(u,Math.log2(a)*cs,s)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cs,a=this.getDirection(!0);return this._move(a.rotateZ({radians:Math.PI/2}),i)}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cs,a=this.getDirection(!0);return this._move(a.rotateZ({radians:-Math.PI/2}),i)}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cs,a=this.getDirection(!0);return this._move(a,i)}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cs,a=this.getDirection(!0);return this._move(a.negate(),i)}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-i})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:i})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this.zoom({scale:1/i})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=El({},this.getViewportProps()),s=o.bearing,u=o.longitude;return Math.abs(s-a.bearing)>180&&(o.bearing=s<0?s+360:s-360),u!==null&&a.longitude!==null&&Math.abs(u-a.longitude)>180&&(o.longitude=u<0?u+360:u-360),o}},{key:"_move",value:function(i,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getViewportProps().position,s=i.scale(a);return this._getUpdatedState({position:new nt(o).add(s)})}},{key:"getDirection",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,a=new lo({bearing:this.getViewportProps().bearing,pitch:i?90:90+this.getViewportProps().pitch}),o=a.toVector3().normalize();return o}},{key:"_getUpdatedState",value:function(i){return new e(El(El(El({},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.pitch,o=i.maxPitch,s=i.minPitch,u=i.longitude,f=i.bearing;return i.pitch=Te(a,s,o),u!==null&&(u<-180||u>180)&&(i.longitude=yi(u+180,360)-180),(f<-180||f>180)&&(i.bearing=yi(f+180,360)-180),i}}]),e}(_a),Sl=function(t){(0,qv.default)(e,t);var r=lM(e);function e(){var n;(0,Xv.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Pl.default)((0,Wv.default)(n),"ControllerState",az),(0,Pl.default)((0,Wv.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Ct(["position","pitch","bearing"])}),n}return e}(rr);function oz(t){var r=sz();return function(){var n=(0,Zv.default)(t),i;if(r){var a=(0,Zv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,dM.default)(this,i)}}function sz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kv=function(t){(0,pM.default)(e,t);var r=oz(e);function e(){return(0,cM.default)(this,e),r.apply(this,arguments)}return(0,hM.default)(e,[{key:"ViewportType",get:function(){return Tl}},{key:"ControllerType",get:function(){return Sl}}]),e}(tr);(0,vM.default)(Kv,"displayName","FirstPersonView");var bM=h(B()),wM=h(U()),xM=h(ie()),TM=h(ae()),rm=h(ne()),EM=h(G());var Jv=h(B()),gM=h(U()),Ol=h(we()),em=h(ie()),yM=h(ae()),Qv=h(ne()),hs=h(G());function mM(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function Oi(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?mM(Object(e),!0).forEach(function(n){(0,hs.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):mM(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function _M(t){var r=uz();return function(){var n=(0,Qv.default)(t),i;if(r){var a=(0,Qv.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,yM.default)(this,i)}}function uz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var tm=function(t){(0,em.default)(e,t);var r=_M(e);function e(n){var i;(0,Jv.default)(this,e);var a=n.width,o=n.height,s=n.rotationX,u=s===void 0?0:s,f=n.rotationOrbit,l=f===void 0?0:f,c=n.target,p=c===void 0?[0,0,0]:c,d=n.zoom,v=d===void 0?0:d,m=n.minRotationX,g=m===void 0?-90:m,_=n.maxRotationX,x=_===void 0?90:_,w=n.minZoom,E=w===void 0?-1/0:w,T=n.maxZoom,P=T===void 0?1/0:T,A=n.startPanPosition,D=n.startRotatePos,L=n.startRotationX,C=n.startRotationOrbit,F=n.startZoomPosition,j=n.startZoom;return i=r.call(this,{width:a,height:o,rotationX:u,rotationOrbit:l,target:p,zoom:v,minRotationX:g,maxRotationX:x,minZoom:E,maxZoom:P},{startPanPosition:A,startRotatePos:D,startRotationX:L,startRotationOrbit:C,startZoomPosition:F,startZoom:j}),(0,hs.default)((0,Ol.default)(i),"makeViewport",void 0),i.makeViewport=n.makeViewport,i}return(0,gM.default)(e,[{key:"panStart",value:function(i){var a=i.pos;return this._getUpdatedState({startPanPosition:this._unproject(a)})}},{key:"pan",value:function(i){var a=i.pos,o=i.startPosition,s=this.getState().startPanPosition||o;if(!s)return this;var u=this.makeViewport(this.getViewportProps()),f=u.panByPosition(s,a);return this._getUpdatedState(f)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(i){var a=i.pos;return this._getUpdatedState({startRotatePos:a,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}},{key:"rotate",value:function(i){var a=i.pos,o=i.deltaAngleX,s=o===void 0?0:o,u=i.deltaAngleY,f=u===void 0?0:u,l=this.getState(),c=l.startRotatePos,p=l.startRotationX,d=l.startRotationOrbit,v=this.getViewportProps(),m=v.width,g=v.height;if(!c||p===void 0||d===void 0)return this;var _;if(a){var x=(a[0]-c[0])/m,w=(a[1]-c[1])/g;(p<-90||p>90)&&(x*=-1),_={rotationX:p+w*180,rotationOrbit:d+x*180}}else _={rotationX:p+f,rotationOrbit:d+s};return this._getUpdatedState(_)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(i){var a=i.getViewportProps(),o=Oi({},this.getViewportProps()),s=o.rotationOrbit;return Math.abs(s-a.rotationOrbit)>180&&(o.rotationOrbit=s<0?s+360:s-360),o}},{key:"zoomStart",value:function(i){var a=i.pos;return this._getUpdatedState({startZoomPosition:this._unproject(a),startZoom:this.getViewportProps().zoom})}},{key:"zoom",value:function(i){var a=i.pos,o=i.startPos,s=i.scale,u=this.getState(),f=u.startZoom,l=u.startZoomPosition;if(l||(f=this.getViewportProps().zoom,l=this._unproject(o)||this._unproject(a)),!l)return this;var c=this._calculateNewZoom({scale:s,startZoom:f}),p=this.makeViewport(Oi(Oi({},this.getViewportProps()),{},{zoom:c}));return this._getUpdatedState(Oi({zoom:c},p.panByPosition(l,a)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:i})})}},{key:"zoomOut",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/i})})}},{key:"moveLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-i,0])}},{key:"moveRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([i,0])}},{key:"moveUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-i])}},{key:"moveDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,i])}},{key:"rotateLeft",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-i})}},{key:"rotateRight",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+i})}},{key:"rotateUp",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-i})}},{key:"rotateDown",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+i})}},{key:"_unproject",value:function(i){var a=this.makeViewport(this.getViewportProps());return i&&a.unproject(i)}},{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,f=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var l=o+Math.log2(a);return Te(l,f,u)}},{key:"_panFromCenter",value:function(i){var a=this.getViewportProps(),o=a.width,s=a.height,u=a.target;return this.pan({startPosition:u,pos:[o/2+i[0],s/2+i[1]]})}},{key:"_getUpdatedState",value:function(i){return new this.constructor(Oi(Oi(Oi({makeViewport:this.makeViewport},this.getViewportProps()),this.getState()),i))}},{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom,u=i.maxRotationX,f=i.minRotationX,l=i.rotationOrbit;return i.zoom=Array.isArray(s)?[Te(s[0],o,a),Te(s[1],o,a)]:Te(s,o,a),i.rotationX=Te(i.rotationX,f,u),(l<-180||l>180)&&(i.rotationOrbit=yi(l+180,360)-180),i}}]),e}(_a),Al=function(t){(0,em.default)(e,t);var r=_M(e);function e(){var n;(0,Jv.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,hs.default)((0,Ol.default)(n),"ControllerState",tm),(0,hs.default)((0,Ol.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Ct({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}),n}return e}(rr);function fz(t){var r=lz();return function(){var n=(0,rm.default)(t),i;if(r){var a=(0,rm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,TM.default)(this,i)}}function lz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var nm=function(t){(0,xM.default)(e,t);var r=fz(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,bM.default)(this,e),n=r.call(this,i),n.props.orbitAxis=i.orbitAxis||"Z",n}return(0,wM.default)(e,[{key:"ViewportType",get:function(){return bl}},{key:"ControllerType",get:function(){return Al}}]),e}(tr);(0,EM.default)(nm,"displayName","OrbitView");var AM=h(B()),MM=h(U()),kM=h(ie()),RM=h(ae()),um=h(ne()),CM=h(G());var PM=h(Ue()),am=h(B()),om=h(U()),ps=h(we()),sm=h(ie()),SM=h(ae()),im=h(ne()),ds=h(G());function OM(t){var r=cz();return function(){var n=(0,im.default)(t),i;if(r){var a=(0,im.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,SM.default)(this,i)}}function cz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var hz=function(t){(0,sm.default)(e,t);var r=OM(e);function e(n){var i;return(0,am.default)(this,e),i=r.call(this,n),(0,ds.default)((0,ps.default)(i),"zoomAxis",void 0),i.zoomAxis=n.zoomAxis||"all",i}return(0,om.default)(e,[{key:"_calculateNewZoom",value:function(i){var a=i.scale,o=i.startZoom,s=this.getViewportProps(),u=s.maxZoom,f=s.minZoom;o===void 0&&(o=this.getViewportProps().zoom);var l=Math.log2(a);if(Array.isArray(o)){var c=o,p=(0,PM.default)(c,2),d=p[0],v=p[1];switch(this.zoomAxis){case"X":d=Te(d+l,f,u);break;case"Y":v=Te(v+l,f,u);break;default:var m=Math.min(d+l,v+l);m<f&&(l+=f-m),m=Math.max(d+l,v+l),m>u&&(l+=u-m),d+=l,v+=l}return[d,v]}return Te(o+l,f,u)}}]),e}(tm),Ml=function(t){(0,sm.default)(e,t);var r=OM(e);function e(){var n;(0,am.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,ds.default)((0,ps.default)(n),"ControllerState",hz),(0,ds.default)((0,ps.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Ct(["target","zoom"])}),(0,ds.default)((0,ps.default)(n),"dragMode","pan"),n}return(0,om.default)(e,[{key:"_onPanRotate",value:function(){return!1}}]),e}(rr);function pz(t){var r=dz();return function(){var n=(0,um.default)(t),i;if(r){var a=(0,um.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,RM.default)(this,i)}}function dz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var fm=function(t){(0,kM.default)(e,t);var r=pz(e);function e(){return(0,AM.default)(this,e),r.apply(this,arguments)}return(0,MM.default)(e,[{key:"ViewportType",get:function(){return wl}},{key:"ControllerType",get:function(){return Ml}}]),e}(tr);(0,CM.default)(fm,"displayName","OrthographicView");var jM=h(B()),FM=h(U()),NM=h(ie()),BM=h(ae()),pm=h(ne()),VM=h(G());var kl=h(we()),IM=h(kt()),Rl=h(G()),lm=h(B()),cm=h(U()),hm=h(ie()),LM=h(ae()),Cl=h(ne());function DM(t){var r=vz();return function(){var n=(0,Cl.default)(t),i;if(r){var a=(0,Cl.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,LM.default)(this,i)}}function vz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var mz=function(t){(0,hm.default)(e,t);var r=DM(e);function e(){return(0,lm.default)(this,e),r.apply(this,arguments)}return(0,cm.default)(e,[{key:"applyConstraints",value:function(i){var a=i.maxZoom,o=i.minZoom,s=i.zoom;i.zoom=Te(s,o,a);var u=i.longitude,f=i.latitude;return(u<-180||u>180)&&(i.longitude=yi(u+180,360)-180),i.latitude=Te(f,-89,89),i}}]),e}(qd),Il=function(t){(0,hm.default)(e,t);var r=DM(e);function e(){var n;(0,lm.default)(this,e);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),(0,Rl.default)((0,kl.default)(n),"ControllerState",mz),(0,Rl.default)((0,kl.default)(n),"transition",{transitionDuration:300,transitionInterpolator:new Ct(["longitude","latitude","zoom"])}),(0,Rl.default)((0,kl.default)(n),"dragMode","pan"),n}return(0,cm.default)(e,[{key:"setProps",value:function(i){(0,IM.default)((0,Cl.default)(e.prototype),"setProps",this).call(this,i),this.dragRotate=!1,this.touchRotate=!1}}]),e}(rr);function gz(t){var r=yz();return function(){var n=(0,pm.default)(t),i;if(r){var a=(0,pm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,BM.default)(this,i)}}function yz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var dm=function(t){(0,NM.default)(e,t);var r=gz(e);function e(){return(0,jM.default)(this,e),r.apply(this,arguments)}return(0,FM.default)(e,[{key:"ViewportType",get:function(){return _l}},{key:"ControllerType",get:function(){return Il}}]),e}(tr);(0,VM.default)(dm,"displayName","GlobeView");var zM=h(B()),UM=h(U()),Ll=h(G());var Dl=function(){function t(r){(0,zM.default)(this,t),(0,Ll.default)(this,"opts",void 0),r&&(this.opts=r)}return(0,UM.default)(t,[{key:"equals",value:function(e){return this===e?!0:this.constructor===e.constructor&&st(this.opts,e.opts,1)}},{key:"getShaders",value:function(e){return null}},{key:"getSubLayerProps",value:function(e){var n=e.constructor,i=n.defaultProps,a={updateTriggers:{}};for(var o in i)if(o in this.props){var s=i[o],u=this.props[o];a[o]=u,s&&s.type==="accessor"&&(a.updateTriggers[o]=this.props.updateTriggers[o],typeof u=="function"&&(a[o]=this.getSubLayerAccessor(u)))}return a}},{key:"initializeState",value:function(e,n){}},{key:"updateState",value:function(e,n){}},{key:"onNeedsRedraw",value:function(e){}},{key:"getNeedsPickingBuffer",value:function(e){return!1}},{key:"draw",value:function(e,n){}},{key:"finalizeState",value:function(e,n){}}],[{key:"componentName",get:function(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}}]),t}();(0,Ll.default)(Dl,"defaultProps",{});(0,Ll.default)(Dl,"extensionName","LayerExtension");var WM=h(B()),YM=h(U()),XM=h(we()),qM=h(ie()),ZM=h(ae()),vm=h(ne()),mm=h(G());function _z(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=bz(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function bz(t,r){if(t){if(typeof t=="string")return GM(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return GM(t,r)}}function GM(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function $M(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function HM(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?$M(Object(e),!0).forEach(function(n){(0,mm.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):$M(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function wz(t){var r=xz();return function(){var n=(0,vm.default)(t),i;if(r){var a=(0,vm.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,ZM.default)(this,i)}}function xz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Tz=["bearing","pitch"],Ez={speed:1.2,curve:1.414},KM=function(t){(0,qM.default)(e,t);var r=wz(e);function e(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,WM.default)(this,e),n=r.call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]}),(0,mm.default)((0,XM.default)(n),"opts",void 0),n.opts=HM(HM({},Ez),i),n}return(0,YM.default)(e,[{key:"interpolateProps",value:function(i,a,o){var s=xf(i,a,o,this.opts),u=_z(Tz),f;try{for(u.s();!(f=u.n()).done;){var l=f.value;s[l]=nn(i[l]||0,a[l]||0,o)}}catch(c){u.e(c)}finally{u.f()}return s}},{key:"getDuration",value:function(i,a){var o=a.transitionDuration;return o==="auto"&&(o=Ad(i,a,this.opts)),o}}]),e}(ga);var ek=h(B()),tk=h(U()),At=h(G());function QM(t,r){var e=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=Pz(t))||r&&t&&typeof t.length=="number"){e&&(t=e);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(f){throw f},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){e=e.call(t)},n:function(){var f=e.next();return a=f.done,f},e:function(f){o=!0,s=f},f:function(){try{!a&&e.return!=null&&e.return()}finally{if(o)throw s}}}}function Pz(t,r){if(t){if(typeof t=="string")return JM(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);if(e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set")return Array.from(t);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return JM(t,r)}}function JM(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}var rk=function(){function t(r){(0,ek.default)(this,t),(0,At.default)(this,"opts",void 0),(0,At.default)(this,"typedArrayManager",void 0),(0,At.default)(this,"indexStarts",[0]),(0,At.default)(this,"vertexStarts",[0]),(0,At.default)(this,"vertexCount",0),(0,At.default)(this,"instanceCount",0),(0,At.default)(this,"attributes",void 0),(0,At.default)(this,"_attributeDefs",void 0),(0,At.default)(this,"data",void 0),(0,At.default)(this,"getGeometry",void 0),(0,At.default)(this,"geometryBuffer",void 0),(0,At.default)(this,"buffers",void 0),(0,At.default)(this,"positionSize",void 0),(0,At.default)(this,"normalize",void 0);var e=r.attributes,n=e===void 0?{}:e;this.typedArrayManager=mr,this.attributes={},this._attributeDefs=n,this.opts=r,this.updateGeometry(r)}return(0,tk.default)(t,[{key:"updateGeometry",value:function(e){Object.assign(this.opts,e);var n=this.opts,i=n.data,a=n.buffers,o=a===void 0?{}:a,s=n.getGeometry,u=n.geometryBuffer,f=n.positionFormat,l=n.dataChanged,c=n.normalize,p=c===void 0?!0:c;if(this.data=i,this.getGeometry=s,this.positionSize=u&&u.size||(f==="XY"?2:3),this.buffers=o,this.normalize=p,u&&(ke(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(u),p||(o.positions=u)),this.geometryBuffer=o.positions,Array.isArray(l)){var d=QM(l),v;try{for(d.s();!(v=d.n()).done;){var m=v.value;this._rebuildGeometry(m)}}catch(g){d.e(g)}finally{d.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(e){var n=e.startRow,i=e.endRow;this._rebuildGeometry({startRow:n,endRow:i})}},{key:"getGeometryFromBuffer",value:function(e){var n=e.value||e;return ArrayBuffer.isView(n)?el(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}},{key:"_allocate",value:function(e,n){var i=this.attributes,a=this.buffers,o=this._attributeDefs,s=this.typedArrayManager;for(var u in o)if(u in a)s.release(i[u]),i[u]=null;else{var f=o[u];f.copy=n,i[u]=s.allocate(i[u],e,f)}}},{key:"_forEachGeometry",value:function(e,n,i){var a=this.data,o=this.getGeometry,s=Ea(a,n,i),u=s.iterable,f=s.objectInfo,l=QM(u),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;f.index++;var d=o?o(p,f):null;e(d,f.index)}}catch(v){l.e(v)}finally{l.f()}}},{key:"_rebuildGeometry",value:function(e){var n=this;if(this.data){var i=this.indexStarts,a=this.vertexStarts,o=this.instanceCount,s=this.data,u=this.geometryBuffer,f=e||{},l=f.startRow,c=l===void 0?0:l,p=f.endRow,d=p===void 0?1/0:p,v={};if(e||(i=[0],a=[0]),this.normalize||!u)this._forEachGeometry(function(E,T){var P=E&&n.normalizeGeometry(E);v[T]=P,a[T+1]=a[T]+(P?n.getGeometrySize(P):0)},c,d),o=a[a.length-1];else if(a=s.startIndices,o=a[s.length]||0,ArrayBuffer.isView(u))o=o||u.length/this.positionSize;else if(u instanceof se){var m=u.accessor.stride||this.positionSize*4;o=o||u.byteLength/m}else if(u.buffer){var g=u.stride||this.positionSize*4;o=o||u.buffer.byteLength/g}else if(u.value){var _=u.value,x=u.stride/_.BYTES_PER_ELEMENT||this.positionSize;o=o||_.length/x}this._allocate(o,Boolean(e)),this.indexStarts=i,this.vertexStarts=a,this.instanceCount=o;var w={};this._forEachGeometry(function(E,T){var P=v[T]||E;w.vertexStart=a[T],w.indexStart=i[T];var A=T<a.length-1?a[T+1]:o;w.geometrySize=A-a[T],w.geometryIndex=T,n.updateGeometryAttributes(P,w)},c,d),this.vertexCount=i[i.length-1]}}}]),t}();var mk=h(B()),gk=h(U()),yk=h(we()),Fl=h(kt()),_k=h(ie()),bk=h(ae()),Ia=h(ne()),bm=h(G());function gm(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function nk(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ym(t,r,e){return r&&nk(t.prototype,r),e&&nk(t,e),t}var Le=h(ck());var aoe=typeof window<"u"?window:global;var Ai=typeof document<"u"?document:{};function Az(){}function Mz(t){t&&console.error(t.error)}var pk={container:Le.default.object,gl:Le.default.object,mapboxApiAccessToken:Le.default.string,mapboxApiUrl:Le.default.string,attributionControl:Le.default.bool,preserveDrawingBuffer:Le.default.bool,reuseMaps:Le.default.bool,transformRequest:Le.default.func,mapOptions:Le.default.object,mapStyle:Le.default.oneOfType([Le.default.string,Le.default.object]),visible:Le.default.bool,asyncRender:Le.default.bool,onLoad:Le.default.func,onError:Le.default.func,width:Le.default.number,height:Le.default.number,viewState:Le.default.object,longitude:Le.default.number,latitude:Le.default.number,zoom:Le.default.number,bearing:Le.default.number,pitch:Le.default.number,altitude:Le.default.number},jl={container:Ai.body,mapboxApiAccessToken:kz(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:Az,onError:Mz,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function kz(){var t=null;if(typeof window<"u"&&window.location){var r=window.location.search.match(/access_token=([^&\/]*)/);t=r&&r[1]}return!t&&typeof process<"u"&&(t=t||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}function hk(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";t.debug&&Le.default.checkPropTypes(pk,t,"prop",r)}var Ca=function(){function t(r){var e=this;if(gm(this,t),X(this,"mapboxgl",void 0),X(this,"props",jl),X(this,"_map",null),X(this,"width",0),X(this,"height",0),X(this,"_fireLoadEvent",function(){e.props.onLoad({type:"load",target:e._map})}),!r.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=r.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(r)}return ym(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(e){return this._update(this.props,e),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var n=this._map.getContainer(),i=e.container;for(i.classList.add("mapboxgl-map");n.childNodes.length>0;)i.appendChild(n.childNodes[0]);this._map._container=i,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var n=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=n,e.gl}}var i={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(i.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},i,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(e){var n=this;e=Object.assign({},jl,e),hk(e,"Mapbox"),this.mapboxgl.accessToken=e.mapboxApiAccessToken||jl.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=e.mapboxApiUrl,this._create(e);var i=e,a=i.container;Object.defineProperty(a,"offsetWidth",{get:function(){return n.width}}),Object.defineProperty(a,"clientWidth",{get:function(){return n.width}}),Object.defineProperty(a,"offsetHeight",{get:function(){return n.height}}),Object.defineProperty(a,"clientHeight",{get:function(){return n.height}});var o=this._map.getCanvas();o&&(o.style.outline="none"),this._updateMapViewport({},e),this._updateMapSize({},e),this.props=e}},{key:"_update",value:function(e,n){if(this._map){n=Object.assign({},this.props,n),hk(n,"Mapbox");var i=this._updateMapViewport(e,n),a=this._updateMapSize(e,n);!n.asyncRender&&(i||a)&&this.redraw(),this.props=n}}},{key:"_updateMapSize",value:function(e,n){var i=e.width!==n.width||e.height!==n.height;return i&&(this.width=n.width,this.height=n.height,this.resize()),i}},{key:"_updateMapViewport",value:function(e,n){var i=this._getViewState(e),a=this._getViewState(n),o=a.latitude!==i.latitude||a.longitude!==i.longitude||a.zoom!==i.zoom||a.pitch!==i.pitch||a.bearing!==i.bearing||a.altitude!==i.altitude;return o&&(this._map.jumpTo(this._viewStateToMapboxProps(a)),a.altitude!==i.altitude&&(this._map.transform.altitude=a.altitude)),o}},{key:"_getViewState",value:function(e){var n=e.viewState||e,i=n.longitude,a=n.latitude,o=n.zoom,s=n.pitch,u=s===void 0?0:s,f=n.bearing,l=f===void 0?0:f,c=n.altitude,p=c===void 0?1.5:c;return{longitude:i,latitude:a,zoom:o,pitch:u,bearing:l,altitude:p}}},{key:"_checkStyleSheet",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ai>"u"))try{var n=Ai.createElement("div");n.className="mapboxgl-map",n.style.display="none",Ai.body.append(n);var i=window.getComputedStyle(n).position!=="static";if(!i){var a=Ai.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(e,"/mapbox-gl.css")),Ai.head.append(a)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}}}]),t}();X(Ca,"initialized",!1);X(Ca,"propTypes",pk);X(Ca,"defaultProps",jl);X(Ca,"savedMap",null);function dk(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,n)}return e}function _m(t){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?dk(Object(e),!0).forEach(function(n){(0,bm.default)(t,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):dk(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}return t}function Rz(t){var r=Cz();return function(){var n=(0,Ia.default)(t),i;if(r){var a=(0,Ia.default)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,bk.default)(this,i)}}function Cz(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var vk={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function Iz(t){var r=t.container,e=r===void 0?document.body:r;if(typeof e=="string"&&(e=document.getElementById(e)),!e)throw Error("Deck: container not found");var n=window.getComputedStyle(e);n.position==="static"&&(e.style.position="relative");var i=document.createElement("div");e.appendChild(i),Object.assign(i.style,vk);var a=document.createElement("canvas");return e.appendChild(a),Object.assign(a.style,vk),{container:e,mapCanvas:i,deckCanvas:a}}var wk=function(t){(0,_k.default)(e,t);var r=Rz(e);function e(n){var i;if((0,mk.default)(this,e),typeof document>"u")throw Error("Deck can only be used in the browser");var a=Iz(n),o=a.mapCanvas,s=a.deckCanvas,u=n.viewState||n.initialViewState,f=Number.isFinite(u&&u.latitude),l=n.map,c=l===void 0?globalThis.mapboxgl||globalThis.maplibregl:l;return i=r.call(this,_m({canvas:s},n)),(0,bm.default)((0,yk.default)(i),"_map",void 0),c&&c.Map?i._map=f&&new Ca(_m(_m({},n),{},{viewState:u,container:o,mapboxgl:c})):i._map=c,i}return(0,gk.default)(e,[{key:"getMapboxMap",value:function(){return this._map&&this._map.getMap()}},{key:"finalize",value:function(){this._map&&this._map.finalize(),(0,Fl.default)((0,Ia.default)(e.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(i){"mapStyle"in i&&this._map&&this._map._map.setStyle(i.mapStyle),(0,Fl.default)((0,Ia.default)(e.prototype),"setProps",this).call(this,i)}},{key:"_drawLayers",value:function(i,a){if(this._map){var o=this.getViewports()[0];this._map.setProps({width:o.width,height:o.height,viewState:o})}(0,Fl.default)((0,Ia.default)(e.prototype),"_drawLayers",this).call(this,i,a)}}]),e}(Ta);globalThis.luma=globalThis.luma||{};globalThis.loaders=globalThis.loaders||{};Object.assign(globalThis.luma,jh);Object.assign(globalThis.loaders,Gp);return qk(Lz);})();
      return __exports__;
      });
