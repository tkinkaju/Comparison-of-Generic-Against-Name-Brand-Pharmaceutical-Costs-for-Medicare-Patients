{"version":3,"sources":["../../../src/classes/renderbuffer.js"],"names":["isFormatSupported","gl","format","formats","info","value","gl2","gl1","getExtension","Renderbuffer","opts","initialize","Object","seal","width","height","samples","_trackDeallocatedMemory","bindRenderbuffer","handle","renderbufferStorageMultisample","renderbufferStorage","_trackAllocatedMemory","RENDERBUFFER_FORMATS","bpp","createRenderbuffer","deleteRenderbuffer","getParameter","pname","getRenderbufferParameter","getInternalformatParameter","Resource","Symbol","toStringTag"],"mappings":"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","sourcesContent":["/* eslint-disable no-inline-comments */\nimport GL from '@luma.gl/constants';\nimport Resource from './resource';\nimport RENDERBUFFER_FORMATS from './renderbuffer-formats';\nimport {isWebGL2} from '@luma.gl/gltools';\nimport {assert} from '../utils/assert';\n\nfunction isFormatSupported(gl, format, formats) {\n  const info = formats[format];\n  if (!info) {\n    return false;\n  }\n  const value = isWebGL2(gl) ? info.gl2 || info.gl1 : info.gl1;\n  if (typeof value === 'string') {\n    return gl.getExtension(value);\n  }\n  return value;\n}\n\nexport default class Renderbuffer extends Resource {\n  // eslint-disable-next-line accessor-pairs\n  get [Symbol.toStringTag]() {\n    return 'Renderbuffer';\n  }\n  static isSupported(gl, {format} = {format: null}) {\n    return !format || isFormatSupported(gl, format, RENDERBUFFER_FORMATS);\n  }\n\n  static getSamplesForFormat(gl, {format}) {\n    // Polyfilled to return [0] under WebGL1\n    return gl.getInternalformatParameter(GL.RENDERBUFFER, format, GL.SAMPLES);\n  }\n\n  constructor(gl, opts = {}) {\n    super(gl, opts);\n\n    // @ts-ignore\n    this.initialize(opts);\n\n    Object.seal(this);\n  }\n\n  // Creates and initializes a renderbuffer object's data store\n  initialize({format, width = 1, height = 1, samples = 0}) {\n    assert(format, 'Needs format');\n\n    this._trackDeallocatedMemory();\n\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, this.handle);\n\n    if (samples !== 0 && isWebGL2(this.gl)) {\n      // @ts-ignore\n      this.gl.renderbufferStorageMultisample(GL.RENDERBUFFER, samples, format, width, height);\n    } else {\n      this.gl.renderbufferStorage(GL.RENDERBUFFER, format, width, height);\n    }\n\n    // this.gl.bindRenderbuffer(GL.RENDERBUFFER, null);\n\n    this.format = format;\n    this.width = width;\n    this.height = height;\n    this.samples = samples;\n\n    this._trackAllocatedMemory(\n      this.width * this.height * (this.samples || 1) * RENDERBUFFER_FORMATS[this.format].bpp\n    );\n\n    return this;\n  }\n\n  resize({width, height}) {\n    // Don't resize if width/height haven't changed\n    if (width !== this.width || height !== this.height) {\n      return this.initialize({width, height, format: this.format, samples: this.samples});\n    }\n    return this;\n  }\n\n  // PRIVATE METHODS\n  _createHandle() {\n    return this.gl.createRenderbuffer();\n  }\n\n  _deleteHandle() {\n    this.gl.deleteRenderbuffer(this.handle);\n    this._trackDeallocatedMemory();\n  }\n\n  _bindHandle(handle) {\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, handle);\n  }\n\n  _syncHandle(handle) {\n    this.format = this.getParameter(GL.RENDERBUFFER_INTERNAL_FORMAT);\n    this.width = this.getParameter(GL.RENDERBUFFER_WIDTH);\n    this.height = this.getParameter(GL.RENDERBUFFER_HEIGHT);\n    this.samples = this.getParameter(GL.RENDERBUFFER_SAMPLES);\n  }\n\n  // @param {Boolean} opt.autobind=true - method call will bind/unbind object\n  // @returns {GLenum|GLint} - depends on pname\n  _getParameter(pname) {\n    this.gl.bindRenderbuffer(GL.RENDERBUFFER, this.handle);\n    const value = this.gl.getRenderbufferParameter(GL.RENDERBUFFER, pname);\n    // this.gl.bindRenderbuffer(GL.RENDERBUFFER, null);\n    return value;\n  }\n}\n"],"file":"renderbuffer.js"}