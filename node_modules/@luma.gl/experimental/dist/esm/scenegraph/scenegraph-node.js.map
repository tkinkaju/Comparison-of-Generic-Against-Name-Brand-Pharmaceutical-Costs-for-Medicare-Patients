{"version":3,"sources":["../../../src/scenegraph/scenegraph-node.js"],"names":["Vector3","Matrix4","assert","uid","ScenegraphNode","constructor","props","id","name","display","position","rotation","scale","matrix","userData","_setScenegraphNodeProps","delete","setProps","toString","getBounds","setPosition","length","setRotation","setScale","setMatrix","copyMatrix","copy","setMatrixComponents","update","updateMatrix","pos","rot","identity","translate","rotateXYZ","options","getCoordinateUniforms","viewMatrix","modelMatrix","worldMatrix","multiplyRight","worldInverse","invert","worldInverseTranspose","transpose","objectMatrix","worldInverseMatrix","worldInverseTransposeMatrix","Object","assign"],"mappings":"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","sourcesContent":["import {Vector3, Matrix4} from '@math.gl/core';\nimport {assert, uid} from '@luma.gl/webgl';\n\nexport default class ScenegraphNode {\n  constructor(props = {}) {\n    const {id} = props;\n\n    this.id = id || uid(this.constructor.name);\n\n    this.display = true; // whether to display the object at all\n    this.position = new Vector3();\n    this.rotation = new Vector3();\n    this.scale = new Vector3(1, 1, 1);\n    this.matrix = new Matrix4();\n    this.userData = {};\n\n    this.props = {};\n    this._setScenegraphNodeProps(props);\n  }\n\n  delete() {}\n\n  setProps(props) {\n    this._setScenegraphNodeProps(props);\n    return this;\n  }\n\n  toString() {\n    return `{type: ScenegraphNode, id: ${this.id})}`;\n  }\n\n  getBounds() {\n    return null;\n  }\n\n  setPosition(position) {\n    assert(position.length === 3, 'setPosition requires vector argument');\n    this.position = position;\n    return this;\n  }\n\n  setRotation(rotation) {\n    assert(rotation.length === 3, 'setRotation requires vector argument');\n    this.rotation = rotation;\n    return this;\n  }\n\n  setScale(scale) {\n    assert(scale.length === 3, 'setScale requires vector argument');\n    this.scale = scale;\n    return this;\n  }\n\n  setMatrix(matrix, copyMatrix = true) {\n    if (copyMatrix) {\n      this.matrix.copy(matrix);\n    } else {\n      this.matrix = matrix;\n    }\n  }\n\n  setMatrixComponents({position, rotation, scale, update = true}) {\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    if (update) {\n      this.updateMatrix();\n    }\n    return this;\n  }\n\n  updateMatrix() {\n    const pos = this.position;\n    const rot = this.rotation;\n    const scale = this.scale;\n\n    this.matrix.identity();\n    this.matrix.translate(pos);\n    this.matrix.rotateXYZ(rot);\n    this.matrix.scale(scale);\n    return this;\n  }\n\n  update(options = {}) {\n    const {position, rotation, scale} = options;\n    if (position) {\n      this.setPosition(position);\n    }\n    if (rotation) {\n      this.setRotation(rotation);\n    }\n    if (scale) {\n      this.setScale(scale);\n    }\n    this.updateMatrix();\n    return this;\n  }\n\n  getCoordinateUniforms(viewMatrix, modelMatrix) {\n    // TODO - solve multiple class problem\n    // assert(viewMatrix instanceof Matrix4);\n    assert(viewMatrix);\n    modelMatrix = modelMatrix || this.matrix;\n    const worldMatrix = new Matrix4(viewMatrix).multiplyRight(modelMatrix);\n    const worldInverse = worldMatrix.invert();\n    const worldInverseTranspose = worldInverse.transpose();\n\n    return {\n      viewMatrix,\n      modelMatrix,\n      objectMatrix: modelMatrix,\n      worldMatrix,\n      worldInverseMatrix: worldInverse,\n      worldInverseTransposeMatrix: worldInverseTranspose\n    };\n  }\n\n  // TODO - copied code, not yet vetted\n  /*\n  transform() {\n    if (!this.parent) {\n      this.endPosition.set(this.position);\n      this.endRotation.set(this.rotation);\n      this.endScale.set(this.scale);\n    } else {\n      const parent = this.parent;\n      this.endPosition.set(this.position.add(parent.endPosition));\n      this.endRotation.set(this.rotation.add(parent.endRotation));\n      this.endScale.set(this.scale.add(parent.endScale));\n    }\n\n    const ch = this.children;\n    for (let i = 0; i < ch.length; ++i) {\n      ch[i].transform();\n    }\n\n    return this;\n  }\n  */\n\n  _setScenegraphNodeProps(props) {\n    if ('display' in props) {\n      this.display = props.display;\n    }\n\n    if ('position' in props) {\n      this.setPosition(props.position);\n    }\n    if ('rotation' in props) {\n      this.setRotation(props.rotation);\n    }\n    if ('scale' in props) {\n      this.setScale(props.scale);\n    }\n\n    // Matrix overwrites other props\n    if ('matrix' in props) {\n      this.setMatrix(props.matrix);\n    }\n\n    Object.assign(this.props, props);\n  }\n}\n"],"file":"scenegraph-node.js"}