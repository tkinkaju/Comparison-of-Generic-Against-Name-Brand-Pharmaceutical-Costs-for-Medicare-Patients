// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = MapPopoverFactory;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _layerHoverInfo = _interopRequireDefault(require("./layer-hover-info"));

var _coordinateInfo = _interopRequireDefault(require("./coordinate-info"));

var _icons = require("../common/icons");

var _reactIntl = require("react-intl");

var _localization = require("@kepler.gl/localization");

var _headless = _interopRequireDefault(require("@tippyjs/react/headless"));

var _ = require("../");

var _templateObject, _templateObject2, _templateObject3, _templateObject4;

var MAX_WIDTH = 500;
var MAX_HEIGHT = 600;

var StyledMapPopover = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  max-width: ", "px;\n  max-height: ", "px;\n  padding: 14px;\n  & > * + * {\n    margin-top: 6px;\n  }\n  ", ";\n  font-family: ", ";\n  font-size: 11px;\n  font-weight: 500;\n  background-color: ", ";\n  color: ", ";\n  z-index: 1000;\n  overflow-x: auto;\n  box-shadow: ", ";\n\n  :hover {\n    background-color: ", ";\n  }\n\n  .primary-label {\n    color: ", ";\n    font-size: 10px;\n  }\n\n  .map-popover__layer-info,\n  .coordingate-hover-info {\n    & > * + * {\n      margin-top: 7px;\n    }\n  }\n\n  table {\n    width: auto;\n    display: grid;\n    border-collapse: collapse;\n    row-gap: 5px;\n    column-gap: 5px;\n  }\n\n  .coordingate-hover-info > table {\n    grid-template-columns: auto auto auto;\n  }\n  .map-popover__layer-info > table {\n    grid-template-columns: auto auto;\n  }\n\n  tbody,\n  tr {\n    display: contents;\n  }\n\n  td {\n    border-color: transparent;\n    color: ", ";\n  }\n\n  td.row__value {\n    text-align: right;\n    font-weight: 500;\n    color: ", ";\n  }\n"])), MAX_WIDTH, MAX_HEIGHT, function (props) {
  return props.theme.scrollBar;
}, function (props) {
  return props.theme.fontFamily;
}, function (props) {
  return props.theme.panelBackground;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.panelBoxShadow;
}, function (props) {
  return "".concat(props.theme.panelBackground, "dd");
}, function (props) {
  return props.theme.notificationColors.success;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.textColorHl;
});

var PinnedButtons = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  align-self: center;\n  align-items: center;\n  justify-items: center;\n  & > * + * {\n    margin-left: 10px;\n  }\n"])));

var PopoverContent = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  flex-direction: column;\n  & > * + * {\n    margin-top: 12px;\n  }\n"])));

var StyledIcon = _styledComponents["default"].div(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n\n  :hover {\n    cursor: pointer;\n    color: ", ";\n  }\n"])), function (props) {
  return props.theme.activeColor;
}, function (props) {
  return props.theme.linkBtnColor;
});

MapPopoverFactory.deps = [_layerHoverInfo["default"], _coordinateInfo["default"]];

function createVirtualReference(container, x, y) {
  var size = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
  var bounds = container && container.getBoundingClientRect ? container.getBoundingClientRect() : {};
  var left = (bounds.left || 0) + x - size / 2;
  var top = (bounds.top || 0) + y - size / 2;
  return {
    left: left,
    top: top,
    right: left + size,
    bottom: top + size,
    width: size,
    height: size,
    // These properties are present to meet the DOMRect interface
    y: top,
    x: left,
    toJSON: function toJSON() {
      return this;
    }
  };
}

function getOffsetForPlacement(_ref) {
  var placement = _ref.placement,
      reference = _ref.reference,
      popper = _ref.popper;
  var gap = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 20;

  switch (placement) {
    case 'top-start':
    case 'bottom-start':
      return [gap, gap];

    case 'top-end':
    case 'bottom-end':
      return [-gap, gap];

    default:
      return [0, 0];
  }
}

function getPopperOptions(container) {
  return {
    modifiers: [{
      name: 'preventOverflow',
      options: {
        boundary: container
      }
    }]
  };
}

function MapPopoverFactory(LayerHoverInfo, CoordinateInfo) {
  /** @type {typeof import('./map-popover').MapPopover} */
  var MapPopover = function MapPopover(_ref2) {
    var x = _ref2.x,
        y = _ref2.y,
        frozen = _ref2.frozen,
        coordinate = _ref2.coordinate,
        layerHoverProp = _ref2.layerHoverProp,
        isBase = _ref2.isBase,
        zoom = _ref2.zoom,
        container = _ref2.container,
        onClose = _ref2.onClose;

    var _useState = (0, _react.useState)('start'),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        horizontalPlacement = _useState2[0],
        setHorizontalPlacement = _useState2[1];

    var moveLeft = function moveLeft() {
      return setHorizontalPlacement('end');
    };

    var moveRight = function moveRight() {
      return setHorizontalPlacement('start');
    };

    return /*#__PURE__*/_react["default"].createElement(_.RootContext.Consumer, null, function (context) {
      return /*#__PURE__*/_react["default"].createElement(_headless["default"], {
        popperOptions: getPopperOptions(container),
        zIndex: 999
        /* should be below Modal which has zIndex=1000 */
        ,
        visible: true,
        interactive: true // @ts-ignore
        ,
        getReferenceClientRect: function getReferenceClientRect() {
          return createVirtualReference(container, x, y);
        } // @ts-ignore
        ,
        placement: "bottom-".concat(horizontalPlacement) // @ts-ignore
        ,
        offset: getOffsetForPlacement,
        appendTo: (context === null || context === void 0 ? void 0 : context.current) || document.body,
        render: function render(attrs) {
          return /*#__PURE__*/_react["default"].createElement(StyledMapPopover, (0, _extends2["default"])({}, attrs, {
            className: "map-popover"
          }), frozen ? /*#__PURE__*/_react["default"].createElement(PinnedButtons, null, horizontalPlacement === 'start' && /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-arrow-left",
            onClick: moveLeft
          }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowLeft, null)), /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-pin",
            onClick: onClose
          }, /*#__PURE__*/_react["default"].createElement(_icons.Pin, {
            height: "16px"
          })), horizontalPlacement === 'end' && /*#__PURE__*/_react["default"].createElement(StyledIcon, {
            className: "popover-arrow-right",
            onClick: moveRight
          }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowRight, null)), isBase && /*#__PURE__*/_react["default"].createElement("div", {
            className: "primary-label"
          }, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
            id: "mapPopover.primary"
          }))) : null, /*#__PURE__*/_react["default"].createElement(PopoverContent, null, Array.isArray(coordinate) && /*#__PURE__*/_react["default"].createElement(CoordinateInfo, {
            coordinate: coordinate,
            zoom: zoom
          }), layerHoverProp && /*#__PURE__*/_react["default"].createElement(LayerHoverInfo, layerHoverProp)));
        }
      });
    });
  };

  return (0, _reactIntl.injectIntl)(MapPopover);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYXAvbWFwLXBvcG92ZXIudHN4Il0sIm5hbWVzIjpbIk1BWF9XSURUSCIsIk1BWF9IRUlHSFQiLCJTdHlsZWRNYXBQb3BvdmVyIiwic3R5bGVkIiwiZGl2IiwicHJvcHMiLCJ0aGVtZSIsInNjcm9sbEJhciIsImZvbnRGYW1pbHkiLCJwYW5lbEJhY2tncm91bmQiLCJ0ZXh0Q29sb3IiLCJwYW5lbEJveFNoYWRvdyIsIm5vdGlmaWNhdGlvbkNvbG9ycyIsInN1Y2Nlc3MiLCJ0ZXh0Q29sb3JIbCIsIlBpbm5lZEJ1dHRvbnMiLCJQb3BvdmVyQ29udGVudCIsIlN0eWxlZEljb24iLCJhY3RpdmVDb2xvciIsImxpbmtCdG5Db2xvciIsIk1hcFBvcG92ZXJGYWN0b3J5IiwiZGVwcyIsIkxheWVySG92ZXJJbmZvRmFjdG9yeSIsIkNvb3JkaW5hdGVJbmZvRmFjdG9yeSIsImNyZWF0ZVZpcnR1YWxSZWZlcmVuY2UiLCJjb250YWluZXIiLCJ4IiwieSIsInNpemUiLCJib3VuZHMiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJsZWZ0IiwidG9wIiwicmlnaHQiLCJib3R0b20iLCJ3aWR0aCIsImhlaWdodCIsInRvSlNPTiIsImdldE9mZnNldEZvclBsYWNlbWVudCIsInBsYWNlbWVudCIsInJlZmVyZW5jZSIsInBvcHBlciIsImdhcCIsImdldFBvcHBlck9wdGlvbnMiLCJtb2RpZmllcnMiLCJuYW1lIiwib3B0aW9ucyIsImJvdW5kYXJ5IiwiTGF5ZXJIb3ZlckluZm8iLCJDb29yZGluYXRlSW5mbyIsIk1hcFBvcG92ZXIiLCJmcm96ZW4iLCJjb29yZGluYXRlIiwibGF5ZXJIb3ZlclByb3AiLCJpc0Jhc2UiLCJ6b29tIiwib25DbG9zZSIsImhvcml6b250YWxQbGFjZW1lbnQiLCJzZXRIb3Jpem9udGFsUGxhY2VtZW50IiwibW92ZUxlZnQiLCJtb3ZlUmlnaHQiLCJjb250ZXh0IiwiY3VycmVudCIsImRvY3VtZW50IiwiYm9keSIsImF0dHJzIiwi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RUFBQyxvQkFBdEI7QUFBMkMsWUFBQSxPQUFPLEVBQUVFO0FBQXBELDBCQUNFLGdDQUFDLGdCQUFELE9BREYsQ0FGSixlQU1FLGdDQUFDLFVBQUQ7QUFBWSxZQUFBLFNBQVMsRUFBQyxhQUF0QjtBQUFvQyxZQUFBLE9BQU8sRUFBRUg7QUFBN0MsMEJBQ0UsZ0NBQUMsVUFBRDtBQUFLLFlBQUEsTUFBTSxFQUFDO0FBQVosWUFERixDQU5GLEVBU0dDLG1CQUFtQixLQUFLLEtBQXhCLGlCQUNDLGdDQUFDLFVBQUQ7QUFBWSxZQUFBLFNBQVMsRUFBQyxxQkFBdEI7QUFBNEMsWUFBQSxPQUFPLEVBQUVHO0FBQXJELDBCQUNFLGdDQUFDLGlCQUFELE9BREYsQ0FWSixFQWNHTixNQUFNLGlCQUNMO0FBQUssWUFBQSxTQUFTLEVBQUM7QUFBZiwwQkFDRSxnQ0FBQyw4QkFBRDtBQUFrQixZQUFBLEVBQUUsRUFBQztBQUFyQixZQURGLENBZkosQ0FESyxHQXFCSCxJQXRCTixlQXVCRSxnQ0FBQyxjQUFELFFBQ0dZLEtBQUssQ0FBQ0MsT0FBTixDQUFjZixVQUFkLGtCQUNDLGdDQUFDLGNBQUQ7QUFBZ0IsWUFBQSxVQUFVLEVBQUVBLFVBQTVCO0FBQXdDLFlBQUEsSUFBSSxFQUFFRztBQUE5QyxZQUZKLEVBSUdGLGNBQWMsaUJBQUksZ0NBQUMsY0FBRCxFQUFvQkEsY0FBcEIsQ0FKckIsQ0F2QkYsQ0FEVztBQUFBO0FBWmYsUUFETTtBQUFBLEtBRFYsQ0FERjtBQW1ERCxHQWpFRDs7QUFrRUEsU0FBTywyQkFBV0gsVUFBWCxDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjIgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QsIHt1c2VTdGF0ZX0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgTGF5ZXJIb3ZlckluZm9GYWN0b3J5IGZyb20gJy4vbGF5ZXItaG92ZXItaW5mbyc7XG5pbXBvcnQgQ29vcmRpbmF0ZUluZm9GYWN0b3J5IGZyb20gJy4vY29vcmRpbmF0ZS1pbmZvJztcbmltcG9ydCB7UGluLCBBcnJvd0xlZnQsIEFycm93UmlnaHR9IGZyb20gJy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQge2luamVjdEludGwsIEludGxTaGFwZX0gZnJvbSAncmVhY3QtaW50bCc7XG5pbXBvcnQge0Zvcm1hdHRlZE1lc3NhZ2V9IGZyb20gJ0BrZXBsZXIuZ2wvbG9jYWxpemF0aW9uJztcbmltcG9ydCBUaXBweSBmcm9tICdAdGlwcHlqcy9yZWFjdC9oZWFkbGVzcyc7XG5pbXBvcnQge1Jvb3RDb250ZXh0fSBmcm9tICcuLi8nO1xuaW1wb3J0IHtMYXllckhvdmVyUHJvcH0gZnJvbSAnQGtlcGxlci5nbC9yZWR1Y2Vycyc7XG5cbmNvbnN0IE1BWF9XSURUSCA9IDUwMDtcbmNvbnN0IE1BWF9IRUlHSFQgPSA2MDA7XG5cbmNvbnN0IFN0eWxlZE1hcFBvcG92ZXIgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICBtYXgtd2lkdGg6ICR7TUFYX1dJRFRIfXB4O1xuICBtYXgtaGVpZ2h0OiAke01BWF9IRUlHSFR9cHg7XG4gIHBhZGRpbmc6IDE0cHg7XG4gICYgPiAqICsgKiB7XG4gICAgbWFyZ2luLXRvcDogNnB4O1xuICB9XG4gICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2Nyb2xsQmFyfTtcbiAgZm9udC1mYW1pbHk6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuZm9udEZhbWlseX07XG4gIGZvbnQtc2l6ZTogMTFweDtcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgYmFja2dyb3VuZC1jb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5wYW5lbEJhY2tncm91bmR9O1xuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0Q29sb3J9O1xuICB6LWluZGV4OiAxMDAwO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICBib3gtc2hhZG93OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnBhbmVsQm94U2hhZG93fTtcblxuICA6aG92ZXIge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gYCR7cHJvcHMudGhlbWUucGFuZWxCYWNrZ3JvdW5kfWRkYH07XG4gIH1cblxuICAucHJpbWFyeS1sYWJlbCB7XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubm90aWZpY2F0aW9uQ29sb3JzLnN1Y2Nlc3N9O1xuICAgIGZvbnQtc2l6ZTogMTBweDtcbiAgfVxuXG4gIC5tYXAtcG9wb3Zlcl9fbGF5ZXItaW5mbyxcbiAgLmNvb3JkaW5nYXRlLWhvdmVyLWluZm8ge1xuICAgICYgPiAqICsgKiB7XG4gICAgICBtYXJnaW4tdG9wOiA3cHg7XG4gICAgfVxuICB9XG5cbiAgdGFibGUge1xuICAgIHdpZHRoOiBhdXRvO1xuICAgIGRpc3BsYXk6IGdyaWQ7XG4gICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTtcbiAgICByb3ctZ2FwOiA1cHg7XG4gICAgY29sdW1uLWdhcDogNXB4O1xuICB9XG5cbiAgLmNvb3JkaW5nYXRlLWhvdmVyLWluZm8gPiB0YWJsZSB7XG4gICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiBhdXRvIGF1dG8gYXV0bztcbiAgfVxuICAubWFwLXBvcG92ZXJfX2xheWVyLWluZm8gPiB0YWJsZSB7XG4gICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiBhdXRvIGF1dG87XG4gIH1cblxuICB0Ym9keSxcbiAgdHIge1xuICAgIGRpc3BsYXk6IGNvbnRlbnRzO1xuICB9XG5cbiAgdGQge1xuICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9yfTtcbiAgfVxuXG4gIHRkLnJvd19fdmFsdWUge1xuICAgIHRleHQtYWxpZ246IHJpZ2h0O1xuICAgIGZvbnQtd2VpZ2h0OiA1MDA7XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9ySGx9O1xuICB9XG5gO1xuXG5jb25zdCBQaW5uZWRCdXR0b25zID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24tc2VsZjogY2VudGVyO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBqdXN0aWZ5LWl0ZW1zOiBjZW50ZXI7XG4gICYgPiAqICsgKiB7XG4gICAgbWFyZ2luLWxlZnQ6IDEwcHg7XG4gIH1cbmA7XG5cbmNvbnN0IFBvcG92ZXJDb250ZW50ID0gc3R5bGVkLmRpdmBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgJiA+ICogKyAqIHtcbiAgICBtYXJnaW4tdG9wOiAxMnB4O1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRJY29uID0gc3R5bGVkLmRpdmBcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuYWN0aXZlQ29sb3J9O1xuXG4gIDpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmxpbmtCdG5Db2xvcn07XG4gIH1cbmA7XG5cbk1hcFBvcG92ZXJGYWN0b3J5LmRlcHMgPSBbTGF5ZXJIb3ZlckluZm9GYWN0b3J5LCBDb29yZGluYXRlSW5mb0ZhY3RvcnldO1xuXG5mdW5jdGlvbiBjcmVhdGVWaXJ0dWFsUmVmZXJlbmNlKGNvbnRhaW5lciwgeCwgeSwgc2l6ZSA9IDApIHtcbiAgY29uc3QgYm91bmRzID1cbiAgICBjb250YWluZXIgJiYgY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCA/IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IHt9O1xuICBjb25zdCBsZWZ0ID0gKGJvdW5kcy5sZWZ0IHx8IDApICsgeCAtIHNpemUgLyAyO1xuICBjb25zdCB0b3AgPSAoYm91bmRzLnRvcCB8fCAwKSArIHkgLSBzaXplIC8gMjtcbiAgcmV0dXJuIHtcbiAgICBsZWZ0LFxuICAgIHRvcCxcbiAgICByaWdodDogbGVmdCArIHNpemUsXG4gICAgYm90dG9tOiB0b3AgKyBzaXplLFxuICAgIHdpZHRoOiBzaXplLFxuICAgIGhlaWdodDogc2l6ZSxcbiAgICAvLyBUaGVzZSBwcm9wZXJ0aWVzIGFyZSBwcmVzZW50IHRvIG1lZXQgdGhlIERPTVJlY3QgaW50ZXJmYWNlXG4gICAgeTogdG9wLFxuICAgIHg6IGxlZnQsXG4gICAgdG9KU09OKCkge1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRPZmZzZXRGb3JQbGFjZW1lbnQoe3BsYWNlbWVudCwgcmVmZXJlbmNlLCBwb3BwZXJ9LCBnYXAgPSAyMCkge1xuICBzd2l0Y2ggKHBsYWNlbWVudCkge1xuICAgIGNhc2UgJ3RvcC1zdGFydCc6XG4gICAgY2FzZSAnYm90dG9tLXN0YXJ0JzpcbiAgICAgIHJldHVybiBbZ2FwLCBnYXBdO1xuICAgIGNhc2UgJ3RvcC1lbmQnOlxuICAgIGNhc2UgJ2JvdHRvbS1lbmQnOlxuICAgICAgcmV0dXJuIFstZ2FwLCBnYXBdO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gWzAsIDBdO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFBvcHBlck9wdGlvbnMoY29udGFpbmVyKSB7XG4gIHJldHVybiB7XG4gICAgbW9kaWZpZXJzOiBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdwcmV2ZW50T3ZlcmZsb3cnLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgYm91bmRhcnk6IGNvbnRhaW5lclxuICAgICAgICB9XG4gICAgICB9XG4gICAgXVxuICB9O1xufVxuXG5leHBvcnQgdHlwZSBNYXBQb3BvdmVyUHJvcHMgPSB7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xuICBmcm96ZW4/OiBib29sZWFuO1xuICBjb29yZGluYXRlOiBbbnVtYmVyLCBudW1iZXJdIHwgYm9vbGVhbjtcbiAgbGF5ZXJIb3ZlclByb3A6IExheWVySG92ZXJQcm9wIHwgbnVsbDtcbiAgaXNCYXNlPzogYm9vbGVhbjtcbiAgem9vbTogbnVtYmVyO1xuICBjb250YWluZXI/OiBIVE1MRWxlbWVudCB8IG51bGw7XG4gIG9uQ2xvc2U6ICgpID0+IHZvaWQ7XG59O1xuXG50eXBlIEludGxQcm9wcyA9IHtcbiAgaW50bDogSW50bFNoYXBlO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gTWFwUG9wb3ZlckZhY3RvcnkoXG4gIExheWVySG92ZXJJbmZvOiBSZXR1cm5UeXBlPHR5cGVvZiBMYXllckhvdmVySW5mb0ZhY3Rvcnk+LFxuICBDb29yZGluYXRlSW5mbzogUmV0dXJuVHlwZTx0eXBlb2YgQ29vcmRpbmF0ZUluZm9GYWN0b3J5PlxuKSB7XG4gIC8qKiBAdHlwZSB7dHlwZW9mIGltcG9ydCgnLi9tYXAtcG9wb3ZlcicpLk1hcFBvcG92ZXJ9ICovXG4gIGNvbnN0IE1hcFBvcG92ZXI6IFJlYWN0LkZDPE1hcFBvcG92ZXJQcm9wcyAmIEludGxQcm9wcz4gPSAoe1xuICAgIHgsXG4gICAgeSxcbiAgICBmcm96ZW4sXG4gICAgY29vcmRpbmF0ZSxcbiAgICBsYXllckhvdmVyUHJvcCxcbiAgICBpc0Jhc2UsXG4gICAgem9vbSxcbiAgICBjb250YWluZXIsXG4gICAgb25DbG9zZVxuICB9KSA9PiB7XG4gICAgY29uc3QgW2hvcml6b250YWxQbGFjZW1lbnQsIHNldEhvcml6b250YWxQbGFjZW1lbnRdID0gdXNlU3RhdGUoJ3N0YXJ0Jyk7XG4gICAgY29uc3QgbW92ZUxlZnQgPSAoKSA9PiBzZXRIb3Jpem9udGFsUGxhY2VtZW50KCdlbmQnKTtcbiAgICBjb25zdCBtb3ZlUmlnaHQgPSAoKSA9PiBzZXRIb3Jpem9udGFsUGxhY2VtZW50KCdzdGFydCcpO1xuICAgIHJldHVybiAoXG4gICAgICA8Um9vdENvbnRleHQuQ29uc3VtZXI+XG4gICAgICAgIHtjb250ZXh0ID0+IChcbiAgICAgICAgICA8VGlwcHlcbiAgICAgICAgICAgIHBvcHBlck9wdGlvbnM9e2dldFBvcHBlck9wdGlvbnMoY29udGFpbmVyKX1cbiAgICAgICAgICAgIHpJbmRleD17OTk5fSAvKiBzaG91bGQgYmUgYmVsb3cgTW9kYWwgd2hpY2ggaGFzIHpJbmRleD0xMDAwICovXG4gICAgICAgICAgICB2aXNpYmxlPXt0cnVlfVxuICAgICAgICAgICAgaW50ZXJhY3RpdmU9e3RydWV9XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBnZXRSZWZlcmVuY2VDbGllbnRSZWN0PXsoKSA9PiBjcmVhdGVWaXJ0dWFsUmVmZXJlbmNlKGNvbnRhaW5lciwgeCwgeSl9XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBwbGFjZW1lbnQ9e2Bib3R0b20tJHtob3Jpem9udGFsUGxhY2VtZW50fWB9XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBvZmZzZXQ9e2dldE9mZnNldEZvclBsYWNlbWVudH1cbiAgICAgICAgICAgIGFwcGVuZFRvPXtjb250ZXh0Py5jdXJyZW50IHx8IGRvY3VtZW50LmJvZHl9XG4gICAgICAgICAgICByZW5kZXI9e2F0dHJzID0+IChcbiAgICAgICAgICAgICAgPFN0eWxlZE1hcFBvcG92ZXIgey4uLmF0dHJzfSBjbGFzc05hbWU9XCJtYXAtcG9wb3ZlclwiPlxuICAgICAgICAgICAgICAgIHtmcm96ZW4gPyAoXG4gICAgICAgICAgICAgICAgICA8UGlubmVkQnV0dG9ucz5cbiAgICAgICAgICAgICAgICAgICAge2hvcml6b250YWxQbGFjZW1lbnQgPT09ICdzdGFydCcgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgIDxTdHlsZWRJY29uIGNsYXNzTmFtZT1cInBvcG92ZXItYXJyb3ctbGVmdFwiIG9uQ2xpY2s9e21vdmVMZWZ0fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxBcnJvd0xlZnQgLz5cbiAgICAgICAgICAgICAgICAgICAgICA8L1N0eWxlZEljb24+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIDxTdHlsZWRJY29uIGNsYXNzTmFtZT1cInBvcG92ZXItcGluXCIgb25DbGljaz17b25DbG9zZX0+XG4gICAgICAgICAgICAgICAgICAgICAgPFBpbiBoZWlnaHQ9XCIxNnB4XCIgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9TdHlsZWRJY29uPlxuICAgICAgICAgICAgICAgICAgICB7aG9yaXpvbnRhbFBsYWNlbWVudCA9PT0gJ2VuZCcgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgIDxTdHlsZWRJY29uIGNsYXNzTmFtZT1cInBvcG92ZXItYXJyb3ctcmlnaHRcIiBvbkNsaWNrPXttb3ZlUmlnaHR9PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEFycm93UmlnaHQgLz5cbiAgICAgICAgICAgICAgICAgICAgICA8L1N0eWxlZEljb24+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIHtpc0Jhc2UgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicHJpbWFyeS1sYWJlbFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9XCJtYXBQb3BvdmVyLnByaW1hcnlcIiAvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgPC9QaW5uZWRCdXR0b25zPlxuICAgICAgICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICAgICAgICAgIDxQb3BvdmVyQ29udGVudD5cbiAgICAgICAgICAgICAgICAgIHtBcnJheS5pc0FycmF5KGNvb3JkaW5hdGUpICYmIChcbiAgICAgICAgICAgICAgICAgICAgPENvb3JkaW5hdGVJbmZvIGNvb3JkaW5hdGU9e2Nvb3JkaW5hdGV9IHpvb209e3pvb219IC8+XG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAge2xheWVySG92ZXJQcm9wICYmIDxMYXllckhvdmVySW5mbyB7Li4ubGF5ZXJIb3ZlclByb3B9IC8+fVxuICAgICAgICAgICAgICAgIDwvUG9wb3ZlckNvbnRlbnQ+XG4gICAgICAgICAgICAgIDwvU3R5bGVkTWFwUG9wb3Zlcj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgIDwvUm9vdENvbnRleHQuQ29uc3VtZXI+XG4gICAgKTtcbiAgfTtcbiAgcmV0dXJuIGluamVjdEludGwoTWFwUG9wb3Zlcik7XG59XG4iXX0=