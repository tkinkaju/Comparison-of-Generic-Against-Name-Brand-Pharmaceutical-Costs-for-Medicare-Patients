// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _react = _interopRequireWildcard(require("react"));

var _ = require("../");

var _react2 = _interopRequireDefault(require("@tippyjs/react"));

var _templateObject, _templateObject2;

var TippyArrow = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  width: 15px;\n  height: 15px;\n  fill: ", ";\n  text-align: initial;\n\n  > svg {\n    position: absolute;\n  }\n"])), function (props) {
  return props.theme.tooltipBg;
});

var TippyTooltipContent = (0, _styledComponents["default"])(function (_ref) {
  var children = _ref.children,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["children"]);
  return /*#__PURE__*/_react["default"].createElement("div", props, children, /*#__PURE__*/_react["default"].createElement(TippyArrow, {
    className: "svg-arrow",
    "data-popper-arrow": ""
  }, /*#__PURE__*/_react["default"].createElement("svg", {
    width: 15,
    height: 15
  }, /*#__PURE__*/_react["default"].createElement("path", {
    d: "M2,7.5 7.5,2 13,7.5Z"
  }))));
})(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  font-family: ", ";\n  font-size: ", ";\n  font-weight: 400;\n  padding: 7px 18px;\n  box-shadow: ", ";\n  background-color: ", ";\n  color: ", ";\n  border-radius: ", ";\n  &[data-placement^='top'] > .svg-arrow {\n    bottom: 0;\n    &::after,\n    > svg {\n      top: 7px;\n      transform: rotate(180deg);\n    }\n  }\n\n  &[data-placement^='bottom'] > .svg-arrow {\n    top: 0;\n    > svg {\n      bottom: 7px;\n    }\n  }\n\n  &[data-placement^='left'] > .svg-arrow {\n    right: 0;\n    &::after,\n    > svg {\n      transform: rotate(90deg);\n      left: 7px;\n    }\n  }\n\n  &[data-placement^='right'] > .svg-arrow {\n    left: 0;\n    &::after,\n    > svg {\n      transform: rotate(-90deg);\n      right: 7px;\n    }\n  }\n"])), function (props) {
  return props.theme.fontFamily;
}, function (props) {
  return props.theme.tooltipFontSize;
}, function (props) {
  return props.theme.tooltipBoxShadow;
}, function (props) {
  return props.theme.tooltipBg;
}, function (props) {
  return props.theme.tooltipColor;
}, function (props) {
  return props.theme.primaryBtnRadius;
});

var TippyTooltip = function TippyTooltip(_ref2) {
  var children = _ref2.children,
      _render = _ref2.render,
      _ref2$duration = _ref2.duration,
      duration = _ref2$duration === void 0 ? 200 : _ref2$duration,
      rest = (0, _objectWithoutProperties2["default"])(_ref2, ["children", "render", "duration"]);

  var _useState = (0, _react.useState)(0),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      opacity = _useState2[0],
      setOpacity = _useState2[1];

  var _useState3 = (0, _react.useState)(null),
      _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
      timer = _useState4[0],
      setTimer = _useState4[1];

  function onMount() {
    setOpacity(1);

    if (timer) {
      // @ts-ignore
      clearTimeout(timer);
    }
  }

  function onHide(instance) {
    var unmount = instance.unmount;
    var timeout = setTimeout(function () {
      var _instance$state;

      if (!((_instance$state = instance.state) !== null && _instance$state !== void 0 && _instance$state.isDestroyed)) {
        unmount();
      }
    }, duration[0] || duration); // @ts-ignore

    setTimer(timeout);
    setOpacity(0);
  }

  return /*#__PURE__*/_react["default"].createElement(_.RootContext.Consumer, null, function (context) {
    return /*#__PURE__*/_react["default"].createElement(_react2["default"], (0, _extends2["default"])({}, rest, {
      // Using document.body would result in the CSS styles not being applied
      // to the tooltip content when embedding the map widget as a Shadow DOM element.
      appendTo: (context === null || context === void 0 ? void 0 : context.current) || 'parent',
      animation: true,
      render: function render(attrs) {
        return /*#__PURE__*/_react["default"].createElement(TippyTooltipContent, (0, _extends2["default"])({}, attrs, {
          style: {
            opacity: opacity,
            transition: "opacity ".concat(duration, "ms")
          }
        }), _render === null || _render === void 0 ? void 0 : _render(attrs));
      },
      onMount: onMount,
      onHide: onHide
    }), children);
  });
};

var _default = TippyTooltip;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21tb24vdGlwcHktdG9vbHRpcC50c3giXSwibmFtZXMiOlsiVGlwcHlBcnJvdyIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJ0b29sdGlwQmciLCJUaXBweVRvb2x0aXBDb250ZW50IiwiY2hpbGRyZW4iLCJmb250RmFtaWx5IiwidG9vbHRpcEZvbnRTaXplIiwidG9vbHRpcEJveFNoYWRvdyIsInRvb2x0aXBDb2xvciIsInByaW1hcnlCdG5SYWRpdXMiLCJUaXBweVRvb2x0aXAiLCJyZW5kZXIiLCJkdXJhdGlvbiIsInJlc3QiLCJvcGFjaXR5Iiwic2V0T3BhY2l0eSIsInRpbWVyIiwic2V0VGltZXIiLCJvbk1vdW50IiwiY2xlYXJUaW1lb3V0Iiwib25IaWRlIiwiaW5zdGFuY2UiLCJ1bm1vdW50IiwidGltZW91dCIsInNldFRpbWVvdXQiLCJzdGF0ZSIsImlzRGVzdHJveWVkIiwiY29udGV4dCIsImN1cnJlbnQiLCJhdHRycyIsInRyYW5zaXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxVQUFVLEdBQUdDLDZCQUFPQyxHQUFWLG1PQUlOLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsU0FBaEI7QUFBQSxDQUpDLENBQWhCOztBQVlBLElBQU1DLG1CQUFtQixHQUFHLGtDQUFPO0FBQUEsTUFBRUMsUUFBRixRQUFFQSxRQUFGO0FBQUEsTUFBZUosS0FBZjtBQUFBLHNCQUNqQyx1Q0FBU0EsS0FBVCxFQUNHSSxRQURILGVBRUUsZ0NBQUMsVUFBRDtBQUFZLElBQUEsU0FBUyxFQUFDLFdBQXRCO0FBQWtDLHlCQUFrQjtBQUFwRCxrQkFDRTtBQUFLLElBQUEsS0FBSyxFQUFFLEVBQVo7QUFBZ0IsSUFBQSxNQUFNLEVBQUU7QUFBeEIsa0JBQ0U7QUFBTSxJQUFBLENBQUMsRUFBQztBQUFSLElBREYsQ0FE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YmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IFJlYWN0LCB7dXNlU3RhdGV9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7Um9vdENvbnRleHR9IGZyb20gJy4uLyc7XG5pbXBvcnQgVGlwcHksIHtUaXBweVByb3BzfSBmcm9tICdAdGlwcHlqcy9yZWFjdCc7XG5cbmNvbnN0IFRpcHB5QXJyb3cgPSBzdHlsZWQuZGl2YFxuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHdpZHRoOiAxNXB4O1xuICBoZWlnaHQ6IDE1cHg7XG4gIGZpbGw6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudG9vbHRpcEJnfTtcbiAgdGV4dC1hbGlnbjogaW5pdGlhbDtcblxuICA+IHN2ZyB7XG4gICAgcG9zaXRpb246IGFic29sdXRlO1xuICB9XG5gO1xuXG5jb25zdCBUaXBweVRvb2x0aXBDb250ZW50ID0gc3R5bGVkKCh7Y2hpbGRyZW4sIC4uLnByb3BzfSkgPT4gKFxuICA8ZGl2IHsuLi5wcm9wc30+XG4gICAge2NoaWxkcmVufVxuICAgIDxUaXBweUFycm93IGNsYXNzTmFtZT1cInN2Zy1hcnJvd1wiIGRhdGEtcG9wcGVyLWFycm93PVwiXCI+XG4gICAgICA8c3ZnIHdpZHRoPXsxNX0gaGVpZ2h0PXsxNX0+XG4gICAgICAgIDxwYXRoIGQ9XCJNMiw3LjUgNy41LDIgMTMsNy41WlwiIC8+XG4gICAgICA8L3N2Zz5cbiAgICA8L1RpcHB5QXJyb3c+XG4gIDwvZGl2PlxuKSlgXG4gIGZvbnQtZmFtaWx5OiAke3Byb3BzID0+IHByb3BzLnRoZW1lLmZvbnRGYW1pbHl9O1xuICBmb250LXNpemU6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudG9vbHRpcEZvbnRTaXplfTtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgcGFkZGluZzogN3B4IDE4cHg7XG4gIGJveC1zaGFkb3c6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudG9vbHRpcEJveFNoYWRvd307XG4gIGJhY2tncm91bmQtY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudG9vbHRpcEJnfTtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudG9vbHRpcENvbG9yfTtcbiAgYm9yZGVyLXJhZGl1czogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5wcmltYXJ5QnRuUmFkaXVzfTtcbiAgJltkYXRhLXBsYWNlbWVudF49J3RvcCddID4gLnN2Zy1hcnJvdyB7XG4gICAgYm90dG9tOiAwO1xuICAgICY6OmFmdGVyLFxuICAgID4gc3ZnIHtcbiAgICAgIHRvcDogN3B4O1xuICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMTgwZGVnKTtcbiAgICB9XG4gIH1cblxuICAmW2RhdGEtcGxhY2VtZW50Xj0nYm90dG9tJ10gPiAuc3ZnLWFycm93IHtcbiAgICB0b3A6IDA7XG4gICAgPiBzdmcge1xuICAgICAgYm90dG9tOiA3cHg7XG4gICAgfVxuICB9XG5cbiAgJltkYXRhLXBsYWNlbWVudF49J2xlZnQnXSA+IC5zdmctYXJyb3cge1xuICAgIHJpZ2h0OiAwO1xuICAgICY6OmFmdGVyLFxuICAgID4gc3ZnIHtcbiAgICAgIHRyYW5zZm9ybTogcm90YXRlKDkwZGVnKTtcbiAgICAgIGxlZnQ6IDdweDtcbiAgICB9XG4gIH1cblxuICAmW2RhdGEtcGxhY2VtZW50Xj0ncmlnaHQnXSA+IC5zdmctYXJyb3cge1xuICAgIGxlZnQ6IDA7XG4gICAgJjo6YWZ0ZXIsXG4gICAgPiBzdmcge1xuICAgICAgdHJhbnNmb3JtOiByb3RhdGUoLTkwZGVnKTtcbiAgICAgIHJpZ2h0OiA3cHg7XG4gICAgfVxuICB9XG5gO1xuXG5jb25zdCBUaXBweVRvb2x0aXAgPSAoe2NoaWxkcmVuLCByZW5kZXIsIGR1cmF0aW9uID0gMjAwLCAuLi5yZXN0fTogVGlwcHlQcm9wcykgPT4ge1xuICBjb25zdCBbb3BhY2l0eSwgc2V0T3BhY2l0eV0gPSB1c2VTdGF0ZSgwKTtcbiAgY29uc3QgW3RpbWVyLCBzZXRUaW1lcl0gPSB1c2VTdGF0ZShudWxsKTtcbiAgZnVuY3Rpb24gb25Nb3VudCgpIHtcbiAgICBzZXRPcGFjaXR5KDEpO1xuICAgIGlmICh0aW1lcikge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvbkhpZGUoaW5zdGFuY2UpIHtcbiAgICBjb25zdCB7dW5tb3VudH0gPSBpbnN0YW5jZTtcbiAgICBjb25zdCB0aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAoIWluc3RhbmNlLnN0YXRlPy5pc0Rlc3Ryb3llZCkge1xuICAgICAgICB1bm1vdW50KCk7XG4gICAgICB9XG4gICAgfSwgZHVyYXRpb25bMF0gfHwgZHVyYXRpb24pO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBzZXRUaW1lcih0aW1lb3V0KTtcbiAgICBzZXRPcGFjaXR5KDApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8Um9vdENvbnRleHQuQ29uc3VtZXI+XG4gICAgICB7Y29udGV4dCA9PiAoXG4gICAgICAgIDxUaXBweVxuICAgICAgICAgIHsuLi5yZXN0fVxuICAgICAgICAgIC8vIFVzaW5nIGRvY3VtZW50LmJvZHkgd291bGQgcmVzdWx0IGluIHRoZSBDU1Mgc3R5bGVzIG5vdCBiZWluZyBhcHBsaWVkXG4gICAgICAgICAgLy8gdG8gdGhlIHRvb2x0aXAgY29udGVudCB3aGVuIGVtYmVkZGluZyB0aGUgbWFwIHdpZGdldCBhcyBhIFNoYWRvdyBET00gZWxlbWVudC5cbiAgICAgICAgICBhcHBlbmRUbz17Y29udGV4dD8uY3VycmVudCB8fCAncGFyZW50J31cbiAgICAgICAgICBhbmltYXRpb249e3RydWV9XG4gICAgICAgICAgcmVuZGVyPXthdHRycyA9PiAoXG4gICAgICAgICAgICA8VGlwcHlUb29sdGlwQ29udGVudCB7Li4uYXR0cnN9IHN0eWxlPXt7b3BhY2l0eSwgdHJhbnNpdGlvbjogYG9wYWNpdHkgJHtkdXJhdGlvbn1tc2B9fT5cbiAgICAgICAgICAgICAge3JlbmRlcj8uKGF0dHJzKX1cbiAgICAgICAgICAgIDwvVGlwcHlUb29sdGlwQ29udGVudD5cbiAgICAgICAgICApfVxuICAgICAgICAgIG9uTW91bnQ9e29uTW91bnR9XG4gICAgICAgICAgb25IaWRlPXtvbkhpZGV9XG4gICAgICAgID5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgIDwvVGlwcHk+XG4gICAgICApfVxuICAgIDwvUm9vdENvbnRleHQuQ29uc3VtZXI+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBUaXBweVRvb2x0aXA7XG4iXX0=