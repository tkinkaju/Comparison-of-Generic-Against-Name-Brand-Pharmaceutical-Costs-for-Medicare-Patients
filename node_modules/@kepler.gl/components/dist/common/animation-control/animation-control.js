// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _slider = _interopRequireDefault(require("../slider/slider"));

var _styledComponents2 = require("../styled-components");

var _playbackControls = _interopRequireDefault(require("./playback-controls"));

var _floatingTimeDisplay = _interopRequireDefault(require("./floating-time-display"));

var _utils = require("@kepler.gl/utils");

var _constants = require("@kepler.gl/constants");

var _styles = require("@kepler.gl/styles");

var _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;

var SLIDER_MARGIN_PALM = 6;

var SliderWrapper = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  flex-grow: 1;\n  margin: 0 24px;\n\n  ", "\n"])), _styles.media.palm(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n    margin: 0 ", "px;\n  "])), SLIDER_MARGIN_PALM));

var AnimationWidgetInner = _styledComponents["default"].div(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  position: relative;\n  display: flex;\n  align-items: center;\n\n  .animation-control__time-slider {\n    display: flex;\n    align-items: center;\n    height: 32px;\n    width: 100%;\n  }\n  .playback-controls {\n    margin-left: 16px;\n  }\n\n  ", ";\n"])), _styles.media.palm(_templateObject4 || (_templateObject4 = (0, _taggedTemplateLiteral2["default"])(["\n    flex-direction: column;\n    .playback-controls {\n      margin: 0;\n    }\n    .animation-control__time-slider {\n      width: 100%;\n      position: relative;\n    }\n    .animation-control__time-domain {\n      position: absolute;\n      top: -24px;\n\n      &.domain-start {\n        left: ", "px;\n      }\n      &.domain-end {\n        right: ", "px;\n      }\n    }\n  "])), SLIDER_MARGIN_PALM, SLIDER_MARGIN_PALM));

var StyledDomain = _styledComponents["default"].div.attrs(function (props) {
  return {
    className: (0, _classnames["default"])('animation-control__time-domain', props.className)
  };
})(_templateObject5 || (_templateObject5 = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  font-weight: 400;\n  font-size: 10px;\n"])), function (props) {
  return props.theme.titleTextColor;
});

AnimationControlFactory.deps = [_playbackControls["default"], _floatingTimeDisplay["default"]];

function AnimationControlFactory(PlaybackControls, FloatingTimeDisplay) {
  var AnimationControl = function AnimationControl(_ref) {
    var isAnimatable = _ref.isAnimatable,
        isAnimating = _ref.isAnimating,
        resetAnimation = _ref.resetAnimation,
        toggleAnimation = _ref.toggleAnimation,
        setLayerAnimationTime = _ref.setLayerAnimationTime,
        updateAnimationSpeed = _ref.updateAnimationSpeed,
        animationConfig = _ref.animationConfig;
    var currentTime = animationConfig.currentTime,
        domain = animationConfig.domain,
        speed = animationConfig.speed,
        step = animationConfig.step,
        timeSteps = animationConfig.timeSteps,
        timeFormat = animationConfig.timeFormat,
        timezone = animationConfig.timezone,
        defaultTimeFormat = animationConfig.defaultTimeFormat;
    var onSlider1Change = (0, _react.useCallback)(function (val) {
      if (Array.isArray(timeSteps)) {
        setLayerAnimationTime((0, _utils.snapToMarks)(val, timeSteps)); // TODO: merge slider in to avoid this step
      } else if (val >= domain[0] && val <= domain[1]) {
        setLayerAnimationTime(val);
      }
    }, [domain, timeSteps, setLayerAnimationTime]);
    var dateFunc = (0, _react.useMemo)(function () {
      var hasUserFormat = typeof timeFormat === 'string';
      var currentFormat = (hasUserFormat ? timeFormat : defaultTimeFormat) || _constants.DEFAULT_TIME_FORMAT;
      return (0, _utils.datetimeFormatter)(timezone)(currentFormat);
    }, [timeFormat, defaultTimeFormat, timezone]);
    var timeStart = (0, _react.useMemo)(function () {
      return domain ? dateFunc(domain[0]) : '';
    }, [domain, dateFunc]);
    var timeEnd = (0, _react.useMemo)(function () {
      return domain ? dateFunc(domain[1]) : '';
    }, [domain, dateFunc]);
    return /*#__PURE__*/_react["default"].createElement(_styledComponents2.BottomWidgetInner, {
      className: "bottom-widget--inner"
    }, /*#__PURE__*/_react["default"].createElement(AnimationWidgetInner, {
      className: "animation-widget--inner"
    }, /*#__PURE__*/_react["default"].createElement("div", {
      className: "animation-control__time-slider"
    }, /*#__PURE__*/_react["default"].createElement(StyledDomain, {
      className: "domain-start"
    }, /*#__PURE__*/_react["default"].createElement("span", null, timeStart)), /*#__PURE__*/_react["default"].createElement(SliderWrapper, {
      className: "animation-control__slider"
    }, /*#__PURE__*/_react["default"].createElement(_slider["default"], {
      isRanged: false,
      step: step,
      minValue: domain ? domain[0] : 0,
      maxValue: domain ? domain[1] : 1,
      value1: currentTime,
      onSlider1Change: onSlider1Change,
      enableBarDrag: true
    })), /*#__PURE__*/_react["default"].createElement(StyledDomain, {
      className: "domain-end"
    }, /*#__PURE__*/_react["default"].createElement("span", null, timeEnd))), /*#__PURE__*/_react["default"].createElement(PlaybackControls, {
      className: "animation-control-playpause",
      startAnimation: toggleAnimation,
      isAnimating: isAnimating,
      pauseAnimation: toggleAnimation,
      resetAnimation: resetAnimation,
      speed: speed,
      isAnimatable: isAnimatable,
      updateAnimationSpeed: updateAnimationSpeed
    })), /*#__PURE__*/_react["default"].createElement(FloatingTimeDisplay, {
      currentTime: currentTime,
      defaultTimeFormat: defaultTimeFormat,
      timeFormat: timeFormat,
      timezone: timezone
    }));
  };

  AnimationControl.defaultProps = {
    toggleAnimation: function toggleAnimation() {},
    updateAnimationSpeed: function updateAnimationSpeed() {},
    animationControlProps: {},
    animationConfig: {}
  };
  return AnimationControl;
}

var _default = AnimationControlFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvYW5pbWF0aW9uLWNvbnRyb2wudHN4Il0sIm5hbWVzIjpbIlNMSURFUl9NQVJHSU5fUEFMTSIsIlNsaWRlcldyYXBwZXIiLCJzdHlsZWQiLCJkaXYiLCJtZWRpYSIsInBhbG0iLCJBbmltYXRpb25XaWRnZXRJbm5lciIsIlN0eWxlZERvbWFpbiIsImF0dHJzIiwicHJvcHMiLCJjbGFzc05hbWUiLCJ0aGVtZSIsInRpdGxlVGV4dENvbG9yIiwiQW5pbWF0aW9uQ29udHJvbEZhY3RvcnkiLCJkZXBzIiwiUGxheWJhY2tDb250cm9sc0ZhY3RvcnkiLCJGbG9hdGluZ1RpbWVEaXNwbGF5RmFjdG9yeSIsIlBsYXliYWNrQ29udHJvbHMiLCJGbG9hdGluZ1RpbWVEaXNwbGF5IiwiQW5pbWF0aW9uQ29udHJvbCIsImlzQW5pbWF0YWJsZSIsImlzQW5pbWF0aW5nIiwicmVzZXRBbmltYXRpb24iLCJ0b2dnbGVBbmltYXRpb24iLCJzZXRMYXllckFuaW1hdGlvblRpbWUiLCJ1cGRhdGVBbmltYXRpb25TcGVlZCIsImFuaW1hdGlvbkNvbmZpZyIsImN1cnJlbnRUaW1lIiwiZG9tYWluIiwic3BlZWQiLCJzdGVwIiwidGltZVN0ZXBzIiwidGltZUZvcm1hdCIsInRpbWV6b25lIiwiZGVmYXVsdFRpbWVGb3JtYXQiLCJvblNsaWRlcjFDaGFuZ2UiLCJ2YWwiLCJBcnJheSIsImlzQXJyYXkiLCJkYXRlRnVuYyIsImhhc1VzZXJGb3JtYXQiLCJjdXJyZW50Rm9ybWF0IiwiREVGQVVMVF9USU1FX0ZPUk1BVCIsInRpbWVTdGFydCIsInRpbWVFbmQiLCJkZWZhdWx0UHJvcHMiLCJhbmltYXRpb25Db250cm9sUHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxrQkFBa0IsR0FBRyxDQUEzQjs7QUFFQSxJQUFNQyxhQUFhLEdBQUdDLDZCQUFPQyxHQUFWLGdMQU1mQyxjQUFNQyxJQU5TLG9IQU9ITCxrQkFQRyxFQUFuQjs7QUFXQSxJQUFNTSxvQkFBb0IsR0FBR0osNkJBQU9DLEdBQVYsMlZBZXRCQyxjQUFNQyxJQWZnQix1ZEE2QlZMLGtCQTdCVSxFQWdDVEEsa0JBaENTLEVBQTFCOztBQXNDQSxJQUFNTyxZQUFZLEdBQUdMLDZCQUFPQyxHQUFQLENBQVdLLEtBQVgsQ0FBaUIsVUFBQUMsS0FBSztBQUFBLFNBQUs7QUFDOUNDLElBQUFBLFNBQVMsRUFBRSw0QkFBVyxnQ0FBWCxFQUE2Q0QsS0FBSyxDQUFDQyxTQUFuRDtBQURtQyxHQUFMO0FBQUEsQ0FBdEIsQ0FBSCxvSkFHUCxVQUFBRCxLQUFLO0FBQUEsU0FBSUEsS0FBSyxDQUFDRSxLQUFOLENBQVlDLGNBQWhCO0FBQUEsQ0FIRSxDQUFsQjs7QUFRQUMsdUJBQXVCLENBQUNDLElBQXhCLEdBQStCLENBQUNDLDRCQUFELEVBQTBCQywrQkFBMUIsQ0FBL0I7O0FBRUEsU0FBU0gsdUJBQVQsQ0FDRUksZ0JBREYsRUFFRUMsbUJBRkYsRUFHRTtBQUNBLE1BQU1DLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBbUIsT0FRbkI7QUFBQSxRQVBKQyxZQU9JLFFBUEpBLFlBT0k7QUFBQSxRQU5KQyxXQU1JLFFBTkpBLFdBTUk7QUFBQSxRQUxKQyxjQUtJLFFBTEpBLGNBS0k7QUFBQSxRQUpKQyxlQUlJLFFBSkpBLGVBSUk7QUFBQSxRQUhKQyxxQkFHSSxRQUhKQSxxQkFHSTtBQUFBLFFBRkpDLG9CQUVJLFFBRkpBLG9CQUVJO0FBQUEsUUFESkMsZUFDSSxRQURKQSxlQUNJO0FBQUEsUUFFRkMsV0FGRSxHQVVBRCxlQVZBLENBRUZDLFdBRkU7QUFBQSxRQUdGQyxNQUhFLEdBVUFGLGVBVkEsQ0FHRkUsTUFIRTtBQUFBLFFBSUZDLEtBSkUsR0FVQUgsZUFWQSxDQUlGRyxLQUpFO0FBQUEsUUFLRkMsSUFMRSxHQVVBSixlQVZBLENBS0ZJLElBTEU7QUFBQSxRQU1GQyxTQU5FLEdBVUFMLGVBVkEsQ0FNRkssU0FORTtBQUFBLFFBT0ZDLFVBUEUsR0FVQU4sZUFWQSxDQU9GTSxVQVBFO0FBQUEsUUFRRkMsUUFSRSxHQVVBUCxlQVZBLENBUUZPLFFBUkU7QUFBQSxRQVNGQyxpQkFURSxHQVVBUixlQVZBLENBU0ZRLGlCQVRFO0FBV0osUUFBTUMsZUFBZSxHQUFHLHdCQUN0QixVQUFBQyxHQUFHLEVBQUk7QUFDTCxVQUFJQyxLQUFLLENBQUNDLE9BQU4sQ0FBY1AsU0FBZCxDQUFKLEVBQThCO0FBQzVCUCxRQUFBQSxxQkFBcUIsQ0FBQyx3QkFBWVksR0FBWixFQUFpQkwsU0FBakIsQ0FBRCxDQUFyQixDQUQ0QixDQUc1QjtBQUNELE9BSkQsTUFJTyxJQUFJSyxHQUFHLElBQUlSLE1BQU0sQ0FBQyxDQUFELENBQWIsSUFBb0JRLEdBQUcsSUFBSVIsTUFBTSxDQUFDLENBQUQsQ0FBckMsRUFBMEM7QUFDL0NKLFFBQUFBLHFCQUFxQixDQUFDWSxHQUFELENBQXJCO0FBQ0Q7QUFDRixLQVRxQixFQVV0QixDQUFDUixNQUFELEVBQVNHLFNBQVQsRUFBb0JQLHFCQUFwQixDQVZzQixDQUF4QjtBQWFBLFFBQU1lLFFBQVEsR0FBRyxvQkFBUSxZQUFNO0FBQzdCLFVBQU1DLGFBQWEsR0FBRyxPQUFPUixVQUFQLEtBQXNCLFFBQTVDO0FBQ0EsVUFBTVMsYUFBYSxHQUFHLENBQUNELGFBQWEsR0FBR1IsVUFBSCxHQUFnQkUsaUJBQTlCLEtBQW9EUSw4QkFBMUU7QUFDQSxhQUFPLDhCQUFrQlQsUUFBbEIsRUFBNEJRLGFBQTVCLENBQVA7QUFDRCxLQUpnQixFQUlkLENBQUNULFVBQUQsRUFBYUUsaUJBQWIsRUFBZ0NELFFBQWhDLENBSmMsQ0FBakI7QUFNQSxRQUFNVSxTQUFTLEdBQUcsb0JBQVE7QUFBQSxhQUFPZixNQUFNLEdBQUdXLFFBQVEsQ0FBQ1gsTUFBTSxDQUFDLENBQUQsQ0FBUCxDQUFYLEdBQXlCLEVBQXRDO0FBQUEsS0FBUixFQUFtRCxDQUFDQSxNQUFELEVBQVNXLFFBQVQsQ0FBbkQsQ0FBbEI7QUFDQSxRQUFNSyxPQUFPLEdBQUcsb0JBQVE7QUFBQSxhQUFPaEIsTUFBTSxHQUFHVyxRQUFRLENBQUNYLE1BQU0sQ0FBQyxDQUFELENBQVAsQ0FBWCxHQUF5QixFQUF0QztBQUFBLEtBQVIsRUFBbUQsQ0FBQ0EsTUFBRCxFQUFTVyxRQUFULENBQW5ELENBQWhCO0FBRUEsd0JBQ0UsZ0NBQUMsb0NBQUQ7QUFBbUIsTUFBQSxTQUFTLEVBQUM7QUFBN0Isb0JBQ0UsZ0NBQUMsb0JBQUQ7QUFBc0IsTUFBQSxTQUFTLEVBQUM7QUFBaEMsb0JBQ0U7QUFBSyxNQUFBLFNBQVMsRUFBQztBQUFmLG9CQUNFLGdDQUFDLFlBQUQ7QUFBYyxNQUFBLFNBQVMsRUFBQztBQUF4QixvQkFDRSw4Q0FBT0ksU0FBUCxDQURGLENBREYsZUFJRSxnQ0FBQyxhQUFEO0FBQWUsTUFBQSxTQUFTLEVBQUM7QUFBekIsb0JBQ0UsZ0NBQUMsa0JBQUQ7QUFDRSxNQUFBLFFBQVEsRUFBRSxLQURaO0FBRUUsTUFBQSxJQUFJLEVBQUViLElBRlI7QUFHRSxNQUFBLFFBQVEsRUFBRUYsTUFBTSxHQUFHQSxNQUFNLENBQUMsQ0FBRCxDQUFULEdBQWUsQ0FIakM7QUFJRSxNQUFBLFFBQVEsRUFBRUEsTUFBTSxHQUFHQSxNQUFNLENBQUMsQ0FBRCxDQUFULEdBQWUsQ0FKakM7QUFLRSxNQUFBLE1BQU0sRUFBRUQsV0FMVjtBQU1FLE1BQUEsZUFBZSxFQUFFUSxlQU5uQjtBQU9FLE1BQUEsYUFBYSxFQUFFO0FBUGpCLE1BREYsQ0FKRixlQWVFLGdDQUFDLFlBQUQ7QUFBYyxNQUFBLFNBQVMsRUFBQztBQUF4QixvQkFDRSw4Q0FBT1MsT0FBUCxDQURGLENBZkYsQ0FERixlQW9CRSxnQ0FBQyxnQkFBRDtBQUNFLE1BQUEsU0FBUyxFQUFDLDZCQURaO0FBRUUsTUFBQSxjQUFjLEVBQUVyQixlQUZsQjtBQUdFLE1BQUEsV0FBVyxFQUFFRixXQUhmO0FBSUUsTUFBQSxjQUFjLEVBQUVFLGVBSmxCO0FBS0UsTUFBQSxjQUFjLEVBQUVELGNBTGxCO0FBTUUsTUFBQSxLQUFLLEVBQUVPLEtBTlQ7QUFPRSxNQUFBLFlBQVksRUFBRVQsWUFQaEI7QUFRRSxNQUFBLG9CQUFvQixFQUFFSztBQVJ4QixNQXBCRixDQURGLGVBZ0NFLGdDQUFDLG1CQUFEO0FBQ0UsTUFBQSxXQUFXLEVBQUVFLFdBRGY7QUFFRSxNQUFBLGlCQUFpQixFQUFFTyxpQkFGckI7QUFHRSxNQUFBLFVBQVUsRUFBRUYsVUFIZDtBQUlFLE1BQUEsUUFBUSxFQUFFQztBQUpaLE1BaENGLENBREY7QUF5Q0QsR0FsRkQ7O0FBb0ZBZCxFQUFBQSxnQkFBZ0IsQ0FBQzBCLFlBQWpCLEdBQWdDO0FBQzlCdEIsSUFBQUEsZUFBZSxFQUFFLDJCQUFNLENBQUUsQ0FESztBQUU5QkUsSUFBQUEsb0JBQW9CLEVBQUUsZ0NBQU0sQ0FBRSxDQUZBO0FBRzlCcUIsSUFBQUEscUJBQXFCLEVBQUUsRUFITztBQUk5QnBCLElBQUFBLGVBQWUsRUFBRTtBQUphLEdBQWhDO0FBT0EsU0FBT1AsZ0JBQVA7QUFDRDs7ZUFFY04sdUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjIgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QsIHt1c2VDYWxsYmFjaywgdXNlTWVtb30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgY2xhc3NuYW1lcyBmcm9tICdjbGFzc25hbWVzJztcblxuaW1wb3J0IFNsaWRlciBmcm9tICcuLi9zbGlkZXIvc2xpZGVyJztcbmltcG9ydCB7Qm90dG9tV2lkZ2V0SW5uZXJ9IGZyb20gJy4uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBQbGF5YmFja0NvbnRyb2xzRmFjdG9yeSBmcm9tICcuL3BsYXliYWNrLWNvbnRyb2xzJztcbmltcG9ydCBGbG9hdGluZ1RpbWVEaXNwbGF5RmFjdG9yeSBmcm9tICcuL2Zsb2F0aW5nLXRpbWUtZGlzcGxheSc7XG5pbXBvcnQge2RhdGV0aW1lRm9ybWF0dGVyLCBzbmFwVG9NYXJrc30gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5pbXBvcnQge0RFRkFVTFRfVElNRV9GT1JNQVR9IGZyb20gJ0BrZXBsZXIuZ2wvY29uc3RhbnRzJztcbmltcG9ydCB7bWVkaWF9IGZyb20gJ0BrZXBsZXIuZ2wvc3R5bGVzJztcblxuY29uc3QgU0xJREVSX01BUkdJTl9QQUxNID0gNjtcblxuY29uc3QgU2xpZGVyV3JhcHBlciA9IHN0eWxlZC5kaXZgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgZmxleC1ncm93OiAxO1xuICBtYXJnaW46IDAgMjRweDtcblxuICAke21lZGlhLnBhbG1gXG4gICAgbWFyZ2luOiAwICR7U0xJREVSX01BUkdJTl9QQUxNfXB4O1xuICBgfVxuYDtcblxuY29uc3QgQW5pbWF0aW9uV2lkZ2V0SW5uZXIgPSBzdHlsZWQuZGl2YFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG5cbiAgLmFuaW1hdGlvbi1jb250cm9sX190aW1lLXNsaWRlciB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIGhlaWdodDogMzJweDtcbiAgICB3aWR0aDogMTAwJTtcbiAgfVxuICAucGxheWJhY2stY29udHJvbHMge1xuICAgIG1hcmdpbi1sZWZ0OiAxNnB4O1xuICB9XG5cbiAgJHttZWRpYS5wYWxtYFxuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgLnBsYXliYWNrLWNvbnRyb2xzIHtcbiAgICAgIG1hcmdpbjogMDtcbiAgICB9XG4gICAgLmFuaW1hdGlvbi1jb250cm9sX190aW1lLXNsaWRlciB7XG4gICAgICB3aWR0aDogMTAwJTtcbiAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICB9XG4gICAgLmFuaW1hdGlvbi1jb250cm9sX190aW1lLWRvbWFpbiB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICB0b3A6IC0yNHB4O1xuXG4gICAgICAmLmRvbWFpbi1zdGFydCB7XG4gICAgICAgIGxlZnQ6ICR7U0xJREVSX01BUkdJTl9QQUxNfXB4O1xuICAgICAgfVxuICAgICAgJi5kb21haW4tZW5kIHtcbiAgICAgICAgcmlnaHQ6ICR7U0xJREVSX01BUkdJTl9QQUxNfXB4O1xuICAgICAgfVxuICAgIH1cbiAgYH07XG5gO1xuXG5jb25zdCBTdHlsZWREb21haW4gPSBzdHlsZWQuZGl2LmF0dHJzKHByb3BzID0+ICh7XG4gIGNsYXNzTmFtZTogY2xhc3NuYW1lcygnYW5pbWF0aW9uLWNvbnRyb2xfX3RpbWUtZG9tYWluJywgcHJvcHMuY2xhc3NOYW1lKVxufSkpYFxuICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50aXRsZVRleHRDb2xvcn07XG4gIGZvbnQtd2VpZ2h0OiA0MDA7XG4gIGZvbnQtc2l6ZTogMTBweDtcbmA7XG5cbkFuaW1hdGlvbkNvbnRyb2xGYWN0b3J5LmRlcHMgPSBbUGxheWJhY2tDb250cm9sc0ZhY3RvcnksIEZsb2F0aW5nVGltZURpc3BsYXlGYWN0b3J5XTtcblxuZnVuY3Rpb24gQW5pbWF0aW9uQ29udHJvbEZhY3RvcnkoXG4gIFBsYXliYWNrQ29udHJvbHM6IFJldHVyblR5cGU8dHlwZW9mIFBsYXliYWNrQ29udHJvbHNGYWN0b3J5PixcbiAgRmxvYXRpbmdUaW1lRGlzcGxheTogUmV0dXJuVHlwZTx0eXBlb2YgRmxvYXRpbmdUaW1lRGlzcGxheUZhY3Rvcnk+XG4pIHtcbiAgY29uc3QgQW5pbWF0aW9uQ29udHJvbCA9ICh7XG4gICAgaXNBbmltYXRhYmxlLFxuICAgIGlzQW5pbWF0aW5nLFxuICAgIHJlc2V0QW5pbWF0aW9uLFxuICAgIHRvZ2dsZUFuaW1hdGlvbixcbiAgICBzZXRMYXllckFuaW1hdGlvblRpbWUsXG4gICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQsXG4gICAgYW5pbWF0aW9uQ29uZmlnXG4gIH0pID0+IHtcbiAgICBjb25zdCB7XG4gICAgICBjdXJyZW50VGltZSxcbiAgICAgIGRvbWFpbixcbiAgICAgIHNwZWVkLFxuICAgICAgc3RlcCxcbiAgICAgIHRpbWVTdGVwcyxcbiAgICAgIHRpbWVGb3JtYXQsXG4gICAgICB0aW1lem9uZSxcbiAgICAgIGRlZmF1bHRUaW1lRm9ybWF0XG4gICAgfSA9IGFuaW1hdGlvbkNvbmZpZztcbiAgICBjb25zdCBvblNsaWRlcjFDaGFuZ2UgPSB1c2VDYWxsYmFjayhcbiAgICAgIHZhbCA9PiB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRpbWVTdGVwcykpIHtcbiAgICAgICAgICBzZXRMYXllckFuaW1hdGlvblRpbWUoc25hcFRvTWFya3ModmFsLCB0aW1lU3RlcHMpKTtcblxuICAgICAgICAgIC8vIFRPRE86IG1lcmdlIHNsaWRlciBpbiB0byBhdm9pZCB0aGlzIHN0ZXBcbiAgICAgICAgfSBlbHNlIGlmICh2YWwgPj0gZG9tYWluWzBdICYmIHZhbCA8PSBkb21haW5bMV0pIHtcbiAgICAgICAgICBzZXRMYXllckFuaW1hdGlvblRpbWUodmFsKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtkb21haW4sIHRpbWVTdGVwcywgc2V0TGF5ZXJBbmltYXRpb25UaW1lXVxuICAgICk7XG5cbiAgICBjb25zdCBkYXRlRnVuYyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgICAgY29uc3QgaGFzVXNlckZvcm1hdCA9IHR5cGVvZiB0aW1lRm9ybWF0ID09PSAnc3RyaW5nJztcbiAgICAgIGNvbnN0IGN1cnJlbnRGb3JtYXQgPSAoaGFzVXNlckZvcm1hdCA/IHRpbWVGb3JtYXQgOiBkZWZhdWx0VGltZUZvcm1hdCkgfHwgREVGQVVMVF9USU1FX0ZPUk1BVDtcbiAgICAgIHJldHVybiBkYXRldGltZUZvcm1hdHRlcih0aW1lem9uZSkoY3VycmVudEZvcm1hdCk7XG4gICAgfSwgW3RpbWVGb3JtYXQsIGRlZmF1bHRUaW1lRm9ybWF0LCB0aW1lem9uZV0pO1xuXG4gICAgY29uc3QgdGltZVN0YXJ0ID0gdXNlTWVtbygoKSA9PiAoZG9tYWluID8gZGF0ZUZ1bmMoZG9tYWluWzBdKSA6ICcnKSwgW2RvbWFpbiwgZGF0ZUZ1bmNdKTtcbiAgICBjb25zdCB0aW1lRW5kID0gdXNlTWVtbygoKSA9PiAoZG9tYWluID8gZGF0ZUZ1bmMoZG9tYWluWzFdKSA6ICcnKSwgW2RvbWFpbiwgZGF0ZUZ1bmNdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Qm90dG9tV2lkZ2V0SW5uZXIgY2xhc3NOYW1lPVwiYm90dG9tLXdpZGdldC0taW5uZXJcIj5cbiAgICAgICAgPEFuaW1hdGlvbldpZGdldElubmVyIGNsYXNzTmFtZT1cImFuaW1hdGlvbi13aWRnZXQtLWlubmVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJhbmltYXRpb24tY29udHJvbF9fdGltZS1zbGlkZXJcIj5cbiAgICAgICAgICAgIDxTdHlsZWREb21haW4gY2xhc3NOYW1lPVwiZG9tYWluLXN0YXJ0XCI+XG4gICAgICAgICAgICAgIDxzcGFuPnt0aW1lU3RhcnR9PC9zcGFuPlxuICAgICAgICAgICAgPC9TdHlsZWREb21haW4+XG4gICAgICAgICAgICA8U2xpZGVyV3JhcHBlciBjbGFzc05hbWU9XCJhbmltYXRpb24tY29udHJvbF9fc2xpZGVyXCI+XG4gICAgICAgICAgICAgIDxTbGlkZXJcbiAgICAgICAgICAgICAgICBpc1JhbmdlZD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgc3RlcD17c3RlcH1cbiAgICAgICAgICAgICAgICBtaW5WYWx1ZT17ZG9tYWluID8gZG9tYWluWzBdIDogMH1cbiAgICAgICAgICAgICAgICBtYXhWYWx1ZT17ZG9tYWluID8gZG9tYWluWzFdIDogMX1cbiAgICAgICAgICAgICAgICB2YWx1ZTE9e2N1cnJlbnRUaW1lfVxuICAgICAgICAgICAgICAgIG9uU2xpZGVyMUNoYW5nZT17b25TbGlkZXIxQ2hhbmdlfVxuICAgICAgICAgICAgICAgIGVuYWJsZUJhckRyYWc9e3RydWV9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1NsaWRlcldyYXBwZXI+XG4gICAgICAgICAgICA8U3R5bGVkRG9tYWluIGNsYXNzTmFtZT1cImRvbWFpbi1lbmRcIj5cbiAgICAgICAgICAgICAgPHNwYW4+e3RpbWVFbmR9PC9zcGFuPlxuICAgICAgICAgICAgPC9TdHlsZWREb21haW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPFBsYXliYWNrQ29udHJvbHNcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImFuaW1hdGlvbi1jb250cm9sLXBsYXlwYXVzZVwiXG4gICAgICAgICAgICBzdGFydEFuaW1hdGlvbj17dG9nZ2xlQW5pbWF0aW9ufVxuICAgICAgICAgICAgaXNBbmltYXRpbmc9e2lzQW5pbWF0aW5nfVxuICAgICAgICAgICAgcGF1c2VBbmltYXRpb249e3RvZ2dsZUFuaW1hdGlvbn1cbiAgICAgICAgICAgIHJlc2V0QW5pbWF0aW9uPXtyZXNldEFuaW1hdGlvbn1cbiAgICAgICAgICAgIHNwZWVkPXtzcGVlZH1cbiAgICAgICAgICAgIGlzQW5pbWF0YWJsZT17aXNBbmltYXRhYmxlfVxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQ9e3VwZGF0ZUFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvQW5pbWF0aW9uV2lkZ2V0SW5uZXI+XG4gICAgICAgIDxGbG9hdGluZ1RpbWVEaXNwbGF5XG4gICAgICAgICAgY3VycmVudFRpbWU9e2N1cnJlbnRUaW1lfVxuICAgICAgICAgIGRlZmF1bHRUaW1lRm9ybWF0PXtkZWZhdWx0VGltZUZvcm1hdH1cbiAgICAgICAgICB0aW1lRm9ybWF0PXt0aW1lRm9ybWF0fVxuICAgICAgICAgIHRpbWV6b25lPXt0aW1lem9uZX1cbiAgICAgICAgLz5cbiAgICAgIDwvQm90dG9tV2lkZ2V0SW5uZXI+XG4gICAgKTtcbiAgfTtcblxuICBBbmltYXRpb25Db250cm9sLmRlZmF1bHRQcm9wcyA9IHtcbiAgICB0b2dnbGVBbmltYXRpb246ICgpID0+IHt9LFxuICAgIHVwZGF0ZUFuaW1hdGlvblNwZWVkOiAoKSA9PiB7fSxcbiAgICBhbmltYXRpb25Db250cm9sUHJvcHM6IHt9LFxuICAgIGFuaW1hdGlvbkNvbmZpZzoge31cbiAgfTtcblxuICByZXR1cm4gQW5pbWF0aW9uQ29udHJvbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQW5pbWF0aW9uQ29udHJvbEZhY3Rvcnk7XG4iXX0=