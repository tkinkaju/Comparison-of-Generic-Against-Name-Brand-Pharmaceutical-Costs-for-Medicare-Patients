// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _classnames = _interopRequireDefault(require("classnames"));

var _icons = require("../icons");

var _constants = require("@kepler.gl/constants");

var _animationSpeedSlider = _interopRequireDefault(require("./animation-speed-slider"));

var _windowActionControl = _interopRequireDefault(require("./window-action-control"));

var _animationWindowControl = _interopRequireDefault(require("./animation-window-control"));

var _resetControl = _interopRequireDefault(require("./reset-control"));

var _playControl = _interopRequireDefault(require("./play-control"));

var _speedControl = _interopRequireDefault(require("./speed-control"));

var _templateObject, _DEFAULT_ANIMATE_ITEM;

var DEFAULT_BUTTON_HEIGHT = '20px';

var StyledAnimationControls = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n\n  &.disabled {\n    opacity: 0.4;\n    pointer-events: none;\n  }\n"])));

var DEFAULT_ICONS = {
  /* eslint-disable react/display-name */
  reset: function reset(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Reset, {
      height: "18px"
    });
  },
  play: function play(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Play, {
      height: "18px"
    });
  },
  pause: function pause(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Pause, {
      height: "18px"
    });
  },
  "export": function _export(_) {
    return /*#__PURE__*/_react["default"].createElement(_icons.Save, {
      height: "18px"
    });
  },

  /* eslint-enable react/display-name */
  speed: _icons.Rocket,
  animationFree: _icons.FreeWindow,
  animationIncremental: _icons.AnchorWindow
};

function nop() {}

var DEFAULT_ANIMATE_ITEMS = (_DEFAULT_ANIMATE_ITEM = {}, (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.free, {
  id: _constants.ANIMATION_WINDOW.free,
  icon: DEFAULT_ICONS.animationFree,
  tooltip: 'tooltip.animationByWindow'
}), (0, _defineProperty2["default"])(_DEFAULT_ANIMATE_ITEM, _constants.ANIMATION_WINDOW.incremental, {
  id: _constants.ANIMATION_WINDOW.incremental,
  icon: DEFAULT_ICONS.animationIncremental,
  tooltip: 'tooltip.animationByIncremental'
}), _DEFAULT_ANIMATE_ITEM);
PlaybackControlsFactory.deps = [// keeping this for backwards compatibility but we can decide to drop it later
_animationSpeedSlider["default"], _windowActionControl["default"], _animationWindowControl["default"], _resetControl["default"], _playControl["default"]];

function PlaybackControlsFactory(AnimationSpeedSlider, WindowActionControl, AnimationWindowControl, ResetControl, PlayControl) {
  var PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS = [PlayControl, (0, _speedControl["default"])(AnimationSpeedSlider), ResetControl, WindowActionControl, AnimationWindowControl]; // eslint-disable-next-line complexity

  var PlaybackControls = function PlaybackControls(_ref) {
    var isAnimatable = _ref.isAnimatable,
        isAnimating = _ref.isAnimating,
        width = _ref.width,
        speed = _ref.speed,
        animationWindow = _ref.animationWindow,
        setFilterAnimationWindow = _ref.setFilterAnimationWindow,
        updateAnimationSpeed = _ref.updateAnimationSpeed,
        pauseAnimation = _ref.pauseAnimation,
        resetAnimation = _ref.resetAnimation,
        startAnimation = _ref.startAnimation,
        playbackIcons = _ref.playbackIcons,
        animationItems = _ref.animationItems,
        buttonStyle = _ref.buttonStyle,
        buttonHeight = _ref.buttonHeight,
        _ref$playbackActionIt = _ref.playbackActionItems,
        playbackActionItems = _ref$playbackActionIt === void 0 ? [] : _ref$playbackActionIt;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        isSpeedControlVisible = _useState2[0],
        toggleSpeedControl = _useState2[1];

    var _useState3 = (0, _react.useState)(false),
        _useState4 = (0, _slicedToArray2["default"])(_useState3, 2),
        showAnimationWindowControl = _useState4[0],
        setShowAnimationWindowControl = _useState4[1];

    var toggleAnimationWindowControl = (0, _react.useCallback)(function () {
      setShowAnimationWindowControl(!showAnimationWindowControl);
    }, [showAnimationWindowControl, setShowAnimationWindowControl]);
    var btnStyle = buttonStyle ? (0, _defineProperty2["default"])({}, buttonStyle, true) : {};
    var hideAndShowSpeedControl = (0, _react.useCallback)(function () {
      if (!isSpeedControlVisible) {
        toggleSpeedControl(true);
      } else {
        // TODO: A HACK to allow input onblur get triggered before the input is unmounted
        // A better solution should be invested, see https://github.com/facebook/react/issues/12363
        window.setTimeout(function () {
          return toggleSpeedControl(false);
        }, 200);
      }
    }, [isSpeedControlVisible, toggleSpeedControl]);
    return /*#__PURE__*/_react["default"].createElement(StyledAnimationControls, {
      className: (0, _classnames["default"])('playback-controls', {
        disabled: !isAnimatable
      }),
      style: {
        width: "".concat(width, "px")
      }
    }, playbackActionItems.map(function (ActionComponent, index) {
      return /*#__PURE__*/_react["default"].createElement(ActionComponent, {
        key: index,
        toggleAnimationWindowControl: toggleAnimationWindowControl,
        showAnimationWindowControl: showAnimationWindowControl,
        btnStyle: btnStyle,
        hideAndShowSpeedControl: hideAndShowSpeedControl,
        animationItems: animationItems,
        animationWindow: animationWindow,
        buttonHeight: buttonHeight,
        setFilterAnimationWindow: setFilterAnimationWindow,
        updateAnimationSpeed: updateAnimationSpeed,
        isAnimating: isAnimating,
        pauseAnimation: pauseAnimation,
        resetAnimation: resetAnimation,
        startAnimation: startAnimation,
        playbackIcons: playbackIcons,
        isSpeedControlVisible: isSpeedControlVisible,
        speed: speed
      });
    }));
  };

  PlaybackControls.defaultProps = {
    playbackIcons: DEFAULT_ICONS,
    animationItems: DEFAULT_ANIMATE_ITEMS,
    buttonStyle: 'secondary',
    buttonHeight: DEFAULT_BUTTON_HEIGHT,
    playbackActionItems: PLAYBACK_CONTROLS_DEFAULT_ACTION_COMPONENTS,
    animationWindow: _constants.ANIMATION_WINDOW.free,
    isAnimatable: true,
    pauseAnimation: nop,
    resetAnimation: nop,
    startAnimation: nop
  };
  return PlaybackControls;
}

var _default = PlaybackControlsFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvcGxheWJhY2stY29udHJvbHMudHN4Il0sIm5hbWVzIjpbIkRFRkFVTFRfQlVUVE9OX0hFSUdIVCIsIlN0eWxlZEFuaW1hdGlvbkNvbnRyb2xzIiwic3R5bGVkIiwiZGl2IiwiREVGQVVMVF9JQ09OUyIsInJlc2V0IiwiXyIsInBsYXkiLCJwYXVzZSIsInNwZWVkIiwiUm9ja2V0IiwiYW5pbWF0aW9uRnJlZSIsIkZyZWVXaW5kb3ciLCJhbmltYXRpb25JbmNyZW1lbnRhbCIsIkFuY2hvcldpbmRvdyIsIm5vcCIsIkRFRkFVTFRfQU5JTUFURV9JVEVNUyIsIkFOSU1BVElPTl9XSU5ET1ciLCJmcmVlIiwiaWQiLCJpY29uIiwidG9vbHRpcCIsImluY3JlbWVudGFsIiwiUGxheWJhY2tDb250cm9sc0ZhY3RvcnkiLCJkZXBzIiwiQW5pbWF0aW9uU3BlZWRTbGlkZXJGYWN0b3J5IiwiV2luZG93QWN0aW9uQ29udHJvbEZhY3RvcnkiLCJBbmltYXRpb25XaW5kb3dDb250cm9sRmFjdG9yeSIsIlJlc2V0Q29udHJvbEZhY3RvcnkiLCJQbGF5Q29udHJvbEZhY3RvcnkiLCJBbmltYXRpb25TcGVlZFNsaWRlciIsIldpbmRvd0FjdGlvbkNvbnRyb2wiLCJBbmltYXRpb25XaW5kb3dDb250cm9sIiwiUmVzZXRDb250cm9sIiwiUGxheUNvbnRyb2wiLCJQTEFZQkFDS19DT05UUk9MU19ERUZBVUxUX0FDVElPTl9DT01QT05FTlRTIiwiUGxheWJhY2tDb250cm9scyIsImlzQW5pbWF0YWJsZSIsImlzQW5pbWF0aW5nIiwid2lkdGgiLCJhbmltYXRpb25XaW5kb3ciLCJzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3ciLCJ1cGRhdGVBbmltYXRpb25TcGVlZCIsInBhdXNlQW5pbWF0aW9uIiwicmVzZXRBbmltYXRpb24iLCJzdGFydEFuaW1hdGlvbiIsInBsYXliYWNrSWNvbnMiLCJhbmltYXRpb25JdGVtcyIsImJ1dHRvblN0eWxlIiwiYnV0dG9uSGVpZ2h0IiwicGxheWJhY2tBY3Rpb25JdGVtcyIsImlzU3BlZWRDb250cm9sVmlzaWJsZSIsInRvZ2dsZVNwZWVkQ29udHJvbCIsInNob3dBbmltYXRpb25XaW5kb3dDb250cm9sIiwic2V0U2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2wiLCJ0b2dnbGVBbmltYXRpb25XaW5kb3dDb250cm9sIiwiYnRuU3R5bGUiLCJoaWRlQW5kU2hvd1NwZWVkQ29udHJvbCIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJkaXNhYmxlZCIsIm1hcCIsIkFjdGlvbkNvbXBvbmVudCIsImluZGV4IiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLElBQU1BLHFCQUFxQixHQUFHLE1BQTlCOztBQUVBLElBQU1DLHVCQUF1QixHQUFHQyw2QkFBT0MsR0FBVixzTUFBN0I7O0FBVUEsSUFBTUMsYUFBYSxHQUFHO0FBQ3BCO0FBQ0FDLEVBQUFBLEtBQUssRUFBRSxlQUFBQyxDQUFDO0FBQUEsd0JBQUksZ0NBQUMsWUFBRDtBQUFPLE1BQUEsTUFBTSxFQUFDO0FBQWQsTUFBSjtBQUFBLEdBRlk7QUFHcEJDLEVBQUFBLElBQUksRUFBRSxjQUFBRCxDQUFDO0FBQUEsd0JBQUksZ0NBQUMsV0FBRDtBQUFNLE1BQUEsTUFBTSxFQUFDO0FBQWIsTUFBSjtBQUFBLEdBSGE7QUFJcEJFLEVBQUFBLEtBQUssRUFBRSxlQUFBRixDQUFDO0FBQUEsd0JBQUksZ0NBQUMsWUFBRDtBQUFPLE1BQUEsTUFBTSxFQUFDO0FBQWQsTUFBSjtBQUFBLEdBSlk7QUFLcEIsWUFBUSxpQkFBQUEsQ0FBQztBQUFBLHdCQUFJLGdDQUFDLFdBQUQ7QUFBTSxNQUFBLE1BQU0sRUFBQztBQUFiLE1BQUo7QUFBQSxHQUxXOztBQU1wQjtBQUNBRyxFQUFBQSxLQUFLLEVBQUVDLGFBUGE7QUFRcEJDLEVBQUFBLGFBQWEsRUFBRUMsaUJBUks7QUFTcEJDLEVBQUFBLG9CQUFvQixFQUFFQztBQVRGLENBQXRCOztBQVlBLFNBQVNDLEdBQVQsR0FBZSxDQUFFOztBQUVqQixJQUFNQyxxQkFBcUIsd0ZBQ3hCQyw0QkFBaUJDLElBRE8sRUFDQTtBQUN2QkMsRUFBQUEsRUFBRSxFQUFFRiw0QkFBaUJDLElBREU7QUFFdkJFLEVBQUFBLElBQUksRUFBRWhCLGFBQWEsQ0FBQ08sYUFGRztBQUd2QlUsRUFBQUEsT0FBTyxFQUFFO0FBSGMsQ0FEQSwyREFNeEJKLDRCQUFpQkssV0FOTyxFQU1PO0FBQzlCSCxFQUFBQSxFQUFFLEVBQUVGLDRCQUFpQkssV0FEUztBQUU5QkYsRUFBQUEsSUFBSSxFQUFFaEIsYUFBYSxDQUFDUyxvQkFGVTtBQUc5QlEsRUFBQUEsT0FBTyxFQUFFO0FBSHFCLENBTlAseUJBQTNCO0FBK0JBRSx1QkFBdUIsQ0FBQ0MsSUFBeEIsR0FBK0IsQ0FDN0I7QUFDQUMsZ0NBRjZCLEVBRzdCQywrQkFINkIsRUFJN0JDLGtDQUo2QixFQUs3QkMsd0JBTDZCLEVBTTdCQyx1QkFONkIsQ0FBL0I7O0FBU0EsU0FBU04sdUJBQVQsQ0FDRU8sb0JBREYsRUFFRUMsbUJBRkYsRUFHRUMsc0JBSEYsRUFJRUMsWUFKRixFQUtFQyxXQUxGLEVBTUU7QUFDQSxNQUFNQywyQ0FBMkMsR0FBRyxDQUNsREQsV0FEa0QsRUFFbEQsOEJBQW9CSixvQkFBcEIsQ0FGa0QsRUFHbERHLFlBSGtELEVBSWxERixtQkFKa0QsRUFLbERDLHNCQUxrRCxDQUFwRCxDQURBLENBU0E7O0FBQ0EsTUFBTUksZ0JBQWlELEdBQUcsU0FBcERBLGdCQUFvRCxPQWdCcEQ7QUFBQSxRQWZKQyxZQWVJLFFBZkpBLFlBZUk7QUFBQSxRQWRKQyxXQWNJLFFBZEpBLFdBY0k7QUFBQSxRQWJKQyxLQWFJLFFBYkpBLEtBYUk7QUFBQSxRQVpKOUIsS0FZSSxRQVpKQSxLQVlJO0FBQUEsUUFYSitCLGVBV0ksUUFYSkEsZUFXSTtBQUFBLFFBVkpDLHdCQVVJLFFBVkpBLHdCQVVJO0FBQUEsUUFUSkMsb0JBU0ksUUFUSkEsb0JBU0k7QUFBQSxRQVJKQyxjQVFJLFFBUkpBLGNBUUk7QUFBQSxRQVBKQyxjQU9JLFFBUEpBLGNBT0k7QUFBQSxRQU5KQyxjQU1JLFFBTkpBLGNBTUk7QUFBQSxRQUxKQyxhQUtJLFFBTEpBLGFBS0k7QUFBQSxRQUpKQyxjQUlJLFFBSkpBLGNBSUk7QUFBQSxRQUhKQyxXQUdJLFFBSEpBLFdBR0k7QUFBQSxRQUZKQyxZQUVJLFFBRkpBLFlBRUk7QUFBQSxxQ0FESkMsbUJBQ0k7QUFBQSxRQURKQSxtQkFDSSxzQ0FEa0IsRUFDbEI7O0FBQUEsb0JBQ2dELHFCQUFTLEtBQVQsQ0FEaEQ7QUFBQTtBQUFBLFFBQ0dDLHFCQURIO0FBQUEsUUFDMEJDLGtCQUQxQjs7QUFBQSxxQkFFZ0UscUJBQVMsS0FBVCxDQUZoRTtBQUFBO0FBQUEsUUFFR0MsMEJBRkg7QUFBQSxRQUUrQkMsNkJBRi9COztBQUlKLFFBQU1DLDRCQUE0QixHQUFHLHdCQUFZLFlBQU07QUFDckRELE1BQUFBLDZCQUE2QixDQUFDLENBQUNELDBCQUFGLENBQTdCO0FBQ0QsS0FGb0MsRUFFbEMsQ0FBQ0EsMEJBQUQsRUFBNkJDLDZCQUE3QixDQUZrQyxDQUFyQztBQUdBLFFBQU1FLFFBQVEsR0FBR1IsV0FBVyx3Q0FBS0EsV0FBTCxFQUFtQixJQUFuQixJQUEyQixFQUF2RDtBQUVBLFFBQU1TLHVCQUF1QixHQUFHLHdCQUFZLFlBQU07QUFDaEQsVUFBSSxDQUFDTixxQkFBTCxFQUE0QjtBQUMxQkMsUUFBQUEsa0JBQWtCLENBQUMsSUFBRCxDQUFsQjtBQUNELE9BRkQsTUFFTztBQUNMO0FBQ0E7QUFDQU0sUUFBQUEsTUFBTSxDQUFDQyxVQUFQLENBQWtCO0FBQUEsaUJBQU1QLGtCQUFrQixDQUFDLEtBQUQsQ0FBeEI7QUFBQSxTQUFsQixFQUFtRCxHQUFuRDtBQUNEO0FBQ0YsS0FSK0IsRUFRN0IsQ0FBQ0QscUJBQUQsRUFBd0JDLGtCQUF4QixDQVI2QixDQUFoQztBQVVBLHdCQUNFLGdDQUFDLHVCQUFEO0FBQ0UsTUFBQSxTQUFTLEVBQUUsNEJBQVcsbUJBQVgsRUFBZ0M7QUFDekNRLFFBQUFBLFFBQVEsRUFBRSxDQUFDdkI7QUFEOEIsT0FBaEMsQ0FEYjtBQUlFLE1BQUEsS0FBSyxFQUFFO0FBQUNFLFFBQUFBLEtBQUssWUFBS0EsS0FBTDtBQUFOO0FBSlQsT0FPR1csbUJBQW1CLENBQUNXLEdBQXBCLENBQXdCLFVBQUNDLGVBQUQsRUFBa0JDLEtBQWxCO0FBQUEsMEJBQ3ZCLGdDQUFDLGVBQUQ7QUFDRSxRQUFBLEdBQUcsRUFBRUEsS0FEUDtBQUVFLFFBQUEsNEJBQTRCLEVBQUVSLDRCQUZoQztBQUdFLFFBQUEsMEJBQTBCLEVBQUVGLDBCQUg5QjtBQUlFLFFBQUEsUUFBUSxFQUFFRyxRQUpaO0FBS0UsUUFBQSx1QkFBdUIsRUFBRUMsdUJBTDNCO0FBTUUsUUFBQSxjQUFjLEVBQUVWLGNBTmxCO0FBT0UsUUFBQSxlQUFlLEVBQUVQLGVBUG5CO0FBUUUsUUFBQSxZQUFZLEVBQUVTLFlBUmhCO0FBU0UsUUFBQSx3QkFBd0IsRUFBRVIsd0JBVDVCO0FBVUUsUUFBQSxvQkFBb0IsRUFBRUMsb0JBVnhCO0FBV0UsUUFBQSxXQUFXLEVBQUVKLFdBWGY7QUFZRSxRQUFBLGNBQWMsRUFBRUssY0FabEI7QUFhRSxRQUFBLGNBQWMsRUFBRUMsY0FibEI7QUFjRSxRQUFBLGNBQWMsRUFBRUMsY0FkbEI7QUFlRSxRQUFBLGFBQWEsRUFBRUMsYUFmakI7QUFnQkUsUUFBQSxxQkFBcUIsRUFBRUsscUJBaEJ6QjtBQWlCRSxRQUFBLEtBQUssRUFBRTFDO0FBakJULFFBRHVCO0FBQUEsS0FBeEIsQ0FQSCxDQURGO0FBK0JELEdBbEVEOztBQW9FQTJCLEVBQUFBLGdCQUFnQixDQUFDNEIsWUFBakIsR0FBZ0M7QUFDOUJsQixJQUFBQSxhQUFhLEVBQUUxQyxhQURlO0FBRTlCMkMsSUFBQUEsY0FBYyxFQUFFL0IscUJBRmM7QUFHOUJnQyxJQUFBQSxXQUFXLEVBQUUsV0FIaUI7QUFJOUJDLElBQUFBLFlBQVksRUFBRWpELHFCQUpnQjtBQUs5QmtELElBQUFBLG1CQUFtQixFQUFFZiwyQ0FMUztBQU05QkssSUFBQUEsZUFBZSxFQUFFdkIsNEJBQWlCQyxJQU5KO0FBTzlCbUIsSUFBQUEsWUFBWSxFQUFFLElBUGdCO0FBUTlCTSxJQUFBQSxjQUFjLEVBQUU1QixHQVJjO0FBUzlCNkIsSUFBQUEsY0FBYyxFQUFFN0IsR0FUYztBQVU5QjhCLElBQUFBLGNBQWMsRUFBRTlCO0FBVmMsR0FBaEM7QUFhQSxTQUFPcUIsZ0JBQVA7QUFDRDs7ZUFFY2IsdUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjIgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QsIHt1c2VTdGF0ZSwgdXNlQ2FsbGJhY2t9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQge1Jlc2V0LCBQbGF5LCBQYXVzZSwgU2F2ZSwgUm9ja2V0LCBBbmNob3JXaW5kb3csIEZyZWVXaW5kb3d9IGZyb20gJy4uL2ljb25zJztcbmltcG9ydCB7QU5JTUFUSU9OX1dJTkRPV30gZnJvbSAnQGtlcGxlci5nbC9jb25zdGFudHMnO1xuaW1wb3J0IEFuaW1hdGlvblNwZWVkU2xpZGVyRmFjdG9yeSBmcm9tICcuL2FuaW1hdGlvbi1zcGVlZC1zbGlkZXInO1xuaW1wb3J0IFdpbmRvd0FjdGlvbkNvbnRyb2xGYWN0b3J5IGZyb20gJy4vd2luZG93LWFjdGlvbi1jb250cm9sJztcbmltcG9ydCBBbmltYXRpb25XaW5kb3dDb250cm9sRmFjdG9yeSwge0FuaW1hdGlvbkl0ZW19IGZyb20gJy4vYW5pbWF0aW9uLXdpbmRvdy1jb250cm9sJztcbmltcG9ydCBSZXNldENvbnRyb2xGYWN0b3J5IGZyb20gJy4vcmVzZXQtY29udHJvbCc7XG5pbXBvcnQgUGxheUNvbnRyb2xGYWN0b3J5IGZyb20gJy4vcGxheS1jb250cm9sJztcbmltcG9ydCBTcGVlZENvbnRyb2xGYWN0b3J5IGZyb20gJy4vc3BlZWQtY29udHJvbCc7XG5cbmNvbnN0IERFRkFVTFRfQlVUVE9OX0hFSUdIVCA9ICcyMHB4JztcblxuY29uc3QgU3R5bGVkQW5pbWF0aW9uQ29udHJvbHMgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG5cbiAgJi5kaXNhYmxlZCB7XG4gICAgb3BhY2l0eTogMC40O1xuICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICB9XG5gO1xuXG5jb25zdCBERUZBVUxUX0lDT05TID0ge1xuICAvKiBlc2xpbnQtZGlzYWJsZSByZWFjdC9kaXNwbGF5LW5hbWUgKi9cbiAgcmVzZXQ6IF8gPT4gPFJlc2V0IGhlaWdodD1cIjE4cHhcIiAvPixcbiAgcGxheTogXyA9PiA8UGxheSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIHBhdXNlOiBfID0+IDxQYXVzZSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIGV4cG9ydDogXyA9PiA8U2F2ZSBoZWlnaHQ9XCIxOHB4XCIgLz4sXG4gIC8qIGVzbGludC1lbmFibGUgcmVhY3QvZGlzcGxheS1uYW1lICovXG4gIHNwZWVkOiBSb2NrZXQsXG4gIGFuaW1hdGlvbkZyZWU6IEZyZWVXaW5kb3csXG4gIGFuaW1hdGlvbkluY3JlbWVudGFsOiBBbmNob3JXaW5kb3dcbn07XG5cbmZ1bmN0aW9uIG5vcCgpIHt9XG5cbmNvbnN0IERFRkFVTFRfQU5JTUFURV9JVEVNUyA9IHtcbiAgW0FOSU1BVElPTl9XSU5ET1cuZnJlZV06IHtcbiAgICBpZDogQU5JTUFUSU9OX1dJTkRPVy5mcmVlLFxuICAgIGljb246IERFRkFVTFRfSUNPTlMuYW5pbWF0aW9uRnJlZSxcbiAgICB0b29sdGlwOiAndG9vbHRpcC5hbmltYXRpb25CeVdpbmRvdydcbiAgfSxcbiAgW0FOSU1BVElPTl9XSU5ET1cuaW5jcmVtZW50YWxdOiB7XG4gICAgaWQ6IEFOSU1BVElPTl9XSU5ET1cuaW5jcmVtZW50YWwsXG4gICAgaWNvbjogREVGQVVMVF9JQ09OUy5hbmltYXRpb25JbmNyZW1lbnRhbCxcbiAgICB0b29sdGlwOiAndG9vbHRpcC5hbmltYXRpb25CeUluY3JlbWVudGFsJ1xuICB9XG59O1xuaW50ZXJmYWNlIFBsYXliYWNrQ29udHJvbHNQcm9wcyB7XG4gIGlzQW5pbWF0YWJsZT86IGJvb2xlYW47XG4gIGlzQW5pbWF0aW5nPzogYm9vbGVhbjtcbiAgd2lkdGg/OiBudW1iZXIgfCBzdHJpbmc7XG4gIHNwZWVkOiBudW1iZXI7XG4gIGFuaW1hdGlvbldpbmRvdz86IHN0cmluZztcbiAgc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93PzogKGlkOiBzdHJpbmcpID0+IHZvaWQ7XG4gIHVwZGF0ZUFuaW1hdGlvblNwZWVkPzogKHZhbDogbnVtYmVyKSA9PiB2b2lkO1xuICBwYXVzZUFuaW1hdGlvbj86ICgpID0+IHZvaWQ7XG4gIHJlc2V0QW5pbWF0aW9uPzogKCkgPT4gdm9pZDtcbiAgc3RhcnRBbmltYXRpb246ICgpID0+IHZvaWQ7XG4gIHBsYXliYWNrSWNvbnM/OiB0eXBlb2YgREVGQVVMVF9JQ09OUztcbiAgYW5pbWF0aW9uSXRlbXM/OiB7W2tleTogc3RyaW5nXTogQW5pbWF0aW9uSXRlbX07XG4gIGJ1dHRvblN0eWxlPzogc3RyaW5nO1xuICBidXR0b25IZWlnaHQ/OiBzdHJpbmc7XG4gIHBsYXliYWNrQWN0aW9uSXRlbXM/OiBhbnlbXTtcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xufVxuXG5QbGF5YmFja0NvbnRyb2xzRmFjdG9yeS5kZXBzID0gW1xuICAvLyBrZWVwaW5nIHRoaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGJ1dCB3ZSBjYW4gZGVjaWRlIHRvIGRyb3AgaXQgbGF0ZXJcbiAgQW5pbWF0aW9uU3BlZWRTbGlkZXJGYWN0b3J5LFxuICBXaW5kb3dBY3Rpb25Db250cm9sRmFjdG9yeSxcbiAgQW5pbWF0aW9uV2luZG93Q29udHJvbEZhY3RvcnksXG4gIFJlc2V0Q29udHJvbEZhY3RvcnksXG4gIFBsYXlDb250cm9sRmFjdG9yeVxuXTtcblxuZnVuY3Rpb24gUGxheWJhY2tDb250cm9sc0ZhY3RvcnkoXG4gIEFuaW1hdGlvblNwZWVkU2xpZGVyOiBSZXR1cm5UeXBlPHR5cGVvZiBBbmltYXRpb25TcGVlZFNsaWRlckZhY3Rvcnk+LFxuICBXaW5kb3dBY3Rpb25Db250cm9sLFxuICBBbmltYXRpb25XaW5kb3dDb250cm9sLFxuICBSZXNldENvbnRyb2wsXG4gIFBsYXlDb250cm9sXG4pIHtcbiAgY29uc3QgUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyA9IFtcbiAgICBQbGF5Q29udHJvbCxcbiAgICBTcGVlZENvbnRyb2xGYWN0b3J5KEFuaW1hdGlvblNwZWVkU2xpZGVyKSxcbiAgICBSZXNldENvbnRyb2wsXG4gICAgV2luZG93QWN0aW9uQ29udHJvbCxcbiAgICBBbmltYXRpb25XaW5kb3dDb250cm9sXG4gIF07XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBsZXhpdHlcbiAgY29uc3QgUGxheWJhY2tDb250cm9sczogUmVhY3QuRkM8UGxheWJhY2tDb250cm9sc1Byb3BzPiA9ICh7XG4gICAgaXNBbmltYXRhYmxlLFxuICAgIGlzQW5pbWF0aW5nLFxuICAgIHdpZHRoLFxuICAgIHNwZWVkLFxuICAgIGFuaW1hdGlvbldpbmRvdyxcbiAgICBzZXRGaWx0ZXJBbmltYXRpb25XaW5kb3csXG4gICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQsXG4gICAgcGF1c2VBbmltYXRpb24sXG4gICAgcmVzZXRBbmltYXRpb24sXG4gICAgc3RhcnRBbmltYXRpb24sXG4gICAgcGxheWJhY2tJY29ucyxcbiAgICBhbmltYXRpb25JdGVtcyxcbiAgICBidXR0b25TdHlsZSxcbiAgICBidXR0b25IZWlnaHQsXG4gICAgcGxheWJhY2tBY3Rpb25JdGVtcyA9IFtdXG4gIH0pID0+IHtcbiAgICBjb25zdCBbaXNTcGVlZENvbnRyb2xWaXNpYmxlLCB0b2dnbGVTcGVlZENvbnRyb2xdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFtzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCwgc2V0U2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2xdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gICAgY29uc3QgdG9nZ2xlQW5pbWF0aW9uV2luZG93Q29udHJvbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIHNldFNob3dBbmltYXRpb25XaW5kb3dDb250cm9sKCFzaG93QW5pbWF0aW9uV2luZG93Q29udHJvbCk7XG4gICAgfSwgW3Nob3dBbmltYXRpb25XaW5kb3dDb250cm9sLCBzZXRTaG93QW5pbWF0aW9uV2luZG93Q29udHJvbF0pO1xuICAgIGNvbnN0IGJ0blN0eWxlID0gYnV0dG9uU3R5bGUgPyB7W2J1dHRvblN0eWxlXTogdHJ1ZX0gOiB7fTtcblxuICAgIGNvbnN0IGhpZGVBbmRTaG93U3BlZWRDb250cm9sID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgaWYgKCFpc1NwZWVkQ29udHJvbFZpc2libGUpIHtcbiAgICAgICAgdG9nZ2xlU3BlZWRDb250cm9sKHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVE9ETzogQSBIQUNLIHRvIGFsbG93IGlucHV0IG9uYmx1ciBnZXQgdHJpZ2dlcmVkIGJlZm9yZSB0aGUgaW5wdXQgaXMgdW5tb3VudGVkXG4gICAgICAgIC8vIEEgYmV0dGVyIHNvbHV0aW9uIHNob3VsZCBiZSBpbnZlc3RlZCwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9pc3N1ZXMvMTIzNjNcbiAgICAgICAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdG9nZ2xlU3BlZWRDb250cm9sKGZhbHNlKSwgMjAwKTtcbiAgICAgIH1cbiAgICB9LCBbaXNTcGVlZENvbnRyb2xWaXNpYmxlLCB0b2dnbGVTcGVlZENvbnRyb2xdKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkQW5pbWF0aW9uQ29udHJvbHNcbiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc25hbWVzKCdwbGF5YmFjay1jb250cm9scycsIHtcbiAgICAgICAgICBkaXNhYmxlZDogIWlzQW5pbWF0YWJsZVxuICAgICAgICB9KX1cbiAgICAgICAgc3R5bGU9e3t3aWR0aDogYCR7d2lkdGh9cHhgfX1cbiAgICAgID5cbiAgICAgICAgey8qKiBXaW5kb3cgKi99XG4gICAgICAgIHtwbGF5YmFja0FjdGlvbkl0ZW1zLm1hcCgoQWN0aW9uQ29tcG9uZW50LCBpbmRleCkgPT4gKFxuICAgICAgICAgIDxBY3Rpb25Db21wb25lbnRcbiAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICB0b2dnbGVBbmltYXRpb25XaW5kb3dDb250cm9sPXt0b2dnbGVBbmltYXRpb25XaW5kb3dDb250cm9sfVxuICAgICAgICAgICAgc2hvd0FuaW1hdGlvbldpbmRvd0NvbnRyb2w9e3Nob3dBbmltYXRpb25XaW5kb3dDb250cm9sfVxuICAgICAgICAgICAgYnRuU3R5bGU9e2J0blN0eWxlfVxuICAgICAgICAgICAgaGlkZUFuZFNob3dTcGVlZENvbnRyb2w9e2hpZGVBbmRTaG93U3BlZWRDb250cm9sfVxuICAgICAgICAgICAgYW5pbWF0aW9uSXRlbXM9e2FuaW1hdGlvbkl0ZW1zfVxuICAgICAgICAgICAgYW5pbWF0aW9uV2luZG93PXthbmltYXRpb25XaW5kb3d9XG4gICAgICAgICAgICBidXR0b25IZWlnaHQ9e2J1dHRvbkhlaWdodH1cbiAgICAgICAgICAgIHNldEZpbHRlckFuaW1hdGlvbldpbmRvdz17c2V0RmlsdGVyQW5pbWF0aW9uV2luZG93fVxuICAgICAgICAgICAgdXBkYXRlQW5pbWF0aW9uU3BlZWQ9e3VwZGF0ZUFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgICAgaXNBbmltYXRpbmc9e2lzQW5pbWF0aW5nfVxuICAgICAgICAgICAgcGF1c2VBbmltYXRpb249e3BhdXNlQW5pbWF0aW9ufVxuICAgICAgICAgICAgcmVzZXRBbmltYXRpb249e3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgICAgc3RhcnRBbmltYXRpb249e3N0YXJ0QW5pbWF0aW9ufVxuICAgICAgICAgICAgcGxheWJhY2tJY29ucz17cGxheWJhY2tJY29uc31cbiAgICAgICAgICAgIGlzU3BlZWRDb250cm9sVmlzaWJsZT17aXNTcGVlZENvbnRyb2xWaXNpYmxlfVxuICAgICAgICAgICAgc3BlZWQ9e3NwZWVkfVxuICAgICAgICAgIC8+XG4gICAgICAgICkpfVxuICAgICAgPC9TdHlsZWRBbmltYXRpb25Db250cm9scz5cbiAgICApO1xuICB9O1xuXG4gIFBsYXliYWNrQ29udHJvbHMuZGVmYXVsdFByb3BzID0ge1xuICAgIHBsYXliYWNrSWNvbnM6IERFRkFVTFRfSUNPTlMsXG4gICAgYW5pbWF0aW9uSXRlbXM6IERFRkFVTFRfQU5JTUFURV9JVEVNUyxcbiAgICBidXR0b25TdHlsZTogJ3NlY29uZGFyeScsXG4gICAgYnV0dG9uSGVpZ2h0OiBERUZBVUxUX0JVVFRPTl9IRUlHSFQsXG4gICAgcGxheWJhY2tBY3Rpb25JdGVtczogUExBWUJBQ0tfQ09OVFJPTFNfREVGQVVMVF9BQ1RJT05fQ09NUE9ORU5UUyxcbiAgICBhbmltYXRpb25XaW5kb3c6IEFOSU1BVElPTl9XSU5ET1cuZnJlZSxcbiAgICBpc0FuaW1hdGFibGU6IHRydWUsXG4gICAgcGF1c2VBbmltYXRpb246IG5vcCxcbiAgICByZXNldEFuaW1hdGlvbjogbm9wLFxuICAgIHN0YXJ0QW5pbWF0aW9uOiBub3BcbiAgfTtcblxuICByZXR1cm4gUGxheWJhY2tDb250cm9scztcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGxheWJhY2tDb250cm9sc0ZhY3Rvcnk7XG4iXX0=