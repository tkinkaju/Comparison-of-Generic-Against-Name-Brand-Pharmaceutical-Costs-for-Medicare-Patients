// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.TimeWidgetTopFactory = TimeWidgetTopFactory;
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _styledComponents2 = require("../common/styled-components");

var _icons = require("../common/icons");

var _timeRangeSlider = _interopRequireDefault(require("../common/time-range-slider"));

var _fieldSelector = _interopRequireDefault(require("../common/field-selector"));

var _floatingTimeDisplay = _interopRequireDefault(require("../common/animation-control/floating-time-display"));

var _timeRangeFilter = require("./time-range-filter");

var _templateObject, _templateObject2, _templateObject3;

var TOP_SECTION_HEIGHT = '36px';
var TimeBottomWidgetInner = (0, _styledComponents["default"])(_styledComponents2.BottomWidgetInner)(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  padding: 6px 32px 24px 32px;\n"])));

var TopSectionWrapper = _styledComponents["default"].div.attrs({
  className: 'time-widget--top'
})(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  justify-content: space-between;\n  width: 100%;\n  color: ", ";\n  height: ", ";\n\n  .bottom-widget__y-axis {\n    flex-grow: 1;\n    margin-left: 20px;\n  }\n\n  .bottom-widget__field-select {\n    width: 160px;\n    display: inline-block;\n\n    .item-selector__dropdown {\n      background: transparent;\n      padding: 4px 10px 4px 4px;\n      border-color: transparent;\n\n      :active,\n      :focus,\n      &.focus,\n      &.active {\n        background: transparent;\n        border-color: transparent;\n      }\n    }\n\n    .item-selector__dropdown:hover {\n      background: transparent;\n      border-color: transparent;\n\n      .item-selector__dropdown__value {\n        color: ", ";\n      }\n    }\n  }\n\n  .animation-control__speed-control {\n    margin-right: -12px;\n\n    .animation-control__speed-slider {\n      right: calc(0% - 48px);\n    }\n  }\n"])), function (props) {
  return props.theme.labelColor;
}, TOP_SECTION_HEIGHT, function (props) {
  return props.hoverColor ? props.theme[props.hoverColor] : props.theme.textColorHl;
});

var StyledTitle = (0, _styledComponents["default"])(_styledComponents2.CenterFlexbox)(_templateObject3 || (_templateObject3 = (0, _taggedTemplateLiteral2["default"])(["\n  flex-grow: 0;\n  color: ", ";\n  margin-right: 10px;\n\n  .bottom-widget__icon {\n    margin-right: 6px;\n  }\n  .bottom-widget__icon.speed {\n    margin-right: 0;\n  }\n"])), function (props) {
  return props.theme.textColor;
});
TimeWidgetTopFactory.deps = [_fieldSelector["default"]];

function TimeWidgetTopFactory(FieldSelector) {
  var TimeWidgetTop = function TimeWidgetTop(_ref) {
    var filter = _ref.filter,
        readOnly = _ref.readOnly,
        datasets = _ref.datasets,
        setFilterPlot = _ref.setFilterPlot,
        index = _ref.index,
        onClose = _ref.onClose;
    var yAxisFields = (0, _react.useMemo)(function () {
      return ((datasets[filter.dataId[0]] || {}).fields || []).filter(function (f) {
        return f.type === 'integer' || f.type === 'real';
      });
    }, [datasets, filter.dataId]);

    var _setFilterPlotYAxis = (0, _react.useCallback)(function (value) {
      return setFilterPlot(index, {
        yAxis: value
      });
    }, [setFilterPlot, index]);

    return /*#__PURE__*/_react["default"].createElement(TopSectionWrapper, null, /*#__PURE__*/_react["default"].createElement(StyledTitle, {
      className: "bottom-widget__field"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.CenterFlexbox, {
      className: "bottom-widget__icon"
    }, /*#__PURE__*/_react["default"].createElement(_icons.Clock, {
      height: "15px"
    })), /*#__PURE__*/_react["default"].createElement(_styledComponents2.SelectTextBold, null, filter.name)), /*#__PURE__*/_react["default"].createElement(StyledTitle, {
      className: "bottom-widget__y-axis"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.CenterFlexbox, {
      className: "bottom-widget__icon"
    }, /*#__PURE__*/_react["default"].createElement(_icons.LineChart, {
      height: "15px"
    })), /*#__PURE__*/_react["default"].createElement("div", {
      className: "bottom-widget__field-select"
    }, /*#__PURE__*/_react["default"].createElement(FieldSelector, {
      fields: yAxisFields,
      placement: "top",
      value: filter.yAxis ? filter.yAxis.name : null,
      onSelect: _setFilterPlotYAxis,
      placeholder: "placeholder.yAxis",
      erasable: true,
      showToken: false
    }))), !readOnly ? /*#__PURE__*/_react["default"].createElement(_styledComponents2.CenterFlexbox, null, /*#__PURE__*/_react["default"].createElement(_styledComponents2.IconRoundSmall, null, /*#__PURE__*/_react["default"].createElement(_icons.Close, {
      height: "12px",
      onClick: onClose
    }))) : null);
  };

  return TimeWidgetTop;
}

TimeWidgetFactory.deps = [_timeRangeSlider["default"], _floatingTimeDisplay["default"], TimeWidgetTopFactory];

function TimeWidgetFactory(TimeRangeSlider, FloatingTimeDisplay, TimeWidgetTop) {
  var TimeWidget = function TimeWidget(_ref2) {
    var datasets = _ref2.datasets,
        filter = _ref2.filter,
        index = _ref2.index,
        readOnly = _ref2.readOnly,
        showTimeDisplay = _ref2.showTimeDisplay,
        setFilterAnimationTime = _ref2.setFilterAnimationTime,
        resetAnimation = _ref2.resetAnimation,
        isAnimatable = _ref2.isAnimatable,
        updateAnimationSpeed = _ref2.updateAnimationSpeed,
        toggleAnimation = _ref2.toggleAnimation,
        enlargeFilter = _ref2.enlargeFilter,
        setFilterPlot = _ref2.setFilterPlot,
        setFilterAnimationWindow = _ref2.setFilterAnimationWindow;

    var _updateAnimationSpeed = (0, _react.useCallback)(function (speed) {
      return updateAnimationSpeed(index, speed);
    }, [updateAnimationSpeed, index]);

    var _toggleAnimation = (0, _react.useCallback)(function () {
      return toggleAnimation(index);
    }, [toggleAnimation, index]);

    var _onClose = (0, _react.useCallback)(function () {
      return enlargeFilter(index);
    }, [enlargeFilter, index]);

    var _setFilterAnimationWindow = (0, _react.useCallback)(function (animationWindow) {
      return setFilterAnimationWindow({
        id: filter.id,
        animationWindow: animationWindow
      });
    }, [setFilterAnimationWindow, filter.id]);

    var timeSliderOnChange = (0, _react.useCallback)(function (value) {
      return setFilterAnimationTime(index, 'value', value);
    }, [setFilterAnimationTime, index]);
    return /*#__PURE__*/_react["default"].createElement(TimeBottomWidgetInner, {
      className: "bottom-widget--inner"
    }, /*#__PURE__*/_react["default"].createElement(TimeWidgetTop, {
      filter: filter,
      readOnly: readOnly,
      datasets: datasets,
      setFilterPlot: setFilterPlot,
      index: index,
      onClose: _onClose
    }), /*#__PURE__*/_react["default"].createElement(TimeRangeSlider, (0, _extends2["default"])({}, (0, _timeRangeFilter.timeRangeSliderFieldsSelector)(filter), {
      onChange: timeSliderOnChange,
      toggleAnimation: _toggleAnimation,
      updateAnimationSpeed: _updateAnimationSpeed,
      setFilterAnimationWindow: _setFilterAnimationWindow,
      hideTimeTitle: showTimeDisplay,
      resetAnimation: resetAnimation,
      isAnimatable: isAnimatable
    })), showTimeDisplay ? /*#__PURE__*/_react["default"].createElement(FloatingTimeDisplay, {
      currentTime: filter.value,
      defaultTimeFormat: filter.defaultTimeFormat,
      timeFormat: filter.timeFormat,
      timezone: filter.timezone
    }) : null);
  };

  return /*#__PURE__*/_react["default"].memo(TimeWidget);
}

var _default = TimeWidgetFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9maWx0ZXJzL3RpbWUtd2lkZ2V0LnRzeCJdLCJuYW1lcyI6WyJUT1BfU0VDVElPTl9IRUlHSFQiLCJUaW1lQm90dG9tV2lkZ2V0SW5uZXIiLCJCb3R0b21XaWRnZXRJbm5lciIsIlRvcFNlY3Rpb25XcmFwcGVyIiwic3R5bGVkIiwiZGl2IiwiYXR0cnMiLCJjbGFzc05hbWUiLCJwcm9wcyIsInRoZW1lIiwibGFiZWxDb2xvciIsImhvdmVyQ29sb3IiLCJ0ZXh0Q29sb3JIbCIsIlN0eWxlZFRpdGxlIiwiQ2VudGVyRmxleGJveCIsInRleHRDb2xvciIsIlRpbWVXaWRnZXRUb3BGYWN0b3J5IiwiZGVwcyIsIkZpZWxkU2VsZWN0b3JGYWN0b3J5IiwiRmllbGRTZWxlY3RvciIsIlRpbWVXaWRnZXRUb3AiLCJmaWx0ZXIiLCJyZWFkT25seSIsImRhdGFzZXRzIiwic2V0RmlsdGVyUGxvdCIsImluZGV4Iiwib25DbG9zZSIsInlBeGlzRmllbGRzIiwiZGF0YUlkIiwiZmllbGRzIiwiZiIsInR5cGUiLCJfc2V0RmlsdGVyUGxvdFlBeGlzIiwidmFsdWUiLCJ5QXhpcyIsIm5hbWUiLCJUaW1lV2lkZ2V0RmFjdG9yeSIsIlRpbWVSYW5nZVNsaWRlckZhY3RvcnkiLCJGbG9hdGluZ1RpbWVEaXNwbGF5RmFjdG9yeSIsIlRpbWVSYW5nZVNsaWRlciIsIkZsb2F0aW5nVGltZURpc3BsYXkiLCJUaW1lV2lkZ2V0Iiwic2hvd1RpbWVEaXNwbGF5Iiwic2V0RmlsdGVyQW5pbWF0aW9uVGltZSIsInJlc2V0QW5pbWF0aW9uIiwiaXNBbmltYXRhYmxlIiwidXBkYXRlQW5pbWF0aW9uU3BlZWQiLCJ0b2dnbGVBbmltYXRpb24iLCJlbmxhcmdlRmlsdGVyIiwic2V0RmlsdGVyQW5pbWF0aW9uV2luZG93IiwiX3VwZGF0ZUFuaW1hdGlvblNwZWVkIiwic3BlZWQiLCJfdG9nZ2xlQW5pbWF0aW9uIiwiX29uQ2xvc2UiLCJfc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93IiwiYW5pbWF0aW9uV2luZG93IiwiaWQiLCJ0aW1lU2xpZGVyT25DaGFuZ2UiLCJkZWZhdWx0VGltZUZvcm1hdCIsInRpbWVGb3JtYXQiLCJ0aW1lem9uZSIsIlJlYWN0IiwibWVtbyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7QUFDQTs7QUFDQTs7QUFNQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7OztBQUdBLElBQU1BLGtCQUFrQixHQUFHLE1BQTNCO0FBRUEsSUFBTUMscUJBQXFCLEdBQUcsa0NBQU9DLG9DQUFQLENBQUgsd0hBQTNCOztBQUdBLElBQU1DLGlCQUFpQixHQUFHQyw2QkFBT0MsR0FBUCxDQUFXQyxLQUFYLENBQWlCO0FBQ3pDQyxFQUFBQSxTQUFTLEVBQUU7QUFEOEIsQ0FBakIsQ0FBSCx5OUJBTVosVUFBQUMsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxVQUFoQjtBQUFBLENBTk8sRUFPWFYsa0JBUFcsRUFxQ04sVUFBQVEsS0FBSztBQUFBLFNBQ1pBLEtBQUssQ0FBQ0csVUFBTixHQUFtQkgsS0FBSyxDQUFDQyxLQUFOLENBQVlELEtBQUssQ0FBQ0csVUFBbEIsQ0FBbkIsR0FBbURILEtBQUssQ0FBQ0MsS0FBTixDQUFZRyxXQURuRDtBQUFBLENBckNDLENBQXZCOztBQW9EQSxJQUFNQyxXQUFXLEdBQUcsa0NBQU9DLGdDQUFQLENBQUgsdVFBRU4sVUFBQU4sS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZTSxTQUFoQjtBQUFBLENBRkMsQ0FBakI7QUFhQUMsb0JBQW9CLENBQUNDLElBQXJCLEdBQTRCLENBQUNDLHlCQUFELENBQTVCOztBQUNPLFNBQVNGLG9CQUFULENBQThCRyxhQUE5QixFQUFzRjtBQUMzRixNQUFNQyxhQUEyQyxHQUFHLFNBQTlDQSxhQUE4QyxPQU85QztBQUFBLFFBTkpDLE1BTUksUUFOSkEsTUFNSTtBQUFBLFFBTEpDLFFBS0ksUUFMSkEsUUFLSTtBQUFBLFFBSkpDLFFBSUksUUFKSkEs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LEtBQWpCLEVBQW9FLENBQzdGVSxzQkFENkYsRUFFN0ZsQixLQUY2RixDQUFwRSxDQUEzQjtBQUtBLHdCQUNFLGdDQUFDLHFCQUFEO0FBQXVCLE1BQUEsU0FBUyxFQUFDO0FBQWpDLG9CQUNFLGdDQUFDLGFBQUQ7QUFDRSxNQUFBLE1BQU0sRUFBRUosTUFEVjtBQUVFLE1BQUEsUUFBUSxFQUFFQyxRQUZaO0FBR0UsTUFBQSxRQUFRLEVBQUVDLFFBSFo7QUFJRSxNQUFBLGFBQWEsRUFBRUMsYUFKakI7QUFLRSxNQUFBLEtBQUssRUFBRUMsS0FMVDtBQU1FLE1BQUEsT0FBTyxFQUFFNEI7QUFOWCxNQURGLGVBU0UsZ0NBQUMsZUFBRCxnQ0FDTSxvREFBOEJoQyxNQUE5QixDQUROO0FBRUUsTUFBQSxRQUFRLEVBQUVvQyxrQkFGWjtBQUdFLE1BQUEsZUFBZSxFQUFFTCxnQkFIbkI7QUFJRSxNQUFBLG9CQUFvQixFQUFFRixxQkFKeEI7QUFLRSxNQUFBLHdCQUF3QixFQUFFSSx5QkFMNUI7QUFNRSxNQUFBLGFBQWEsRUFBRVosZUFOakI7QUFPRSxNQUFBLGNBQWMsRUFBRUUsY0FQbEI7QUFRRSxNQUFBLFlBQVksRUFBRUM7QUFSaEIsT0FURixFQW1CR0gsZUFBZSxnQkFDZCxnQ0FBQyxtQkFBRDtBQUNFLE1BQUEsV0FBVyxFQUFFckIsTUFBTSxDQUFDWSxLQUR0QjtBQUVFLE1BQUEsaUJBQWlCLEVBQUVaLE1BQU0sQ0FBQ3FDLGlCQUY1QjtBQUdFLE1BQUEsVUFBVSxFQUFFckMsTUFBTSxDQUFDc0MsVUFIckI7QUFJRSxNQUFBLFFBQVEsRUFBRXRDLE1BQU0sQ0FBQ3VDO0FBSm5CLE1BRGMsR0FPWixJQTFCTixDQURGO0FBOEJELEdBaEVEOztBQWtFQSxzQkFBT0Msa0JBQU1DLElBQU4sQ0FBV3JCLFVBQVgsQ0FBUDtBQUNEOztlQUVjTCxpQiIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAyMiBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBSZWFjdCwge3VzZUNhbGxiYWNrLCB1c2VNZW1vfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7XG4gIENlbnRlckZsZXhib3gsXG4gIFNlbGVjdFRleHRCb2xkLFxuICBJY29uUm91bmRTbWFsbCxcbiAgQm90dG9tV2lkZ2V0SW5uZXJcbn0gZnJvbSAnLi4vY29tbW9uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7Q2xvc2UsIENsb2NrLCBMaW5lQ2hhcnR9IGZyb20gJy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQgVGltZVJhbmdlU2xpZGVyRmFjdG9yeSBmcm9tICcuLi9jb21tb24vdGltZS1yYW5nZS1zbGlkZXInO1xuaW1wb3J0IEZpZWxkU2VsZWN0b3JGYWN0b3J5IGZyb20gJy4uL2NvbW1vbi9maWVsZC1zZWxlY3Rvcic7XG5pbXBvcnQgRmxvYXRpbmdUaW1lRGlzcGxheUZhY3RvcnkgZnJvbSAnLi4vY29tbW9uL2FuaW1hdGlvbi1jb250cm9sL2Zsb2F0aW5nLXRpbWUtZGlzcGxheSc7XG5pbXBvcnQge0ZpZWxkfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7dGltZVJhbmdlU2xpZGVyRmllbGRzU2VsZWN0b3J9IGZyb20gJy4vdGltZS1yYW5nZS1maWx0ZXInO1xuaW1wb3J0IHtUaW1lV2lkZ2V0UHJvcHMsIFRpbWVXaWRnZXRUb3BQcm9wcywgVG9wU2VjdGlvbldyYXBwZXJQcm9wc30gZnJvbSAnLi90eXBlcyc7XG5cbmNvbnN0IFRPUF9TRUNUSU9OX0hFSUdIVCA9ICczNnB4JztcblxuY29uc3QgVGltZUJvdHRvbVdpZGdldElubmVyID0gc3R5bGVkKEJvdHRvbVdpZGdldElubmVyKWBcbiAgcGFkZGluZzogNnB4IDMycHggMjRweCAzMnB4O1xuYDtcbmNvbnN0IFRvcFNlY3Rpb25XcmFwcGVyID0gc3R5bGVkLmRpdi5hdHRycyh7XG4gIGNsYXNzTmFtZTogJ3RpbWUtd2lkZ2V0LS10b3AnXG59KTxUb3BTZWN0aW9uV3JhcHBlclByb3BzPmBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICB3aWR0aDogMTAwJTtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubGFiZWxDb2xvcn07XG4gIGhlaWdodDogJHtUT1BfU0VDVElPTl9IRUlHSFR9O1xuXG4gIC5ib3R0b20td2lkZ2V0X195LWF4aXMge1xuICAgIGZsZXgtZ3JvdzogMTtcbiAgICBtYXJnaW4tbGVmdDogMjBweDtcbiAgfVxuXG4gIC5ib3R0b20td2lkZ2V0X19maWVsZC1zZWxlY3Qge1xuICAgIHdpZHRoOiAxNjBweDtcbiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG5cbiAgICAuaXRlbS1zZWxlY3Rvcl9fZHJvcGRvd24ge1xuICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gICAgICBwYWRkaW5nOiA0cHggMTBweCA0cHggNHB4O1xuICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudDtcblxuICAgICAgOmFjdGl2ZSxcbiAgICAgIDpmb2N1cyxcbiAgICAgICYuZm9jdXMsXG4gICAgICAmLmFjdGl2ZSB7XG4gICAgICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICAgICAgICBib3JkZXItY29sb3I6IHRyYW5zcGFyZW50O1xuICAgICAgfVxuICAgIH1cblxuICAgIC5pdGVtLXNlbGVjdG9yX19kcm9wZG93bjpob3ZlciB7XG4gICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQ7XG5cbiAgICAgIC5pdGVtLXNlbGVjdG9yX19kcm9wZG93bl9fdmFsdWUge1xuICAgICAgICBjb2xvcjogJHtwcm9wcyA9PlxuICAgICAgICAgIHByb3BzLmhvdmVyQ29sb3IgPyBwcm9wcy50aGVtZVtwcm9wcy5ob3ZlckNvbG9yXSA6IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAuYW5pbWF0aW9uLWNvbnRyb2xfX3NwZWVkLWNvbnRyb2wge1xuICAgIG1hcmdpbi1yaWdodDogLTEycHg7XG5cbiAgICAuYW5pbWF0aW9uLWNvbnRyb2xfX3NwZWVkLXNsaWRlciB7XG4gICAgICByaWdodDogY2FsYygwJSAtIDQ4cHgpO1xuICAgIH1cbiAgfVxuYDtcblxuY29uc3QgU3R5bGVkVGl0bGUgPSBzdHlsZWQoQ2VudGVyRmxleGJveClgXG4gIGZsZXgtZ3JvdzogMDtcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9yfTtcbiAgbWFyZ2luLXJpZ2h0OiAxMHB4O1xuXG4gIC5ib3R0b20td2lkZ2V0X19pY29uIHtcbiAgICBtYXJnaW4tcmlnaHQ6IDZweDtcbiAgfVxuICAuYm90dG9tLXdpZGdldF9faWNvbi5zcGVlZCB7XG4gICAgbWFyZ2luLXJpZ2h0OiAwO1xuICB9XG5gO1xuXG5UaW1lV2lkZ2V0VG9wRmFjdG9yeS5kZXBzID0gW0ZpZWxkU2VsZWN0b3JGYWN0b3J5XTtcbmV4cG9ydCBmdW5jdGlvbiBUaW1lV2lkZ2V0VG9wRmFjdG9yeShGaWVsZFNlbGVjdG9yOiBSZXR1cm5UeXBlPHR5cGVvZiBGaWVsZFNlbGVjdG9yRmFjdG9yeT4pIHtcbiAgY29uc3QgVGltZVdpZGdldFRvcDogUmVhY3QuRkM8VGltZVdpZGdldFRvcFByb3BzPiA9ICh7XG4gICAgZmlsdGVyLFxuICAgIHJlYWRPbmx5LFxuICAgIGRhdGFzZXRzLFxuICAgIHNldEZpbHRlclBsb3QsXG4gICAgaW5kZXgsXG4gICAgb25DbG9zZVxuICB9KSA9PiB7XG4gICAgY29uc3QgeUF4aXNGaWVsZHMgPSB1c2VNZW1vKFxuICAgICAgKCkgPT5cbiAgICAgICAgKChkYXRhc2V0c1tmaWx0ZXIuZGF0YUlkWzBdXSB8fCB7fSkuZmllbGRzIHx8IFtdKS5maWx0ZXIoXG4gICAgICAgICAgKGY6IEZpZWxkKSA9PiBmLnR5cGUgPT09ICdpbnRlZ2VyJyB8fCBmLnR5cGUgPT09ICdyZWFsJ1xuICAgICAgICApLFxuICAgICAgW2RhdGFzZXRzLCBmaWx0ZXIuZGF0YUlkXVxuICAgICk7XG4gICAgY29uc3QgX3NldEZpbHRlclBsb3RZQXhpcyA9IHVzZUNhbGxiYWNrKHZhbHVlID0+IHNldEZpbHRlclBsb3QoaW5kZXgsIHt5QXhpczogdmFsdWV9KSwgW1xuICAgICAgc2V0RmlsdGVyUGxvdCxcbiAgICAgIGluZGV4XG4gICAgXSk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxUb3BTZWN0aW9uV3JhcHBlcj5cbiAgICAgICAgPFN0eWxlZFRpdGxlIGNsYXNzTmFtZT1cImJvdHRvbS13aWRnZXRfX2ZpZWxkXCI+XG4gICAgICAgICAgPENlbnRlckZsZXhib3ggY2xhc3NOYW1lPVwiYm90dG9tLXdpZGdldF9faWNvblwiPlxuICAgICAgICAgICAgPENsb2NrIGhlaWdodD1cIjE1cHhcIiAvPlxuICAgICAgICAgIDwvQ2VudGVyRmxleGJveD5cbiAgICAgICAgICA8U2VsZWN0VGV4dEJvbGQ+e2ZpbHRlci5uYW1lfTwvU2VsZWN0VGV4dEJvbGQ+XG4gICAgICAgIDwvU3R5bGVkVGl0bGU+XG4gICAgICAgIDxTdHlsZWRUaXRsZSBjbGFzc05hbWU9XCJib3R0b20td2lkZ2V0X195LWF4aXNcIj5cbiAgICAgICAgICA8Q2VudGVyRmxleGJveCBjbGFzc05hbWU9XCJib3R0b20td2lkZ2V0X19pY29uXCI+XG4gICAgICAgICAgICA8TGluZUNoYXJ0IGhlaWdodD1cIjE1cHhcIiAvPlxuICAgICAgICAgIDwvQ2VudGVyRmxleGJveD5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJvdHRvbS13aWRnZXRfX2ZpZWxkLXNlbGVjdFwiPlxuICAgICAgICAgICAgPEZpZWxkU2VsZWN0b3JcbiAgICAgICAgICAgICAgZmllbGRzPXt5QXhpc0ZpZWxkc31cbiAgICAgICAgICAgICAgcGxhY2VtZW50PVwidG9wXCJcbiAgICAgICAgICAgICAgdmFsdWU9e2ZpbHRlci55QXhpcyA/IGZpbHRlci55QXhpcy5uYW1lIDogbnVsbH1cbiAgICAgICAgICAgICAgb25TZWxlY3Q9e19zZXRGaWx0ZXJQbG90WUF4aXN9XG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwicGxhY2Vob2xkZXIueUF4aXNcIlxuICAgICAgICAgICAgICBlcmFzYWJsZVxuICAgICAgICAgICAgICBzaG93VG9rZW49e2ZhbHNlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9TdHlsZWRUaXRsZT5cbiAgICAgICAgeyFyZWFkT25seSA/IChcbiAgICAgICAgICA8Q2VudGVyRmxleGJveD5cbiAgICAgICAgICAgIDxJY29uUm91bmRTbWFsbD5cbiAgICAgICAgICAgICAgPENsb3NlIGhlaWdodD1cIjEycHhcIiBvbkNsaWNrPXtvbkNsb3NlfSAvPlxuICAgICAgICAgICAgPC9JY29uUm91bmRTbWFsbD5cbiAgICAgICAgICA8L0NlbnRlckZsZXhib3g+XG4gICAgICAgICkgOiBudWxsfVxuICAgICAgPC9Ub3BTZWN0aW9uV3JhcHBlcj5cbiAgICApO1xuICB9O1xuICByZXR1cm4gVGltZVdpZGdldFRvcDtcbn1cblxuVGltZVdpZGdldEZhY3RvcnkuZGVwcyA9IFtUaW1lUmFuZ2VTbGlkZXJGYWN0b3J5LCBGbG9hdGluZ1RpbWVEaXNwbGF5RmFjdG9yeSwgVGltZVdpZGdldFRvcEZhY3RvcnldO1xuZnVuY3Rpb24gVGltZVdpZGdldEZhY3RvcnkoXG4gIFRpbWVSYW5nZVNsaWRlcjogUmV0dXJuVHlwZTx0eXBlb2YgVGltZVJhbmdlU2xpZGVyRmFjdG9yeT4sXG4gIEZsb2F0aW5nVGltZURpc3BsYXk6IFJldHVyblR5cGU8dHlwZW9mIEZsb2F0aW5nVGltZURpc3BsYXlGYWN0b3J5PixcbiAgVGltZVdpZGdldFRvcDogUmV0dXJuVHlwZTx0eXBlb2YgVGltZVdpZGdldFRvcEZhY3Rvcnk+XG4pIHtcbiAgY29uc3QgVGltZVdpZGdldDogUmVhY3QuRkM8VGltZVdpZGdldFByb3BzPiA9ICh7XG4gICAgZGF0YXNldHMsXG4gICAgZmlsdGVyLFxuICAgIGluZGV4LFxuICAgIHJlYWRPbmx5LFxuICAgIHNob3dUaW1lRGlzcGxheSxcbiAgICBzZXRGaWx0ZXJBbmltYXRpb25UaW1lLFxuICAgIHJlc2V0QW5pbWF0aW9uLFxuICAgIGlzQW5pbWF0YWJsZSxcbiAgICB1cGRhdGVBbmltYXRpb25TcGVlZCxcbiAgICB0b2dnbGVBbmltYXRpb24sXG4gICAgZW5sYXJnZUZpbHRlcixcbiAgICBzZXRGaWx0ZXJQbG90LFxuICAgIHNldEZpbHRlckFuaW1hdGlvbldpbmRvd1xuICB9OiBUaW1lV2lkZ2V0UHJvcHMpID0+IHtcbiAgICBjb25zdCBfdXBkYXRlQW5pbWF0aW9uU3BlZWQgPSB1c2VDYWxsYmFjayhzcGVlZCA9PiB1cGRhdGVBbmltYXRpb25TcGVlZChpbmRleCwgc3BlZWQpLCBbXG4gICAgICB1cGRhdGVBbmltYXRpb25TcGVlZCxcbiAgICAgIGluZGV4XG4gICAgXSk7XG5cbiAgICBjb25zdCBfdG9nZ2xlQW5pbWF0aW9uID0gdXNlQ2FsbGJhY2soKCkgPT4gdG9nZ2xlQW5pbWF0aW9uKGluZGV4KSwgW3RvZ2dsZUFuaW1hdGlvbiwgaW5kZXhdKTtcblxuICAgIGNvbnN0IF9vbkNsb3NlID0gdXNlQ2FsbGJhY2soKCkgPT4gZW5sYXJnZUZpbHRlcihpbmRleCksIFtlbmxhcmdlRmlsdGVyLCBpbmRleF0pO1xuXG4gICAgY29uc3QgX3NldEZpbHRlckFuaW1hdGlvbldpbmRvdyA9IHVzZUNhbGxiYWNrKFxuICAgICAgYW5pbWF0aW9uV2luZG93ID0+IHNldEZpbHRlckFuaW1hdGlvbldpbmRvdyh7aWQ6IGZpbHRlci5pZCwgYW5pbWF0aW9uV2luZG93fSksXG4gICAgICBbc2V0RmlsdGVyQW5pbWF0aW9uV2luZG93LCBmaWx0ZXIuaWRdXG4gICAgKTtcblxuICAgIGNvbnN0IHRpbWVTbGlkZXJPbkNoYW5nZSA9IHVzZUNhbGxiYWNrKHZhbHVlID0+IHNldEZpbHRlckFuaW1hdGlvblRpbWUoaW5kZXgsICd2YWx1ZScsIHZhbHVlKSwgW1xuICAgICAgc2V0RmlsdGVyQW5pbWF0aW9uVGltZSxcbiAgICAgIGluZGV4XG4gICAgXSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRpbWVCb3R0b21XaWRnZXRJbm5lciBjbGFzc05hbWU9XCJib3R0b20td2lkZ2V0LS1pbm5lclwiPlxuICAgICAgICA8VGltZVdpZGdldFRvcFxuICAgICAgICAgIGZpbHRlcj17ZmlsdGVyfVxuICAgICAgICAgIHJlYWRPbmx5PXtyZWFkT25seX1cbiAgICAgICAgICBkYXRhc2V0cz17ZGF0YXNldHN9XG4gICAgICAgICAgc2V0RmlsdGVyUGxvdD17c2V0RmlsdGVyUGxvdH1cbiAgICAgICAgICBpbmRleD17aW5kZXh9XG4gICAgICAgICAgb25DbG9zZT17X29uQ2xvc2V9XG4gICAgICAgIC8+XG4gICAgICAgIDxUaW1lUmFuZ2VTbGlkZXJcbiAgICAgICAgICB7Li4udGltZVJhbmdlU2xpZGVyRmllbGRzU2VsZWN0b3IoZmlsdGVyKX1cbiAgICAgICAgICBvbkNoYW5nZT17dGltZVNsaWRlck9uQ2hhbmdlfVxuICAgICAgICAgIHRvZ2dsZUFuaW1hdGlvbj17X3RvZ2dsZUFuaW1hdGlvbn1cbiAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17X3VwZGF0ZUFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgIHNldEZpbHRlckFuaW1hdGlvbldpbmRvdz17X3NldEZpbHRlckFuaW1hdGlvbldpbmRvd31cbiAgICAgICAgICBoaWRlVGltZVRpdGxlPXtzaG93VGltZURpc3BsYXl9XG4gICAgICAgICAgcmVzZXRBbmltYXRpb249e3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgIGlzQW5pbWF0YWJsZT17aXNBbmltYXRhYmxlfVxuICAgICAgICAvPlxuICAgICAgICB7c2hvd1RpbWVEaXNwbGF5ID8gKFxuICAgICAgICAgIDxGbG9hdGluZ1RpbWVEaXNwbGF5XG4gICAgICAgICAgICBjdXJyZW50VGltZT17ZmlsdGVyLnZhbHVlfVxuICAgICAgICAgICAgZGVmYXVsdFRpbWVGb3JtYXQ9e2ZpbHRlci5kZWZhdWx0VGltZUZvcm1hdH1cbiAgICAgICAgICAgIHRpbWVGb3JtYXQ9e2ZpbHRlci50aW1lRm9ybWF0fVxuICAgICAgICAgICAgdGltZXpvbmU9e2ZpbHRlci50aW1lem9uZX1cbiAgICAgICAgICAvPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgIDwvVGltZUJvdHRvbVdpZGdldElubmVyPlxuICAgICk7XG4gIH07XG5cbiAgcmV0dXJuIFJlYWN0Lm1lbW8oVGltZVdpZGdldCk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRpbWVXaWRnZXRGYWN0b3J5O1xuIl19