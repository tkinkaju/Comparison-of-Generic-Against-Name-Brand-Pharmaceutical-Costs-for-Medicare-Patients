// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PureFeatureActionPanelFactory = PureFeatureActionPanelFactory;
exports["default"] = FeatureActionPanelFactory;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _reactIntl = require("react-intl");

var _actionPanel = _interopRequireWildcard(require("../common/action-panel"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _reactOnclickoutside = _interopRequireDefault(require("react-onclickoutside"));

var _classnames = _interopRequireDefault(require("classnames"));

var _icons = require("../common/icons");

var _copyToClipboard = _interopRequireDefault(require("copy-to-clipboard"));

var _templateObject;

var LAYOVER_OFFSET = 4;

var StyledActionsLayer = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n"])));

PureFeatureActionPanelFactory.deps = [];

function PureFeatureActionPanelFactory() {
  var FeatureActionPanel = function FeatureActionPanel(_ref) {
    var className = _ref.className,
        datasets = _ref.datasets,
        selectedFeature = _ref.selectedFeature,
        position = _ref.position,
        layers = _ref.layers,
        currentFilter = _ref.currentFilter,
        onToggleLayer = _ref.onToggleLayer,
        onDeleteFeature = _ref.onDeleteFeature;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        copied = _useState2[0],
        setCopied = _useState2[1];

    var _ref2 = currentFilter || {},
        _ref2$layerId = _ref2.layerId,
        layerId = _ref2$layerId === void 0 ? [] : _ref2$layerId;

    var intl = (0, _reactIntl.useIntl)();
    var copyGeometry = (0, _react.useCallback)(function () {
      if (selectedFeature !== null && selectedFeature !== void 0 && selectedFeature.geometry) (0, _copyToClipboard["default"])(JSON.stringify(selectedFeature.geometry));
      setCopied(true);
    }, [selectedFeature === null || selectedFeature === void 0 ? void 0 : selectedFeature.geometry]);

    if (!position) {
      return null;
    }

    return /*#__PURE__*/_react["default"].createElement(StyledActionsLayer, {
      className: (0, _classnames["default"])('feature-action-panel', className),
      style: {
        top: "".concat(position.y + LAYOVER_OFFSET, "px"),
        left: "".concat(position.x + LAYOVER_OFFSET, "px")
      }
    }, /*#__PURE__*/_react["default"].createElement(_actionPanel["default"], null, /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      className: "editor-layers-list",
      label: intl.formatMessage({
        id: 'editor.filterLayer',
        defaultMessage: 'Filter layers'
      }),
      Icon: _icons.Layers
    }, layers.map(function (layer, index) {
      return /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
        key: index,
        label: layer.config.label // @ts-ignore
        ,
        color: datasets[layer.config.dataId].color,
        isSelection: true,
        isActive: layerId.includes(layer.id),
        onClick: function onClick() {
          return onToggleLayer(layer);
        },
        className: "layer-panel-item"
      });
    })), /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      label: intl.formatMessage({
        id: 'editor.copyGeometry',
        defaultMessage: 'Copy Geometry'
      }),
      className: "delete-panel-item",
      Icon: copied ? _icons.Checkmark : _icons.Copy,
      onClick: copyGeometry
    }), /*#__PURE__*/_react["default"].createElement(_actionPanel.ActionPanelItem, {
      label: intl.formatMessage({
        id: 'tooltip.delete',
        defaultMessage: 'Delete'
      }),
      className: "delete-panel-item",
      Icon: _icons.Trash,
      onClick: onDeleteFeature
    })));
  };

  FeatureActionPanel.displayName = 'FeatureActionPanel';
  FeatureActionPanel.defaultProps = {
    position: null
  };
  return FeatureActionPanel;
}

FeatureActionPanelFactory.deps = PureFeatureActionPanelFactory.deps;

function FeatureActionPanelFactory() {
  var PureFeatureActionPanel = PureFeatureActionPanelFactory();

  var ClickOutsideFeatureActionPanel = function ClickOutsideFeatureActionPanel(props) {
    // @ts-ignore
    ClickOutsideFeatureActionPanel.handleClickOutside = function (e) {
      var _props$onClose;

      e.preventDefault();
      e.stopPropagation();
      (_props$onClose = props.onClose) === null || _props$onClose === void 0 ? void 0 : _props$onClose.call(props);
    };

    return /*#__PURE__*/_react["default"].createElement(PureFeatureActionPanel, props);
  };

  var clickOutsideConfig = {
    // @ts-ignore
    handleClickOutside: function handleClickOutside() {
      return ClickOutsideFeatureActionPanel.handleClickOutside;
    }
  };
  return (0, _reactOnclickoutside["default"])(ClickOutsideFeatureActionPanel, clickOutsideConfig);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9lZGl0b3IvZmVhdHVyZS1hY3Rpb24tcGFuZWwudHN4Il0sIm5hbWVzIjpbIkxBWU9WRVJfT0ZGU0VUIiwiU3R5bGVkQWN0aW9uc0xheWVyIiwic3R5bGVkIiwiZGl2IiwiUHVyZUZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkiLCJkZXBzIiwiRmVhdHVyZUFjdGlvblBhbmVsIiwiY2xhc3NOYW1lIiwiZGF0YXNldHMiLCJzZWxlY3RlZEZlYXR1cmUiLCJwb3NpdGlvbiIsImxheWVycyIsImN1cnJlbnRGaWx0ZXIiLCJvblRvZ2dsZUxheWVyIiwib25EZWxldGVGZWF0dXJlIiwiY29waWVkIiwic2V0Q29waWVkIiwibGF5ZXJJZCIsImludGwiLCJjb3B5R2VvbWV0cnkiLCJnZW9tZXRyeSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0b3AiLCJ5IiwibGVmdCIsIngiLCJmb3JtYXRNZXNzYWdlIiwiaWQiLCJkZWZhdWx0TWVzc2FnZSIsIkxheWVycyIsIm1hcCIsImxheWVyIiwiaW5kZXgiLCJjb25maWciLCJsYWJlbCIsImRhdGFJZCIsImNvbG9yIiwiaW5jbHVkZXMiLCJDaGVja21hcmsiLCJDb3B5IiwiVHJhc2giLCJkaXNwbGF5TmFtZSIsImRlZmF1bHRQcm9wcyIsIkZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkiLCJQdXJlRmVhdHVyZUFjdGlvblBhbmVsIiwiQ2xpY2tPdXRzaWRlRmVhdHVyZUFjdGlvblBhbmVsIiwicHJvcHMiLCJoYW5kbGVDbGlja091dHNpZGUiLCJlIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJvbkNsb3NlIiwiY2xpY2tPdXRzaWRlQ29uZmlnIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBTUEsSUFBTUEsY0FBYyxHQUFHLENBQXZCOztBQUVBLElBQU1DLGtCQUFrQixHQUFHQyw2QkFBT0Ms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UDtBQUNELEdBUkQ7O0FBVUEsTUFBTU0sa0JBQWtCLEdBQUc7QUFDekI7QUFDQUwsSUFBQUEsa0JBQWtCLEVBQUU7QUFBQSxhQUFNRiw4QkFBOEIsQ0FBQ0Usa0JBQXJDO0FBQUE7QUFGSyxHQUEzQjtBQUtBLFNBQU8scUNBQWVGLDhCQUFmLEVBQStDTyxrQkFBL0MsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDIyIFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0LCB7dXNlQ2FsbGJhY2ssIHVzZVN0YXRlfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge3VzZUludGx9IGZyb20gJ3JlYWN0LWludGwnO1xuXG5pbXBvcnQgQWN0aW9uUGFuZWwsIHtBY3Rpb25QYW5lbEl0ZW19IGZyb20gJy4uL2NvbW1vbi9hY3Rpb24tcGFuZWwnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgb25DbGlja091dHNpZGUgZnJvbSAncmVhY3Qtb25jbGlja291dHNpZGUnO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQge1RyYXNoLCBMYXllcnMsIENvcHksIENoZWNrbWFya30gZnJvbSAnLi4vY29tbW9uL2ljb25zJztcbmltcG9ydCBjb3B5IGZyb20gJ2NvcHktdG8tY2xpcGJvYXJkJztcbmltcG9ydCB7TGF5ZXJ9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7RmlsdGVyfSBmcm9tICdAa2VwbGVyLmdsL3R5cGVzJztcbmltcG9ydCB7RmVhdHVyZX0gZnJvbSAnQG5lYnVsYS5nbC9lZGl0LW1vZGVzJztcbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuXG5jb25zdCBMQVlPVkVSX09GRlNFVCA9IDQ7XG5cbmNvbnN0IFN0eWxlZEFjdGlvbnNMYXllciA9IHN0eWxlZC5kaXZgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbmA7XG5cblB1cmVGZWF0dXJlQWN0aW9uUGFuZWxGYWN0b3J5LmRlcHMgPSBbXTtcblxuZXhwb3J0IGludGVyZmFjZSBGZWF0dXJlQWN0aW9uUGFuZWxQcm9wcyB7XG4gIGNsYXNzTmFtZT86IHN0cmluZztcbiAgZGF0YXNldHM6IERhdGFzZXRzO1xuICBzZWxlY3RlZEZlYXR1cmU6IEZlYXR1cmUgfCBudWxsO1xuICBwb3NpdGlvbjoge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gIH0gfCBudWxsO1xuICBsYXllcnM6IExheWVyW107XG4gIGN1cnJlbnRGaWx0ZXI/OiBGaWx0ZXI7XG4gIG9uVG9nZ2xlTGF5ZXI6IChsOiBMYXllcikgPT4gdm9pZDtcbiAgb25EZWxldGVGZWF0dXJlOiAoKSA9PiB2b2lkO1xuICBvbkNsb3NlOiAoKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gUHVyZUZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkoKTogUmVhY3QuRkM8RmVhdHVyZUFjdGlvblBhbmVsUHJvcHM+IHtcbiAgY29uc3QgRmVhdHVyZUFjdGlvblBhbmVsID0gKHtcbiAgICBjbGFzc05hbWUsXG4gICAgZGF0YXNldHMsXG4gICAgc2VsZWN0ZWRGZWF0dXJlLFxuICAgIHBvc2l0aW9uLFxuICAgIGxheWVycyxcbiAgICBjdXJyZW50RmlsdGVyLFxuICAgIG9uVG9nZ2xlTGF5ZXIsXG4gICAgb25EZWxldGVGZWF0dXJlXG4gIH06IEZlYXR1cmVBY3Rpb25QYW5lbFByb3BzKSA9PiB7XG4gICAgY29uc3QgW2NvcGllZCwgc2V0Q29waWVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCB7bGF5ZXJJZCA9IFtdfSA9IGN1cnJlbnRGaWx0ZXIgfHwge307XG4gICAgY29uc3QgaW50bCA9IHVzZUludGwoKTtcblxuICAgIGNvbnN0IGNvcHlHZW9tZXRyeSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgIGlmIChzZWxlY3RlZEZlYXR1cmU/Lmdlb21ldHJ5KSBjb3B5KEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkRmVhdHVyZS5nZW9tZXRyeSkpO1xuICAgICAgc2V0Q29waWVkKHRydWUpO1xuICAgIH0sIFtzZWxlY3RlZEZlYXR1cmU/Lmdlb21ldHJ5XSk7XG5cbiAgICBpZiAoIXBvc2l0aW9uKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZEFjdGlvbnNMYXllclxuICAgICAgICBjbGFzc05hbWU9e2NsYXNzbmFtZXMoJ2ZlYXR1cmUtYWN0aW9uLXBhbmVsJywgY2xhc3NOYW1lKX1cbiAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICB0b3A6IGAke3Bvc2l0aW9uLnkgKyBMQVlPVkVSX09GRlNFVH1weGAsXG4gICAgICAgICAgbGVmdDogYCR7cG9zaXRpb24ueCArIExBWU9WRVJfT0ZGU0VUfXB4YFxuICAgICAgICB9fVxuICAgICAgPlxuICAgICAgICA8QWN0aW9uUGFuZWw+XG4gICAgICAgICAgPEFjdGlvblBhbmVsSXRlbVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiZWRpdG9yLWxheWVycy1saXN0XCJcbiAgICAgICAgICAgIGxhYmVsPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiAnZWRpdG9yLmZpbHRlckxheWVyJywgZGVmYXVsdE1lc3NhZ2U6ICdGaWx0ZXIgbGF5ZXJzJ30pfVxuICAgICAgICAgICAgSWNvbj17TGF5ZXJzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtsYXllcnMubWFwKChsYXllciwgaW5kZXgpID0+IChcbiAgICAgICAgICAgICAgPEFjdGlvblBhbmVsSXRlbVxuICAgICAgICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgICAgICAgICAgbGFiZWw9e2xheWVyLmNvbmZpZy5sYWJlbH1cbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgY29sb3I9e2RhdGFzZXRzW2xheWVyLmNvbmZpZy5kYXRhSWRdLmNvbG9yfVxuICAgICAgICAgICAgICAgIGlzU2VsZWN0aW9uPXt0cnVlfVxuICAgICAgICAgICAgICAgIGlzQWN0aXZlPXtsYXllcklkLmluY2x1ZGVzKGxheWVyLmlkKX1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBvblRvZ2dsZUxheWVyKGxheWVyKX1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJsYXllci1wYW5lbC1pdGVtXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvQWN0aW9uUGFuZWxJdGVtPlxuICAgICAgICAgIDxBY3Rpb25QYW5lbEl0ZW1cbiAgICAgICAgICAgIGxhYmVsPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiAnZWRpdG9yLmNvcHlHZW9tZXRyeScsIGRlZmF1bHRNZXNzYWdlOiAnQ29weSBHZW9tZXRyeSd9KX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImRlbGV0ZS1wYW5lbC1pdGVtXCJcbiAgICAgICAgICAgIEljb249e2NvcGllZCA/IENoZWNrbWFyayA6IENvcHl9XG4gICAgICAgICAgICBvbkNsaWNrPXtjb3B5R2VvbWV0cnl9XG4gICAgICAgICAgLz5cblxuICAgICAgICAgIDxBY3Rpb25QYW5lbEl0ZW1cbiAgICAgICAgICAgIGxhYmVsPXtpbnRsLmZvcm1hdE1lc3NhZ2Uoe2lkOiAndG9vbHRpcC5kZWxldGUnLCBkZWZhdWx0TWVzc2FnZTogJ0RlbGV0ZSd9KX1cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImRlbGV0ZS1wYW5lbC1pdGVtXCJcbiAgICAgICAgICAgIEljb249e1RyYXNofVxuICAgICAgICAgICAgb25DbGljaz17b25EZWxldGVGZWF0dXJlfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvQWN0aW9uUGFuZWw+XG4gICAgICA8L1N0eWxlZEFjdGlvbnNMYXllcj5cbiAgICApO1xuICB9O1xuXG4gIEZlYXR1cmVBY3Rpb25QYW5lbC5kaXNwbGF5TmFtZSA9ICdGZWF0dXJlQWN0aW9uUGFuZWwnO1xuICBGZWF0dXJlQWN0aW9uUGFuZWwuZGVmYXVsdFByb3BzID0ge1xuICAgIHBvc2l0aW9uOiBudWxsXG4gIH07XG5cbiAgcmV0dXJuIEZlYXR1cmVBY3Rpb25QYW5lbDtcbn1cblxuRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeS5kZXBzID0gUHVyZUZlYXR1cmVBY3Rpb25QYW5lbEZhY3RvcnkuZGVwcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gRmVhdHVyZUFjdGlvblBhbmVsRmFjdG9yeSgpIHtcbiAgY29uc3QgUHVyZUZlYXR1cmVBY3Rpb25QYW5lbCA9IFB1cmVGZWF0dXJlQWN0aW9uUGFuZWxGYWN0b3J5KCk7XG5cbiAgY29uc3QgQ2xpY2tPdXRzaWRlRmVhdHVyZUFjdGlvblBhbmVsOiBSZWFjdC5GQzxGZWF0dXJlQWN0aW9uUGFuZWxQcm9wcz4gPSBwcm9wcyA9PiB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIENsaWNrT3V0c2lkZUZlYXR1cmVBY3Rpb25QYW5lbC5oYW5kbGVDbGlja091dHNpZGUgPSAoZTogRXZlbnQpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBwcm9wcy5vbkNsb3NlPy4oKTtcbiAgICB9O1xuICAgIHJldHVybiA8UHVyZUZlYXR1cmVBY3Rpb25QYW5lbCB7Li4ucHJvcHN9IC8+O1xuICB9O1xuXG4gIGNvbnN0IGNsaWNrT3V0c2lkZUNvbmZpZyA9IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgaGFuZGxlQ2xpY2tPdXRzaWRlOiAoKSA9PiBDbGlja091dHNpZGVGZWF0dXJlQWN0aW9uUGFuZWwuaGFuZGxlQ2xpY2tPdXRzaWRlXG4gIH07XG5cbiAgcmV0dXJuIG9uQ2xpY2tPdXRzaWRlKENsaWNrT3V0c2lkZUZlYXR1cmVBY3Rpb25QYW5lbCwgY2xpY2tPdXRzaWRlQ29uZmlnKTtcbn1cbiJdfQ==