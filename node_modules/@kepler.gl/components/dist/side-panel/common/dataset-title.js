// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = DatasetTitleFactory;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _localization = require("@kepler.gl/localization");

var _layers = require("@kepler.gl/layers");

var _styledComponents2 = require("../../common/styled-components");

var _icons = require("../../common/icons");

var _datasetTag = _interopRequireDefault(require("./dataset-tag"));

var _customPicker = _interopRequireDefault(require("../layer-panel/custom-picker"));

var _ = require("../..");

var _utils = require("@kepler.gl/utils");

var _templateObject, _templateObject2;

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = (0, _getPrototypeOf2["default"])(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = (0, _getPrototypeOf2["default"])(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return (0, _possibleConstructorReturn2["default"])(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }

var StyledDatasetTitle = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  display: flex;\n  align-items: flex-start;\n\n  .source-data-arrow {\n    height: 16px;\n  }\n  :hover {\n    cursor: ", ";\n\n    .dataset-name {\n      color: ", ";\n    }\n\n    .dataset-action {\n      color: ", ";\n      opacity: 1;\n    }\n\n    .dataset-action:hover {\n      color: ", ";\n    }\n  }\n"])), function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.clickable ? 'pointer' : 'auto';
}, function (props) {
  return props.clickable ? props.theme.textColorHl : props.theme.textColor;
}, function (props) {
  return props.theme.textColor;
}, function (props) {
  return props.theme.textColorHl;
});

var DataTagAction = _styledComponents["default"].div(_templateObject2 || (_templateObject2 = (0, _taggedTemplateLiteral2["default"])(["\n  margin-left: 12px;\n  height: 16px;\n  opacity: 0;\n"])));

var ShowDataTable = function ShowDataTable(_ref) {
  var id = _ref.id,
      showDatasetTable = _ref.showDatasetTable;
  return /*#__PURE__*/_react["default"].createElement(DataTagAction, {
    className: "dataset-action show-data-table",
    "data-tip": true,
    "data-for": "data-table-".concat(id)
  }, /*#__PURE__*/_react["default"].createElement(_layers.Table, {
    height: "16px",
    onClick: function onClick(e) {
      e.stopPropagation();
      showDatasetTable === null || showDatasetTable === void 0 ? void 0 : showDatasetTable(id);
    }
  }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.Tooltip, {
    id: "data-table-".concat(id),
    effect: "solid"
  }, /*#__PURE__*/_react["default"].createElement("span", null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: 'datasetTitle.showDataTable'
  }))));
};

var RemoveDataset = function RemoveDataset(_ref2) {
  var datasetKey = _ref2.datasetKey,
      removeDataset = _ref2.removeDataset;
  return /*#__PURE__*/_react["default"].createElement(DataTagAction, {
    className: "dataset-action remove-dataset",
    "data-tip": true,
    "data-for": "delete-".concat(datasetKey)
  }, /*#__PURE__*/_react["default"].createElement(_icons.Trash, {
    height: "16px",
    onClick: function onClick(e) {
      e.stopPropagation();
      removeDataset === null || removeDataset === void 0 ? void 0 : removeDataset(datasetKey);
    }
  }), /*#__PURE__*/_react["default"].createElement(_styledComponents2.Tooltip, {
    id: "delete-".concat(datasetKey),
    effect: "solid",
    type: "error"
  }, /*#__PURE__*/_react["default"].createElement("span", null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
    id: 'datasetTitle.removeDataset'
  }))));
};

DatasetTitleFactory.deps = [_datasetTag["default"]];

function DatasetTitleFactory(DatasetTag) {
  var DatasetTitle = /*#__PURE__*/function (_PureComponent) {
    (0, _inherits2["default"])(DatasetTitle, _PureComponent);

    var _super = _createSuper(DatasetTitle);

    function DatasetTitle() {
      var _this;

      (0, _classCallCheck2["default"])(this, DatasetTitle);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = _super.call.apply(_super, [this].concat(args));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
        displayColorPicker: false
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_handleClick", function () {
        _this.setState({
          displayColorPicker: !_this.state.displayColorPicker
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_handleClosePicker", function () {
        _this.setState({
          displayColorPicker: false
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "root", /*#__PURE__*/(0, _react.createRef)());
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_onClickTitle", function (e) {
        e.stopPropagation();

        if (typeof _this.props.onTitleClick === 'function') {
          _this.props.onTitleClick();
        } else if (typeof _this.props.showDatasetTable === 'function') {
          _this.props.showDatasetTable(_this.props.dataset.id);
        }
      });
      return _this;
    }

    (0, _createClass2["default"])(DatasetTitle, [{
      key: "render",
      value: function render() {
        var _this$props = this.props,
            showDatasetTable = _this$props.showDatasetTable,
            showDeleteDataset = _this$props.showDeleteDataset,
            onTitleClick = _this$props.onTitleClick,
            removeDataset = _this$props.removeDataset,
            dataset = _this$props.dataset,
            updateTableColor = _this$props.updateTableColor;
        return /*#__PURE__*/_react["default"].createElement("div", {
          className: "custom-palette-panel",
          ref: this.root
        }, /*#__PURE__*/_react["default"].createElement(StyledDatasetTitle, {
          className: "source-data-title",
          clickable: Boolean(showDatasetTable || onTitleClick)
        }, /*#__PURE__*/_react["default"].createElement(DatasetTag, {
          dataset: dataset,
          onClick: this._onClickTitle,
          updateTableColor: updateTableColor,
          onClickSquare: this._handleClick
        }), /*#__PURE__*/_react["default"].createElement(_.Portaled, {
          isOpened: this.state.displayColorPicker !== false,
          left: 110,
          top: -50,
          onClose: this._handleClosePicker
        }, /*#__PURE__*/_react["default"].createElement(_customPicker["default"], {
          color: (0, _utils.rgbToHex)(dataset.color),
          onChange: function onChange(color) {
            return updateTableColor(dataset.id, [color.rgb.r, color.rgb.g, color.rgb.b]);
          },
          onSwatchClose: this._handleClosePicker
        })), showDatasetTable ? /*#__PURE__*/_react["default"].createElement(_styledComponents2.CenterFlexbox, {
          className: "source-data-arrow"
        }, /*#__PURE__*/_react["default"].createElement(_icons.ArrowRight, {
          height: "12px"
        })) : null, showDatasetTable ? /*#__PURE__*/_react["default"].createElement(ShowDataTable, {
          id: dataset.id,
          showDatasetTable: showDatasetTable
        }) : null, showDeleteDataset ? /*#__PURE__*/_react["default"].createElement(RemoveDataset, {
          datasetKey: dataset.id,
          removeDataset: removeDataset
        }) : null));
      }
    }]);
    return DatasetTitle;
  }(_react.PureComponent);

  return DatasetTitle;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2NvbW1vbi9kYXRhc2V0LXRpdGxlLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWREYXRhc2V0VGl0bGUiLCJzdHlsZWQiLCJkaXYiLCJwcm9wcyIsInRoZW1lIiwidGV4dENvbG9yIiwiY2xpY2thYmxlIiwidGV4dENvbG9ySGwiLCJEYXRhVGFnQWN0aW9uIiwiU2hvd0RhdGFUYWJsZSIsImlkIiwic2hvd0RhdGFzZXRUYWJsZSIsImUiLCJzdG9wUHJvcGFnYXRpb24iLCJSZW1vdmVEYXRhc2V0IiwiZGF0YXNldEtleSIsInJlbW92ZURhdGFzZXQiLCJEYXRhc2V0VGl0bGVGYWN0b3J5IiwiZGVwcyIsIkRhdGFzZXRUYWdGYWN0b3J5IiwiRGF0YXNldFRhZyIsIkRhdGFzZXRUaXRsZSIsImRpc3BsYXlDb2xvclBpY2tlciIsInNldFN0YXRlIiwic3RhdGUiLCJvblRpdGxlQ2xpY2siLCJkYXRhc2V0Iiwic2hvd0RlbGV0ZURhdGFzZXQiLCJ1cGRhdGVUYWJsZUNvbG9yIiwicm9vdCIsIkJvb2xlYW4iLCJfb25DbGlja1RpdGxlIiwiX2hhbmRsZUNsaWNrIiwiX2hhbmRsZUNsb3NlUGlja2VyIiwiY29sb3IiLCJyZ2IiLCJyIiwiZyIsImIiLCJQdXJlQ29tcG9uZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBUUEsSUFBTUEsa0JBQWtCLEdBQUdDLDZCQUFPQyxHQUFWLGdhQUNiLFVBQUFDLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsU0FBaEI7QUFBQSxDQURRLEVBU1YsVUFBQUYsS0FBSztBQUFBLFNBQUtBLEtBQUssQ0FBQ0csU0FBTixHQUFrQixTQUFsQixHQUE4QixNQUFuQztBQUFBLENBVEssRUFZVCxVQUFBSCxLQUFLO0FBQUEsU0FB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QUVFLFVBQUEsSUFBSSxFQUFFLEdBRlI7QUFHRSxVQUFBLEdBQUcsRUFBRSxDQUFDLEVBSFI7QUFJRSxVQUFBLE9BQU8sRUFBRSxLQUFLVztBQUpoQix3QkFNRSxnQ0FBQyx3QkFBRDtBQUNFLFVBQUEsS0FBSyxFQUFFLHFCQUFTUCxPQUFPLENBQUNRLEtBQWpCLENBRFQ7QUFFRSxVQUFBLFFBQVEsRUFBRSxrQkFBQ0EsS0FBRDtBQUFBLG1CQUNSTixnQkFBZ0IsQ0FBQ0YsT0FBTyxDQUFDaEIsRUFBVCxFQUFhLENBQUN3QixLQUFLLENBQUNDLEdBQU4sQ0FBVUMsQ0FBWCxFQUFjRixLQUFLLENBQUNDLEdBQU4sQ0FBVUUsQ0FBeEIsRUFBMkJILEtBQUssQ0FBQ0MsR0FBTixDQUFVRyxDQUFyQyxDQUFiLENBRFI7QUFBQSxXQUZaO0FBS0UsVUFBQSxhQUFhLEVBQUUsS0FBS0w7QUFMdEIsVUFORixDQVZGLEVBd0JHdEIsZ0JBQWdCLGdCQUNmLGdDQUFDLGdDQUFEO0FBQWUsVUFBQSxTQUFTLEVBQUM7QUFBekIsd0JBQ0UsZ0NBQUMsaUJBQUQ7QUFBWSxVQUFBLE1BQU0sRUFBQztBQUFuQixVQURGLENBRGUsR0FJYixJQTVCTixFQTZCR0EsZ0JBQWdCLGdCQUNmLGdDQUFDLGFBQUQ7QUFBZSxVQUFBLEVBQUUsRUFBRWUsT0FBTyxDQUFDaEIsRUFBM0I7QUFBK0IsVUFBQSxnQkFBZ0IsRUFBRUM7QUFBakQsVUFEZSxHQUViLElBL0JOLEVBZ0NHZ0IsaUJBQWlCLGdCQUNoQixnQ0FBQyxhQUFEO0FBQWUsVUFBQSxVQUFVLEVBQUVELE9BQU8sQ0FBQ2hCLEVBQW5DO0FBQXVDLFVBQUEsYUFBYSxFQUFFTTtBQUF0RCxVQURnQixHQUVkLElBbENOLENBREYsQ0FERjtBQXdDRDtBQTNFcUM7QUFBQTtBQUFBLElBQ2J1QixvQkFEYTs7QUE4RXhDLFNBQU9sQixZQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjIgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QsIHtjcmVhdGVSZWYsIE1vdXNlRXZlbnQsIFB1cmVDb21wb25lbnR9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBzdHlsZWQgZnJvbSAnc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5cbmltcG9ydCB7VGFibGV9IGZyb20gJ0BrZXBsZXIuZ2wvbGF5ZXJzJztcbmltcG9ydCB7Q2VudGVyRmxleGJveCwgVG9vbHRpcH0gZnJvbSAnLi4vLi4vY29tbW9uL3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7QXJyb3dSaWdodCwgVHJhc2h9IGZyb20gJy4uLy4uL2NvbW1vbi9pY29ucyc7XG5pbXBvcnQgRGF0YXNldFRhZ0ZhY3RvcnkgZnJvbSAnLi9kYXRhc2V0LXRhZyc7XG5pbXBvcnQgQ3VzdG9tUGlja2VyIGZyb20gJy4uL2xheWVyLXBhbmVsL2N1c3RvbS1waWNrZXInO1xuaW1wb3J0IHtQb3J0YWxlZH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHtyZ2JUb0hleH0gZnJvbSAnQGtlcGxlci5nbC91dGlscyc7XG5pbXBvcnQge1xuICBTdHlsZWREYXRhc2V0VGl0bGVQcm9wcyxcbiAgRGF0YXNldFRpdGxlUHJvcHMsXG4gIFJlbW92ZURhdGFzZXRQcm9wcyxcbiAgU2hvd0RhdGFUYWJsZVByb3BzXG59IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBTdHlsZWREYXRhc2V0VGl0bGUgPSBzdHlsZWQuZGl2PFN0eWxlZERhdGFzZXRUaXRsZVByb3BzPmBcbiAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9yfTtcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGZsZXgtc3RhcnQ7XG5cbiAgLnNvdXJjZS1kYXRhLWFycm93IHtcbiAgICBoZWlnaHQ6IDE2cHg7XG4gIH1cbiAgOmhvdmVyIHtcbiAgICBjdXJzb3I6ICR7cHJvcHMgPT4gKHByb3BzLmNsaWNrYWJsZSA/ICdwb2ludGVyJyA6ICdhdXRvJyl9O1xuXG4gICAgLmRhdGFzZXQtbmFtZSB7XG4gICAgICBjb2xvcjogJHtwcm9wcyA9PiAocHJvcHMuY2xpY2thYmxlID8gcHJvcHMudGhlbWUudGV4dENvbG9ySGwgOiBwcm9wcy50aGVtZS50ZXh0Q29sb3IpfTtcbiAgICB9XG5cbiAgICAuZGF0YXNldC1hY3Rpb24ge1xuICAgICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUudGV4dENvbG9yfTtcbiAgICAgIG9wYWNpdHk6IDE7XG4gICAgfVxuXG4gICAgLmRhdGFzZXQtYWN0aW9uOmhvdmVyIHtcbiAgICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgICB9XG4gIH1cbmA7XG5cbmNvbnN0IERhdGFUYWdBY3Rpb24gPSBzdHlsZWQuZGl2YFxuICBtYXJnaW4tbGVmdDogMTJweDtcbiAgaGVpZ2h0OiAxNnB4O1xuICBvcGFjaXR5OiAwO1xuYDtcblxuY29uc3QgU2hvd0RhdGFUYWJsZSA9ICh7aWQsIHNob3dEYXRhc2V0VGFibGV9OiBTaG93RGF0YVRhYmxlUHJvcHMpID0+IChcbiAgPERhdGFUYWdBY3Rpb24gY2xhc3NOYW1lPVwiZGF0YXNldC1hY3Rpb24gc2hvdy1kYXRhLXRhYmxlXCIgZGF0YS10aXAgZGF0YS1mb3I9e2BkYXRhLXRhYmxlLSR7aWR9YH0+XG4gICAgPFRhYmxlXG4gICAgICBoZWlnaHQ9XCIxNnB4XCJcbiAgICAgIG9uQ2xpY2s9e2UgPT4ge1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBzaG93RGF0YXNldFRhYmxlPy4oaWQpO1xuICAgICAgfX1cbiAgICAvPlxuICAgIDxUb29sdGlwIGlkPXtgZGF0YS10YWJsZS0ke2lkfWB9IGVmZmVjdD1cInNvbGlkXCI+XG4gICAgICA8c3Bhbj5cbiAgICAgICAgPEZvcm1hdHRlZE1lc3NhZ2UgaWQ9eydkYXRhc2V0VGl0bGUuc2hvd0RhdGFUYWJsZSd9IC8+XG4gICAgICA8L3NwYW4+XG4gICAgPC9Ub29sdGlwPlxuICA8L0RhdGFUYWdBY3Rpb24+XG4pO1xuXG5jb25zdCBSZW1vdmVEYXRhc2V0ID0gKHtkYXRhc2V0S2V5LCByZW1vdmVEYXRhc2V0fTogUmVtb3ZlRGF0YXNldFByb3BzKSA9PiAoXG4gIDxEYXRhVGFnQWN0aW9uXG4gICAgY2xhc3NOYW1lPVwiZGF0YXNldC1hY3Rpb24gcmVtb3ZlLWRhdGFzZXRcIlxuICAgIGRhdGEtdGlwXG4gICAgZGF0YS1mb3I9e2BkZWxldGUtJHtkYXRhc2V0S2V5fWB9XG4gID5cbiAgICA8VHJhc2hcbiAgICAgIGhlaWdodD1cIjE2cHhcIlxuICAgICAgb25DbGljaz17ZSA9PiB7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIHJlbW92ZURhdGFzZXQ/LihkYXRhc2V0S2V5KTtcbiAgICAgIH19XG4gICAgLz5cbiAgICA8VG9vbHRpcCBpZD17YGRlbGV0ZS0ke2RhdGFzZXRLZXl9YH0gZWZmZWN0PVwic29saWRcIiB0eXBlPVwiZXJyb3JcIj5cbiAgICAgIDxzcGFuPlxuICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD17J2RhdGFzZXRUaXRsZS5yZW1vdmVEYXRhc2V0J30gLz5cbiAgICAgIDwvc3Bhbj5cbiAgICA8L1Rvb2x0aXA+XG4gIDwvRGF0YVRhZ0FjdGlvbj5cbik7XG5cbkRhdGFzZXRUaXRsZUZhY3RvcnkuZGVwcyA9IFtEYXRhc2V0VGFnRmFjdG9yeV07XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIERhdGFzZXRUaXRsZUZhY3RvcnkoXG4gIERhdGFzZXRUYWc6IFJldHVyblR5cGU8dHlwZW9mIERhdGFzZXRUYWdGYWN0b3J5PlxuKTogUmVhY3QuQ29tcG9uZW50VHlwZTxEYXRhc2V0VGl0bGVQcm9wcz4ge1xuICBjbGFzcyBEYXRhc2V0VGl0bGUgZXh0ZW5kcyBQdXJlQ29tcG9uZW50PERhdGFzZXRUaXRsZVByb3BzPiB7XG4gICAgc3RhdGUgPSB7XG4gICAgICBkaXNwbGF5Q29sb3JQaWNrZXI6IGZhbHNlXG4gICAgfTtcblxuICAgIF9oYW5kbGVDbGljayA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe2Rpc3BsYXlDb2xvclBpY2tlcjogIXRoaXMuc3RhdGUuZGlzcGxheUNvbG9yUGlja2VyfSk7XG4gICAgfTtcblxuICAgIF9oYW5kbGVDbG9zZVBpY2tlciA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe2Rpc3BsYXlDb2xvclBpY2tlcjogZmFsc2V9KTtcbiAgICB9O1xuXG4gICAgcm9vdCA9IGNyZWF0ZVJlZjxIVE1MRGl2RWxlbWVudD4oKTtcblxuICAgIF9vbkNsaWNrVGl0bGUgPSAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5wcm9wcy5vblRpdGxlQ2xpY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vblRpdGxlQ2xpY2soKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMucHJvcHMuc2hvd0RhdGFzZXRUYWJsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aGlzLnByb3BzLnNob3dEYXRhc2V0VGFibGUodGhpcy5wcm9wcy5kYXRhc2V0LmlkKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVuZGVyKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBzaG93RGF0YXNldFRhYmxlLFxuICAgICAgICBzaG93RGVsZXRlRGF0YXNldCxcbiAgICAgICAgb25UaXRsZUNsaWNrLFxuICAgICAgICByZW1vdmVEYXRhc2V0LFxuICAgICAgICBkYXRhc2V0LFxuICAgICAgICB1cGRhdGVUYWJsZUNvbG9yXG4gICAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjdXN0b20tcGFsZXR0ZS1wYW5lbFwiIHJlZj17dGhpcy5yb290fT5cbiAgICAgICAgICA8U3R5bGVkRGF0YXNldFRpdGxlXG4gICAgICAgICAgICBjbGFzc05hbWU9XCJzb3VyY2UtZGF0YS10aXRsZVwiXG4gICAgICAgICAgICBjbGlja2FibGU9e0Jvb2xlYW4oc2hvd0RhdGFzZXRUYWJsZSB8fCBvblRpdGxlQ2xpY2spfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxEYXRhc2V0VGFnXG4gICAgICAgICAgICAgIGRhdGFzZXQ9e2RhdGFzZXR9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX29uQ2xpY2tUaXRsZX1cbiAgICAgICAgICAgICAgdXBkYXRlVGFibGVDb2xvcj17dXBkYXRlVGFibGVDb2xvcn1cbiAgICAgICAgICAgICAgb25DbGlja1NxdWFyZT17dGhpcy5faGFuZGxlQ2xpY2t9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPFBvcnRhbGVkXG4gICAgICAgICAgICAgIGlzT3BlbmVkPXt0aGlzLnN0YXRlLmRpc3BsYXlDb2xvclBpY2tlciAhPT0gZmFsc2V9XG4gICAgICAgICAgICAgIGxlZnQ9ezExMH1cbiAgICAgICAgICAgICAgdG9wPXstNTB9XG4gICAgICAgICAgICAgIG9uQ2xvc2U9e3RoaXMuX2hhbmRsZUNsb3NlUGlja2VyfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8Q3VzdG9tUGlja2VyXG4gICAgICAgICAgICAgICAgY29sb3I9e3JnYlRvSGV4KGRhdGFzZXQuY29sb3IpfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoY29sb3I6IHtyZ2I6IFJlY29yZDxzdHJpbmcsIG51bWJlcj59KSA9PlxuICAgICAgICAgICAgICAgICAgdXBkYXRlVGFibGVDb2xvcihkYXRhc2V0LmlkLCBbY29sb3IucmdiLnIsIGNvbG9yLnJnYi5nLCBjb2xvci5yZ2IuYl0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG9uU3dhdGNoQ2xvc2U9e3RoaXMuX2hhbmRsZUNsb3NlUGlja2VyfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Qb3J0YWxlZD5cbiAgICAgICAgICAgIHtzaG93RGF0YXNldFRhYmxlID8gKFxuICAgICAgICAgICAgICA8Q2VudGVyRmxleGJveCBjbGFzc05hbWU9XCJzb3VyY2UtZGF0YS1hcnJvd1wiPlxuICAgICAgICAgICAgICAgIDxBcnJvd1JpZ2h0IGhlaWdodD1cIjEycHhcIiAvPlxuICAgICAgICAgICAgICA8L0NlbnRlckZsZXhib3g+XG4gICAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgICAgIHtzaG93RGF0YXNldFRhYmxlID8gKFxuICAgICAgICAgICAgICA8U2hvd0RhdGFUYWJsZSBpZD17ZGF0YXNldC5pZH0gc2hvd0RhdGFzZXRUYWJsZT17c2hvd0RhdGFzZXRUYWJsZX0gLz5cbiAgICAgICAgICAgICkgOiBudWxsfVxuICAgICAgICAgICAge3Nob3dEZWxldGVEYXRhc2V0ID8gKFxuICAgICAgICAgICAgICA8UmVtb3ZlRGF0YXNldCBkYXRhc2V0S2V5PXtkYXRhc2V0LmlkfSByZW1vdmVEYXRhc2V0PXtyZW1vdmVEYXRhc2V0fSAvPlxuICAgICAgICAgICAgKSA6IG51bGx9XG4gICAgICAgICAgPC9TdHlsZWREYXRhc2V0VGl0bGU+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gRGF0YXNldFRpdGxlO1xufVxuIl19