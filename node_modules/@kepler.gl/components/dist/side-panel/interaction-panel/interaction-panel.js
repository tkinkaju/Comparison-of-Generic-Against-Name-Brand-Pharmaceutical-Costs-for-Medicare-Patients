// Copyright (c) 2022 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _switch = _interopRequireDefault(require("../../common/switch"));

var _brushConfig = _interopRequireDefault(require("./brush-config"));

var _tooltipConfig = _interopRequireDefault(require("./tooltip-config"));

var _styledComponents2 = require("../../common/styled-components");

var _icons = require("../../common/icons");

var _localization = require("@kepler.gl/localization");

var _templateObject;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var StyledInteractionPanel = _styledComponents["default"].div(_templateObject || (_templateObject = (0, _taggedTemplateLiteral2["default"])(["\n  padding-bottom: 6px;\n"])));

InteractionPanelFactory.deps = [_tooltipConfig["default"], _brushConfig["default"]];
var INTERACTION_CONFIG_ICONS = {
  tooltip: _icons.Messages,
  geocoder: _icons.Pin,
  brush: _icons.Crosshairs,
  coordinate: _icons.CursorClick
};

function InteractionPanelFactory(TooltipConfig, BrushConfig) {
  var InteractionPanel = function InteractionPanel(_ref) {
    var config = _ref.config,
        onConfigChange = _ref.onConfigChange,
        datasets = _ref.datasets,
        _ref$interactionConfi = _ref.interactionConfigIcons,
        interactionConfigIcons = _ref$interactionConfi === void 0 ? INTERACTION_CONFIG_ICONS : _ref$interactionConfi;

    var _useState = (0, _react.useState)(false),
        _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
        isConfigActive = _useState2[0],
        setIsConfigAction = _useState2[1];

    var _updateConfig = (0, _react.useCallback)(function (newProp) {
      onConfigChange(_objectSpread(_objectSpread({}, config), newProp));
    }, [onConfigChange, config]);

    var togglePanelActive = (0, _react.useCallback)(function () {
      setIsConfigAction(!isConfigActive);
    }, [setIsConfigAction, isConfigActive]);
    var enabled = config.enabled;
    var toggleEnableConfig = (0, _react.useCallback)(function () {
      _updateConfig({
        enabled: !enabled
      });
    }, [_updateConfig, enabled]);
    var onChange = (0, _react.useCallback)(function (newConfig) {
      return _updateConfig({
        config: newConfig
      });
    }, [_updateConfig]);
    var IconComponent = interactionConfigIcons[config.id];
    var template = null;

    switch (config.id) {
      case 'tooltip':
        template = /*#__PURE__*/_react["default"].createElement(TooltipConfig, {
          datasets: datasets,
          config: config.config,
          onChange: onChange
        });
        break;

      case 'brush':
        template = /*#__PURE__*/_react["default"].createElement(BrushConfig, {
          config: config.config,
          onChange: onChange
        });
        break;

      default:
        break;
    }

    return /*#__PURE__*/_react["default"].createElement(StyledInteractionPanel, {
      className: "interaction-panel"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.StyledPanelHeader, {
      className: "interaction-panel__header",
      onClick: togglePanelActive
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelHeaderContent, {
      className: "interaction-panel__header__content"
    }, /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__icon icon"
    }, IconComponent ? /*#__PURE__*/_react["default"].createElement(IconComponent, {
      height: "16px"
    }) : null), /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__title"
    }, /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelHeaderTitle, null, /*#__PURE__*/_react["default"].createElement(_localization.FormattedMessage, {
      id: config.label
    })))), /*#__PURE__*/_react["default"].createElement("div", {
      className: "interaction-panel__header__actions"
    }, /*#__PURE__*/_react["default"].createElement(_switch["default"], {
      checked: config.enabled,
      id: "".concat(config.id, "-toggle"),
      onChange: toggleEnableConfig,
      secondary: true
    }))), config.enabled && template && /*#__PURE__*/_react["default"].createElement(_styledComponents2.PanelContent, {
      className: "interaction-panel__content"
    }, template));
  };

  return InteractionPanel;
}

var _default = InteractionPanelFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9zaWRlLXBhbmVsL2ludGVyYWN0aW9uLXBhbmVsL2ludGVyYWN0aW9uLXBhbmVsLnRzeCJdLCJuYW1lcyI6WyJTdHlsZWRJbnRlcmFjdGlvblBhbmVsIiwic3R5bGVkIiwiZGl2IiwiSW50ZXJhY3Rpb25QYW5lbEZhY3RvcnkiLCJkZXBzIiwiVG9vbHRpcENvbmZpZ0ZhY3RvcnkiLCJCcnVzaENvbmZpZ0ZhY3RvcnkiLCJJTlRFUkFDVElPTl9DT05GSUdfSUNPTlMiLCJ0b29sdGlwIiwiTWVzc2FnZXMiLCJnZW9jb2RlciIsIlBpbiIsImJydXNoIiwiQ3Jvc3NoYWlycyIsImNvb3JkaW5hdGUiLCJDdXJzb3JDbGljayIsIlRvb2x0aXBDb25maWciLCJCcnVzaENvbmZpZyIsIkludGVyYWN0aW9uUGFuZWwiLCJjb25maWciLCJvbkNvbmZpZ0NoYW5nZSIsImRhdGFzZXRzIiwiaW50ZXJhY3Rpb25Db25maWdJY29ucyIsImlzQ29uZmlnQWN0aXZlIiwic2V0SXNDb25maWdBY3Rpb24iLCJfdXBkYXRlQ29uZmlnIiwibmV3UHJvcCIsInRvZ2dsZVBhbmVsQWN0aXZlIiwiZW5hYmxlZCIsInRvZ2dsZUVuYWJsZUNvbmZpZyIsIm9uQ2hhbmdlIiwibmV3Q29uZmlnIiwiSWNvbkNvbXBvbmVudCIsImlkIiwidGVtcGxhdGUiLCJsYWJlbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBSUE7O0FBTUE7O0FBRUE7Ozs7Ozs7O0FBV0EsSUFBTUEsc0JBQXNCLEdBQUdDLDZCQUFPQyxHQUFWLGdIQUE1Qjs7QUFJQUMsdUJBQXVCLENBQUNDLElBQXhCLEdBQStCLENBQUNDLHlCQUFELEVBQXVCQyx1QkFBdkIsQ0FBL0I7QUFFQSxJQUFNQyx3QkFBNEQsR0FBRztBQUNuRUMsRUFBQUEsT0FBTyxFQUFFQyxlQUQwRDtBQUVuRUMsRUFBQUEsUUFBUSxFQUFFQyxVQUZ5RDtBQUduRUMs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QWYsb0JBQ0UsZ0NBQUMsa0JBQUQ7QUFDRSxNQUFBLE9BQU8sRUFBRWhCLE1BQU0sQ0FBQ1MsT0FEbEI7QUFFRSxNQUFBLEVBQUUsWUFBS1QsTUFBTSxDQUFDYyxFQUFaLFlBRko7QUFHRSxNQUFBLFFBQVEsRUFBRUosa0JBSFo7QUFJRSxNQUFBLFNBQVM7QUFKWCxNQURGLENBWEYsQ0FERixFQXFCR1YsTUFBTSxDQUFDUyxPQUFQLElBQWtCTSxRQUFsQixpQkFDQyxnQ0FBQywrQkFBRDtBQUFjLE1BQUEsU0FBUyxFQUFDO0FBQXhCLE9BQXNEQSxRQUF0RCxDQXRCSixDQURGO0FBMkJELEdBdEVEOztBQXdFQSxTQUFPaEIsZ0JBQVA7QUFDRDs7ZUFFY2YsdUIiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMjIgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QsIHt1c2VTdGF0ZSwgQ29tcG9uZW50VHlwZSwgUmVhY3RFbGVtZW50LCB1c2VDYWxsYmFja30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgU3dpdGNoIGZyb20gJy4uLy4uL2NvbW1vbi9zd2l0Y2gnO1xuXG5pbXBvcnQgQnJ1c2hDb25maWdGYWN0b3J5IGZyb20gJy4vYnJ1c2gtY29uZmlnJztcbmltcG9ydCBUb29sdGlwQ29uZmlnRmFjdG9yeSBmcm9tICcuL3Rvb2x0aXAtY29uZmlnJztcbmltcG9ydCB7RGF0YXNldHN9IGZyb20gJ0BrZXBsZXIuZ2wvdGFibGUnO1xuaW1wb3J0IHtJbnRlcmFjdGlvbkNvbmZpZywgVmFsdWVPZn0gZnJvbSAnQGtlcGxlci5nbC90eXBlcyc7XG5cbmltcG9ydCB7XG4gIFN0eWxlZFBhbmVsSGVhZGVyLFxuICBQYW5lbEhlYWRlclRpdGxlLFxuICBQYW5lbEhlYWRlckNvbnRlbnQsXG4gIFBhbmVsQ29udGVudFxufSBmcm9tICcuLi8uLi9jb21tb24vc3R5bGVkLWNvbXBvbmVudHMnO1xuaW1wb3J0IHtNZXNzYWdlcywgQ3Jvc3NoYWlycywgQ3Vyc29yQ2xpY2ssIFBpbn0gZnJvbSAnLi4vLi4vY29tbW9uL2ljb25zJztcblxuaW1wb3J0IHtGb3JtYXR0ZWRNZXNzYWdlfSBmcm9tICdAa2VwbGVyLmdsL2xvY2FsaXphdGlvbic7XG5cbmludGVyZmFjZSBJbnRlcmFjdGlvblBhbmVsUHJvcHMge1xuICBkYXRhc2V0czogRGF0YXNldHM7XG4gIGNvbmZpZzogVmFsdWVPZjxJbnRlcmFjdGlvbkNvbmZpZz47XG4gIG9uQ29uZmlnQ2hhbmdlOiBhbnk7XG4gIGludGVyYWN0aW9uQ29uZmlnSWNvbnM/OiB7XG4gICAgW2tleTogc3RyaW5nXTogUmVhY3QuRWxlbWVudFR5cGU7XG4gIH07XG59XG5cbmNvbnN0IFN0eWxlZEludGVyYWN0aW9uUGFuZWwgPSBzdHlsZWQuZGl2YFxuICBwYWRkaW5nLWJvdHRvbTogNnB4O1xuYDtcblxuSW50ZXJhY3Rpb25QYW5lbEZhY3RvcnkuZGVwcyA9IFtUb29sdGlwQ29uZmlnRmFjdG9yeSwgQnJ1c2hDb25maWdGYWN0b3J5XTtcblxuY29uc3QgSU5URVJBQ1RJT05fQ09ORklHX0lDT05TOiB7W2tleTogc3RyaW5nXTogUmVhY3QuRWxlbWVudFR5cGV9ID0ge1xuICB0b29sdGlwOiBNZXNzYWdlcyxcbiAgZ2VvY29kZXI6IFBpbixcbiAgYnJ1c2g6IENyb3NzaGFpcnMsXG4gIGNvb3JkaW5hdGU6IEN1cnNvckNsaWNrXG59O1xuXG5mdW5jdGlvbiBJbnRlcmFjdGlvblBhbmVsRmFjdG9yeShcbiAgVG9vbHRpcENvbmZpZzogUmV0dXJuVHlwZTx0eXBlb2YgVG9vbHRpcENvbmZpZ0ZhY3Rvcnk+LFxuICBCcnVzaENvbmZpZzogUmV0dXJuVHlwZTx0eXBlb2YgQnJ1c2hDb25maWdGYWN0b3J5PlxuKTogQ29tcG9uZW50VHlwZTxJbnRlcmFjdGlvblBhbmVsUHJvcHM+IHtcbiAgY29uc3QgSW50ZXJhY3Rpb25QYW5lbDogUmVhY3QuRkM8SW50ZXJhY3Rpb25QYW5lbFByb3BzPiA9ICh7XG4gICAgY29uZmlnLFxuICAgIG9uQ29uZmlnQ2hhbmdlLFxuICAgIGRhdGFzZXRzLFxuICAgIGludGVyYWN0aW9uQ29uZmlnSWNvbnMgPSBJTlRFUkFDVElPTl9DT05GSUdfSUNPTlNcbiAgfSkgPT4ge1xuICAgIGNvbnN0IFtpc0NvbmZpZ0FjdGl2ZSwgc2V0SXNDb25maWdBY3Rpb25dID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gICAgY29uc3QgX3VwZGF0ZUNvbmZpZyA9IHVzZUNhbGxiYWNrKFxuICAgICAgbmV3UHJvcCA9PiB7XG4gICAgICAgIG9uQ29uZmlnQ2hhbmdlKHtcbiAgICAgICAgICAuLi5jb25maWcsXG4gICAgICAgICAgLi4ubmV3UHJvcFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBbb25Db25maWdDaGFuZ2UsIGNvbmZpZ11cbiAgICApO1xuXG4gICAgY29uc3QgdG9nZ2xlUGFuZWxBY3RpdmUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBzZXRJc0NvbmZpZ0FjdGlvbighaXNDb25maWdBY3RpdmUpO1xuICAgIH0sIFtzZXRJc0NvbmZpZ0FjdGlvbiwgaXNDb25maWdBY3RpdmVdKTtcblxuICAgIGNvbnN0IHtlbmFibGVkfSA9IGNvbmZpZztcbiAgICBjb25zdCB0b2dnbGVFbmFibGVDb25maWcgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICBfdXBkYXRlQ29uZmlnKHtlbmFibGVkOiAhZW5hYmxlZH0pO1xuICAgIH0sIFtfdXBkYXRlQ29uZmlnLCBlbmFibGVkXSk7XG5cbiAgICBjb25zdCBvbkNoYW5nZSA9IHVzZUNhbGxiYWNrKG5ld0NvbmZpZyA9PiBfdXBkYXRlQ29uZmlnKHtjb25maWc6IG5ld0NvbmZpZ30pLCBbX3VwZGF0ZUNvbmZpZ10pO1xuICAgIGNvbnN0IEljb25Db21wb25lbnQgPSBpbnRlcmFjdGlvbkNvbmZpZ0ljb25zW2NvbmZpZy5pZF07XG5cbiAgICBsZXQgdGVtcGxhdGU6IFJlYWN0RWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG4gICAgc3dpdGNoIChjb25maWcuaWQpIHtcbiAgICAgIGNhc2UgJ3Rvb2x0aXAnOlxuICAgICAgICB0ZW1wbGF0ZSA9IDxUb29sdGlwQ29uZmlnIGRhdGFzZXRzPXtkYXRhc2V0c30gY29uZmlnPXtjb25maWcuY29uZmlnfSBvbkNoYW5nZT17b25DaGFuZ2V9IC8+O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2JydXNoJzpcbiAgICAgICAgdGVtcGxhdGUgPSA8QnJ1c2hDb25maWcgY29uZmlnPXtjb25maWcuY29uZmlnfSBvbkNoYW5nZT17b25DaGFuZ2V9IC8+O1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICA8U3R5bGVkSW50ZXJhY3Rpb25QYW5lbCBjbGFzc05hbWU9XCJpbnRlcmFjdGlvbi1wYW5lbFwiPlxuICAgICAgICA8U3R5bGVkUGFuZWxIZWFkZXIgY2xhc3NOYW1lPVwiaW50ZXJhY3Rpb24tcGFuZWxfX2hlYWRlclwiIG9uQ2xpY2s9e3RvZ2dsZVBhbmVsQWN0aXZlfT5cbiAgICAgICAgICA8UGFuZWxIZWFkZXJDb250ZW50IGNsYXNzTmFtZT1cImludGVyYWN0aW9uLXBhbmVsX19oZWFkZXJfX2NvbnRlbnRcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW50ZXJhY3Rpb24tcGFuZWxfX2hlYWRlcl9faWNvbiBpY29uXCI+XG4gICAgICAgICAgICAgIHtJY29uQ29tcG9uZW50ID8gPEljb25Db21wb25lbnQgaGVpZ2h0PVwiMTZweFwiIC8+IDogbnVsbH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJpbnRlcmFjdGlvbi1wYW5lbF9faGVhZGVyX190aXRsZVwiPlxuICAgICAgICAgICAgICA8UGFuZWxIZWFkZXJUaXRsZT5cbiAgICAgICAgICAgICAgICA8Rm9ybWF0dGVkTWVzc2FnZSBpZD17Y29uZmlnLmxhYmVsfSAvPlxuICAgICAgICAgICAgICA8L1BhbmVsSGVhZGVyVGl0bGU+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L1BhbmVsSGVhZGVyQ29udGVudD5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImludGVyYWN0aW9uLXBhbmVsX19oZWFkZXJfX2FjdGlvbnNcIj5cbiAgICAgICAgICAgIDxTd2l0Y2hcbiAgICAgICAgICAgICAgY2hlY2tlZD17Y29uZmlnLmVuYWJsZWR9XG4gICAgICAgICAgICAgIGlkPXtgJHtjb25maWcuaWR9LXRvZ2dsZWB9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXt0b2dnbGVFbmFibGVDb25maWd9XG4gICAgICAgICAgICAgIHNlY29uZGFyeVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9TdHlsZWRQYW5lbEhlYWRlcj5cbiAgICAgICAge2NvbmZpZy5lbmFibGVkICYmIHRlbXBsYXRlICYmIChcbiAgICAgICAgICA8UGFuZWxDb250ZW50IGNsYXNzTmFtZT1cImludGVyYWN0aW9uLXBhbmVsX19jb250ZW50XCI+e3RlbXBsYXRlfTwvUGFuZWxDb250ZW50PlxuICAgICAgICApfVxuICAgICAgPC9TdHlsZWRJbnRlcmFjdGlvblBhbmVsPlxuICAgICk7XG4gIH07XG5cbiAgcmV0dXJuIEludGVyYWN0aW9uUGFuZWw7XG59XG5cbmV4cG9ydCBkZWZhdWx0IEludGVyYWN0aW9uUGFuZWxGYWN0b3J5O1xuIl19